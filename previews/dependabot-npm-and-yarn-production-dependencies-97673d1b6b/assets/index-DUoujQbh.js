(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const X of document.querySelectorAll('link[rel="modulepreload"]'))A(X);new MutationObserver(X=>{for(const ie of X)if(ie.type==="childList")for(const z of ie.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&A(z)}).observe(document,{childList:!0,subtree:!0});function N(X){const ie={};return X.integrity&&(ie.integrity=X.integrity),X.referrerPolicy&&(ie.referrerPolicy=X.referrerPolicy),X.crossOrigin==="use-credentials"?ie.credentials="include":X.crossOrigin==="anonymous"?ie.credentials="omit":ie.credentials="same-origin",ie}function A(X){if(X.ep)return;X.ep=!0;const ie=N(X);fetch(X.href,ie)}})();function km(re){return re&&re.__esModule&&Object.prototype.hasOwnProperty.call(re,"default")?re.default:re}var Yf={exports:{}},jp={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lm;function Lm(){if(lm)return jp;lm=1;var re=Symbol.for("react.transitional.element"),C=Symbol.for("react.fragment");function N(A,X,ie){var z=null;if(ie!==void 0&&(z=""+ie),X.key!==void 0&&(z=""+X.key),"key"in X){ie={};for(var u in X)u!=="key"&&(ie[u]=X[u])}else ie=X;return X=ie.ref,{$$typeof:re,type:A,key:z,ref:X!==void 0?X:null,props:ie}}return jp.Fragment=C,jp.jsx=N,jp.jsxs=N,jp}var cm;function jm(){return cm||(cm=1,Yf.exports=Lm()),Yf.exports}var D=jm(),Kf={exports:{}},Op={},Qf={exports:{}},Jf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var um;function Om(){return um||(um=1,(function(re){function C(He,gt){var Ot=He.length;He.push(gt);e:for(;0<Ot;){var At=Ot-1>>>1,mi=He[At];if(0<X(mi,gt))He[At]=gt,He[Ot]=mi,Ot=At;else break e}}function N(He){return He.length===0?null:He[0]}function A(He){if(He.length===0)return null;var gt=He[0],Ot=He.pop();if(Ot!==gt){He[0]=Ot;e:for(var At=0,mi=He.length,be=mi>>>1;At<be;){var Ye=2*(At+1)-1,yt=He[Ye],kt=Ye+1,Ht=He[kt];if(0>X(yt,Ot))kt<mi&&0>X(Ht,yt)?(He[At]=Ht,He[kt]=Ot,At=kt):(He[At]=yt,He[Ye]=Ot,At=Ye);else if(kt<mi&&0>X(Ht,Ot))He[At]=Ht,He[kt]=Ot,At=kt;else break e}}return gt}function X(He,gt){var Ot=He.sortIndex-gt.sortIndex;return Ot!==0?Ot:He.id-gt.id}if(re.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var ie=performance;re.unstable_now=function(){return ie.now()}}else{var z=Date,u=z.now();re.unstable_now=function(){return z.now()-u}}var W=[],te=[],xe=1,De=null,we=3,Ee=!1,Qe=!1,ve=!1,St=!1,wt=typeof setTimeout=="function"?setTimeout:null,jt=typeof clearTimeout=="function"?clearTimeout:null,$t=typeof setImmediate<"u"?setImmediate:null;function Fi(He){for(var gt=N(te);gt!==null;){if(gt.callback===null)A(te);else if(gt.startTime<=He)A(te),gt.sortIndex=gt.expirationTime,C(W,gt);else break;gt=N(te)}}function Rt(He){if(ve=!1,Fi(He),!Qe)if(N(W)!==null)Qe=!0,vt||(vt=!0,Ci());else{var gt=N(te);gt!==null&&qi(Rt,gt.startTime-He)}}var vt=!1,Ft=-1,wi=5,Ui=-1;function Ri(){return St?!0:!(re.unstable_now()-Ui<wi)}function Yi(){if(St=!1,vt){var He=re.unstable_now();Ui=He;var gt=!0;try{e:{Qe=!1,ve&&(ve=!1,jt(Ft),Ft=-1),Ee=!0;var Ot=we;try{t:{for(Fi(He),De=N(W);De!==null&&!(De.expirationTime>He&&Ri());){var At=De.callback;if(typeof At=="function"){De.callback=null,we=De.priorityLevel;var mi=At(De.expirationTime<=He);if(He=re.unstable_now(),typeof mi=="function"){De.callback=mi,Fi(He),gt=!0;break t}De===N(W)&&A(W),Fi(He)}else A(W);De=N(W)}if(De!==null)gt=!0;else{var be=N(te);be!==null&&qi(Rt,be.startTime-He),gt=!1}}break e}finally{De=null,we=Ot,Ee=!1}gt=void 0}}finally{gt?Ci():vt=!1}}}var Ci;if(typeof $t=="function")Ci=function(){$t(Yi)};else if(typeof MessageChannel<"u"){var Vt=new MessageChannel,Kt=Vt.port2;Vt.port1.onmessage=Yi,Ci=function(){Kt.postMessage(null)}}else Ci=function(){wt(Yi,0)};function qi(He,gt){Ft=wt(function(){He(re.unstable_now())},gt)}re.unstable_IdlePriority=5,re.unstable_ImmediatePriority=1,re.unstable_LowPriority=4,re.unstable_NormalPriority=3,re.unstable_Profiling=null,re.unstable_UserBlockingPriority=2,re.unstable_cancelCallback=function(He){He.callback=null},re.unstable_forceFrameRate=function(He){0>He||125<He?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):wi=0<He?Math.floor(1e3/He):5},re.unstable_getCurrentPriorityLevel=function(){return we},re.unstable_next=function(He){switch(we){case 1:case 2:case 3:var gt=3;break;default:gt=we}var Ot=we;we=gt;try{return He()}finally{we=Ot}},re.unstable_requestPaint=function(){St=!0},re.unstable_runWithPriority=function(He,gt){switch(He){case 1:case 2:case 3:case 4:case 5:break;default:He=3}var Ot=we;we=He;try{return gt()}finally{we=Ot}},re.unstable_scheduleCallback=function(He,gt,Ot){var At=re.unstable_now();switch(typeof Ot=="object"&&Ot!==null?(Ot=Ot.delay,Ot=typeof Ot=="number"&&0<Ot?At+Ot:At):Ot=At,He){case 1:var mi=-1;break;case 2:mi=250;break;case 5:mi=1073741823;break;case 4:mi=1e4;break;default:mi=5e3}return mi=Ot+mi,He={id:xe++,callback:gt,priorityLevel:He,startTime:Ot,expirationTime:mi,sortIndex:-1},Ot>At?(He.sortIndex=Ot,C(te,He),N(W)===null&&He===N(te)&&(ve?(jt(Ft),Ft=-1):ve=!0,qi(Rt,Ot-At))):(He.sortIndex=mi,C(W,He),Qe||Ee||(Qe=!0,vt||(vt=!0,Ci()))),He},re.unstable_shouldYield=Ri,re.unstable_wrapCallback=function(He){var gt=we;return function(){var Ot=we;we=gt;try{return He.apply(this,arguments)}finally{we=Ot}}}})(Jf)),Jf}var hm;function Bm(){return hm||(hm=1,Qf.exports=Om()),Qf.exports}var em={exports:{}},xi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dm;function Nm(){if(dm)return xi;dm=1;var re=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),ie=Symbol.for("react.consumer"),z=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),te=Symbol.for("react.memo"),xe=Symbol.for("react.lazy"),De=Symbol.for("react.activity"),we=Symbol.iterator;function Ee(be){return be===null||typeof be!="object"?null:(be=we&&be[we]||be["@@iterator"],typeof be=="function"?be:null)}var Qe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ve=Object.assign,St={};function wt(be,Ye,yt){this.props=be,this.context=Ye,this.refs=St,this.updater=yt||Qe}wt.prototype.isReactComponent={},wt.prototype.setState=function(be,Ye){if(typeof be!="object"&&typeof be!="function"&&be!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,be,Ye,"setState")},wt.prototype.forceUpdate=function(be){this.updater.enqueueForceUpdate(this,be,"forceUpdate")};function jt(){}jt.prototype=wt.prototype;function $t(be,Ye,yt){this.props=be,this.context=Ye,this.refs=St,this.updater=yt||Qe}var Fi=$t.prototype=new jt;Fi.constructor=$t,ve(Fi,wt.prototype),Fi.isPureReactComponent=!0;var Rt=Array.isArray;function vt(){}var Ft={H:null,A:null,T:null,S:null},wi=Object.prototype.hasOwnProperty;function Ui(be,Ye,yt){var kt=yt.ref;return{$$typeof:re,type:be,key:Ye,ref:kt!==void 0?kt:null,props:yt}}function Ri(be,Ye){return Ui(be.type,Ye,be.props)}function Yi(be){return typeof be=="object"&&be!==null&&be.$$typeof===re}function Ci(be){var Ye={"=":"=0",":":"=2"};return"$"+be.replace(/[=:]/g,function(yt){return Ye[yt]})}var Vt=/\/+/g;function Kt(be,Ye){return typeof be=="object"&&be!==null&&be.key!=null?Ci(""+be.key):Ye.toString(36)}function qi(be){switch(be.status){case"fulfilled":return be.value;case"rejected":throw be.reason;default:switch(typeof be.status=="string"?be.then(vt,vt):(be.status="pending",be.then(function(Ye){be.status==="pending"&&(be.status="fulfilled",be.value=Ye)},function(Ye){be.status==="pending"&&(be.status="rejected",be.reason=Ye)})),be.status){case"fulfilled":return be.value;case"rejected":throw be.reason}}throw be}function He(be,Ye,yt,kt,Ht){var Gt=typeof be;(Gt==="undefined"||Gt==="boolean")&&(be=null);var ei=!1;if(be===null)ei=!0;else switch(Gt){case"bigint":case"string":case"number":ei=!0;break;case"object":switch(be.$$typeof){case re:case C:ei=!0;break;case xe:return ei=be._init,He(ei(be._payload),Ye,yt,kt,Ht)}}if(ei)return Ht=Ht(be),ei=kt===""?"."+Kt(be,0):kt,Rt(Ht)?(yt="",ei!=null&&(yt=ei.replace(Vt,"$&/")+"/"),He(Ht,Ye,yt,"",function(Cn){return Cn})):Ht!=null&&(Yi(Ht)&&(Ht=Ri(Ht,yt+(Ht.key==null||be&&be.key===Ht.key?"":(""+Ht.key).replace(Vt,"$&/")+"/")+ei)),Ye.push(Ht)),1;ei=0;var $i=kt===""?".":kt+":";if(Rt(be))for(var vi=0;vi<be.length;vi++)kt=be[vi],Gt=$i+Kt(kt,vi),ei+=He(kt,Ye,yt,Gt,Ht);else if(vi=Ee(be),typeof vi=="function")for(be=vi.call(be),vi=0;!(kt=be.next()).done;)kt=kt.value,Gt=$i+Kt(kt,vi++),ei+=He(kt,Ye,yt,Gt,Ht);else if(Gt==="object"){if(typeof be.then=="function")return He(qi(be),Ye,yt,kt,Ht);throw Ye=String(be),Error("Objects are not valid as a React child (found: "+(Ye==="[object Object]"?"object with keys {"+Object.keys(be).join(", ")+"}":Ye)+"). If you meant to render a collection of children, use an array instead.")}return ei}function gt(be,Ye,yt){if(be==null)return be;var kt=[],Ht=0;return He(be,kt,"","",function(Gt){return Ye.call(yt,Gt,Ht++)}),kt}function Ot(be){if(be._status===-1){var Ye=be._result;Ye=Ye(),Ye.then(function(yt){(be._status===0||be._status===-1)&&(be._status=1,be._result=yt)},function(yt){(be._status===0||be._status===-1)&&(be._status=2,be._result=yt)}),be._status===-1&&(be._status=0,be._result=Ye)}if(be._status===1)return be._result.default;throw be._result}var At=typeof reportError=="function"?reportError:function(be){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ye=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof be=="object"&&be!==null&&typeof be.message=="string"?String(be.message):String(be),error:be});if(!window.dispatchEvent(Ye))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",be);return}console.error(be)},mi={map:gt,forEach:function(be,Ye,yt){gt(be,function(){Ye.apply(this,arguments)},yt)},count:function(be){var Ye=0;return gt(be,function(){Ye++}),Ye},toArray:function(be){return gt(be,function(Ye){return Ye})||[]},only:function(be){if(!Yi(be))throw Error("React.Children.only expected to receive a single React element child.");return be}};return xi.Activity=De,xi.Children=mi,xi.Component=wt,xi.Fragment=N,xi.Profiler=X,xi.PureComponent=$t,xi.StrictMode=A,xi.Suspense=W,xi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ft,xi.__COMPILER_RUNTIME={__proto__:null,c:function(be){return Ft.H.useMemoCache(be)}},xi.cache=function(be){return function(){return be.apply(null,arguments)}},xi.cacheSignal=function(){return null},xi.cloneElement=function(be,Ye,yt){if(be==null)throw Error("The argument must be a React element, but you passed "+be+".");var kt=ve({},be.props),Ht=be.key;if(Ye!=null)for(Gt in Ye.key!==void 0&&(Ht=""+Ye.key),Ye)!wi.call(Ye,Gt)||Gt==="key"||Gt==="__self"||Gt==="__source"||Gt==="ref"&&Ye.ref===void 0||(kt[Gt]=Ye[Gt]);var Gt=arguments.length-2;if(Gt===1)kt.children=yt;else if(1<Gt){for(var ei=Array(Gt),$i=0;$i<Gt;$i++)ei[$i]=arguments[$i+2];kt.children=ei}return Ui(be.type,Ht,kt)},xi.createContext=function(be){return be={$$typeof:z,_currentValue:be,_currentValue2:be,_threadCount:0,Provider:null,Consumer:null},be.Provider=be,be.Consumer={$$typeof:ie,_context:be},be},xi.createElement=function(be,Ye,yt){var kt,Ht={},Gt=null;if(Ye!=null)for(kt in Ye.key!==void 0&&(Gt=""+Ye.key),Ye)wi.call(Ye,kt)&&kt!=="key"&&kt!=="__self"&&kt!=="__source"&&(Ht[kt]=Ye[kt]);var ei=arguments.length-2;if(ei===1)Ht.children=yt;else if(1<ei){for(var $i=Array(ei),vi=0;vi<ei;vi++)$i[vi]=arguments[vi+2];Ht.children=$i}if(be&&be.defaultProps)for(kt in ei=be.defaultProps,ei)Ht[kt]===void 0&&(Ht[kt]=ei[kt]);return Ui(be,Gt,Ht)},xi.createRef=function(){return{current:null}},xi.forwardRef=function(be){return{$$typeof:u,render:be}},xi.isValidElement=Yi,xi.lazy=function(be){return{$$typeof:xe,_payload:{_status:-1,_result:be},_init:Ot}},xi.memo=function(be,Ye){return{$$typeof:te,type:be,compare:Ye===void 0?null:Ye}},xi.startTransition=function(be){var Ye=Ft.T,yt={};Ft.T=yt;try{var kt=be(),Ht=Ft.S;Ht!==null&&Ht(yt,kt),typeof kt=="object"&&kt!==null&&typeof kt.then=="function"&&kt.then(vt,At)}catch(Gt){At(Gt)}finally{Ye!==null&&yt.types!==null&&(Ye.types=yt.types),Ft.T=Ye}},xi.unstable_useCacheRefresh=function(){return Ft.H.useCacheRefresh()},xi.use=function(be){return Ft.H.use(be)},xi.useActionState=function(be,Ye,yt){return Ft.H.useActionState(be,Ye,yt)},xi.useCallback=function(be,Ye){return Ft.H.useCallback(be,Ye)},xi.useContext=function(be){return Ft.H.useContext(be)},xi.useDebugValue=function(){},xi.useDeferredValue=function(be,Ye){return Ft.H.useDeferredValue(be,Ye)},xi.useEffect=function(be,Ye){return Ft.H.useEffect(be,Ye)},xi.useEffectEvent=function(be){return Ft.H.useEffectEvent(be)},xi.useId=function(){return Ft.H.useId()},xi.useImperativeHandle=function(be,Ye,yt){return Ft.H.useImperativeHandle(be,Ye,yt)},xi.useInsertionEffect=function(be,Ye){return Ft.H.useInsertionEffect(be,Ye)},xi.useLayoutEffect=function(be,Ye){return Ft.H.useLayoutEffect(be,Ye)},xi.useMemo=function(be,Ye){return Ft.H.useMemo(be,Ye)},xi.useOptimistic=function(be,Ye){return Ft.H.useOptimistic(be,Ye)},xi.useReducer=function(be,Ye,yt){return Ft.H.useReducer(be,Ye,yt)},xi.useRef=function(be){return Ft.H.useRef(be)},xi.useState=function(be){return Ft.H.useState(be)},xi.useSyncExternalStore=function(be,Ye,yt){return Ft.H.useSyncExternalStore(be,Ye,yt)},xi.useTransition=function(){return Ft.H.useTransition()},xi.version="19.2.0",xi}var pm;function am(){return pm||(pm=1,em.exports=Nm()),em.exports}var tm={exports:{}},Ia={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fm;function Fm(){if(fm)return Ia;fm=1;var re=am();function C(W){var te="https://react.dev/errors/"+W;if(1<arguments.length){te+="?args[]="+encodeURIComponent(arguments[1]);for(var xe=2;xe<arguments.length;xe++)te+="&args[]="+encodeURIComponent(arguments[xe])}return"Minified React error #"+W+"; visit "+te+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function N(){}var A={d:{f:N,r:function(){throw Error(C(522))},D:N,C:N,L:N,m:N,X:N,S:N,M:N},p:0,findDOMNode:null},X=Symbol.for("react.portal");function ie(W,te,xe){var De=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:X,key:De==null?null:""+De,children:W,containerInfo:te,implementation:xe}}var z=re.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(W,te){if(W==="font")return"";if(typeof te=="string")return te==="use-credentials"?te:""}return Ia.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,Ia.createPortal=function(W,te){var xe=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!te||te.nodeType!==1&&te.nodeType!==9&&te.nodeType!==11)throw Error(C(299));return ie(W,te,null,xe)},Ia.flushSync=function(W){var te=z.T,xe=A.p;try{if(z.T=null,A.p=2,W)return W()}finally{z.T=te,A.p=xe,A.d.f()}},Ia.preconnect=function(W,te){typeof W=="string"&&(te?(te=te.crossOrigin,te=typeof te=="string"?te==="use-credentials"?te:"":void 0):te=null,A.d.C(W,te))},Ia.prefetchDNS=function(W){typeof W=="string"&&A.d.D(W)},Ia.preinit=function(W,te){if(typeof W=="string"&&te&&typeof te.as=="string"){var xe=te.as,De=u(xe,te.crossOrigin),we=typeof te.integrity=="string"?te.integrity:void 0,Ee=typeof te.fetchPriority=="string"?te.fetchPriority:void 0;xe==="style"?A.d.S(W,typeof te.precedence=="string"?te.precedence:void 0,{crossOrigin:De,integrity:we,fetchPriority:Ee}):xe==="script"&&A.d.X(W,{crossOrigin:De,integrity:we,fetchPriority:Ee,nonce:typeof te.nonce=="string"?te.nonce:void 0})}},Ia.preinitModule=function(W,te){if(typeof W=="string")if(typeof te=="object"&&te!==null){if(te.as==null||te.as==="script"){var xe=u(te.as,te.crossOrigin);A.d.M(W,{crossOrigin:xe,integrity:typeof te.integrity=="string"?te.integrity:void 0,nonce:typeof te.nonce=="string"?te.nonce:void 0})}}else te==null&&A.d.M(W)},Ia.preload=function(W,te){if(typeof W=="string"&&typeof te=="object"&&te!==null&&typeof te.as=="string"){var xe=te.as,De=u(xe,te.crossOrigin);A.d.L(W,xe,{crossOrigin:De,integrity:typeof te.integrity=="string"?te.integrity:void 0,nonce:typeof te.nonce=="string"?te.nonce:void 0,type:typeof te.type=="string"?te.type:void 0,fetchPriority:typeof te.fetchPriority=="string"?te.fetchPriority:void 0,referrerPolicy:typeof te.referrerPolicy=="string"?te.referrerPolicy:void 0,imageSrcSet:typeof te.imageSrcSet=="string"?te.imageSrcSet:void 0,imageSizes:typeof te.imageSizes=="string"?te.imageSizes:void 0,media:typeof te.media=="string"?te.media:void 0})}},Ia.preloadModule=function(W,te){if(typeof W=="string")if(te){var xe=u(te.as,te.crossOrigin);A.d.m(W,{as:typeof te.as=="string"&&te.as!=="script"?te.as:void 0,crossOrigin:xe,integrity:typeof te.integrity=="string"?te.integrity:void 0})}else A.d.m(W)},Ia.requestFormReset=function(W){A.d.r(W)},Ia.unstable_batchedUpdates=function(W,te){return W(te)},Ia.useFormState=function(W,te,xe){return z.H.useFormState(W,te,xe)},Ia.useFormStatus=function(){return z.H.useHostTransitionStatus()},Ia.version="19.2.0",Ia}var mm;function Um(){if(mm)return tm.exports;mm=1;function re(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(re)}catch(C){console.error(C)}}return re(),tm.exports=Fm(),tm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gm;function $m(){if(gm)return Op;gm=1;var re=Bm(),C=am(),N=Um();function A(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function X(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function ie(i){var s=i,c=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(c=s.return),i=s.return;while(i)}return s.tag===3?c:null}function z(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function u(i){if(i.tag===31){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function W(i){if(ie(i)!==i)throw Error(A(188))}function te(i){var s=i.alternate;if(!s){if(s=ie(i),s===null)throw Error(A(188));return s!==i?null:i}for(var c=i,f=s;;){var b=c.return;if(b===null)break;var T=b.alternate;if(T===null){if(f=b.return,f!==null){c=f;continue}break}if(b.child===T.child){for(T=b.child;T;){if(T===c)return W(b),i;if(T===f)return W(b),s;T=T.sibling}throw Error(A(188))}if(c.return!==f.return)c=b,f=T;else{for(var j=!1,H=b.child;H;){if(H===c){j=!0,c=b,f=T;break}if(H===f){j=!0,f=b,c=T;break}H=H.sibling}if(!j){for(H=T.child;H;){if(H===c){j=!0,c=T,f=b;break}if(H===f){j=!0,f=T,c=b;break}H=H.sibling}if(!j)throw Error(A(189))}}if(c.alternate!==f)throw Error(A(190))}if(c.tag!==3)throw Error(A(188));return c.stateNode.current===c?i:s}function xe(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=xe(i),s!==null)return s;i=i.sibling}return null}var De=Object.assign,we=Symbol.for("react.element"),Ee=Symbol.for("react.transitional.element"),Qe=Symbol.for("react.portal"),ve=Symbol.for("react.fragment"),St=Symbol.for("react.strict_mode"),wt=Symbol.for("react.profiler"),jt=Symbol.for("react.consumer"),$t=Symbol.for("react.context"),Fi=Symbol.for("react.forward_ref"),Rt=Symbol.for("react.suspense"),vt=Symbol.for("react.suspense_list"),Ft=Symbol.for("react.memo"),wi=Symbol.for("react.lazy"),Ui=Symbol.for("react.activity"),Ri=Symbol.for("react.memo_cache_sentinel"),Yi=Symbol.iterator;function Ci(i){return i===null||typeof i!="object"?null:(i=Yi&&i[Yi]||i["@@iterator"],typeof i=="function"?i:null)}var Vt=Symbol.for("react.client.reference");function Kt(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===Vt?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ve:return"Fragment";case wt:return"Profiler";case St:return"StrictMode";case Rt:return"Suspense";case vt:return"SuspenseList";case Ui:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case Qe:return"Portal";case $t:return i.displayName||"Context";case jt:return(i._context.displayName||"Context")+".Consumer";case Fi:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Ft:return s=i.displayName||null,s!==null?s:Kt(i.type)||"Memo";case wi:s=i._payload,i=i._init;try{return Kt(i(s))}catch{}}return null}var qi=Array.isArray,He=C.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,gt=N.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ot={pending:!1,data:null,method:null,action:null},At=[],mi=-1;function be(i){return{current:i}}function Ye(i){0>mi||(i.current=At[mi],At[mi]=null,mi--)}function yt(i,s){mi++,At[mi]=i.current,i.current=s}var kt=be(null),Ht=be(null),Gt=be(null),ei=be(null);function $i(i,s){switch(yt(Gt,s),yt(Ht,i),yt(kt,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?kp(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=kp(s),i=nl(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}Ye(kt),yt(kt,i)}function vi(){Ye(kt),Ye(Ht),Ye(Gt)}function Cn(i){i.memoizedState!==null&&yt(ei,i);var s=kt.current,c=nl(s,i.type);s!==c&&(yt(Ht,i),yt(kt,c))}function _n(i){Ht.current===i&&(Ye(kt),Ye(Ht)),ei.current===i&&(Ye(ei),Ue._currentValue=Ot)}var Tr,En;function zi(i){if(Tr===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Tr=s&&s[1]||"",En=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Tr+i+En}var Bi=!1;function cn(i,s){if(!i||Bi)return"";Bi=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(s){var rt=function(){throw Error()};if(Object.defineProperty(rt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(rt,[])}catch(qe){var $e=qe}Reflect.construct(i,[],rt)}else{try{rt.call()}catch(qe){$e=qe}i.call(rt.prototype)}}else{try{throw Error()}catch(qe){$e=qe}(rt=i())&&typeof rt.catch=="function"&&rt.catch(function(){})}}catch(qe){if(qe&&$e&&typeof qe.stack=="string")return[qe.stack,$e.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=f.DetermineComponentFrameRoot(),j=T[0],H=T[1];if(j&&H){var ye=j.split(`
`),Fe=H.split(`
`);for(b=f=0;f<ye.length&&!ye[f].includes("DetermineComponentFrameRoot");)f++;for(;b<Fe.length&&!Fe[b].includes("DetermineComponentFrameRoot");)b++;if(f===ye.length||b===Fe.length)for(f=ye.length-1,b=Fe.length-1;1<=f&&0<=b&&ye[f]!==Fe[b];)b--;for(;1<=f&&0<=b;f--,b--)if(ye[f]!==Fe[b]){if(f!==1||b!==1)do if(f--,b--,0>b||ye[f]!==Fe[b]){var Je=`
`+ye[f].replace(" at new "," at ");return i.displayName&&Je.includes("<anonymous>")&&(Je=Je.replace("<anonymous>",i.displayName)),Je}while(1<=f&&0<=b);break}}}finally{Bi=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?zi(c):""}function Pa(i,s){switch(i.tag){case 26:case 27:case 5:return zi(i.type);case 16:return zi("Lazy");case 13:return i.child!==s&&s!==null?zi("Suspense Fallback"):zi("Suspense");case 19:return zi("SuspenseList");case 0:case 15:return cn(i.type,!1);case 11:return cn(i.type.render,!1);case 1:return cn(i.type,!0);case 31:return zi("Activity");default:return""}}function Ei(i){try{var s="",c=null;do s+=Pa(i,c),c=i,i=i.return;while(i);return s}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var An=Object.prototype.hasOwnProperty,Fn=re.unstable_scheduleCallback,Hr=re.unstable_cancelCallback,Qn=re.unstable_shouldYield,un=re.unstable_requestPaint,dr=re.unstable_now,fa=re.unstable_getCurrentPriorityLevel,rn=re.unstable_ImmediatePriority,st=re.unstable_UserBlockingPriority,Pt=re.unstable_NormalPriority,Et=re.unstable_LowPriority,ne=re.unstable_IdlePriority,O=re.log,F=re.unstable_setDisableYieldValue,G=null,ee=null;function le(i){if(typeof O=="function"&&F(i),ee&&typeof ee.setStrictMode=="function")try{ee.setStrictMode(G,i)}catch{}}var fe=Math.clz32?Math.clz32:Ae,Pe=Math.log,Se=Math.LN2;function Ae(i){return i>>>=0,i===0?32:31-(Pe(i)/Se|0)|0}var Ge=256,Ve=262144,ct=4194304;function _e(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function qt(i,s,c){var f=i.pendingLanes;if(f===0)return 0;var b=0,T=i.suspendedLanes,j=i.pingedLanes;i=i.warmLanes;var H=f&134217727;return H!==0?(f=H&~T,f!==0?b=_e(f):(j&=H,j!==0?b=_e(j):c||(c=H&~i,c!==0&&(b=_e(c))))):(H=f&~T,H!==0?b=_e(H):j!==0?b=_e(j):c||(c=f&~i,c!==0&&(b=_e(c)))),b===0?0:s!==0&&s!==b&&(s&T)===0&&(T=b&-b,c=s&-s,T>=c||T===32&&(c&4194048)!==0)?s:b}function Ii(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function zt(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oi(){var i=ct;return ct<<=1,(ct&62914560)===0&&(ct=4194304),i}function ki(i){for(var s=[],c=0;31>c;c++)s.push(i);return s}function mr(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function nr(i,s,c,f,b,T){var j=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var H=i.entanglements,ye=i.expirationTimes,Fe=i.hiddenUpdates;for(c=j&~c;0<c;){var Je=31-fe(c),rt=1<<Je;H[Je]=0,ye[Je]=-1;var $e=Fe[Je];if($e!==null)for(Fe[Je]=null,Je=0;Je<$e.length;Je++){var qe=$e[Je];qe!==null&&(qe.lane&=-536870913)}c&=~rt}f!==0&&gi(i,f,0),T!==0&&b===0&&i.tag!==0&&(i.suspendedLanes|=T&~(j&~s))}function gi(i,s,c){i.pendingLanes|=s,i.suspendedLanes&=~s;var f=31-fe(s);i.entangledLanes|=s,i.entanglements[f]=i.entanglements[f]|1073741824|c&261930}function ze(i,s){var c=i.entangledLanes|=s;for(i=i.entanglements;c;){var f=31-fe(c),b=1<<f;b&s|i[f]&s&&(i[f]|=s),c&=~b}}function Ke(i,s){var c=s&-s;return c=(c&42)!==0?1:pe(c),(c&(i.suspendedLanes|s))!==0?0:c}function pe(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Me(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function ht(){var i=gt.p;return i!==0?i:(i=window.event,i===void 0?32:yn(i.type))}function ot(i,s){var c=gt.p;try{return gt.p=i,s()}finally{gt.p=c}}var ri=Math.random().toString(36).slice(2),di="__reactFiber$"+ri,Ze="__reactProps$"+ri,dt="__reactContainer$"+ri,Bt="__reactEvents$"+ri,xt="__reactListeners$"+ri,Si="__reactHandles$"+ri,Un="__reactResources$"+ri,Zt="__reactMarker$"+ri;function gs(i){delete i[di],delete i[Ze],delete i[Bt],delete i[xt],delete i[Si]}function Da(i){var s=i[di];if(s)return s;for(var c=i.parentNode;c;){if(s=c[dt]||c[di]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(i=zd(i);i!==null;){if(c=i[di])return c;i=zd(i)}return s}i=c,c=i.parentNode}return null}function Ra(i){if(i=i[di]||i[dt]){var s=i.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return i}return null}function ys(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(A(33))}function ma(i){var s=i[Un];return s||(s=i[Un]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Er(i){i[Zt]=!0}var ts=new Set,xn={};function ni(i,s){sl(i,s),sl(i+"Capture",s)}function sl(i,s){for(xn[i]=s,i=0;i<s.length;i++)ts.add(s[i])}var ol=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$s={},_s={};function Vs(i){return An.call(_s,i)?!0:An.call($s,i)?!1:ol.test(i)?_s[i]=!0:($s[i]=!0,!1)}function Gl(i,s,c){if(Vs(s))if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var f=s.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+c)}}function ll(i,s,c){if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+c)}}function is(i,s,c,f){if(f===null)i.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(s,c,""+f)}}function nn(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Du(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Od(i,s,c){var f=Object.getOwnPropertyDescriptor(i.constructor.prototype,s);if(!i.hasOwnProperty(s)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,T=f.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return b.call(this)},set:function(j){c=""+j,T.call(this,j)}}),Object.defineProperty(i,s,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(j){c=""+j},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function Ru(i){if(!i._valueTracker){var s=Du(i)?"checked":"value";i._valueTracker=Od(i,s,""+i[s])}}function Rh(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var c=s.getValue(),f="";return i&&(f=Du(i)?i.checked?"true":"false":i.value),i=f,i!==c?(s.setValue(i),!0):!1}function Zl(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Lh=/[\n"\\]/g;function $n(i){return i.replace(Lh,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function cl(i,s,c,f,b,T,j,H){i.name="",j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?i.type=j:i.removeAttribute("type"),s!=null?j==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+nn(s)):i.value!==""+nn(s)&&(i.value=""+nn(s)):j!=="submit"&&j!=="reset"||i.removeAttribute("value"),s!=null?ql(i,j,nn(s)):c!=null?ql(i,j,nn(c)):f!=null&&i.removeAttribute("value"),b==null&&T!=null&&(i.defaultChecked=!!T),b!=null&&(i.checked=b&&typeof b!="function"&&typeof b!="symbol"),H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?i.name=""+nn(H):i.removeAttribute("name")}function To(i,s,c,f,b,T,j,H){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(i.type=T),s!=null||c!=null){if(!(T!=="submit"&&T!=="reset"||s!=null)){Ru(i);return}c=c!=null?""+nn(c):"",s=s!=null?""+nn(s):c,H||s===i.value||(i.value=s),i.defaultValue=s}f=f??b,f=typeof f!="function"&&typeof f!="symbol"&&!!f,i.checked=H?i.checked:!!f,i.defaultChecked=!!f,j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(i.name=j),Ru(i)}function ql(i,s,c){s==="number"&&Zl(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function Gs(i,s,c,f){if(i=i.options,s){s={};for(var b=0;b<c.length;b++)s["$"+c[b]]=!0;for(c=0;c<i.length;c++)b=s.hasOwnProperty("$"+i[c].value),i[c].selected!==b&&(i[c].selected=b),b&&f&&(i[c].defaultSelected=!0)}else{for(c=""+nn(c),s=null,b=0;b<i.length;b++){if(i[b].value===c){i[b].selected=!0,f&&(i[b].defaultSelected=!0);return}s!==null||i[b].disabled||(s=i[b])}s!==null&&(s.selected=!0)}}function ul(i,s,c){if(s!=null&&(s=""+nn(s),s!==i.value&&(i.value=s),c==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=c!=null?""+nn(c):""}function hl(i,s,c,f){if(s==null){if(f!=null){if(c!=null)throw Error(A(92));if(qi(f)){if(1<f.length)throw Error(A(93));f=f[0]}c=f}c==null&&(c=""),s=c}c=nn(s),i.defaultValue=c,f=i.textContent,f===c&&f!==""&&f!==null&&(i.value=f),Ru(i)}function xs(i,s){if(s){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=s;return}}i.textContent=s}var jh=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zs(i,s,c){var f=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":f?i.setProperty(s,c):typeof c!="number"||c===0||jh.has(s)?s==="float"?i.cssFloat=c:i[s]=(""+c).trim():i[s]=c+"px"}function Bc(i,s,c){if(s!=null&&typeof s!="object")throw Error(A(62));if(i=i.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||s!=null&&s.hasOwnProperty(f)||(f.indexOf("--")===0?i.setProperty(f,""):f==="float"?i.cssFloat="":i[f]="");for(var b in s)f=s[b],s.hasOwnProperty(b)&&c[b]!==f&&Zs(i,b,f)}else for(var T in s)s.hasOwnProperty(T)&&Zs(i,T,s[T])}function ga(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ui=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),La=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ti(i){return La.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function ya(){}var Nc=null;function Mo(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Ar=null,Mr=null;function hn(i){var s=Ra(i);if(s&&(i=s.stateNode)){var c=i[Ze]||null;e:switch(i=s.stateNode,s.type){case"input":if(cl(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+$n(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var f=c[s];if(f!==i&&f.form===i.form){var b=f[Ze]||null;if(!b)throw Error(A(90));cl(f,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<c.length;s++)f=c[s],f.form===i.form&&Rh(f)}break e;case"textarea":ul(i,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&Gs(i,!!c.multiple,s,!1)}}}var Rr=!1;function ar(i,s,c){if(Rr)return i(s,c);Rr=!0;try{var f=i(s);return f}finally{if(Rr=!1,(Ar!==null||Mr!==null)&&(dd(),Ar&&(s=Ar,i=Mr,Mr=Ar=null,hn(s),i)))for(s=0;s<i.length;s++)hn(i[s])}}function Hl(i,s){var c=i.stateNode;if(c===null)return null;var f=c[Ze]||null;if(f===null)return null;c=f[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(A(231,s,typeof c));return c}var gr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xr=!1;if(gr)try{var an={};Object.defineProperty(an,"passive",{get:function(){Xr=!0}}),window.addEventListener("test",an,an),window.removeEventListener("test",an,an)}catch{Xr=!1}var rs=null,qs=null,sr=null;function Hi(){if(sr)return sr;var i,s=qs,c=s.length,f,b="value"in rs?rs.value:rs.textContent,T=b.length;for(i=0;i<c&&s[i]===b[i];i++);var j=c-i;for(f=1;f<=j&&s[c-f]===b[T-f];f++);return sr=b.slice(i,1<f?1-f:void 0)}function _a(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function pi(){return!0}function Xt(){return!1}function dn(i){function s(c,f,b,T,j){this._reactName=c,this._targetInst=b,this.type=f,this.nativeEvent=T,this.target=j,this.currentTarget=null;for(var H in i)i.hasOwnProperty(H)&&(c=i[H],this[H]=c?c(T):T[H]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?pi:Xt,this.isPropagationStopped=Xt,this}return De(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=pi)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=pi)},persist:function(){},isPersistent:pi}),s}var ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dl=dn(ai),Vn=De({},ai,{view:0,detail:0}),pl=dn(Vn),vs,ko,bs,Co=De({},Vn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ml,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==bs&&(bs&&i.type==="mousemove"?(vs=i.screenX-bs.screenX,ko=i.screenY-bs.screenY):ko=vs=0,bs=i),vs)},movementY:function(i){return"movementY"in i?i.movementY:ko}}),Xl=dn(Co),Fc=De({},Co,{dataTransfer:0}),Uc=dn(Fc),ja=De({},Vn,{relatedTarget:0}),Lr=dn(ja),Hs=De({},ai,{animationName:0,elapsedTime:0,pseudoElement:0}),Oh=dn(Hs),fl=De({},ai,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Wr=dn(fl),Bh=De({},ai,{data:0}),$c=dn(Bh),zn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Lu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},In={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Eo(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=In[i])?!!s[i]:!1}function ml(){return Eo}var Nh=De({},Vn,{key:function(i){if(i.key){var s=zn[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=_a(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Lu[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ml,charCode:function(i){return i.type==="keypress"?_a(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?_a(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Ao=dn(Nh),Vc=De({},Co,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wl=dn(Vc),Oa=De({},Vn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ml}),Fh=dn(Oa),Gc=De({},ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bd=dn(Gc),gl=De({},Co,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),ju=dn(gl),Zc=De({},ai,{newState:0,oldState:0}),Ou=dn(Zc),Bu=[9,13,27,32],Pn=gr&&"CompositionEvent"in window,Yl=null;gr&&"documentMode"in document&&(Yl=document.documentMode);var qc=gr&&"TextEvent"in window&&!Yl,zo=gr&&(!Pn||Yl&&8<Yl&&11>=Yl),yl=" ",Nu=!1;function Kl(i,s){switch(i){case"keyup":return Bu.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Uh(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Ba=!1;function Nd(i,s){switch(i){case"compositionend":return Uh(s);case"keypress":return s.which!==32?null:(Nu=!0,yl);case"textInput":return i=s.data,i===yl&&Nu?null:i;default:return null}}function $h(i,s){if(Ba)return i==="compositionend"||!Pn&&Kl(i,s)?(i=Hi(),sr=qs=rs=null,Ba=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return zo&&s.locale!=="ko"?null:s.data;default:return null}}var Vh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hc(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Vh[i.type]:s==="textarea"}function Ql(i,s,c,f){Ar?Mr?Mr.push(f):Mr=[f]:Ar=f,s=Ch(s,"onChange"),0<s.length&&(c=new dl("onChange","change",null,c,f),i.push({event:c,listeners:s}))}var _l=null,xl=null;function Gh(i){ff(i,0)}function Jl(i){var s=ys(i);if(Rh(s))return i}function Na(i,s){if(i==="change")return s}var Fu=!1;if(gr){var Xc;if(gr){var Io="oninput"in document;if(!Io){var Zh=document.createElement("div");Zh.setAttribute("oninput","return;"),Io=typeof Zh.oninput=="function"}Xc=Io}else Xc=!1;Fu=Xc&&(!document.documentMode||9<document.documentMode)}function Po(){_l&&(_l.detachEvent("onpropertychange",Uu),xl=_l=null)}function Uu(i){if(i.propertyName==="value"&&Jl(xl)){var s=[];Ql(s,xl,i,Mo(i)),ar(Gh,s)}}function Fd(i,s,c){i==="focusin"?(Po(),_l=s,xl=c,_l.attachEvent("onpropertychange",Uu)):i==="focusout"&&Po()}function qh(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Jl(xl)}function $u(i,s){if(i==="click")return Jl(s)}function Vu(i,s){if(i==="input"||i==="change")return Jl(s)}function Gu(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var Gn=typeof Object.is=="function"?Object.is:Gu;function Xs(i,s){if(Gn(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var c=Object.keys(i),f=Object.keys(s);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var b=c[f];if(!An.call(s,b)||!Gn(i[b],s[b]))return!1}return!0}function Fa(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Wc(i,s){var c=Fa(i);i=0;for(var f;c;){if(c.nodeType===3){if(f=i+c.textContent.length,i<=s&&f>=s)return{node:c,offset:s-i};i=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Fa(c)}}function Yc(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Yc(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Kc(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=Zl(i.document);s instanceof i.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)i=s.contentWindow;else break;s=Zl(i.document)}return s}function Qc(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var Li=gr&&"documentMode"in document&&11>=document.documentMode,xa=null,ec=null,tc=null,Zu=!1;function Hh(i,s,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Zu||xa==null||xa!==Zl(f)||(f=xa,"selectionStart"in f&&Qc(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),tc&&Xs(tc,f)||(tc=f,f=Ch(ec,"onSelect"),0<f.length&&(s=new dl("onSelect","select",null,s,c),i.push({event:s,listeners:f}),s.target=xa)))}function Do(i,s){var c={};return c[i.toLowerCase()]=s.toLowerCase(),c["Webkit"+i]="webkit"+s,c["Moz"+i]="moz"+s,c}var Ro={animationend:Do("Animation","AnimationEnd"),animationiteration:Do("Animation","AnimationIteration"),animationstart:Do("Animation","AnimationStart"),transitionrun:Do("Transition","TransitionRun"),transitionstart:Do("Transition","TransitionStart"),transitioncancel:Do("Transition","TransitionCancel"),transitionend:Do("Transition","TransitionEnd")},qu={},Hu={};gr&&(Hu=document.createElement("div").style,"AnimationEvent"in window||(delete Ro.animationend.animation,delete Ro.animationiteration.animation,delete Ro.animationstart.animation),"TransitionEvent"in window||delete Ro.transitionend.transition);function ns(i){if(qu[i])return qu[i];if(!Ro[i])return i;var s=Ro[i],c;for(c in s)if(s.hasOwnProperty(c)&&c in Hu)return qu[i]=s[c];return i}var ic=ns("animationend"),rc=ns("animationiteration"),Jc=ns("animationstart"),Lo=ns("transitionrun"),nc=ns("transitionstart"),vl=ns("transitioncancel"),Jn=ns("transitionend"),Xu=new Map,eu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");eu.push("scrollEnd");function ea(i,s){Xu.set(i,s),ni(s,[i])}var as=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Dn=[],ws=0,jo=0;function Oo(){for(var i=ws,s=jo=ws=0;s<i;){var c=Dn[s];Dn[s++]=null;var f=Dn[s];Dn[s++]=null;var b=Dn[s];Dn[s++]=null;var T=Dn[s];if(Dn[s++]=null,f!==null&&b!==null){var j=f.pending;j===null?b.next=b:(b.next=j.next,j.next=b),f.pending=b}T!==0&&Wu(c,b,T)}}function ac(i,s,c,f){Dn[ws++]=i,Dn[ws++]=s,Dn[ws++]=c,Dn[ws++]=f,jo|=f,i.lanes|=f,i=i.alternate,i!==null&&(i.lanes|=f)}function Ws(i,s,c,f){return ac(i,s,c,f),bl(i)}function va(i,s){return ac(i,null,null,s),bl(i)}function Wu(i,s,c){i.lanes|=c;var f=i.alternate;f!==null&&(f.lanes|=c);for(var b=!1,T=i.return;T!==null;)T.childLanes|=c,f=T.alternate,f!==null&&(f.childLanes|=c),T.tag===22&&(i=T.stateNode,i===null||i._visibility&1||(b=!0)),i=T,T=T.return;return i.tag===3?(T=i.stateNode,b&&s!==null&&(b=31-fe(c),i=T.hiddenUpdates,f=i[b],f===null?i[b]=[s]:f.push(s),s.lane=c|536870912),T):null}function bl(i){if(50<Ir)throw Ir=0,xh=null,Error(A(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var li={};function wl(i,s,c,f){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ta(i,s,c,f){return new wl(i,s,c,f)}function tu(i){return i=i.prototype,!(!i||!i.isReactComponent)}function ia(i,s){var c=i.alternate;return c===null?(c=ta(i.tag,s,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=s,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,s=i.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function Yu(i,s){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,s=c.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function iu(i,s,c,f,b,T){var j=0;if(f=i,typeof i=="function")tu(i)&&(j=1);else if(typeof i=="string")j=U(i,c,kt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Ui:return i=ta(31,c,s,b),i.elementType=Ui,i.lanes=T,i;case ve:return Ys(c.children,b,T,s);case St:j=8,b|=24;break;case wt:return i=ta(12,c,s,b|2),i.elementType=wt,i.lanes=T,i;case Rt:return i=ta(13,c,s,b),i.elementType=Rt,i.lanes=T,i;case vt:return i=ta(19,c,s,b),i.elementType=vt,i.lanes=T,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case $t:j=10;break e;case jt:j=9;break e;case Fi:j=11;break e;case Ft:j=14;break e;case wi:j=16,f=null;break e}j=29,c=Error(A(130,i===null?"null":typeof i,"")),f=null}return s=ta(j,c,s,b),s.elementType=i,s.type=f,s.lanes=T,s}function Ys(i,s,c,f){return i=ta(7,i,f,s),i.lanes=c,i}function Sl(i,s,c){return i=ta(6,i,null,s),i.lanes=c,i}function sc(i){var s=ta(18,null,null,0);return s.stateNode=i,s}function Tl(i,s,c){return s=ta(4,i.children!==null?i.children:[],i.key,s),s.lanes=c,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var oc=new WeakMap;function Rn(i,s){if(typeof i=="object"&&i!==null){var c=oc.get(i);return c!==void 0?c:(s={value:i,source:s,stack:Ei(s)},oc.set(i,s),s)}return{value:i,source:s,stack:Ei(s)}}var Ks=[],Bo=0,Qs=null,Ss=0,Ln=[],pn=0,Ua=null,$a=1,jn="";function Ts(i,s){Ks[Bo++]=Ss,Ks[Bo++]=Qs,Qs=i,Ss=s}function Ku(i,s,c){Ln[pn++]=$a,Ln[pn++]=jn,Ln[pn++]=Ua,Ua=i;var f=$a;i=jn;var b=32-fe(f)-1;f&=~(1<<b),c+=1;var T=32-fe(s)+b;if(30<T){var j=b-b%5;T=(f&(1<<j)-1).toString(32),f>>=j,b-=j,$a=1<<32-fe(s)+b|c<<b|f,jn=T+i}else $a=1<<T|c<<b|f,jn=i}function Ml(i){i.return!==null&&(Ts(i,1),Ku(i,1,0))}function lc(i){for(;i===Qs;)Qs=Ks[--Bo],Ks[Bo]=null,Ss=Ks[--Bo],Ks[Bo]=null;for(;i===Ua;)Ua=Ln[--pn],Ln[pn]=null,jn=Ln[--pn],Ln[pn]=null,$a=Ln[--pn],Ln[pn]=null}function ru(i,s){Ln[pn++]=$a,Ln[pn++]=jn,Ln[pn++]=Ua,$a=s.id,jn=s.overflow,Ua=i}var Yr=null,Xi=null,bi=!1,ss=null,On=!1,or=Error(A(519));function Zn(i){var s=Error(A(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw to(Rn(s,i)),or}function ra(i){var s=i.stateNode,c=i.type,f=i.memoizedProps;switch(s[di]=i,s[Ze]=f,c){case"dialog":Di("cancel",s),Di("close",s);break;case"iframe":case"object":case"embed":Di("load",s);break;case"video":case"audio":for(c=0;c<Mh.length;c++)Di(Mh[c],s);break;case"source":Di("error",s);break;case"img":case"image":case"link":Di("error",s),Di("load",s);break;case"details":Di("toggle",s);break;case"input":Di("invalid",s),To(s,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":Di("invalid",s);break;case"textarea":Di("invalid",s),hl(s,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||f.suppressHydrationWarning===!0||Tp(s.textContent,c)?(f.popover!=null&&(Di("beforetoggle",s),Di("toggle",s)),f.onScroll!=null&&Di("scroll",s),f.onScrollEnd!=null&&Di("scrollend",s),f.onClick!=null&&(s.onclick=ya),s=!0):s=!1,s||Zn(i,!0)}function nu(i){for(Yr=i.return;Yr;)switch(Yr.tag){case 5:case 31:case 13:On=!1;return;case 27:case 3:On=!0;return;default:Yr=Yr.return}}function Ms(i){if(i!==Yr)return!1;if(!bi)return nu(i),bi=!0,!1;var s=i.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||kd(i.type,i.memoizedProps)),c=!c),c&&Xi&&Zn(i),nu(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(A(317));Xi=zp(i)}else if(s===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(A(317));Xi=zp(i)}else s===27?(s=Xi,Fs(i.type)?(i=Ad,Ad=null,Xi=i):Xi=s):Xi=Yr?Ca(i.stateNode.nextSibling):null;return!0}function Js(){Xi=Yr=null,bi=!1}function eo(){var i=ss;return i!==null&&(ua===null?ua=i:ua.push.apply(ua,i),ss=null),i}function to(i){ss===null?ss=[i]:ss.push(i)}var io=be(null),ba=null,os=null;function ls(i,s,c){yt(io,s._currentValue),s._currentValue=c}function Va(i){i._currentValue=io.current,Ye(io)}function au(i,s,c){for(;i!==null;){var f=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,f!==null&&(f.childLanes|=s)):f!==null&&(f.childLanes&s)!==s&&(f.childLanes|=s),i===c)break;i=i.return}}function cc(i,s,c,f){var b=i.child;for(b!==null&&(b.return=i);b!==null;){var T=b.dependencies;if(T!==null){var j=b.child;T=T.firstContext;e:for(;T!==null;){var H=T;T=b;for(var ye=0;ye<s.length;ye++)if(H.context===s[ye]){T.lanes|=c,H=T.alternate,H!==null&&(H.lanes|=c),au(T.return,c,i),f||(j=null);break e}T=H.next}}else if(b.tag===18){if(j=b.return,j===null)throw Error(A(341));j.lanes|=c,T=j.alternate,T!==null&&(T.lanes|=c),au(j,c,i),j=null}else j=b.child;if(j!==null)j.return=b;else for(j=b;j!==null;){if(j===i){j=null;break}if(b=j.sibling,b!==null){b.return=j.return,j=b;break}j=j.return}b=j}}function na(i,s,c,f){i=null;for(var b=s,T=!1;b!==null;){if(!T){if((b.flags&524288)!==0)T=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var j=b.alternate;if(j===null)throw Error(A(387));if(j=j.memoizedProps,j!==null){var H=b.type;Gn(b.pendingProps.value,j.value)||(i!==null?i.push(H):i=[H])}}else if(b===ei.current){if(j=b.alternate,j===null)throw Error(A(387));j.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(i!==null?i.push(Ue):i=[Ue])}b=b.return}i!==null&&cc(s,i,c,f),s.flags|=262144}function ks(i){for(i=i.firstContext;i!==null;){if(!Gn(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function ro(i){ba=i,os=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function sn(i){return Qu(ba,i)}function uc(i,s){return ba===null&&ro(i),Qu(i,s)}function Qu(i,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},os===null){if(i===null)throw Error(A(308));os=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else os=os.next=s;return c}var Xh=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(c,f){i.push(f)}};this.abort=function(){s.aborted=!0,i.forEach(function(c){return c()})}},Wh=re.unstable_scheduleCallback,kl=re.unstable_NormalPriority,lr={$$typeof:$t,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vn(){return{controller:new Xh,data:new Map,refCount:0}}function Fr(i){i.refCount--,i.refCount===0&&Wh(kl,function(){i.controller.abort()})}var bn=null,su=0,wn=0,Bn=null;function Yh(i,s){if(bn===null){var c=bn=[];su=0,wn=Fl(),Bn={status:"pending",value:void 0,then:function(f){c.push(f)}}}return su++,s.then(ou,ou),s}function ou(){if(--su===0&&bn!==null){Bn!==null&&(Bn.status="fulfilled");var i=bn;bn=null,wn=0,Bn=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function Ud(i,s){var c=[],f={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return i.then(function(){f.status="fulfilled",f.value=s;for(var b=0;b<c.length;b++)(0,c[b])(s)},function(b){for(f.status="rejected",f.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),f}var lu=He.S;He.S=function(i,s){nf=dr(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Yh(i,s),lu!==null&&lu(i,s)};var no=be(null);function Ga(){var i=no.current;return i!==null?i:hr.pooledCache}function wa(i,s){s===null?yt(no,no.current):yt(no,s.pool)}function _t(){var i=Ga();return i===null?null:{parent:lr._currentValue,pool:i}}var No=Error(A(460)),Cs=Error(A(474)),hc=Error(A(542)),ao={then:function(){}};function Es(i){return i=i.status,i==="fulfilled"||i==="rejected"}function cu(i,s,c){switch(c=i[c],c===void 0?i.push(s):c!==s&&(s.then(ya,ya),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,dc(i),i;default:if(typeof s.status=="string")s.then(ya,ya);else{if(i=hr,i!==null&&100<i.shellSuspendCounter)throw Error(A(482));i=s,i.status="pending",i.then(function(f){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=f}},function(f){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=f}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,dc(i),i}throw Sa=s,No}}function si(i){try{var s=i._init;return s(i._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Sa=c,No):c}}var Sa=null;function Ju(){if(Sa===null)throw Error(A(459));var i=Sa;return Sa=null,i}function dc(i){if(i===No||i===hc)throw Error(A(483))}var Fo=null,Cl=0;function Uo(i){var s=Cl;return Cl+=1,Fo===null&&(Fo=[]),cu(Fo,i,s)}function so(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function pc(i,s){throw s.$$typeof===we?Error(A(525)):(i=Object.prototype.toString.call(s),Error(A(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function eh(i){function s(Ie,ke){if(i){var Ne=Ie.deletions;Ne===null?(Ie.deletions=[ke],Ie.flags|=16):Ne.push(ke)}}function c(Ie,ke){if(!i)return null;for(;ke!==null;)s(Ie,ke),ke=ke.sibling;return null}function f(Ie){for(var ke=new Map;Ie!==null;)Ie.key!==null?ke.set(Ie.key,Ie):ke.set(Ie.index,Ie),Ie=Ie.sibling;return ke}function b(Ie,ke){return Ie=ia(Ie,ke),Ie.index=0,Ie.sibling=null,Ie}function T(Ie,ke,Ne){return Ie.index=Ne,i?(Ne=Ie.alternate,Ne!==null?(Ne=Ne.index,Ne<ke?(Ie.flags|=67108866,ke):Ne):(Ie.flags|=67108866,ke)):(Ie.flags|=1048576,ke)}function j(Ie){return i&&Ie.alternate===null&&(Ie.flags|=67108866),Ie}function H(Ie,ke,Ne,tt){return ke===null||ke.tag!==6?(ke=Sl(Ne,Ie.mode,tt),ke.return=Ie,ke):(ke=b(ke,Ne),ke.return=Ie,ke)}function ye(Ie,ke,Ne,tt){var Yt=Ne.type;return Yt===ve?Je(Ie,ke,Ne.props.children,tt,Ne.key):ke!==null&&(ke.elementType===Yt||typeof Yt=="object"&&Yt!==null&&Yt.$$typeof===wi&&si(Yt)===ke.type)?(ke=b(ke,Ne.props),so(ke,Ne),ke.return=Ie,ke):(ke=iu(Ne.type,Ne.key,Ne.props,null,Ie.mode,tt),so(ke,Ne),ke.return=Ie,ke)}function Fe(Ie,ke,Ne,tt){return ke===null||ke.tag!==4||ke.stateNode.containerInfo!==Ne.containerInfo||ke.stateNode.implementation!==Ne.implementation?(ke=Tl(Ne,Ie.mode,tt),ke.return=Ie,ke):(ke=b(ke,Ne.children||[]),ke.return=Ie,ke)}function Je(Ie,ke,Ne,tt,Yt){return ke===null||ke.tag!==7?(ke=Ys(Ne,Ie.mode,tt,Yt),ke.return=Ie,ke):(ke=b(ke,Ne),ke.return=Ie,ke)}function rt(Ie,ke,Ne){if(typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint")return ke=Sl(""+ke,Ie.mode,Ne),ke.return=Ie,ke;if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case Ee:return Ne=iu(ke.type,ke.key,ke.props,null,Ie.mode,Ne),so(Ne,ke),Ne.return=Ie,Ne;case Qe:return ke=Tl(ke,Ie.mode,Ne),ke.return=Ie,ke;case wi:return ke=si(ke),rt(Ie,ke,Ne)}if(qi(ke)||Ci(ke))return ke=Ys(ke,Ie.mode,Ne,null),ke.return=Ie,ke;if(typeof ke.then=="function")return rt(Ie,Uo(ke),Ne);if(ke.$$typeof===$t)return rt(Ie,uc(Ie,ke),Ne);pc(Ie,ke)}return null}function $e(Ie,ke,Ne,tt){var Yt=ke!==null?ke.key:null;if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return Yt!==null?null:H(Ie,ke,""+Ne,tt);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case Ee:return Ne.key===Yt?ye(Ie,ke,Ne,tt):null;case Qe:return Ne.key===Yt?Fe(Ie,ke,Ne,tt):null;case wi:return Ne=si(Ne),$e(Ie,ke,Ne,tt)}if(qi(Ne)||Ci(Ne))return Yt!==null?null:Je(Ie,ke,Ne,tt,null);if(typeof Ne.then=="function")return $e(Ie,ke,Uo(Ne),tt);if(Ne.$$typeof===$t)return $e(Ie,ke,uc(Ie,Ne),tt);pc(Ie,Ne)}return null}function qe(Ie,ke,Ne,tt,Yt){if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return Ie=Ie.get(Ne)||null,H(ke,Ie,""+tt,Yt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case Ee:return Ie=Ie.get(tt.key===null?Ne:tt.key)||null,ye(ke,Ie,tt,Yt);case Qe:return Ie=Ie.get(tt.key===null?Ne:tt.key)||null,Fe(ke,Ie,tt,Yt);case wi:return tt=si(tt),qe(Ie,ke,Ne,tt,Yt)}if(qi(tt)||Ci(tt))return Ie=Ie.get(Ne)||null,Je(ke,Ie,tt,Yt,null);if(typeof tt.then=="function")return qe(Ie,ke,Ne,Uo(tt),Yt);if(tt.$$typeof===$t)return qe(Ie,ke,Ne,uc(ke,tt),Yt);pc(ke,tt)}return null}function Dt(Ie,ke,Ne,tt){for(var Yt=null,Wi=null,Tt=ke,Jt=ke=0,yi=null;Tt!==null&&Jt<Ne.length;Jt++){Tt.index>Jt?(yi=Tt,Tt=null):yi=Tt.sibling;var _i=$e(Ie,Tt,Ne[Jt],tt);if(_i===null){Tt===null&&(Tt=yi);break}i&&Tt&&_i.alternate===null&&s(Ie,Tt),ke=T(_i,ke,Jt),Wi===null?Yt=_i:Wi.sibling=_i,Wi=_i,Tt=yi}if(Jt===Ne.length)return c(Ie,Tt),bi&&Ts(Ie,Jt),Yt;if(Tt===null){for(;Jt<Ne.length;Jt++)Tt=rt(Ie,Ne[Jt],tt),Tt!==null&&(ke=T(Tt,ke,Jt),Wi===null?Yt=Tt:Wi.sibling=Tt,Wi=Tt);return bi&&Ts(Ie,Jt),Yt}for(Tt=f(Tt);Jt<Ne.length;Jt++)yi=qe(Tt,Ie,Jt,Ne[Jt],tt),yi!==null&&(i&&yi.alternate!==null&&Tt.delete(yi.key===null?Jt:yi.key),ke=T(yi,ke,Jt),Wi===null?Yt=yi:Wi.sibling=yi,Wi=yi);return i&&Tt.forEach(function(za){return s(Ie,za)}),bi&&Ts(Ie,Jt),Yt}function ii(Ie,ke,Ne,tt){if(Ne==null)throw Error(A(151));for(var Yt=null,Wi=null,Tt=ke,Jt=ke=0,yi=null,_i=Ne.next();Tt!==null&&!_i.done;Jt++,_i=Ne.next()){Tt.index>Jt?(yi=Tt,Tt=null):yi=Tt.sibling;var za=$e(Ie,Tt,_i.value,tt);if(za===null){Tt===null&&(Tt=yi);break}i&&Tt&&za.alternate===null&&s(Ie,Tt),ke=T(za,ke,Jt),Wi===null?Yt=za:Wi.sibling=za,Wi=za,Tt=yi}if(_i.done)return c(Ie,Tt),bi&&Ts(Ie,Jt),Yt;if(Tt===null){for(;!_i.done;Jt++,_i=Ne.next())_i=rt(Ie,_i.value,tt),_i!==null&&(ke=T(_i,ke,Jt),Wi===null?Yt=_i:Wi.sibling=_i,Wi=_i);return bi&&Ts(Ie,Jt),Yt}for(Tt=f(Tt);!_i.done;Jt++,_i=Ne.next())_i=qe(Tt,Ie,Jt,_i.value,tt),_i!==null&&(i&&_i.alternate!==null&&Tt.delete(_i.key===null?Jt:_i.key),ke=T(_i,ke,Jt),Wi===null?Yt=_i:Wi.sibling=_i,Wi=_i);return i&&Tt.forEach(function(wo){return s(Ie,wo)}),bi&&Ts(Ie,Jt),Yt}function fr(Ie,ke,Ne,tt){if(typeof Ne=="object"&&Ne!==null&&Ne.type===ve&&Ne.key===null&&(Ne=Ne.props.children),typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case Ee:e:{for(var Yt=Ne.key;ke!==null;){if(ke.key===Yt){if(Yt=Ne.type,Yt===ve){if(ke.tag===7){c(Ie,ke.sibling),tt=b(ke,Ne.props.children),tt.return=Ie,Ie=tt;break e}}else if(ke.elementType===Yt||typeof Yt=="object"&&Yt!==null&&Yt.$$typeof===wi&&si(Yt)===ke.type){c(Ie,ke.sibling),tt=b(ke,Ne.props),so(tt,Ne),tt.return=Ie,Ie=tt;break e}c(Ie,ke);break}else s(Ie,ke);ke=ke.sibling}Ne.type===ve?(tt=Ys(Ne.props.children,Ie.mode,tt,Ne.key),tt.return=Ie,Ie=tt):(tt=iu(Ne.type,Ne.key,Ne.props,null,Ie.mode,tt),so(tt,Ne),tt.return=Ie,Ie=tt)}return j(Ie);case Qe:e:{for(Yt=Ne.key;ke!==null;){if(ke.key===Yt)if(ke.tag===4&&ke.stateNode.containerInfo===Ne.containerInfo&&ke.stateNode.implementation===Ne.implementation){c(Ie,ke.sibling),tt=b(ke,Ne.children||[]),tt.return=Ie,Ie=tt;break e}else{c(Ie,ke);break}else s(Ie,ke);ke=ke.sibling}tt=Tl(Ne,Ie.mode,tt),tt.return=Ie,Ie=tt}return j(Ie);case wi:return Ne=si(Ne),fr(Ie,ke,Ne,tt)}if(qi(Ne))return Dt(Ie,ke,Ne,tt);if(Ci(Ne)){if(Yt=Ci(Ne),typeof Yt!="function")throw Error(A(150));return Ne=Yt.call(Ne),ii(Ie,ke,Ne,tt)}if(typeof Ne.then=="function")return fr(Ie,ke,Uo(Ne),tt);if(Ne.$$typeof===$t)return fr(Ie,ke,uc(Ie,Ne),tt);pc(Ie,Ne)}return typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint"?(Ne=""+Ne,ke!==null&&ke.tag===6?(c(Ie,ke.sibling),tt=b(ke,Ne),tt.return=Ie,Ie=tt):(c(Ie,ke),tt=Sl(Ne,Ie.mode,tt),tt.return=Ie,Ie=tt),j(Ie)):c(Ie,ke)}return function(Ie,ke,Ne,tt){try{Cl=0;var Yt=fr(Ie,ke,Ne,tt);return Fo=null,Yt}catch(Tt){if(Tt===No||Tt===hc)throw Tt;var Wi=ta(29,Tt,null,Ie.mode);return Wi.lanes=tt,Wi.return=Ie,Wi}finally{}}}var oo=eh(!0),th=eh(!1),lo=!1;function Za(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Vi(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function co(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function qa(i,s,c){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(Oi&2)!==0){var b=f.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),f.pending=s,s=bl(i),Wu(i,null,c),s}return ac(i,f,s,c),bl(i)}function uo(i,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var f=s.lanes;f&=i.pendingLanes,c|=f,s.lanes=c,ze(i,c)}}function fc(i,s){var c=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var b=null,T=null;if(c=c.firstBaseUpdate,c!==null){do{var j={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};T===null?b=T=j:T=T.next=j,c=c.next}while(c!==null);T===null?b=T=s:T=T.next=s}else b=T=s;c={baseState:f.baseState,firstBaseUpdate:b,lastBaseUpdate:T,shared:f.shared,callbacks:f.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=s:i.next=s,c.lastBaseUpdate=s}var mc=!1;function $o(){if(mc){var i=Bn;if(i!==null)throw i}}function ho(i,s,c,f){mc=!1;var b=i.updateQueue;lo=!1;var T=b.firstBaseUpdate,j=b.lastBaseUpdate,H=b.shared.pending;if(H!==null){b.shared.pending=null;var ye=H,Fe=ye.next;ye.next=null,j===null?T=Fe:j.next=Fe,j=ye;var Je=i.alternate;Je!==null&&(Je=Je.updateQueue,H=Je.lastBaseUpdate,H!==j&&(H===null?Je.firstBaseUpdate=Fe:H.next=Fe,Je.lastBaseUpdate=ye))}if(T!==null){var rt=b.baseState;j=0,Je=Fe=ye=null,H=T;do{var $e=H.lane&-536870913,qe=$e!==H.lane;if(qe?(ji&$e)===$e:(f&$e)===$e){$e!==0&&$e===wn&&(mc=!0),Je!==null&&(Je=Je.next={lane:0,tag:H.tag,payload:H.payload,callback:null,next:null});e:{var Dt=i,ii=H;$e=s;var fr=c;switch(ii.tag){case 1:if(Dt=ii.payload,typeof Dt=="function"){rt=Dt.call(fr,rt,$e);break e}rt=Dt;break e;case 3:Dt.flags=Dt.flags&-65537|128;case 0:if(Dt=ii.payload,$e=typeof Dt=="function"?Dt.call(fr,rt,$e):Dt,$e==null)break e;rt=De({},rt,$e);break e;case 2:lo=!0}}$e=H.callback,$e!==null&&(i.flags|=64,qe&&(i.flags|=8192),qe=b.callbacks,qe===null?b.callbacks=[$e]:qe.push($e))}else qe={lane:$e,tag:H.tag,payload:H.payload,callback:H.callback,next:null},Je===null?(Fe=Je=qe,ye=rt):Je=Je.next=qe,j|=$e;if(H=H.next,H===null){if(H=b.shared.pending,H===null)break;qe=H,H=qe.next,qe.next=null,b.lastBaseUpdate=qe,b.shared.pending=null}}while(!0);Je===null&&(ye=rt),b.baseState=ye,b.firstBaseUpdate=Fe,b.lastBaseUpdate=Je,T===null&&(b.shared.lanes=0),Ol|=j,i.lanes=j,i.memoizedState=rt}}function Ha(i,s){if(typeof i!="function")throw Error(A(191,i));i.call(s)}function Vo(i,s){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)Ha(c[i],s)}var Mt=be(null),Nt=be(0);function Go(i,s){i=yo,yt(Nt,i),yt(Mt,s),yo=i|s.baseLanes}function gc(){yt(Nt,yo),yt(Mt,Mt.current)}function Zo(){yo=Nt.current,Ye(Mt),Ye(Nt)}var cr=be(null),aa=null;function on(i){var s=i.alternate;yt(yr,yr.current&1),yt(cr,i),aa===null&&(s===null||Mt.current!==null||s.memoizedState!==null)&&(aa=i)}function uu(i){yt(yr,yr.current),yt(cr,i),aa===null&&(aa=i)}function Kh(i){i.tag===22?(yt(yr,yr.current),yt(cr,i),aa===null&&(aa=i)):sa()}function sa(){yt(yr,yr.current),yt(cr,cr.current)}function oa(i){Ye(cr),aa===i&&(aa=null),Ye(yr)}var yr=be(0);function ur(i){for(var s=i;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Ap(c)||$l(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Gi=0,hi=null,Ni=null,Ki=null,qo=!1,cs=!1,us=!1,hs=0,Ho=0,Xa=null,Xo=0;function vr(){throw Error(A(321))}function El(i,s){if(s===null)return!1;for(var c=0;c<s.length&&c<i.length;c++)if(!Gn(i[c],s[c]))return!1;return!0}function As(i,s,c,f,b,T){return Gi=T,hi=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,He.H=i===null||i.memoizedState===null?Ls:ps,us=!1,T=c(f,b),us=!1,cs&&(T=du(s,c,f,b)),hu(i),T}function hu(i){He.H=zl;var s=Ni!==null&&Ni.next!==null;if(Gi=0,Ki=Ni=hi=null,qo=!1,Ho=0,Xa=null,s)throw Error(A(300));i===null||Qr||(i=i.dependencies,i!==null&&ks(i)&&(Qr=!0))}function du(i,s,c,f){hi=i;var b=0;do{if(cs&&(Xa=null),Ho=0,cs=!1,25<=b)throw Error(A(301));if(b+=1,Ki=Ni=null,i.updateQueue!=null){var T=i.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}He.H=rh,T=s(c,f)}while(cs);return T}function pu(){var i=He.H,s=i.useState()[0];return s=typeof s.then=="function"?g(s):s,i=i.useState()[0],(Ni!==null?Ni.memoizedState:null)!==i&&(hi.flags|=1024),s}function Al(){var i=hs!==0;return hs=0,i}function p(i,s,c){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~c}function e(i){if(qo){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}qo=!1}Gi=0,Ki=Ni=hi=null,cs=!1,Ho=hs=0,Xa=null}function a(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ki===null?hi.memoizedState=Ki=i:Ki=Ki.next=i,Ki}function l(){if(Ni===null){var i=hi.alternate;i=i!==null?i.memoizedState:null}else i=Ni.next;var s=Ki===null?hi.memoizedState:Ki.next;if(s!==null)Ki=s,Ni=i;else{if(i===null)throw hi.alternate===null?Error(A(467)):Error(A(310));Ni=i,i={memoizedState:Ni.memoizedState,baseState:Ni.baseState,baseQueue:Ni.baseQueue,queue:Ni.queue,next:null},Ki===null?hi.memoizedState=Ki=i:Ki=Ki.next=i}return Ki}function d(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function g(i){var s=Ho;return Ho+=1,Xa===null&&(Xa=[]),i=cu(Xa,i,s),s=hi,(Ki===null?s.memoizedState:Ki.next)===null&&(s=s.alternate,He.H=s===null||s.memoizedState===null?Ls:ps),i}function _(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return g(i);if(i.$$typeof===$t)return sn(i)}throw Error(A(438,String(i)))}function w(i){var s=null,c=hi.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var f=hi.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(s={data:f.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=d(),hi.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(i),f=0;f<i;f++)c[f]=Ri;return s.index++,c}function S(i,s){return typeof s=="function"?s(i):s}function E(i){var s=l();return I(s,Ni,i)}function I(i,s,c){var f=i.queue;if(f===null)throw Error(A(311));f.lastRenderedReducer=c;var b=i.baseQueue,T=f.pending;if(T!==null){if(b!==null){var j=b.next;b.next=T.next,T.next=j}s.baseQueue=b=T,f.pending=null}if(T=i.baseState,b===null)i.memoizedState=T;else{s=b.next;var H=j=null,ye=null,Fe=s,Je=!1;do{var rt=Fe.lane&-536870913;if(rt!==Fe.lane?(ji&rt)===rt:(Gi&rt)===rt){var $e=Fe.revertLane;if($e===0)ye!==null&&(ye=ye.next={lane:0,revertLane:0,gesture:null,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null}),rt===wn&&(Je=!0);else if((Gi&$e)===$e){Fe=Fe.next,$e===wn&&(Je=!0);continue}else rt={lane:0,revertLane:Fe.revertLane,gesture:null,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},ye===null?(H=ye=rt,j=T):ye=ye.next=rt,hi.lanes|=$e,Ol|=$e;rt=Fe.action,us&&c(T,rt),T=Fe.hasEagerState?Fe.eagerState:c(T,rt)}else $e={lane:rt,revertLane:Fe.revertLane,gesture:Fe.gesture,action:Fe.action,hasEagerState:Fe.hasEagerState,eagerState:Fe.eagerState,next:null},ye===null?(H=ye=$e,j=T):ye=ye.next=$e,hi.lanes|=rt,Ol|=rt;Fe=Fe.next}while(Fe!==null&&Fe!==s);if(ye===null?j=T:ye.next=H,!Gn(T,i.memoizedState)&&(Qr=!0,Je&&(c=Bn,c!==null)))throw c;i.memoizedState=T,i.baseState=j,i.baseQueue=ye,f.lastRenderedState=T}return b===null&&(f.lanes=0),[i.memoizedState,f.dispatch]}function L(i){var s=l(),c=s.queue;if(c===null)throw Error(A(311));c.lastRenderedReducer=i;var f=c.dispatch,b=c.pending,T=s.memoizedState;if(b!==null){c.pending=null;var j=b=b.next;do T=i(T,j.action),j=j.next;while(j!==b);Gn(T,s.memoizedState)||(Qr=!0),s.memoizedState=T,s.baseQueue===null&&(s.baseState=T),c.lastRenderedState=T}return[T,f]}function R(i,s,c){var f=hi,b=l(),T=bi;if(T){if(c===void 0)throw Error(A(407));c=c()}else c=s();var j=!Gn((Ni||b).memoizedState,c);if(j&&(b.memoizedState=c,Qr=!0),b=b.queue,ci(K.bind(null,f,b,i),[i]),b.getSnapshot!==s||j||Ki!==null&&Ki.memoizedState.tag&1){if(f.flags|=2048,bt(9,{destroy:void 0},Z.bind(null,f,b,c,s),null),hr===null)throw Error(A(349));T||(Gi&127)!==0||$(f,s,c)}return c}function $(i,s,c){i.flags|=16384,i={getSnapshot:s,value:c},s=hi.updateQueue,s===null?(s=d(),hi.updateQueue=s,s.stores=[i]):(c=s.stores,c===null?s.stores=[i]:c.push(i))}function Z(i,s,c,f){s.value=c,s.getSnapshot=f,Q(s)&&J(i)}function K(i,s,c){return c(function(){Q(s)&&J(i)})}function Q(i){var s=i.getSnapshot;i=i.value;try{var c=s();return!Gn(i,c)}catch{return!0}}function J(i){var s=va(i,2);s!==null&&Xn(s,i,2)}function oe(i){var s=a();if(typeof i=="function"){var c=i;if(i=c(),us){le(!0);try{c()}finally{le(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:S,lastRenderedState:i},s}function he(i,s,c,f){return i.baseState=c,I(i,Ni,typeof f=="function"?f:S)}function se(i,s,c,f,b){if(Hn(i))throw Error(A(485));if(i=s.action,i!==null){var T={payload:b,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(j){T.listeners.push(j)}};He.T!==null?c(!0):T.isTransition=!1,f(T),c=s.pending,c===null?(T.next=s.pending=T,de(s,T)):(T.next=c.next,s.pending=c.next=T)}}function de(i,s){var c=s.action,f=s.payload,b=i.state;if(s.isTransition){var T=He.T,j={};He.T=j;try{var H=c(b,f),ye=He.S;ye!==null&&ye(j,H),ge(i,s,H)}catch(Fe){Te(i,s,Fe)}finally{T!==null&&j.types!==null&&(T.types=j.types),He.T=T}}else try{T=c(b,f),ge(i,s,T)}catch(Fe){Te(i,s,Fe)}}function ge(i,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){ce(i,s,f)},function(f){return Te(i,s,f)}):ce(i,s,c)}function ce(i,s,c){s.status="fulfilled",s.value=c,Oe(s),i.state=c,s=i.pending,s!==null&&(c=s.next,c===s?i.pending=null:(c=c.next,s.next=c,de(i,c)))}function Te(i,s,c){var f=i.pending;if(i.pending=null,f!==null){f=f.next;do s.status="rejected",s.reason=c,Oe(s),s=s.next;while(s!==f)}i.action=null}function Oe(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function Re(i,s){return s}function Le(i,s){if(bi){var c=hr.formState;if(c!==null){e:{var f=hi;if(bi){if(Xi){t:{for(var b=Xi,T=On;b.nodeType!==8;){if(!T){b=null;break t}if(b=Ca(b.nextSibling),b===null){b=null;break t}}T=b.data,b=T==="F!"||T==="F"?b:null}if(b){Xi=Ca(b.nextSibling),f=b.data==="F!";break e}}Zn(f)}f=!1}f&&(s=c[0])}}return c=a(),c.memoizedState=c.baseState=s,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Re,lastRenderedState:s},c.queue=f,c=Cr.bind(null,hi,f),f.dispatch=c,f=oe(!1),T=Ya.bind(null,hi,!1,f.queue),f=a(),b={state:s,dispatch:null,action:i,pending:null},f.queue=b,c=se.bind(null,hi,b,T,c),b.dispatch=c,f.memoizedState=i,[s,c,!1]}function Be(i){var s=l();return nt(s,Ni,i)}function nt(i,s,c){if(s=I(i,s,Re)[0],i=E(S)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var f=g(s)}catch(j){throw j===No?hc:j}else f=s;s=l();var b=s.queue,T=b.dispatch;return c!==s.memoizedState&&(hi.flags|=2048,bt(9,{destroy:void 0},at.bind(null,b,c),null)),[f,T,i]}function at(i,s){i.action=s}function et(i){var s=l(),c=Ni;if(c!==null)return nt(s,c,i);l(),s=s.memoizedState,c=l();var f=c.queue.dispatch;return c.memoizedState=i,[s,f,!1]}function bt(i,s,c,f){return i={tag:i,create:c,deps:f,inst:s,next:null},s=hi.updateQueue,s===null&&(s=d(),hi.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=i.next=i:(f=c.next,c.next=i,i.next=f,s.lastEffect=i),i}function Wt(){return l().memoizedState}function Ai(i,s,c,f){var b=a();hi.flags|=i,b.memoizedState=bt(1|s,{destroy:void 0},c,f===void 0?null:f)}function Qi(i,s,c,f){var b=l();f=f===void 0?null:f;var T=b.memoizedState.inst;Ni!==null&&f!==null&&El(f,Ni.memoizedState.deps)?b.memoizedState=bt(s,T,c,f):(hi.flags|=i,b.memoizedState=bt(1|s,T,c,f))}function tr(i,s){Ai(8390656,8,i,s)}function ci(i,s){Qi(2048,8,i,s)}function ir(i){hi.flags|=4;var s=hi.updateQueue;if(s===null)s=d(),hi.updateQueue=s,s.events=[i];else{var c=s.events;c===null?s.events=[i]:c.push(i)}}function Ur(i){var s=l().memoizedState;return ir({ref:s,nextImpl:i}),function(){if((Oi&2)!==0)throw Error(A(440));return s.impl.apply(void 0,arguments)}}function _r(i,s){return Qi(4,2,i,s)}function Kr(i,s){return Qi(4,4,i,s)}function kr(i,s){if(typeof s=="function"){i=i();var c=s(i);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function zr(i,s,c){c=c!=null?c.concat([i]):null,Qi(4,4,kr.bind(null,s,i),c)}function $r(){}function zs(i,s){var c=l();s=s===void 0?null:s;var f=c.memoizedState;return s!==null&&El(s,f[1])?f[0]:(c.memoizedState=[i,s],i)}function Is(i,s){var c=l();s=s===void 0?null:s;var f=c.memoizedState;if(s!==null&&El(s,f[1]))return f[0];if(f=i(),us){le(!0);try{i()}finally{le(!1)}}return c.memoizedState=[f,s],f}function Ps(i,s,c){return c===void 0||(Gi&1073741824)!==0&&(ji&261930)===0?i.memoizedState=s:(i.memoizedState=c,i=sp(),hi.lanes|=i,Ol|=i,c)}function Ds(i,s,c,f){return Gn(c,s)?c:Mt.current!==null?(i=Ps(i,c,f),Gn(i,s)||(Qr=!0),i):(Gi&42)===0||(Gi&1073741824)!==0&&(ji&261930)===0?(Qr=!0,i.memoizedState=c):(i=sp(),hi.lanes|=i,Ol|=i,s)}function po(i,s,c,f,b){var T=gt.p;gt.p=T!==0&&8>T?T:8;var j=He.T,H={};He.T=H,Ya(i,!1,s,c);try{var ye=b(),Fe=He.S;if(Fe!==null&&Fe(H,ye),ye!==null&&typeof ye=="object"&&typeof ye.then=="function"){var Je=Ud(ye,f);Wa(i,s,Je,ka(i))}else Wa(i,s,f,ka(i))}catch(rt){Wa(i,s,{then:function(){},status:"rejected",reason:rt},ka())}finally{gt.p=T,j!==null&&H.types!==null&&(j.types=H.types),He.T=j}}function yc(){}function ds(i,s,c,f){if(i.tag!==5)throw Error(A(476));var b=Sn(i).queue;po(i,b,s,Ot,c===null?yc:function(){return fn(i),c(f)})}function Sn(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:Ot,baseState:Ot,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:S,lastRenderedState:Ot},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:S,lastRenderedState:c},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function fn(i){var s=Sn(i);s.next===null&&(s=i.alternate.memoizedState),Wa(i,s.next.queue,{},ka())}function Ta(){return sn(Ue)}function Wo(){return l().memoizedState}function jr(){return l().memoizedState}function ln(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var c=ka();i=co(c);var f=qa(s,i,c);f!==null&&(Xn(f,s,c),uo(f,s,c)),s={cache:vn()},i.payload=s;return}s=s.return}}function qn(i,s,c){var f=ka();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Hn(i)?Rs(s,c):(c=Ws(i,s,c,f),c!==null&&(Xn(c,i,f),ih(c,s,f)))}function Cr(i,s,c){var f=ka();Wa(i,s,c,f)}function Wa(i,s,c,f){var b={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Hn(i))Rs(s,b);else{var T=i.alternate;if(i.lanes===0&&(T===null||T.lanes===0)&&(T=s.lastRenderedReducer,T!==null))try{var j=s.lastRenderedState,H=T(j,c);if(b.hasEagerState=!0,b.eagerState=H,Gn(H,j))return ac(i,s,b,0),hr===null&&Oo(),!1}catch{}finally{}if(c=Ws(i,s,b,f),c!==null)return Xn(c,i,f),ih(c,s,f),!0}return!1}function Ya(i,s,c,f){if(f={lane:2,revertLane:Fl(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Hn(i)){if(s)throw Error(A(479))}else s=Ws(i,c,f,2),s!==null&&Xn(s,i,2)}function Hn(i){var s=i.alternate;return i===hi||s!==null&&s===hi}function Rs(i,s){cs=qo=!0;var c=i.pending;c===null?s.next=s:(s.next=c.next,c.next=s),i.pending=s}function ih(i,s,c){if((c&4194048)!==0){var f=s.lanes;f&=i.pendingLanes,c|=f,s.lanes=c,ze(i,c)}}var zl={readContext:sn,use:_,useCallback:vr,useContext:vr,useEffect:vr,useImperativeHandle:vr,useLayoutEffect:vr,useInsertionEffect:vr,useMemo:vr,useReducer:vr,useRef:vr,useState:vr,useDebugValue:vr,useDeferredValue:vr,useTransition:vr,useSyncExternalStore:vr,useId:vr,useHostTransitionStatus:vr,useFormState:vr,useActionState:vr,useOptimistic:vr,useMemoCache:vr,useCacheRefresh:vr};zl.useEffectEvent=vr;var Ls={readContext:sn,use:_,useCallback:function(i,s){return a().memoizedState=[i,s===void 0?null:s],i},useContext:sn,useEffect:tr,useImperativeHandle:function(i,s,c){c=c!=null?c.concat([i]):null,Ai(4194308,4,kr.bind(null,s,i),c)},useLayoutEffect:function(i,s){return Ai(4194308,4,i,s)},useInsertionEffect:function(i,s){Ai(4,2,i,s)},useMemo:function(i,s){var c=a();s=s===void 0?null:s;var f=i();if(us){le(!0);try{i()}finally{le(!1)}}return c.memoizedState=[f,s],f},useReducer:function(i,s,c){var f=a();if(c!==void 0){var b=c(s);if(us){le(!0);try{c(s)}finally{le(!1)}}}else b=s;return f.memoizedState=f.baseState=b,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:b},f.queue=i,i=i.dispatch=qn.bind(null,hi,i),[f.memoizedState,i]},useRef:function(i){var s=a();return i={current:i},s.memoizedState=i},useState:function(i){i=oe(i);var s=i.queue,c=Cr.bind(null,hi,s);return s.dispatch=c,[i.memoizedState,c]},useDebugValue:$r,useDeferredValue:function(i,s){var c=a();return Ps(c,i,s)},useTransition:function(){var i=oe(!1);return i=po.bind(null,hi,i.queue,!0,!1),a().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,c){var f=hi,b=a();if(bi){if(c===void 0)throw Error(A(407));c=c()}else{if(c=s(),hr===null)throw Error(A(349));(ji&127)!==0||$(f,s,c)}b.memoizedState=c;var T={value:c,getSnapshot:s};return b.queue=T,tr(K.bind(null,f,T,i),[i]),f.flags|=2048,bt(9,{destroy:void 0},Z.bind(null,f,T,c,s),null),c},useId:function(){var i=a(),s=hr.identifierPrefix;if(bi){var c=jn,f=$a;c=(f&~(1<<32-fe(f)-1)).toString(32)+c,s="_"+s+"R_"+c,c=hs++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=Xo++,s="_"+s+"r_"+c.toString(32)+"_";return i.memoizedState=s},useHostTransitionStatus:Ta,useFormState:Le,useActionState:Le,useOptimistic:function(i){var s=a();s.memoizedState=s.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=Ya.bind(null,hi,!0,c),c.dispatch=s,[i,s]},useMemoCache:w,useCacheRefresh:function(){return a().memoizedState=ln.bind(null,hi)},useEffectEvent:function(i){var s=a(),c={impl:i};return s.memoizedState=c,function(){if((Oi&2)!==0)throw Error(A(440));return c.impl.apply(void 0,arguments)}}},ps={readContext:sn,use:_,useCallback:zs,useContext:sn,useEffect:ci,useImperativeHandle:zr,useInsertionEffect:_r,useLayoutEffect:Kr,useMemo:Is,useReducer:E,useRef:Wt,useState:function(){return E(S)},useDebugValue:$r,useDeferredValue:function(i,s){var c=l();return Ds(c,Ni.memoizedState,i,s)},useTransition:function(){var i=E(S)[0],s=l().memoizedState;return[typeof i=="boolean"?i:g(i),s]},useSyncExternalStore:R,useId:Wo,useHostTransitionStatus:Ta,useFormState:Be,useActionState:Be,useOptimistic:function(i,s){var c=l();return he(c,Ni,i,s)},useMemoCache:w,useCacheRefresh:jr};ps.useEffectEvent=Ur;var rh={readContext:sn,use:_,useCallback:zs,useContext:sn,useEffect:ci,useImperativeHandle:zr,useInsertionEffect:_r,useLayoutEffect:Kr,useMemo:Is,useReducer:L,useRef:Wt,useState:function(){return L(S)},useDebugValue:$r,useDeferredValue:function(i,s){var c=l();return Ni===null?Ps(c,i,s):Ds(c,Ni.memoizedState,i,s)},useTransition:function(){var i=L(S)[0],s=l().memoizedState;return[typeof i=="boolean"?i:g(i),s]},useSyncExternalStore:R,useId:Wo,useHostTransitionStatus:Ta,useFormState:et,useActionState:et,useOptimistic:function(i,s){var c=l();return Ni!==null?he(c,Ni,i,s):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:w,useCacheRefresh:jr};rh.useEffectEvent=Ur;function _c(i,s,c,f){s=i.memoizedState,c=c(f,s),c=c==null?s:De({},s,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var Yo={enqueueSetState:function(i,s,c){i=i._reactInternals;var f=ka(),b=co(f);b.payload=s,c!=null&&(b.callback=c),s=qa(i,b,f),s!==null&&(Xn(s,i,f),uo(s,i,f))},enqueueReplaceState:function(i,s,c){i=i._reactInternals;var f=ka(),b=co(f);b.tag=1,b.payload=s,c!=null&&(b.callback=c),s=qa(i,b,f),s!==null&&(Xn(s,i,f),uo(s,i,f))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var c=ka(),f=co(c);f.tag=2,s!=null&&(f.callback=s),s=qa(i,f,c),s!==null&&(Xn(s,i,c),uo(s,i,c))}};function fu(i,s,c,f,b,T,j){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,T,j):s.prototype&&s.prototype.isPureReactComponent?!Xs(c,f)||!Xs(b,T):!0}function fs(i,s,c,f){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,f),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,f),s.state!==i&&Yo.enqueueReplaceState(s,s.state,null)}function Ka(i,s){var c=s;if("ref"in s){c={};for(var f in s)f!=="ref"&&(c[f]=s[f])}if(i=i.defaultProps){c===s&&(c=De({},c));for(var b in i)c[b]===void 0&&(c[b]=i[b])}return c}function $d(i){as(i)}function Fp(i){console.error(i)}function Qh(i){as(i)}function nh(i,s){try{var c=i.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(f){setTimeout(function(){throw f})}}function ah(i,s,c){try{var f=i.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Jh(i,s,c){return c=co(c),c.tag=3,c.payload={element:null},c.callback=function(){nh(i,s)},c}function Up(i){return i=co(i),i.tag=3,i}function ed(i,s,c,f){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var T=f.value;i.payload=function(){return b(T)},i.callback=function(){ah(s,c,f)}}var j=c.stateNode;j!==null&&typeof j.componentDidCatch=="function"&&(i.callback=function(){ah(s,c,f),typeof b!="function"&&(tl===null?tl=new Set([this]):tl.add(this));var H=f.stack;this.componentDidCatch(f.value,{componentStack:H!==null?H:""})})}function Rf(i,s,c,f,b){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(s=c.alternate,s!==null&&na(s,c,b,!0),c=cr.current,c!==null){switch(c.tag){case 31:case 13:return aa===null?pd():c.alternate===null&&Vr===0&&(Vr=3),c.flags&=-257,c.flags|=65536,c.lanes=b,f===ao?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([f]):s.add(f),wh(i,f,b)),!1;case 22:return c.flags|=65536,f===ao?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([f]):c.add(f)),wh(i,f,b)),!1}throw Error(A(435,c.tag))}return wh(i,f,b),pd(),!1}if(bi)return s=cr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,f!==or&&(i=Error(A(422),{cause:f}),to(Rn(i,c)))):(f!==or&&(s=Error(A(423),{cause:f}),to(Rn(s,c))),i=i.current.alternate,i.flags|=65536,b&=-b,i.lanes|=b,f=Rn(f,c),b=Jh(i.stateNode,f,b),fc(i,b),Vr!==4&&(Vr=2)),!1;var T=Error(A(520),{cause:f});if(T=Rn(T,c),Cc===null?Cc=[T]:Cc.push(T),Vr!==4&&(Vr=2),s===null)return!0;f=Rn(f,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,i=b&-b,c.lanes|=i,i=Jh(c.stateNode,f,i),fc(c,i),!1;case 1:if(s=c.type,T=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(tl===null||!tl.has(T))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Up(b),ed(b,i,c,f),fc(c,b),!1}c=c.return}while(c!==null);return!1}var sh=Error(A(461)),Qr=!1;function Tn(i,s,c,f){s.child=i===null?th(s,null,c,f):oo(s,i.child,c,f)}function xc(i,s,c,f,b){c=c.render;var T=s.ref;if("ref"in f){var j={};for(var H in f)H!=="ref"&&(j[H]=f[H])}else j=f;return ro(s),f=As(i,s,c,j,T,b),H=Al(),i!==null&&!Qr?(p(i,s,b),js(i,s,b)):(bi&&H&&Ml(s),s.flags|=1,Tn(i,s,f,b),s.child)}function $p(i,s,c,f,b){if(i===null){var T=c.type;return typeof T=="function"&&!tu(T)&&T.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=T,vc(i,s,T,f,b)):(i=iu(c.type,null,f,s,s.mode,b),i.ref=s.ref,i.return=s,s.child=i)}if(T=i.child,!Hd(i,b)){var j=T.memoizedProps;if(c=c.compare,c=c!==null?c:Xs,c(j,f)&&i.ref===s.ref)return js(i,s,b)}return s.flags|=1,i=ia(T,f),i.ref=s.ref,i.return=s,s.child=i}function vc(i,s,c,f,b){if(i!==null){var T=i.memoizedProps;if(Xs(T,f)&&i.ref===s.ref)if(Qr=!1,s.pendingProps=f=T,Hd(i,b))(i.flags&131072)!==0&&(Qr=!0);else return s.lanes=i.lanes,js(i,s,b)}return ch(i,s,c,f,b)}function oh(i,s,c,f){var b=f.children,T=i!==null?i.memoizedState:null;if(i===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((s.flags&128)!==0){if(T=T!==null?T.baseLanes|c:c,i!==null){for(f=s.child=i.child,b=0;f!==null;)b=b|f.lanes|f.childLanes,f=f.sibling;f=b&~T}else f=0,s.child=null;return Vp(i,s,T,c,f)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&wa(s,T!==null?T.cachePool:null),T!==null?Go(s,T):gc(),Kh(s);else return f=s.lanes=536870912,Vp(i,s,T!==null?T.baseLanes|c:c,c,f)}else T!==null?(wa(s,T.cachePool),Go(s,T),sa(),s.memoizedState=null):(i!==null&&wa(s,null),gc(),sa());return Tn(i,s,b,c),s.child}function Il(i,s){return i!==null&&i.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Vp(i,s,c,f,b){var T=Ga();return T=T===null?null:{parent:lr._currentValue,pool:T},s.memoizedState={baseLanes:c,cachePool:T},i!==null&&wa(s,null),gc(),Kh(s),i!==null&&na(i,s,f,!0),s.childLanes=b,null}function td(i,s){return s=hh({mode:s.mode,children:s.children},i.mode),s.ref=i.ref,i.child=s,s.return=i,s}function Gp(i,s,c){return oo(s,i.child,null,c),i=td(s,s.pendingProps),i.flags|=2,oa(s),s.memoizedState=null,i}function Lf(i,s,c){var f=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,i===null){if(bi){if(f.mode==="hidden")return i=td(s,f),s.lanes=536870912,Il(null,i);if(uu(s),(i=Xi)?(i=bf(i,On),i=i!==null&&i.data==="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Ua!==null?{id:$a,overflow:jn}:null,retryLane:536870912,hydrationErrors:null},c=sc(i),c.return=s,s.child=c,Yr=s,Xi=null)):i=null,i===null)throw Zn(s);return s.lanes=536870912,null}return td(s,f)}var T=i.memoizedState;if(T!==null){var j=T.dehydrated;if(uu(s),b)if(s.flags&256)s.flags&=-257,s=Gp(i,s,c);else if(s.memoizedState!==null)s.child=i.child,s.flags|=128,s=null;else throw Error(A(558));else if(Qr||na(i,s,c,!1),b=(c&i.childLanes)!==0,Qr||b){if(f=hr,f!==null&&(j=Ke(f,c),j!==0&&j!==T.retryLane))throw T.retryLane=j,va(i,j),Xn(f,i,j),sh;pd(),s=Gp(i,s,c)}else i=T.treeContext,Xi=Ca(j.nextSibling),Yr=s,bi=!0,ss=null,On=!1,i!==null&&ru(s,i),s=td(s,f),s.flags|=4096;return s}return i=ia(i.child,{mode:f.mode,children:f.children}),i.ref=s.ref,s.child=i,i.return=s,i}function lh(i,s){var c=s.ref;if(c===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(A(284));(i===null||i.ref!==c)&&(s.flags|=4194816)}}function ch(i,s,c,f,b){return ro(s),c=As(i,s,c,f,void 0,b),f=Al(),i!==null&&!Qr?(p(i,s,b),js(i,s,b)):(bi&&f&&Ml(s),s.flags|=1,Tn(i,s,c,b),s.child)}function Vd(i,s,c,f,b,T){return ro(s),s.updateQueue=null,c=du(s,f,c,b),hu(i),f=Al(),i!==null&&!Qr?(p(i,s,T),js(i,s,T)):(bi&&f&&Ml(s),s.flags|=1,Tn(i,s,c,T),s.child)}function Gd(i,s,c,f,b){if(ro(s),s.stateNode===null){var T=li,j=c.contextType;typeof j=="object"&&j!==null&&(T=sn(j)),T=new c(f,T),s.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=Yo,s.stateNode=T,T._reactInternals=s,T=s.stateNode,T.props=f,T.state=s.memoizedState,T.refs={},Za(s),j=c.contextType,T.context=typeof j=="object"&&j!==null?sn(j):li,T.state=s.memoizedState,j=c.getDerivedStateFromProps,typeof j=="function"&&(_c(s,c,j,f),T.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(j=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),j!==T.state&&Yo.enqueueReplaceState(T,T.state,null),ho(s,f,T,b),$o(),T.state=s.memoizedState),typeof T.componentDidMount=="function"&&(s.flags|=4194308),f=!0}else if(i===null){T=s.stateNode;var H=s.memoizedProps,ye=Ka(c,H);T.props=ye;var Fe=T.context,Je=c.contextType;j=li,typeof Je=="object"&&Je!==null&&(j=sn(Je));var rt=c.getDerivedStateFromProps;Je=typeof rt=="function"||typeof T.getSnapshotBeforeUpdate=="function",H=s.pendingProps!==H,Je||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(H||Fe!==j)&&fs(s,T,f,j),lo=!1;var $e=s.memoizedState;T.state=$e,ho(s,f,T,b),$o(),Fe=s.memoizedState,H||$e!==Fe||lo?(typeof rt=="function"&&(_c(s,c,rt,f),Fe=s.memoizedState),(ye=lo||fu(s,c,ye,f,$e,Fe,j))?(Je||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(s.flags|=4194308)):(typeof T.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=f,s.memoizedState=Fe),T.props=f,T.state=Fe,T.context=j,f=ye):(typeof T.componentDidMount=="function"&&(s.flags|=4194308),f=!1)}else{T=s.stateNode,Vi(i,s),j=s.memoizedProps,Je=Ka(c,j),T.props=Je,rt=s.pendingProps,$e=T.context,Fe=c.contextType,ye=li,typeof Fe=="object"&&Fe!==null&&(ye=sn(Fe)),H=c.getDerivedStateFromProps,(Fe=typeof H=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(j!==rt||$e!==ye)&&fs(s,T,f,ye),lo=!1,$e=s.memoizedState,T.state=$e,ho(s,f,T,b),$o();var qe=s.memoizedState;j!==rt||$e!==qe||lo||i!==null&&i.dependencies!==null&&ks(i.dependencies)?(typeof H=="function"&&(_c(s,c,H,f),qe=s.memoizedState),(Je=lo||fu(s,c,Je,f,$e,qe,ye)||i!==null&&i.dependencies!==null&&ks(i.dependencies))?(Fe||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,qe,ye),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,qe,ye)),typeof T.componentDidUpdate=="function"&&(s.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof T.componentDidUpdate!="function"||j===i.memoizedProps&&$e===i.memoizedState||(s.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||j===i.memoizedProps&&$e===i.memoizedState||(s.flags|=1024),s.memoizedProps=f,s.memoizedState=qe),T.props=f,T.state=qe,T.context=ye,f=Je):(typeof T.componentDidUpdate!="function"||j===i.memoizedProps&&$e===i.memoizedState||(s.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||j===i.memoizedProps&&$e===i.memoizedState||(s.flags|=1024),f=!1)}return T=f,lh(i,s),f=(s.flags&128)!==0,T||f?(T=s.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:T.render(),s.flags|=1,i!==null&&f?(s.child=oo(s,i.child,null,b),s.child=oo(s,null,c,b)):Tn(i,s,c,b),s.memoizedState=T.state,i=s.child):i=js(i,s,b),i}function Zp(i,s,c,f){return Js(),s.flags|=256,Tn(i,s,c,f),s.child}var Zd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function id(i){return{baseLanes:i,cachePool:_t()}}function rd(i,s,c){return i=i!==null?i.childLanes&~c:0,s&&(i|=Ja),i}function qp(i,s,c){var f=s.pendingProps,b=!1,T=(s.flags&128)!==0,j;if((j=T)||(j=i!==null&&i.memoizedState===null?!1:(yr.current&2)!==0),j&&(b=!0,s.flags&=-129),j=(s.flags&32)!==0,s.flags&=-33,i===null){if(bi){if(b?on(s):sa(),(i=Xi)?(i=bf(i,On),i=i!==null&&i.data!=="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Ua!==null?{id:$a,overflow:jn}:null,retryLane:536870912,hydrationErrors:null},c=sc(i),c.return=s,s.child=c,Yr=s,Xi=null)):i=null,i===null)throw Zn(s);return $l(i)?s.lanes=32:s.lanes=536870912,null}var H=f.children;return f=f.fallback,b?(sa(),b=s.mode,H=hh({mode:"hidden",children:H},b),f=Ys(f,b,c,null),H.return=s,f.return=s,H.sibling=f,s.child=H,f=s.child,f.memoizedState=id(c),f.childLanes=rd(i,j,c),s.memoizedState=Zd,Il(null,f)):(on(s),uh(s,H))}var ye=i.memoizedState;if(ye!==null&&(H=ye.dehydrated,H!==null)){if(T)s.flags&256?(on(s),s.flags&=-257,s=dh(i,s,c)):s.memoizedState!==null?(sa(),s.child=i.child,s.flags|=128,s=null):(sa(),H=f.fallback,b=s.mode,f=hh({mode:"visible",children:f.children},b),H=Ys(H,b,c,null),H.flags|=2,f.return=s,H.return=s,f.sibling=H,s.child=f,oo(s,i.child,null,c),f=s.child,f.memoizedState=id(c),f.childLanes=rd(i,j,c),s.memoizedState=Zd,s=Il(null,f));else if(on(s),$l(H)){if(j=H.nextSibling&&H.nextSibling.dataset,j)var Fe=j.dgst;j=Fe,f=Error(A(419)),f.stack="",f.digest=j,to({value:f,source:null,stack:null}),s=dh(i,s,c)}else if(Qr||na(i,s,c,!1),j=(c&i.childLanes)!==0,Qr||j){if(j=hr,j!==null&&(f=Ke(j,c),f!==0&&f!==ye.retryLane))throw ye.retryLane=f,va(i,f),Xn(j,i,f),sh;Ap(H)||pd(),s=dh(i,s,c)}else Ap(H)?(s.flags|=192,s.child=i.child,s=null):(i=ye.treeContext,Xi=Ca(H.nextSibling),Yr=s,bi=!0,ss=null,On=!1,i!==null&&ru(s,i),s=uh(s,f.children),s.flags|=4096);return s}return b?(sa(),H=f.fallback,b=s.mode,ye=i.child,Fe=ye.sibling,f=ia(ye,{mode:"hidden",children:f.children}),f.subtreeFlags=ye.subtreeFlags&65011712,Fe!==null?H=ia(Fe,H):(H=Ys(H,b,c,null),H.flags|=2),H.return=s,f.return=s,f.sibling=H,s.child=f,Il(null,f),f=s.child,H=i.child.memoizedState,H===null?H=id(c):(b=H.cachePool,b!==null?(ye=lr._currentValue,b=b.parent!==ye?{parent:ye,pool:ye}:b):b=_t(),H={baseLanes:H.baseLanes|c,cachePool:b}),f.memoizedState=H,f.childLanes=rd(i,j,c),s.memoizedState=Zd,Il(i.child,f)):(on(s),c=i.child,i=c.sibling,c=ia(c,{mode:"visible",children:f.children}),c.return=s,c.sibling=null,i!==null&&(j=s.deletions,j===null?(s.deletions=[i],s.flags|=16):j.push(i)),s.child=c,s.memoizedState=null,c)}function uh(i,s){return s=hh({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function hh(i,s){return i=ta(22,i,null,s),i.lanes=0,i}function dh(i,s,c){return oo(s,i.child,null,c),i=uh(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function mu(i,s,c){i.lanes|=s;var f=i.alternate;f!==null&&(f.lanes|=s),au(i.return,s,c)}function Nn(i,s,c,f,b,T){var j=i.memoizedState;j===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:b,treeForkCount:T}:(j.isBackwards=s,j.rendering=null,j.renderingStartTime=0,j.last=f,j.tail=c,j.tailMode=b,j.treeForkCount=T)}function qd(i,s,c){var f=s.pendingProps,b=f.revealOrder,T=f.tail;f=f.children;var j=yr.current,H=(j&2)!==0;if(H?(j=j&1|2,s.flags|=128):j&=1,yt(yr,j),Tn(i,s,f,c),f=bi?Ss:0,!H&&i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&mu(i,c,s);else if(i.tag===19)mu(i,c,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(b){case"forwards":for(c=s.child,b=null;c!==null;)i=c.alternate,i!==null&&ur(i)===null&&(b=c),c=c.sibling;c=b,c===null?(b=s.child,s.child=null):(b=c.sibling,c.sibling=null),Nn(s,!1,b,c,T,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=s.child,s.child=null;b!==null;){if(i=b.alternate,i!==null&&ur(i)===null){s.child=b;break}i=b.sibling,b.sibling=c,c=b,b=i}Nn(s,!0,c,null,T,f);break;case"together":Nn(s,!1,null,null,void 0,f);break;default:s.memoizedState=null}return s.child}function js(i,s,c){if(i!==null&&(s.dependencies=i.dependencies),Ol|=s.lanes,(c&s.childLanes)===0)if(i!==null){if(na(i,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(A(153));if(s.child!==null){for(i=s.child,c=ia(i,i.pendingProps),s.child=c,c.return=s;i.sibling!==null;)i=i.sibling,c=c.sibling=ia(i,i.pendingProps),c.return=s;c.sibling=null}return s.child}function Hd(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&ks(i)))}function Hp(i,s,c){switch(s.tag){case 3:$i(s,s.stateNode.containerInfo),ls(s,lr,i.memoizedState.cache),Js();break;case 27:case 5:Cn(s);break;case 4:$i(s,s.stateNode.containerInfo);break;case 10:ls(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,uu(s),null;break;case 13:var f=s.memoizedState;if(f!==null)return f.dehydrated!==null?(on(s),s.flags|=128,null):(c&s.child.childLanes)!==0?qp(i,s,c):(on(s),i=js(i,s,c),i!==null?i.sibling:null);on(s);break;case 19:var b=(i.flags&128)!==0;if(f=(c&s.childLanes)!==0,f||(na(i,s,c,!1),f=(c&s.childLanes)!==0),b){if(f)return qd(i,s,c);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),yt(yr,yr.current),f)break;return null;case 22:return s.lanes=0,oh(i,s,c,s.pendingProps);case 24:ls(s,lr,i.memoizedState.cache)}return js(i,s,c)}function Xp(i,s,c){if(i!==null)if(i.memoizedProps!==s.pendingProps)Qr=!0;else{if(!Hd(i,c)&&(s.flags&128)===0)return Qr=!1,Hp(i,s,c);Qr=(i.flags&131072)!==0}else Qr=!1,bi&&(s.flags&1048576)!==0&&Ku(s,Ss,s.index);switch(s.lanes=0,s.tag){case 16:e:{var f=s.pendingProps;if(i=si(s.elementType),s.type=i,typeof i=="function")tu(i)?(f=Ka(i,f),s.tag=1,s=Gd(null,s,i,f,c)):(s.tag=0,s=ch(null,s,i,f,c));else{if(i!=null){var b=i.$$typeof;if(b===Fi){s.tag=11,s=xc(null,s,i,f,c);break e}else if(b===Ft){s.tag=14,s=$p(null,s,i,f,c);break e}}throw s=Kt(i)||i,Error(A(306,s,""))}}return s;case 0:return ch(i,s,s.type,s.pendingProps,c);case 1:return f=s.type,b=Ka(f,s.pendingProps),Gd(i,s,f,b,c);case 3:e:{if($i(s,s.stateNode.containerInfo),i===null)throw Error(A(387));f=s.pendingProps;var T=s.memoizedState;b=T.element,Vi(i,s),ho(s,f,null,c);var j=s.memoizedState;if(f=j.cache,ls(s,lr,f),f!==T.cache&&cc(s,[lr],c,!0),$o(),f=j.element,T.isDehydrated)if(T={element:f,isDehydrated:!1,cache:j.cache},s.updateQueue.baseState=T,s.memoizedState=T,s.flags&256){s=Zp(i,s,f,c);break e}else if(f!==b){b=Rn(Error(A(424)),s),to(b),s=Zp(i,s,f,c);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Xi=Ca(i.firstChild),Yr=s,bi=!0,ss=null,On=!0,c=th(s,null,f,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Js(),f===b){s=js(i,s,c);break e}Tn(i,s,f,c)}s=s.child}return s;case 26:return lh(i,s),i===null?(c=kf(s.type,null,s.pendingProps,null))?s.memoizedState=c:bi||(c=s.type,i=s.pendingProps,f=Md(Gt.current).createElement(c),f[di]=s,f[Ze]=i,en(f,c,i),Er(f),s.stateNode=f):s.memoizedState=kf(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return Cn(s),i===null&&bi&&(f=s.stateNode=wf(s.type,s.pendingProps,Gt.current),Yr=s,On=!0,b=Xi,Fs(s.type)?(Ad=b,Xi=Ca(f.firstChild)):Xi=b),Tn(i,s,s.pendingProps.children,c),lh(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&bi&&((b=f=Xi)&&(f=Ed(f,s.type,s.pendingProps,On),f!==null?(s.stateNode=f,Yr=s,Xi=Ca(f.firstChild),On=!1,b=!0):b=!1),b||Zn(s)),Cn(s),b=s.type,T=s.pendingProps,j=i!==null?i.memoizedProps:null,f=T.children,kd(b,T)?f=null:j!==null&&kd(b,j)&&(s.flags|=32),s.memoizedState!==null&&(b=As(i,s,pu,null,null,c),Ue._currentValue=b),lh(i,s),Tn(i,s,f,c),s.child;case 6:return i===null&&bi&&((i=c=Xi)&&(c=Wf(c,s.pendingProps,On),c!==null?(s.stateNode=c,Yr=s,Xi=null,i=!0):i=!1),i||Zn(s)),null;case 13:return qp(i,s,c);case 4:return $i(s,s.stateNode.containerInfo),f=s.pendingProps,i===null?s.child=oo(s,null,f,c):Tn(i,s,f,c),s.child;case 11:return xc(i,s,s.type,s.pendingProps,c);case 7:return Tn(i,s,s.pendingProps,c),s.child;case 8:return Tn(i,s,s.pendingProps.children,c),s.child;case 12:return Tn(i,s,s.pendingProps.children,c),s.child;case 10:return f=s.pendingProps,ls(s,s.type,f.value),Tn(i,s,f.children,c),s.child;case 9:return b=s.type._context,f=s.pendingProps.children,ro(s),b=sn(b),f=f(b),s.flags|=1,Tn(i,s,f,c),s.child;case 14:return $p(i,s,s.type,s.pendingProps,c);case 15:return vc(i,s,s.type,s.pendingProps,c);case 19:return qd(i,s,c);case 31:return Lf(i,s,c);case 22:return oh(i,s,c,s.pendingProps);case 24:return ro(s),f=sn(lr),i===null?(b=Ga(),b===null&&(b=hr,T=vn(),b.pooledCache=T,T.refCount++,T!==null&&(b.pooledCacheLanes|=c),b=T),s.memoizedState={parent:f,cache:b},Za(s),ls(s,lr,b)):((i.lanes&c)!==0&&(Vi(i,s),ho(s,null,null,c),$o()),b=i.memoizedState,T=s.memoizedState,b.parent!==f?(b={parent:f,cache:f},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),ls(s,lr,f)):(f=T.cache,ls(s,lr,f),f!==b.cache&&cc(s,[lr],c,!0))),Tn(i,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(A(156,s.tag))}function Ko(i){i.flags|=4}function nd(i,s,c,f,b){if((s=(i.mode&32)!==0)&&(s=!1),s){if(i.flags|=16777216,(b&335544128)===b)if(i.stateNode.complete)i.flags|=8192;else if(sf())i.flags|=8192;else throw Sa=ao,Cs}else i.flags&=-16777217}function Wp(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!V(s))if(sf())i.flags|=8192;else throw Sa=ao,Cs}function gu(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?oi():536870912,i.lanes|=s,kc|=s)}function yu(i,s){if(!bi)switch(i.tailMode){case"hidden":s=i.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function br(i){var s=i.alternate!==null&&i.alternate.child===i.child,c=0,f=0;if(s)for(var b=i.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags&65011712,f|=b.flags&65011712,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)c|=b.lanes|b.childLanes,f|=b.subtreeFlags,f|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=f,i.childLanes=c,s}function jf(i,s,c){var f=s.pendingProps;switch(lc(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return br(s),null;case 1:return br(s),null;case 3:return c=s.stateNode,f=null,i!==null&&(f=i.memoizedState.cache),s.memoizedState.cache!==f&&(s.flags|=2048),Va(lr),vi(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(Ms(s)?Ko(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,eo())),br(s),null;case 26:var b=s.type,T=s.memoizedState;return i===null?(Ko(s),T!==null?(br(s),Wp(s,T)):(br(s),nd(s,b,null,f,c))):T?T!==i.memoizedState?(Ko(s),br(s),Wp(s,T)):(br(s),s.flags&=-16777217):(i=i.memoizedProps,i!==f&&Ko(s),br(s),nd(s,b,i,f,c)),null;case 27:if(_n(s),c=Gt.current,b=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==f&&Ko(s);else{if(!f){if(s.stateNode===null)throw Error(A(166));return br(s),null}i=kt.current,Ms(s)?ra(s):(i=wf(b,f,c),s.stateNode=i,Ko(s))}return br(s),null;case 5:if(_n(s),b=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==f&&Ko(s);else{if(!f){if(s.stateNode===null)throw Error(A(166));return br(s),null}if(T=kt.current,Ms(s))ra(s);else{var j=Md(Gt.current);switch(T){case 1:T=j.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:T=j.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":T=j.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":T=j.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":T=j.createElement("div"),T.innerHTML="<script><\/script>",T=T.removeChild(T.firstChild);break;case"select":T=typeof f.is=="string"?j.createElement("select",{is:f.is}):j.createElement("select"),f.multiple?T.multiple=!0:f.size&&(T.size=f.size);break;default:T=typeof f.is=="string"?j.createElement(b,{is:f.is}):j.createElement(b)}}T[di]=s,T[Ze]=f;e:for(j=s.child;j!==null;){if(j.tag===5||j.tag===6)T.appendChild(j.stateNode);else if(j.tag!==4&&j.tag!==27&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===s)break e;for(;j.sibling===null;){if(j.return===null||j.return===s)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}s.stateNode=T;e:switch(en(T,b,f),b){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&Ko(s)}}return br(s),nd(s,s.type,i===null?null:i.memoizedProps,s.pendingProps,c),null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==f&&Ko(s);else{if(typeof f!="string"&&s.stateNode===null)throw Error(A(166));if(i=Gt.current,Ms(s)){if(i=s.stateNode,c=s.memoizedProps,f=null,b=Yr,b!==null)switch(b.tag){case 27:case 5:f=b.memoizedProps}i[di]=s,i=!!(i.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||Tp(i.nodeValue,c)),i||Zn(s,!0)}else i=Md(i).createTextNode(f),i[di]=s,s.stateNode=i}return br(s),null;case 31:if(c=s.memoizedState,i===null||i.memoizedState!==null){if(f=Ms(s),c!==null){if(i===null){if(!f)throw Error(A(318));if(i=s.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(A(557));i[di]=s}else Js(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;br(s),i=!1}else c=eo(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=c),i=!0;if(!i)return s.flags&256?(oa(s),s):(oa(s),null);if((s.flags&128)!==0)throw Error(A(558))}return br(s),null;case 13:if(f=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(b=Ms(s),f!==null&&f.dehydrated!==null){if(i===null){if(!b)throw Error(A(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(A(317));b[di]=s}else Js(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;br(s),b=!1}else b=eo(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(oa(s),s):(oa(s),null)}return oa(s),(s.flags&128)!==0?(s.lanes=c,s):(c=f!==null,i=i!==null&&i.memoizedState!==null,c&&(f=s.child,b=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(b=f.alternate.memoizedState.cachePool.pool),T=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),T!==b&&(f.flags|=2048)),c!==i&&c&&(s.child.flags|=8192),gu(s,s.updateQueue),br(s),null);case 4:return vi(),i===null&&vd(s.stateNode.containerInfo),br(s),null;case 10:return Va(s.type),br(s),null;case 19:if(Ye(yr),f=s.memoizedState,f===null)return br(s),null;if(b=(s.flags&128)!==0,T=f.rendering,T===null)if(b)yu(f,!1);else{if(Vr!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(T=ur(i),T!==null){for(s.flags|=128,yu(f,!1),i=T.updateQueue,s.updateQueue=i,gu(s,i),s.subtreeFlags=0,i=c,c=s.child;c!==null;)Yu(c,i),c=c.sibling;return yt(yr,yr.current&1|2),bi&&Ts(s,f.treeForkCount),s.child}i=i.sibling}f.tail!==null&&dr()>Ec&&(s.flags|=128,b=!0,yu(f,!1),s.lanes=4194304)}else{if(!b)if(i=ur(T),i!==null){if(s.flags|=128,b=!0,i=i.updateQueue,s.updateQueue=i,gu(s,i),yu(f,!0),f.tail===null&&f.tailMode==="hidden"&&!T.alternate&&!bi)return br(s),null}else 2*dr()-f.renderingStartTime>Ec&&c!==536870912&&(s.flags|=128,b=!0,yu(f,!1),s.lanes=4194304);f.isBackwards?(T.sibling=s.child,s.child=T):(i=f.last,i!==null?i.sibling=T:s.child=T,f.last=T)}return f.tail!==null?(i=f.tail,f.rendering=i,f.tail=i.sibling,f.renderingStartTime=dr(),i.sibling=null,c=yr.current,yt(yr,b?c&1|2:c&1),bi&&Ts(s,f.treeForkCount),i):(br(s),null);case 22:case 23:return oa(s),Zo(),f=s.memoizedState!==null,i!==null?i.memoizedState!==null!==f&&(s.flags|=8192):f&&(s.flags|=8192),f?(c&536870912)!==0&&(s.flags&128)===0&&(br(s),s.subtreeFlags&6&&(s.flags|=8192)):br(s),c=s.updateQueue,c!==null&&gu(s,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),f=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(f=s.memoizedState.cachePool.pool),f!==c&&(s.flags|=2048),i!==null&&Ye(no),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),Va(lr),br(s),null;case 25:return null;case 30:return null}throw Error(A(156,s.tag))}function Of(i,s){switch(lc(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Va(lr),vi(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return _n(s),null;case 31:if(s.memoizedState!==null){if(oa(s),s.alternate===null)throw Error(A(340));Js()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 13:if(oa(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(A(340));Js()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return Ye(yr),null;case 4:return vi(),null;case 10:return Va(s.type),null;case 22:case 23:return oa(s),Zo(),i!==null&&Ye(no),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Va(lr),null;case 25:return null;default:return null}}function Yp(i,s){switch(lc(s),s.tag){case 3:Va(lr),vi();break;case 26:case 27:case 5:_n(s);break;case 4:vi();break;case 31:s.memoizedState!==null&&oa(s);break;case 13:oa(s);break;case 19:Ye(yr);break;case 10:Va(s.type);break;case 22:case 23:oa(s),Zo(),i!==null&&Ye(no);break;case 24:Va(lr)}}function Pl(i,s){try{var c=s.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var b=f.next;c=b;do{if((c.tag&i)===i){f=void 0;var T=c.create,j=c.inst;f=T(),j.destroy=f}c=c.next}while(c!==b)}}catch(H){Ji(s,s.return,H)}}function fo(i,s,c){try{var f=s.updateQueue,b=f!==null?f.lastEffect:null;if(b!==null){var T=b.next;f=T;do{if((f.tag&i)===i){var j=f.inst,H=j.destroy;if(H!==void 0){j.destroy=void 0,b=s;var ye=c,Fe=H;try{Fe()}catch(Je){Ji(b,ye,Je)}}}f=f.next}while(f!==T)}}catch(Je){Ji(s,s.return,Je)}}function Xd(i){var s=i.updateQueue;if(s!==null){var c=i.stateNode;try{Vo(s,c)}catch(f){Ji(i,i.return,f)}}}function Dl(i,s,c){c.props=Ka(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(f){Ji(i,s,f)}}function Qo(i,s){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var f=i.stateNode;break;case 30:f=i.stateNode;break;default:f=i.stateNode}typeof c=="function"?i.refCleanup=c(f):c.current=f}}catch(b){Ji(i,s,b)}}function mo(i,s){var c=i.ref,f=i.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(b){Ji(i,s,b)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){Ji(i,s,b)}else c.current=null}function Kp(i){var s=i.type,c=i.memoizedProps,f=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(b){Ji(i,i.return,b)}}function Wd(i,s,c){try{var f=i.stateNode;Ic(f,i.type,c,s),f[Ze]=s}catch(b){Ji(i,i.return,b)}}function Qp(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Fs(i.type)||i.tag===4}function Yd(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Qp(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Fs(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Kd(i,s,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(i),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=ya));else if(f!==4&&(f===27&&Fs(i.type)&&(c=i.stateNode,s=null),i=i.child,i!==null))for(Kd(i,s,c),i=i.sibling;i!==null;)Kd(i,s,c),i=i.sibling}function ad(i,s,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,s?c.insertBefore(i,s):c.appendChild(i);else if(f!==4&&(f===27&&Fs(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(ad(i,s,c),i=i.sibling;i!==null;)ad(i,s,c),i=i.sibling}function sd(i){var s=i.stateNode,c=i.memoizedProps;try{for(var f=i.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);en(s,f,c),s[di]=i,s[Ze]=c}catch(T){Ji(i,i.return,T)}}var Jo=!1,Jr=!1,bc=!1,Jp=typeof WeakSet=="function"?WeakSet:Set,Ti=null;function _u(i,s){if(i=i.containerInfo,Sd=Ut,i=Kc(i),Qc(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var b=f.anchorOffset,T=f.focusNode;f=f.focusOffset;try{c.nodeType,T.nodeType}catch{c=null;break e}var j=0,H=-1,ye=-1,Fe=0,Je=0,rt=i,$e=null;t:for(;;){for(var qe;rt!==c||b!==0&&rt.nodeType!==3||(H=j+b),rt!==T||f!==0&&rt.nodeType!==3||(ye=j+f),rt.nodeType===3&&(j+=rt.nodeValue.length),(qe=rt.firstChild)!==null;)$e=rt,rt=qe;for(;;){if(rt===i)break t;if($e===c&&++Fe===b&&(H=j),$e===T&&++Je===f&&(ye=j),(qe=rt.nextSibling)!==null)break;rt=$e,$e=rt.parentNode}rt=qe}c=H===-1||ye===-1?null:{start:H,end:ye}}else c=null}c=c||{start:0,end:0}}else c=null;for(Td={focusedElem:i,selectionRange:c},Ut=!1,Ti=s;Ti!==null;)if(s=Ti,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,Ti=i;else for(;Ti!==null;){switch(s=Ti,T=s.alternate,i=s.flags,s.tag){case 0:if((i&4)!==0&&(i=s.updateQueue,i=i!==null?i.events:null,i!==null))for(c=0;c<i.length;c++)b=i[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&T!==null){i=void 0,c=s,b=T.memoizedProps,T=T.memoizedState,f=c.stateNode;try{var Dt=Ka(c.type,b);i=f.getSnapshotBeforeUpdate(Dt,T),f.__reactInternalSnapshotBeforeUpdate=i}catch(ii){Ji(c,c.return,ii)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,c=i.nodeType,c===9)zu(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":zu(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(A(163))}if(i=s.sibling,i!==null){i.return=s.return,Ti=i;break}Ti=s.return}}function Qd(i,s,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:el(i,c),f&4&&Pl(5,c);break;case 1:if(el(i,c),f&4)if(i=c.stateNode,s===null)try{i.componentDidMount()}catch(j){Ji(c,c.return,j)}else{var b=Ka(c.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(b,s,i.__reactInternalSnapshotBeforeUpdate)}catch(j){Ji(c,c.return,j)}}f&64&&Xd(c),f&512&&Qo(c,c.return);break;case 3:if(el(i,c),f&64&&(i=c.updateQueue,i!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{Vo(i,s)}catch(j){Ji(c,c.return,j)}}break;case 27:s===null&&f&4&&sd(c);case 26:case 5:el(i,c),s===null&&f&4&&Kp(c),f&512&&Qo(c,c.return);break;case 12:el(i,c);break;case 31:el(i,c),f&4&&xu(i,c);break;case 13:el(i,c),f&4&&od(i,c),f&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=$f.bind(null,c),kn(i,c))));break;case 22:if(f=c.memoizedState!==null||Jo,!f){s=s!==null&&s.memoizedState!==null||Jr,b=Jo;var T=Jr;Jo=f,(Jr=s)&&!T?Qa(i,c,(c.subtreeFlags&8772)!==0):el(i,c),Jo=b,Jr=T}break;case 30:break;default:el(i,c)}}function ph(i){var s=i.alternate;s!==null&&(i.alternate=null,ph(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&gs(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var xr=null,Mn=!1;function go(i,s,c){for(c=c.child;c!==null;)Jd(i,s,c),c=c.sibling}function Jd(i,s,c){if(ee&&typeof ee.onCommitFiberUnmount=="function")try{ee.onCommitFiberUnmount(G,c)}catch{}switch(c.tag){case 26:Jr||mo(c,s),go(i,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Jr||mo(c,s);var f=xr,b=Mn;Fs(c.type)&&(xr=c.stateNode,Mn=!1),go(i,s,c),Iu(c.stateNode),xr=f,Mn=b;break;case 5:Jr||mo(c,s);case 6:if(f=xr,b=Mn,xr=null,go(i,s,c),xr=f,Mn=b,xr!==null)if(Mn)try{(xr.nodeType===9?xr.body:xr.nodeName==="HTML"?xr.ownerDocument.body:xr).removeChild(c.stateNode)}catch(T){Ji(c,s,T)}else try{xr.removeChild(c.stateNode)}catch(T){Ji(c,s,T)}break;case 18:xr!==null&&(Mn?(i=xr,Ep(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),Yn(i)):Ep(xr,c.stateNode));break;case 4:f=xr,b=Mn,xr=c.stateNode.containerInfo,Mn=!0,go(i,s,c),xr=f,Mn=b;break;case 0:case 11:case 14:case 15:fo(2,c,s),Jr||fo(4,c,s),go(i,s,c);break;case 1:Jr||(mo(c,s),f=c.stateNode,typeof f.componentWillUnmount=="function"&&Dl(c,s,f)),go(i,s,c);break;case 21:go(i,s,c);break;case 22:Jr=(f=Jr)||c.memoizedState!==null,go(i,s,c),Jr=f;break;default:go(i,s,c)}}function xu(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Yn(i)}catch(c){Ji(s,s.return,c)}}}function od(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Yn(i)}catch(c){Ji(s,s.return,c)}}function vu(i){switch(i.tag){case 31:case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new Jp),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new Jp),s;default:throw Error(A(435,i.tag))}}function wc(i,s){var c=vu(i);s.forEach(function(f){if(!c.has(f)){c.add(f);var b=Vf.bind(null,i,f);f.then(b,b)}})}function mn(i,s){var c=s.deletions;if(c!==null)for(var f=0;f<c.length;f++){var b=c[f],T=i,j=s,H=j;e:for(;H!==null;){switch(H.tag){case 27:if(Fs(H.type)){xr=H.stateNode,Mn=!1;break e}break;case 5:xr=H.stateNode,Mn=!1;break e;case 3:case 4:xr=H.stateNode.containerInfo,Mn=!0;break e}H=H.return}if(xr===null)throw Error(A(160));Jd(T,j,b),xr=null,Mn=!1,T=b.alternate,T!==null&&(T.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)ef(s,i),s=s.sibling}var la=null;function ef(i,s){var c=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:mn(s,i),ca(i),f&4&&(fo(3,i,i.return),Pl(3,i),fo(5,i,i.return));break;case 1:mn(s,i),ca(i),f&512&&(Jr||c===null||mo(c,c.return)),f&64&&Jo&&(i=i.updateQueue,i!==null&&(f=i.callbacks,f!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var b=la;if(mn(s,i),ca(i),f&512&&(Jr||c===null||mo(c,c.return)),f&4){var T=c!==null?c.memoizedState:null;if(f=i.memoizedState,c===null)if(f===null)if(i.stateNode===null){e:{f=i.type,c=i.memoizedProps,b=b.ownerDocument||b;t:switch(f){case"title":T=b.getElementsByTagName("title")[0],(!T||T[Zt]||T[di]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=b.createElement(f),b.head.insertBefore(T,b.querySelector("head > title"))),en(T,f,c),T[di]=i,Er(T),f=T;break e;case"link":var j=P("link","href",b).get(f+(c.href||""));if(j){for(var H=0;H<j.length;H++)if(T=j[H],T.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&T.getAttribute("rel")===(c.rel==null?null:c.rel)&&T.getAttribute("title")===(c.title==null?null:c.title)&&T.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){j.splice(H,1);break t}}T=b.createElement(f),en(T,f,c),b.head.appendChild(T);break;case"meta":if(j=P("meta","content",b).get(f+(c.content||""))){for(H=0;H<j.length;H++)if(T=j[H],T.getAttribute("content")===(c.content==null?null:""+c.content)&&T.getAttribute("name")===(c.name==null?null:c.name)&&T.getAttribute("property")===(c.property==null?null:c.property)&&T.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&T.getAttribute("charset")===(c.charSet==null?null:c.charSet)){j.splice(H,1);break t}}T=b.createElement(f),en(T,f,c),b.head.appendChild(T);break;default:throw Error(A(468,f))}T[di]=i,Er(T),f=T}i.stateNode=f}else B(b,i.type,i.stateNode);else i.stateNode=y(b,f,i.memoizedProps);else T!==f?(T===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):T.count--,f===null?B(b,i.type,i.stateNode):y(b,f,i.memoizedProps)):f===null&&i.stateNode!==null&&Wd(i,i.memoizedProps,c.memoizedProps)}break;case 27:mn(s,i),ca(i),f&512&&(Jr||c===null||mo(c,c.return)),c!==null&&f&4&&Wd(i,i.memoizedProps,c.memoizedProps);break;case 5:if(mn(s,i),ca(i),f&512&&(Jr||c===null||mo(c,c.return)),i.flags&32){b=i.stateNode;try{xs(b,"")}catch(Dt){Ji(i,i.return,Dt)}}f&4&&i.stateNode!=null&&(b=i.memoizedProps,Wd(i,b,c!==null?c.memoizedProps:b)),f&1024&&(bc=!0);break;case 6:if(mn(s,i),ca(i),f&4){if(i.stateNode===null)throw Error(A(162));f=i.memoizedProps,c=i.stateNode;try{c.nodeValue=f}catch(Dt){Ji(i,i.return,Dt)}}break;case 3:if(k=null,b=la,la=zh(s.containerInfo),mn(s,i),la=b,ca(i),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Yn(s.containerInfo)}catch(Dt){Ji(i,i.return,Dt)}bc&&(bc=!1,Rl(i));break;case 4:f=la,la=zh(i.stateNode.containerInfo),mn(s,i),ca(i),la=f;break;case 12:mn(s,i),ca(i);break;case 31:mn(s,i),ca(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,wc(i,f)));break;case 13:mn(s,i),ca(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(_h=dr()),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,wc(i,f)));break;case 22:b=i.memoizedState!==null;var ye=c!==null&&c.memoizedState!==null,Fe=Jo,Je=Jr;if(Jo=Fe||b,Jr=Je||ye,mn(s,i),Jr=Je,Jo=Fe,ca(i),f&8192)e:for(s=i.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(c===null||ye||Jo||Jr||Ll(i)),c=null,s=i;;){if(s.tag===5||s.tag===26){if(c===null){ye=c=s;try{if(T=ye.stateNode,b)j=T.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none";else{H=ye.stateNode;var rt=ye.memoizedProps.style,$e=rt!=null&&rt.hasOwnProperty("display")?rt.display:null;H.style.display=$e==null||typeof $e=="boolean"?"":(""+$e).trim()}}catch(Dt){Ji(ye,ye.return,Dt)}}}else if(s.tag===6){if(c===null){ye=s;try{ye.stateNode.nodeValue=b?"":ye.memoizedProps}catch(Dt){Ji(ye,ye.return,Dt)}}}else if(s.tag===18){if(c===null){ye=s;try{var qe=ye.stateNode;b?Ah(qe,!0):Ah(ye.stateNode,!1)}catch(Dt){Ji(ye,ye.return,Dt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}f&4&&(f=i.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,wc(i,c))));break;case 19:mn(s,i),ca(i),f&4&&(f=i.updateQueue,f!==null&&(i.updateQueue=null,wc(i,f)));break;case 30:break;case 21:break;default:mn(s,i),ca(i)}}function ca(i){var s=i.flags;if(s&2){try{for(var c,f=i.return;f!==null;){if(Qp(f)){c=f;break}f=f.return}if(c==null)throw Error(A(160));switch(c.tag){case 27:var b=c.stateNode,T=Yd(i);ad(i,T,b);break;case 5:var j=c.stateNode;c.flags&32&&(xs(j,""),c.flags&=-33);var H=Yd(i);ad(i,H,j);break;case 3:case 4:var ye=c.stateNode.containerInfo,Fe=Yd(i);Kd(i,Fe,ye);break;default:throw Error(A(161))}}catch(Je){Ji(i,i.return,Je)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function Rl(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;Rl(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function el(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Qd(i,s.alternate,s),s=s.sibling}function Ll(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:fo(4,s,s.return),Ll(s);break;case 1:mo(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&Dl(s,s.return,c),Ll(s);break;case 27:Iu(s.stateNode);case 26:case 5:mo(s,s.return),Ll(s);break;case 22:s.memoizedState===null&&Ll(s);break;case 30:Ll(s);break;default:Ll(s)}i=i.sibling}}function Qa(i,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var f=s.alternate,b=i,T=s,j=T.flags;switch(T.tag){case 0:case 11:case 15:Qa(b,T,c),Pl(4,T);break;case 1:if(Qa(b,T,c),f=T,b=f.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Fe){Ji(f,f.return,Fe)}if(f=T,b=f.updateQueue,b!==null){var H=f.stateNode;try{var ye=b.shared.hiddenCallbacks;if(ye!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ye.length;b++)Ha(ye[b],H)}catch(Fe){Ji(f,f.return,Fe)}}c&&j&64&&Xd(T),Qo(T,T.return);break;case 27:sd(T);case 26:case 5:Qa(b,T,c),c&&f===null&&j&4&&Kp(T),Qo(T,T.return);break;case 12:Qa(b,T,c);break;case 31:Qa(b,T,c),c&&j&4&&xu(b,T);break;case 13:Qa(b,T,c),c&&j&4&&od(b,T);break;case 22:T.memoizedState===null&&Qa(b,T,c),Qo(T,T.return);break;case 30:break;default:Qa(b,T,c)}s=s.sibling}}function fh(i,s){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&Fr(c))}function ld(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Fr(i))}function ms(i,s,c,f){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)tf(i,s,c,f),s=s.sibling}function tf(i,s,c,f){var b=s.flags;switch(s.tag){case 0:case 11:case 15:ms(i,s,c,f),b&2048&&Pl(9,s);break;case 1:ms(i,s,c,f);break;case 3:ms(i,s,c,f),b&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Fr(i)));break;case 12:if(b&2048){ms(i,s,c,f),i=s.stateNode;try{var T=s.memoizedProps,j=T.id,H=T.onPostCommit;typeof H=="function"&&H(j,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(ye){Ji(s,s.return,ye)}}else ms(i,s,c,f);break;case 31:ms(i,s,c,f);break;case 13:ms(i,s,c,f);break;case 23:break;case 22:T=s.stateNode,j=s.alternate,s.memoizedState!==null?T._visibility&2?ms(i,s,c,f):mh(i,s):T._visibility&2?ms(i,s,c,f):(T._visibility|=2,bu(i,s,c,f,(s.subtreeFlags&10256)!==0||!1)),b&2048&&fh(j,s);break;case 24:ms(i,s,c,f),b&2048&&ld(s.alternate,s);break;default:ms(i,s,c,f)}}function bu(i,s,c,f,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var T=i,j=s,H=c,ye=f,Fe=j.flags;switch(j.tag){case 0:case 11:case 15:bu(T,j,H,ye,b),Pl(8,j);break;case 23:break;case 22:var Je=j.stateNode;j.memoizedState!==null?Je._visibility&2?bu(T,j,H,ye,b):mh(T,j):(Je._visibility|=2,bu(T,j,H,ye,b)),b&&Fe&2048&&fh(j.alternate,j);break;case 24:bu(T,j,H,ye,b),b&&Fe&2048&&ld(j.alternate,j);break;default:bu(T,j,H,ye,b)}s=s.sibling}}function mh(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=i,f=s,b=f.flags;switch(f.tag){case 22:mh(c,f),b&2048&&fh(f.alternate,f);break;case 24:mh(c,f),b&2048&&ld(f.alternate,f);break;default:mh(c,f)}s=s.sibling}}var gh=8192;function wu(i,s,c){if(i.subtreeFlags&gh)for(i=i.child;i!==null;)Sc(i,s,c),i=i.sibling}function Sc(i,s,c){switch(i.tag){case 26:wu(i,s,c),i.flags&gh&&i.memoizedState!==null&&q(c,la,i.memoizedState,i.memoizedProps);break;case 5:wu(i,s,c);break;case 3:case 4:var f=la;la=zh(i.stateNode.containerInfo),wu(i,s,c),la=f;break;case 22:i.memoizedState===null&&(f=i.alternate,f!==null&&f.memoizedState!==null?(f=gh,gh=16777216,wu(i,s,c),gh=f):wu(i,s,c));break;default:wu(i,s,c)}}function rf(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function yh(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var f=s[c];Ti=f,tp(f,i)}rf(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)ep(i),i=i.sibling}function ep(i){switch(i.tag){case 0:case 11:case 15:yh(i),i.flags&2048&&fo(9,i,i.return);break;case 3:yh(i);break;case 12:yh(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,cd(i)):yh(i);break;default:yh(i)}}function cd(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var f=s[c];Ti=f,tp(f,i)}rf(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:fo(8,s,s.return),cd(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,cd(s));break;default:cd(s)}i=i.sibling}}function tp(i,s){for(;Ti!==null;){var c=Ti;switch(c.tag){case 0:case 11:case 15:fo(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Fr(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Ti=f;else e:for(c=i;Ti!==null;){f=Ti;var b=f.sibling,T=f.return;if(ph(f),f===c){Ti=null;break e}if(b!==null){b.return=T,Ti=b;break e}Ti=T}}}var Bf={getCacheForType:function(i){var s=sn(lr),c=s.data.get(i);return c===void 0&&(c=i(),s.data.set(i,c)),c},cacheSignal:function(){return sn(lr).controller.signal}},ip=typeof WeakMap=="function"?WeakMap:Map,Oi=0,hr=null,Pi=null,ji=0,rr=0,Ma=null,jl=!1,Su=!1,Tc=!1,yo=0,Vr=0,Ol=0,Mc=0,rp=0,Ja=0,kc=0,Cc=null,ua=null,ud=!1,_h=0,nf=0,Ec=1/0,hd=null,tl=null,gn=0,Bl=null,Tu=null,_o=0,np=0,ap=null,Mu=null,Ir=0,xh=null;function ka(){return(Oi&2)!==0&&ji!==0?ji&-ji:He.T!==null?Fl():ht()}function sp(){if(Ja===0)if((ji&536870912)===0||bi){var i=Ve;Ve<<=1,(Ve&3932160)===0&&(Ve=262144),Ja=i}else Ja=536870912;return i=cr.current,i!==null&&(i.flags|=32),Ja}function Xn(i,s,c){(i===hr&&(rr===2||rr===9)||i.cancelPendingCommit!==null)&&(ku(i,0),Nl(i,ji,Ja,!1)),mr(i,c),((Oi&2)===0||i!==hr)&&(i===hr&&((Oi&2)===0&&(Mc|=c),Vr===4&&Nl(i,ji,Ja,!1)),Bs(i))}function Ac(i,s,c){if((Oi&6)!==0)throw Error(A(327));var f=!c&&(s&127)===0&&(s&i.expiredLanes)===0||Ii(i,s),b=f?cf(i,s):cp(i,s,!0),T=f;do{if(b===0){Su&&!f&&Nl(i,s,0,!1);break}else{if(c=i.current.alternate,T&&!Nf(c)){b=cp(i,s,!1),T=!1;continue}if(b===2){if(T=s,i.errorRecoveryDisabledLanes&T)var j=0;else j=i.pendingLanes&-536870913,j=j!==0?j:j&536870912?536870912:0;if(j!==0){s=j;e:{var H=i;b=Cc;var ye=H.current.memoizedState.isDehydrated;if(ye&&(ku(H,j).flags|=256),j=cp(H,j,!1),j!==2){if(Tc&&!ye){H.errorRecoveryDisabledLanes|=T,Mc|=T,b=4;break e}T=ua,ua=b,T!==null&&(ua===null?ua=T:ua.push.apply(ua,T))}b=j}if(T=!1,b!==2)continue}}if(b===1){ku(i,0),Nl(i,s,0,!0);break}e:{switch(f=i,T=b,T){case 0:case 1:throw Error(A(345));case 4:if((s&4194048)!==s)break;case 6:Nl(f,s,Ja,!jl);break e;case 2:ua=null;break;case 3:case 5:break;default:throw Error(A(329))}if((s&62914560)===s&&(b=_h+300-dr(),10<b)){if(Nl(f,s,Ja,!jl),qt(f,0,!0)!==0)break e;_o=s,f.timeoutHandle=Cp(op.bind(null,f,c,ua,hd,ud,s,Ja,Mc,kc,jl,T,"Throttled",-0,0),b);break e}op(f,c,ua,hd,ud,s,Ja,Mc,kc,jl,T,null,-0,0)}}break}while(!0);Bs(i)}function op(i,s,c,f,b,T,j,H,ye,Fe,Je,rt,$e,qe){if(i.timeoutHandle=-1,rt=s.subtreeFlags,rt&8192||(rt&16785408)===16785408){rt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ya},Sc(s,T,rt);var Dt=(T&62914560)===T?_h-dr():(T&4194048)===T?nf-dr():0;if(Dt=ae(rt,Dt),Dt!==null){_o=T,i.cancelPendingCommit=Dt(bh.bind(null,i,s,T,c,f,b,j,H,ye,Je,rt,null,$e,qe)),Nl(i,T,j,!Fe);return}}bh(i,s,T,c,f,b,j,H,ye)}function Nf(i){for(var s=i;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var b=c[f],T=b.getSnapshot;b=b.value;try{if(!Gn(T(),b))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Nl(i,s,c,f){s&=~rp,s&=~Mc,i.suspendedLanes|=s,i.pingedLanes&=~s,f&&(i.warmLanes|=s),f=i.expirationTimes;for(var b=s;0<b;){var T=31-fe(b),j=1<<T;f[T]=-1,b&=~j}c!==0&&gi(i,c,s)}function dd(){return(Oi&6)===0?(zc(0),!1):!0}function lp(){if(Pi!==null){if(rr===0)var i=Pi.return;else i=Pi,os=ba=null,e(i),Fo=null,Cl=0,i=Pi;for(;i!==null;)Yp(i.alternate,i),i=i.return;Pi=null}}function ku(i,s){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,Xf(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),_o=0,lp(),hr=i,Pi=c=ia(i.current,null),ji=s,rr=0,Ma=null,jl=!1,Su=Ii(i,s),Tc=!1,kc=Ja=rp=Mc=Ol=Vr=0,ua=Cc=null,ud=!1,(s&8)!==0&&(s|=s&32);var f=i.entangledLanes;if(f!==0)for(i=i.entanglements,f&=s;0<f;){var b=31-fe(f),T=1<<b;s|=i[b],f&=~T}return yo=s,Oo(),c}function af(i,s){hi=null,He.H=zl,s===No||s===hc?(s=Ju(),rr=3):s===Cs?(s=Ju(),rr=4):rr=s===sh?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ma=s,Pi===null&&(Vr=1,nh(i,Rn(s,i.current)))}function sf(){var i=cr.current;return i===null?!0:(ji&4194048)===ji?aa===null:(ji&62914560)===ji||(ji&536870912)!==0?i===aa:!1}function of(){var i=He.H;return He.H=zl,i===null?zl:i}function lf(){var i=He.A;return He.A=Bf,i}function pd(){Vr=4,jl||(ji&4194048)!==ji&&cr.current!==null||(Su=!0),(Ol&134217727)===0&&(Mc&134217727)===0||hr===null||Nl(hr,ji,Ja,!1)}function cp(i,s,c){var f=Oi;Oi|=2;var b=of(),T=lf();(hr!==i||ji!==s)&&(hd=null,ku(i,s)),s=!1;var j=Vr;e:do try{if(rr!==0&&Pi!==null){var H=Pi,ye=Ma;switch(rr){case 8:lp(),j=6;break e;case 3:case 2:case 9:case 6:cr.current===null&&(s=!0);var Fe=rr;if(rr=0,Ma=null,xo(i,H,ye,Fe),c&&Su){j=0;break e}break;default:Fe=rr,rr=0,Ma=null,xo(i,H,ye,Fe)}}Ff(),j=Vr;break}catch(Je){af(i,Je)}while(!0);return s&&i.shellSuspendCounter++,os=ba=null,Oi=f,He.H=b,He.A=T,Pi===null&&(hr=null,ji=0,Oo()),j}function Ff(){for(;Pi!==null;)hp(Pi)}function cf(i,s){var c=Oi;Oi|=2;var f=of(),b=lf();hr!==i||ji!==s?(hd=null,Ec=dr()+500,ku(i,s)):Su=Ii(i,s);e:do try{if(rr!==0&&Pi!==null){s=Pi;var T=Ma;t:switch(rr){case 1:rr=0,Ma=null,xo(i,s,T,1);break;case 2:case 9:if(Es(T)){rr=0,Ma=null,il(s);break}s=function(){rr!==2&&rr!==9||hr!==i||(rr=7),Bs(i)},T.then(s,s);break e;case 3:rr=7;break e;case 4:rr=5;break e;case 7:Es(T)?(rr=0,Ma=null,il(s)):(rr=0,Ma=null,xo(i,s,T,7));break;case 5:var j=null;switch(Pi.tag){case 26:j=Pi.memoizedState;case 5:case 27:var H=Pi;if(j?V(j):H.stateNode.complete){rr=0,Ma=null;var ye=H.sibling;if(ye!==null)Pi=ye;else{var Fe=H.return;Fe!==null?(Pi=Fe,rl(Fe)):Pi=null}break t}}rr=0,Ma=null,xo(i,s,T,5);break;case 6:rr=0,Ma=null,xo(i,s,T,6);break;case 8:lp(),Vr=6;break e;default:throw Error(A(462))}}up();break}catch(Je){af(i,Je)}while(!0);return os=ba=null,He.H=f,He.A=b,Oi=c,Pi!==null?0:(hr=null,ji=0,Oo(),Vr)}function up(){for(;Pi!==null&&!Qn();)hp(Pi)}function hp(i){var s=Xp(i.alternate,i,yo);i.memoizedProps=i.pendingProps,s===null?rl(i):Pi=s}function il(i){var s=i,c=s.alternate;switch(s.tag){case 15:case 0:s=Vd(c,s,s.pendingProps,s.type,void 0,ji);break;case 11:s=Vd(c,s,s.pendingProps,s.type.render,s.ref,ji);break;case 5:e(s);default:Yp(c,s),s=Pi=Yu(s,yo),s=Xp(c,s,yo)}i.memoizedProps=i.pendingProps,s===null?rl(i):Pi=s}function xo(i,s,c,f){os=ba=null,e(s),Fo=null,Cl=0;var b=s.return;try{if(Rf(i,b,s,c,ji)){Vr=1,nh(i,Rn(c,i.current)),Pi=null;return}}catch(T){if(b!==null)throw Pi=b,T;Vr=1,nh(i,Rn(c,i.current)),Pi=null;return}s.flags&32768?(bi||f===1?i=!0:Su||(ji&536870912)!==0?i=!1:(jl=i=!0,(f===2||f===9||f===3||f===6)&&(f=cr.current,f!==null&&f.tag===13&&(f.flags|=16384))),vh(s,i)):rl(s)}function rl(i){var s=i;do{if((s.flags&32768)!==0){vh(s,jl);return}i=s.return;var c=jf(s.alternate,s,yo);if(c!==null){Pi=c;return}if(s=s.sibling,s!==null){Pi=s;return}Pi=s=i}while(s!==null);Vr===0&&(Vr=5)}function vh(i,s){do{var c=Of(i.alternate,i);if(c!==null){c.flags&=32767,Pi=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(i=i.sibling,i!==null)){Pi=i;return}Pi=i=c}while(i!==null);Vr=6,Pi=null}function bh(i,s,c,f,b,T,j,H,ye){i.cancelPendingCommit=null;do fd();while(gn!==0);if((Oi&6)!==0)throw Error(A(327));if(s!==null){if(s===i.current)throw Error(A(177));if(T=s.lanes|s.childLanes,T|=jo,nr(i,c,T,j,H,ye),i===hr&&(Pi=hr=null,ji=0),Tu=s,Bl=i,_o=c,np=T,ap=b,Mu=f,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,Gf(Pt,function(){return fp(),null})):(i.callbackNode=null,i.callbackPriority=0),f=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||f){f=He.T,He.T=null,b=gt.p,gt.p=2,j=Oi,Oi|=4;try{_u(i,s,c)}finally{Oi=j,gt.p=b,He.T=f}}gn=1,uf(),hf(),dp()}}function uf(){if(gn===1){gn=0;var i=Bl,s=Tu,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=He.T,He.T=null;var f=gt.p;gt.p=2;var b=Oi;Oi|=4;try{ef(s,i);var T=Td,j=Kc(i.containerInfo),H=T.focusedElem,ye=T.selectionRange;if(j!==H&&H&&H.ownerDocument&&Yc(H.ownerDocument.documentElement,H)){if(ye!==null&&Qc(H)){var Fe=ye.start,Je=ye.end;if(Je===void 0&&(Je=Fe),"selectionStart"in H)H.selectionStart=Fe,H.selectionEnd=Math.min(Je,H.value.length);else{var rt=H.ownerDocument||document,$e=rt&&rt.defaultView||window;if($e.getSelection){var qe=$e.getSelection(),Dt=H.textContent.length,ii=Math.min(ye.start,Dt),fr=ye.end===void 0?ii:Math.min(ye.end,Dt);!qe.extend&&ii>fr&&(j=fr,fr=ii,ii=j);var Ie=Wc(H,ii),ke=Wc(H,fr);if(Ie&&ke&&(qe.rangeCount!==1||qe.anchorNode!==Ie.node||qe.anchorOffset!==Ie.offset||qe.focusNode!==ke.node||qe.focusOffset!==ke.offset)){var Ne=rt.createRange();Ne.setStart(Ie.node,Ie.offset),qe.removeAllRanges(),ii>fr?(qe.addRange(Ne),qe.extend(ke.node,ke.offset)):(Ne.setEnd(ke.node,ke.offset),qe.addRange(Ne))}}}}for(rt=[],qe=H;qe=qe.parentNode;)qe.nodeType===1&&rt.push({element:qe,left:qe.scrollLeft,top:qe.scrollTop});for(typeof H.focus=="function"&&H.focus(),H=0;H<rt.length;H++){var tt=rt[H];tt.element.scrollLeft=tt.left,tt.element.scrollTop=tt.top}}Ut=!!Sd,Td=Sd=null}finally{Oi=b,gt.p=f,He.T=c}}i.current=s,gn=2}}function hf(){if(gn===2){gn=0;var i=Bl,s=Tu,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=He.T,He.T=null;var f=gt.p;gt.p=2;var b=Oi;Oi|=4;try{Qd(i,s.alternate,s)}finally{Oi=b,gt.p=f,He.T=c}}gn=3}}function dp(){if(gn===4||gn===3){gn=0,un();var i=Bl,s=Tu,c=_o,f=Mu;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?gn=5:(gn=0,Tu=Bl=null,pp(i,i.pendingLanes));var b=i.pendingLanes;if(b===0&&(tl=null),Me(c),s=s.stateNode,ee&&typeof ee.onCommitFiberRoot=="function")try{ee.onCommitFiberRoot(G,s,void 0,(s.current.flags&128)===128)}catch{}if(f!==null){s=He.T,b=gt.p,gt.p=2,He.T=null;try{for(var T=i.onRecoverableError,j=0;j<f.length;j++){var H=f[j];T(H.value,{componentStack:H.stack})}}finally{He.T=s,gt.p=b}}(_o&3)!==0&&fd(),Bs(i),b=i.pendingLanes,(c&261930)!==0&&(b&42)!==0?i===xh?Ir++:(Ir=0,xh=i):Ir=0,zc(0)}}function pp(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,Fr(s)))}function fd(){return uf(),hf(),dp(),fp()}function fp(){if(gn!==5)return!1;var i=Bl,s=np;np=0;var c=Me(_o),f=He.T,b=gt.p;try{gt.p=32>c?32:c,He.T=null,c=ap,ap=null;var T=Bl,j=_o;if(gn=0,Tu=Bl=null,_o=0,(Oi&6)!==0)throw Error(A(331));var H=Oi;if(Oi|=4,ep(T.current),tf(T,T.current,j,c),Oi=H,zc(0,!1),ee&&typeof ee.onPostCommitFiberRoot=="function")try{ee.onPostCommitFiberRoot(G,T)}catch{}return!0}finally{gt.p=b,He.T=f,pp(i,s)}}function mp(i,s,c){s=Rn(c,s),s=Jh(i.stateNode,s,2),i=qa(i,s,2),i!==null&&(mr(i,2),Bs(i))}function Ji(i,s,c){if(i.tag===3)mp(i,i,c);else for(;s!==null;){if(s.tag===3){mp(s,i,c);break}else if(s.tag===1){var f=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(tl===null||!tl.has(f))){i=Rn(c,i),c=Up(2),f=qa(s,c,2),f!==null&&(ed(c,f,s,i),mr(f,2),Bs(f));break}}s=s.return}}function wh(i,s,c){var f=i.pingCache;if(f===null){f=i.pingCache=new ip;var b=new Set;f.set(s,b)}else b=f.get(s),b===void 0&&(b=new Set,f.set(s,b));b.has(c)||(Tc=!0,b.add(c),i=Uf.bind(null,i,s,c),s.then(i,i))}function Uf(i,s,c){var f=i.pingCache;f!==null&&f.delete(s),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,hr===i&&(ji&c)===c&&(Vr===4||Vr===3&&(ji&62914560)===ji&&300>dr()-_h?(Oi&2)===0&&ku(i,0):rp|=c,kc===ji&&(kc=0)),Bs(i)}function gp(i,s){s===0&&(s=oi()),i=va(i,s),i!==null&&(mr(i,s),Bs(i))}function $f(i){var s=i.memoizedState,c=0;s!==null&&(c=s.retryLane),gp(i,c)}function Vf(i,s){var c=0;switch(i.tag){case 31:case 13:var f=i.stateNode,b=i.memoizedState;b!==null&&(c=b.retryLane);break;case 19:f=i.stateNode;break;case 22:f=i.stateNode._retryCache;break;default:throw Error(A(314))}f!==null&&f.delete(s),gp(i,c)}function Gf(i,s){return Fn(i,s)}var md=null,Cu=null,gd=!1,Sh=!1,Os=!1,ha=0;function Bs(i){i!==Cu&&i.next===null&&(Cu===null?md=Cu=i:Cu=Cu.next=i),Sh=!0,gd||(gd=!0,yp())}function zc(i,s){if(!Os&&Sh){Os=!0;do for(var c=!1,f=md;f!==null;){if(i!==0){var b=f.pendingLanes;if(b===0)var T=0;else{var j=f.suspendedLanes,H=f.pingedLanes;T=(1<<31-fe(42|i)+1)-1,T&=b&~(j&~H),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(c=!0,_d(f,T))}else T=ji,T=qt(f,f===hr?T:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(T&3)===0||Ii(f,T)||(c=!0,_d(f,T));f=f.next}while(c);Os=!1}}function Zf(){Th()}function Th(){Sh=gd=!1;var i=0;ha!==0&&yf()&&(i=ha);for(var s=dr(),c=null,f=md;f!==null;){var b=f.next,T=yd(f,s);T===0?(f.next=null,c===null?md=b:c.next=b,b===null&&(Cu=c)):(c=f,(i!==0||(T&3)!==0)&&(Sh=!0)),f=b}gn!==0&&gn!==5||zc(i),ha!==0&&(ha=0)}function yd(i,s){for(var c=i.suspendedLanes,f=i.pingedLanes,b=i.expirationTimes,T=i.pendingLanes&-62914561;0<T;){var j=31-fe(T),H=1<<j,ye=b[j];ye===-1?((H&c)===0||(H&f)!==0)&&(b[j]=zt(H,s)):ye<=s&&(i.expiredLanes|=H),T&=~H}if(s=hr,c=ji,c=qt(i,i===s?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f=i.callbackNode,c===0||i===s&&(rr===2||rr===9)||i.cancelPendingCommit!==null)return f!==null&&f!==null&&Hr(f),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||Ii(i,c)){if(s=c&-c,s===i.callbackPriority)return s;switch(f!==null&&Hr(f),Me(c)){case 2:case 8:c=st;break;case 32:c=Pt;break;case 268435456:c=ne;break;default:c=Pt}return f=df.bind(null,i),c=Fn(c,f),i.callbackPriority=s,i.callbackNode=c,s}return f!==null&&f!==null&&Hr(f),i.callbackPriority=2,i.callbackNode=null,2}function df(i,s){if(gn!==0&&gn!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(fd()&&i.callbackNode!==c)return null;var f=ji;return f=qt(i,i===hr?f:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),f===0?null:(Ac(i,f,s),yd(i,dr()),i.callbackNode!=null&&i.callbackNode===c?df.bind(null,i):null)}function _d(i,s){if(fd())return null;Ac(i,s,!0)}function yp(){xf(function(){(Oi&6)!==0?Fn(rn,Zf):Th()})}function Fl(){if(ha===0){var i=wn;i===0&&(i=Ge,Ge<<=1,(Ge&261888)===0&&(Ge=256)),ha=i}return ha}function _p(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:ti(""+i)}function xp(i,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,i.id&&c.setAttribute("form",i.id),s.parentNode.insertBefore(c,s),i=new FormData(i),c.parentNode.removeChild(c),i}function vp(i,s,c,f,b){if(s==="submit"&&c&&c.stateNode===b){var T=_p((b[Ze]||null).action),j=f.submitter;j&&(s=(s=j[Ze]||null)?_p(s.formAction):j.getAttribute("formAction"),s!==null&&(T=s,j=null));var H=new dl("action","action",null,f,b);i.push({event:H,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(ha!==0){var ye=j?xp(b,j):new FormData(b);ds(c,{pending:!0,data:ye,method:b.method,action:T},null,ye)}}else typeof T=="function"&&(H.preventDefault(),ye=j?xp(b,j):new FormData(b),ds(c,{pending:!0,data:ye,method:b.method,action:T},T,ye))},currentTarget:b}]})}}for(var xd=0;xd<eu.length;xd++){var Eu=eu[xd],pf=Eu.toLowerCase(),qf=Eu[0].toUpperCase()+Eu.slice(1);ea(pf,"on"+qf)}ea(ic,"onAnimationEnd"),ea(rc,"onAnimationIteration"),ea(Jc,"onAnimationStart"),ea("dblclick","onDoubleClick"),ea("focusin","onFocus"),ea("focusout","onBlur"),ea(Lo,"onTransitionRun"),ea(nc,"onTransitionStart"),ea(vl,"onTransitionCancel"),ea(Jn,"onTransitionEnd"),sl("onMouseEnter",["mouseout","mouseover"]),sl("onMouseLeave",["mouseout","mouseover"]),sl("onPointerEnter",["pointerout","pointerover"]),sl("onPointerLeave",["pointerout","pointerover"]),ni("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ni("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ni("onBeforeInput",["compositionend","keypress","textInput","paste"]),ni("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ni("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ni("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Hf=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Mh));function ff(i,s){s=(s&4)!==0;for(var c=0;c<i.length;c++){var f=i[c],b=f.event;f=f.listeners;e:{var T=void 0;if(s)for(var j=f.length-1;0<=j;j--){var H=f[j],ye=H.instance,Fe=H.currentTarget;if(H=H.listener,ye!==T&&b.isPropagationStopped())break e;T=H,b.currentTarget=Fe;try{T(b)}catch(Je){as(Je)}b.currentTarget=null,T=ye}else for(j=0;j<f.length;j++){if(H=f[j],ye=H.instance,Fe=H.currentTarget,H=H.listener,ye!==T&&b.isPropagationStopped())break e;T=H,b.currentTarget=Fe;try{T(b)}catch(Je){as(Je)}b.currentTarget=null,T=ye}}}}function Di(i,s){var c=s[Bt];c===void 0&&(c=s[Bt]=new Set);var f=i+"__bubble";c.has(f)||(bp(s,i,2,!1),c.add(f))}function kh(i,s,c){var f=0;s&&(f|=4),bp(c,i,f,s)}var Ns="_reactListening"+Math.random().toString(36).slice(2);function vd(i){if(!i[Ns]){i[Ns]=!0,ts.forEach(function(c){c!=="selectionchange"&&(Hf.has(c)||kh(c,!1,i),kh(c,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[Ns]||(s[Ns]=!0,kh("selectionchange",!1,s))}}function bp(i,s,c,f){switch(yn(s)){case 2:var b=Qt;break;case 8:b=Lt;break;default:b=Ct}c=b.bind(null,s,c,i),b=void 0,!Xr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),f?b!==void 0?i.addEventListener(s,c,{capture:!0,passive:b}):i.addEventListener(s,c,!0):b!==void 0?i.addEventListener(s,c,{passive:b}):i.addEventListener(s,c,!1)}function bd(i,s,c,f,b){var T=f;if((s&1)===0&&(s&2)===0&&f!==null)e:for(;;){if(f===null)return;var j=f.tag;if(j===3||j===4){var H=f.stateNode.containerInfo;if(H===b)break;if(j===4)for(j=f.return;j!==null;){var ye=j.tag;if((ye===3||ye===4)&&j.stateNode.containerInfo===b)return;j=j.return}for(;H!==null;){if(j=Da(H),j===null)return;if(ye=j.tag,ye===5||ye===6||ye===26||ye===27){f=T=j;continue e}H=H.parentNode}}f=f.return}ar(function(){var Fe=T,Je=Mo(c),rt=[];e:{var $e=Xu.get(i);if($e!==void 0){var qe=dl,Dt=i;switch(i){case"keypress":if(_a(c)===0)break e;case"keydown":case"keyup":qe=Ao;break;case"focusin":Dt="focus",qe=Lr;break;case"focusout":Dt="blur",qe=Lr;break;case"beforeblur":case"afterblur":qe=Lr;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qe=Xl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qe=Uc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qe=Fh;break;case ic:case rc:case Jc:qe=Oh;break;case Jn:qe=Bd;break;case"scroll":case"scrollend":qe=pl;break;case"wheel":qe=ju;break;case"copy":case"cut":case"paste":qe=Wr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qe=Wl;break;case"toggle":case"beforetoggle":qe=Ou}var ii=(s&4)!==0,fr=!ii&&(i==="scroll"||i==="scrollend"),Ie=ii?$e!==null?$e+"Capture":null:$e;ii=[];for(var ke=Fe,Ne;ke!==null;){var tt=ke;if(Ne=tt.stateNode,tt=tt.tag,tt!==5&&tt!==26&&tt!==27||Ne===null||Ie===null||(tt=Hl(ke,Ie),tt!=null&&ii.push(Au(ke,tt,Ne))),fr)break;ke=ke.return}0<ii.length&&($e=new qe($e,Dt,null,c,Je),rt.push({event:$e,listeners:ii}))}}if((s&7)===0){e:{if($e=i==="mouseover"||i==="pointerover",qe=i==="mouseout"||i==="pointerout",$e&&c!==Nc&&(Dt=c.relatedTarget||c.fromElement)&&(Da(Dt)||Dt[dt]))break e;if((qe||$e)&&($e=Je.window===Je?Je:($e=Je.ownerDocument)?$e.defaultView||$e.parentWindow:window,qe?(Dt=c.relatedTarget||c.toElement,qe=Fe,Dt=Dt?Da(Dt):null,Dt!==null&&(fr=ie(Dt),ii=Dt.tag,Dt!==fr||ii!==5&&ii!==27&&ii!==6)&&(Dt=null)):(qe=null,Dt=Fe),qe!==Dt)){if(ii=Xl,tt="onMouseLeave",Ie="onMouseEnter",ke="mouse",(i==="pointerout"||i==="pointerover")&&(ii=Wl,tt="onPointerLeave",Ie="onPointerEnter",ke="pointer"),fr=qe==null?$e:ys(qe),Ne=Dt==null?$e:ys(Dt),$e=new ii(tt,ke+"leave",qe,c,Je),$e.target=fr,$e.relatedTarget=Ne,tt=null,Da(Je)===Fe&&(ii=new ii(Ie,ke+"enter",Dt,c,Je),ii.target=Ne,ii.relatedTarget=fr,tt=ii),fr=tt,qe&&Dt)t:{for(ii=wp,Ie=qe,ke=Dt,Ne=0,tt=Ie;tt;tt=ii(tt))Ne++;tt=0;for(var Yt=ke;Yt;Yt=ii(Yt))tt++;for(;0<Ne-tt;)Ie=ii(Ie),Ne--;for(;0<tt-Ne;)ke=ii(ke),tt--;for(;Ne--;){if(Ie===ke||ke!==null&&Ie===ke.alternate){ii=Ie;break t}Ie=ii(Ie),ke=ii(ke)}ii=null}else ii=null;qe!==null&&Sp(rt,$e,qe,ii,!1),Dt!==null&&fr!==null&&Sp(rt,fr,Dt,ii,!0)}}e:{if($e=Fe?ys(Fe):window,qe=$e.nodeName&&$e.nodeName.toLowerCase(),qe==="select"||qe==="input"&&$e.type==="file")var Wi=Na;else if(Hc($e))if(Fu)Wi=Vu;else{Wi=qh;var Tt=Fd}else qe=$e.nodeName,!qe||qe.toLowerCase()!=="input"||$e.type!=="checkbox"&&$e.type!=="radio"?Fe&&ga(Fe.elementType)&&(Wi=Na):Wi=$u;if(Wi&&(Wi=Wi(i,Fe))){Ql(rt,Wi,c,Je);break e}Tt&&Tt(i,$e,Fe),i==="focusout"&&Fe&&$e.type==="number"&&Fe.memoizedProps.value!=null&&ql($e,"number",$e.value)}switch(Tt=Fe?ys(Fe):window,i){case"focusin":(Hc(Tt)||Tt.contentEditable==="true")&&(xa=Tt,ec=Fe,tc=null);break;case"focusout":tc=ec=xa=null;break;case"mousedown":Zu=!0;break;case"contextmenu":case"mouseup":case"dragend":Zu=!1,Hh(rt,c,Je);break;case"selectionchange":if(Li)break;case"keydown":case"keyup":Hh(rt,c,Je)}var Jt;if(Pn)e:{switch(i){case"compositionstart":var yi="onCompositionStart";break e;case"compositionend":yi="onCompositionEnd";break e;case"compositionupdate":yi="onCompositionUpdate";break e}yi=void 0}else Ba?Kl(i,c)&&(yi="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(yi="onCompositionStart");yi&&(zo&&c.locale!=="ko"&&(Ba||yi!=="onCompositionStart"?yi==="onCompositionEnd"&&Ba&&(Jt=Hi()):(rs=Je,qs="value"in rs?rs.value:rs.textContent,Ba=!0)),Tt=Ch(Fe,yi),0<Tt.length&&(yi=new $c(yi,i,null,c,Je),rt.push({event:yi,listeners:Tt}),Jt?yi.data=Jt:(Jt=Uh(c),Jt!==null&&(yi.data=Jt)))),(Jt=qc?Nd(i,c):$h(i,c))&&(yi=Ch(Fe,"onBeforeInput"),0<yi.length&&(Tt=new $c("onBeforeInput","beforeinput",null,c,Je),rt.push({event:Tt,listeners:yi}),Tt.data=Jt)),vp(rt,i,Fe,c,Je)}ff(rt,s)})}function Au(i,s,c){return{instance:i,listener:s,currentTarget:c}}function Ch(i,s){for(var c=s+"Capture",f=[];i!==null;){var b=i,T=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||T===null||(b=Hl(i,c),b!=null&&f.unshift(Au(i,b,T)),b=Hl(i,s),b!=null&&f.push(Au(i,b,T))),i.tag===3)return f;i=i.return}return[]}function wp(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Sp(i,s,c,f,b){for(var T=s._reactName,j=[];c!==null&&c!==f;){var H=c,ye=H.alternate,Fe=H.stateNode;if(H=H.tag,ye!==null&&ye===f)break;H!==5&&H!==26&&H!==27||Fe===null||(ye=Fe,b?(Fe=Hl(c,T),Fe!=null&&j.unshift(Au(c,Fe,ye))):b||(Fe=Hl(c,T),Fe!=null&&j.push(Au(c,Fe,ye)))),c=c.return}j.length!==0&&i.push({event:s,listeners:j})}var Eh=/\r\n?/g,mf=/\u0000|\uFFFD/g;function wd(i){return(typeof i=="string"?i:""+i).replace(Eh,`
`).replace(mf,"")}function Tp(i,s){return s=wd(s),wd(i)===s}function Mi(i,s,c,f,b,T){switch(c){case"children":typeof f=="string"?s==="body"||s==="textarea"&&f===""||xs(i,f):(typeof f=="number"||typeof f=="bigint")&&s!=="body"&&xs(i,""+f);break;case"className":ll(i,"class",f);break;case"tabIndex":ll(i,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":ll(i,c,f);break;case"style":Bc(i,f,T);break;case"data":if(s!=="object"){ll(i,"data",f);break}case"src":case"href":if(f===""&&(s!=="a"||c!=="href")){i.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(c);break}f=ti(""+f),i.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(c==="formAction"?(s!=="input"&&Mi(i,s,"name",b.name,b,null),Mi(i,s,"formEncType",b.formEncType,b,null),Mi(i,s,"formMethod",b.formMethod,b,null),Mi(i,s,"formTarget",b.formTarget,b,null)):(Mi(i,s,"encType",b.encType,b,null),Mi(i,s,"method",b.method,b,null),Mi(i,s,"target",b.target,b,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){i.removeAttribute(c);break}f=ti(""+f),i.setAttribute(c,f);break;case"onClick":f!=null&&(i.onclick=ya);break;case"onScroll":f!=null&&Di("scroll",i);break;case"onScrollEnd":f!=null&&Di("scrollend",i);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(A(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(A(60));i.innerHTML=c}}break;case"multiple":i.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":i.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){i.removeAttribute("xlink:href");break}c=ti(""+f),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,""+f):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":f===!0?i.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?i.setAttribute(c,f):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?i.setAttribute(c,f):i.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?i.removeAttribute(c):i.setAttribute(c,f);break;case"popover":Di("beforetoggle",i),Di("toggle",i),Gl(i,"popover",f);break;case"xlinkActuate":is(i,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":is(i,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":is(i,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":is(i,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":is(i,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":is(i,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":is(i,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":is(i,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":is(i,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Gl(i,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=ui.get(c)||c,Gl(i,c,f))}}function Ul(i,s,c,f,b,T){switch(c){case"style":Bc(i,f,T);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(A(61));if(c=f.__html,c!=null){if(b.children!=null)throw Error(A(60));i.innerHTML=c}}break;case"children":typeof f=="string"?xs(i,f):(typeof f=="number"||typeof f=="bigint")&&xs(i,""+f);break;case"onScroll":f!=null&&Di("scroll",i);break;case"onScrollEnd":f!=null&&Di("scrollend",i);break;case"onClick":f!=null&&(i.onclick=ya);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xn.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),s=c.slice(2,b?c.length-7:void 0),T=i[Ze]||null,T=T!=null?T[c]:null,typeof T=="function"&&i.removeEventListener(s,T,b),typeof f=="function")){typeof T!="function"&&T!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(s,f,b);break e}c in i?i[c]=f:f===!0?i.setAttribute(c,""):Gl(i,c,f)}}}function en(i,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Di("error",i),Di("load",i);var f=!1,b=!1,T;for(T in c)if(c.hasOwnProperty(T)){var j=c[T];if(j!=null)switch(T){case"src":f=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(A(137,s));default:Mi(i,s,T,j,c,null)}}b&&Mi(i,s,"srcSet",c.srcSet,c,null),f&&Mi(i,s,"src",c.src,c,null);return;case"input":Di("invalid",i);var H=T=j=b=null,ye=null,Fe=null;for(f in c)if(c.hasOwnProperty(f)){var Je=c[f];if(Je!=null)switch(f){case"name":b=Je;break;case"type":j=Je;break;case"checked":ye=Je;break;case"defaultChecked":Fe=Je;break;case"value":T=Je;break;case"defaultValue":H=Je;break;case"children":case"dangerouslySetInnerHTML":if(Je!=null)throw Error(A(137,s));break;default:Mi(i,s,f,Je,c,null)}}To(i,T,H,ye,Fe,j,b,!1);return;case"select":Di("invalid",i),f=j=T=null;for(b in c)if(c.hasOwnProperty(b)&&(H=c[b],H!=null))switch(b){case"value":T=H;break;case"defaultValue":j=H;break;case"multiple":f=H;default:Mi(i,s,b,H,c,null)}s=T,c=j,i.multiple=!!f,s!=null?Gs(i,!!f,s,!1):c!=null&&Gs(i,!!f,c,!0);return;case"textarea":Di("invalid",i),T=b=f=null;for(j in c)if(c.hasOwnProperty(j)&&(H=c[j],H!=null))switch(j){case"value":f=H;break;case"defaultValue":b=H;break;case"children":T=H;break;case"dangerouslySetInnerHTML":if(H!=null)throw Error(A(91));break;default:Mi(i,s,j,H,c,null)}hl(i,f,b,T);return;case"option":for(ye in c)if(c.hasOwnProperty(ye)&&(f=c[ye],f!=null))switch(ye){case"selected":i.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Mi(i,s,ye,f,c,null)}return;case"dialog":Di("beforetoggle",i),Di("toggle",i),Di("cancel",i),Di("close",i);break;case"iframe":case"object":Di("load",i);break;case"video":case"audio":for(f=0;f<Mh.length;f++)Di(Mh[f],i);break;case"image":Di("error",i),Di("load",i);break;case"details":Di("toggle",i);break;case"embed":case"source":case"link":Di("error",i),Di("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Fe in c)if(c.hasOwnProperty(Fe)&&(f=c[Fe],f!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":throw Error(A(137,s));default:Mi(i,s,Fe,f,c,null)}return;default:if(ga(s)){for(Je in c)c.hasOwnProperty(Je)&&(f=c[Je],f!==void 0&&Ul(i,s,Je,f,c,void 0));return}}for(H in c)c.hasOwnProperty(H)&&(f=c[H],f!=null&&Mi(i,s,H,f,c,null))}function Ic(i,s,c,f){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,T=null,j=null,H=null,ye=null,Fe=null,Je=null;for(qe in c){var rt=c[qe];if(c.hasOwnProperty(qe)&&rt!=null)switch(qe){case"checked":break;case"value":break;case"defaultValue":ye=rt;default:f.hasOwnProperty(qe)||Mi(i,s,qe,null,f,rt)}}for(var $e in f){var qe=f[$e];if(rt=c[$e],f.hasOwnProperty($e)&&(qe!=null||rt!=null))switch($e){case"type":T=qe;break;case"name":b=qe;break;case"checked":Fe=qe;break;case"defaultChecked":Je=qe;break;case"value":j=qe;break;case"defaultValue":H=qe;break;case"children":case"dangerouslySetInnerHTML":if(qe!=null)throw Error(A(137,s));break;default:qe!==rt&&Mi(i,s,$e,qe,f,rt)}}cl(i,j,H,ye,Fe,Je,T,b);return;case"select":qe=j=H=$e=null;for(T in c)if(ye=c[T],c.hasOwnProperty(T)&&ye!=null)switch(T){case"value":break;case"multiple":qe=ye;default:f.hasOwnProperty(T)||Mi(i,s,T,null,f,ye)}for(b in f)if(T=f[b],ye=c[b],f.hasOwnProperty(b)&&(T!=null||ye!=null))switch(b){case"value":$e=T;break;case"defaultValue":H=T;break;case"multiple":j=T;default:T!==ye&&Mi(i,s,b,T,f,ye)}s=H,c=j,f=qe,$e!=null?Gs(i,!!c,$e,!1):!!f!=!!c&&(s!=null?Gs(i,!!c,s,!0):Gs(i,!!c,c?[]:"",!1));return;case"textarea":qe=$e=null;for(H in c)if(b=c[H],c.hasOwnProperty(H)&&b!=null&&!f.hasOwnProperty(H))switch(H){case"value":break;case"children":break;default:Mi(i,s,H,null,f,b)}for(j in f)if(b=f[j],T=c[j],f.hasOwnProperty(j)&&(b!=null||T!=null))switch(j){case"value":$e=b;break;case"defaultValue":qe=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(A(91));break;default:b!==T&&Mi(i,s,j,b,f,T)}ul(i,$e,qe);return;case"option":for(var Dt in c)if($e=c[Dt],c.hasOwnProperty(Dt)&&$e!=null&&!f.hasOwnProperty(Dt))switch(Dt){case"selected":i.selected=!1;break;default:Mi(i,s,Dt,null,f,$e)}for(ye in f)if($e=f[ye],qe=c[ye],f.hasOwnProperty(ye)&&$e!==qe&&($e!=null||qe!=null))switch(ye){case"selected":i.selected=$e&&typeof $e!="function"&&typeof $e!="symbol";break;default:Mi(i,s,ye,$e,f,qe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ii in c)$e=c[ii],c.hasOwnProperty(ii)&&$e!=null&&!f.hasOwnProperty(ii)&&Mi(i,s,ii,null,f,$e);for(Fe in f)if($e=f[Fe],qe=c[Fe],f.hasOwnProperty(Fe)&&$e!==qe&&($e!=null||qe!=null))switch(Fe){case"children":case"dangerouslySetInnerHTML":if($e!=null)throw Error(A(137,s));break;default:Mi(i,s,Fe,$e,f,qe)}return;default:if(ga(s)){for(var fr in c)$e=c[fr],c.hasOwnProperty(fr)&&$e!==void 0&&!f.hasOwnProperty(fr)&&Ul(i,s,fr,void 0,f,$e);for(Je in f)$e=f[Je],qe=c[Je],!f.hasOwnProperty(Je)||$e===qe||$e===void 0&&qe===void 0||Ul(i,s,Je,$e,f,qe);return}}for(var Ie in c)$e=c[Ie],c.hasOwnProperty(Ie)&&$e!=null&&!f.hasOwnProperty(Ie)&&Mi(i,s,Ie,null,f,$e);for(rt in f)$e=f[rt],qe=c[rt],!f.hasOwnProperty(rt)||$e===qe||$e==null&&qe==null||Mi(i,s,rt,$e,f,qe)}function Mp(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function gf(){if(typeof performance.getEntriesByType=="function"){for(var i=0,s=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var b=c[f],T=b.transferSize,j=b.initiatorType,H=b.duration;if(T&&H&&Mp(j)){for(j=0,H=b.responseEnd,f+=1;f<c.length;f++){var ye=c[f],Fe=ye.startTime;if(Fe>H)break;var Je=ye.transferSize,rt=ye.initiatorType;Je&&Mp(rt)&&(ye=ye.responseEnd,j+=Je*(ye<H?1:(H-Fe)/(ye-Fe)))}if(--f,s+=8*(T+j)/(b.duration/1e3),i++,10<i)break}}if(0<i)return s/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Sd=null,Td=null;function Md(i){return i.nodeType===9?i:i.ownerDocument}function kp(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function nl(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function kd(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Cd=null;function yf(){var i=window.event;return i&&i.type==="popstate"?i===Cd?!1:(Cd=i,!0):(Cd=null,!1)}var Cp=typeof setTimeout=="function"?setTimeout:void 0,Xf=typeof clearTimeout=="function"?clearTimeout:void 0,_f=typeof Promise=="function"?Promise:void 0,xf=typeof queueMicrotask=="function"?queueMicrotask:typeof _f<"u"?function(i){return _f.resolve(null).then(i).catch(vf)}:Cp;function vf(i){setTimeout(function(){throw i})}function Fs(i){return i==="head"}function Ep(i,s){var c=s,f=0;do{var b=c.nextSibling;if(i.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(f===0){i.removeChild(b),Yn(s);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")Iu(i.ownerDocument.documentElement);else if(c==="head"){c=i.ownerDocument.head,Iu(c);for(var T=c.firstChild;T;){var j=T.nextSibling,H=T.nodeName;T[Zt]||H==="SCRIPT"||H==="STYLE"||H==="LINK"&&T.rel.toLowerCase()==="stylesheet"||c.removeChild(T),T=j}}else c==="body"&&Iu(i.ownerDocument.body);c=b}while(c);Yn(s)}function Ah(i,s){var c=i;i=0;do{var f=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(i===0)break;i--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||i++;c=f}while(c)}function zu(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":zu(c),gs(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function Ed(i,s,c,f){for(;i.nodeType===1;){var b=c;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!f&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(f){if(!i[Zt])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(T=i.getAttribute("rel"),T==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(T!==b.rel||i.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||i.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||i.getAttribute("title")!==(b.title==null?null:b.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(T=i.getAttribute("src"),(T!==(b.src==null?null:b.src)||i.getAttribute("type")!==(b.type==null?null:b.type)||i.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&T&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var T=b.name==null?null:""+b.name;if(b.type==="hidden"&&i.getAttribute("name")===T)return i}else return i;if(i=Ca(i.nextSibling),i===null)break}return null}function Wf(i,s,c){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=Ca(i.nextSibling),i===null))return null;return i}function bf(i,s){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!s||(i=Ca(i.nextSibling),i===null))return null;return i}function Ap(i){return i.data==="$?"||i.data==="$~"}function $l(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function kn(i,s){var c=i.ownerDocument;if(i.data==="$~")i._reactRetry=s;else if(i.data!=="$?"||c.readyState!=="loading")s();else{var f=function(){s(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),i._reactRetry=f}}function Ca(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return i}var Ad=null;function zp(i){i=i.nextSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"||c==="/&"){if(s===0)return Ca(i.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}i=i.nextSibling}return null}function zd(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return i;s--}else c!=="/$"&&c!=="/&"||s++}i=i.previousSibling}return null}function wf(i,s,c){switch(s=Md(c),i){case"html":if(i=s.documentElement,!i)throw Error(A(452));return i;case"head":if(i=s.head,!i)throw Error(A(453));return i;case"body":if(i=s.body,!i)throw Error(A(454));return i;default:throw Error(A(451))}}function Iu(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);gs(i)}var es=new Map,Sf=new Set;function zh(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var Us=gt.d;gt.d={f:Ip,r:Tf,D:Mf,C:Pp,L:Pd,m:Ih,X:Rp,S:Dp,M:Lp};function Ip(){var i=Us.f(),s=dd();return i||s}function Tf(i){var s=Ra(i);s!==null&&s.tag===5&&s.type==="form"?fn(s):Us.r(i)}var vo=typeof document>"u"?null:document;function Id(i,s,c){var f=vo;if(f&&typeof s=="string"&&s){var b=$n(s);b='link[rel="'+i+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),Sf.has(b)||(Sf.add(b),i={rel:i,crossOrigin:c,href:s},f.querySelector(b)===null&&(s=f.createElement("link"),en(s,"link",i),Er(s),f.head.appendChild(s)))}}function Mf(i){Us.D(i),Id("dns-prefetch",i,null)}function Pp(i,s){Us.C(i,s),Id("preconnect",i,s)}function Pd(i,s,c){Us.L(i,s,c);var f=vo;if(f&&i&&s){var b='link[rel="preload"][as="'+$n(s)+'"]';s==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+$n(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+$n(c.imageSizes)+'"]')):b+='[href="'+$n(i)+'"]';var T=b;switch(s){case"style":T=n(i);break;case"script":T=h(i)}es.has(T)||(i=De({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:i,as:s},c),es.set(T,i),f.querySelector(b)!==null||s==="style"&&f.querySelector(t(T))||s==="script"&&f.querySelector(m(T))||(s=f.createElement("link"),en(s,"link",i),Er(s),f.head.appendChild(s)))}}function Ih(i,s){Us.m(i,s);var c=vo;if(c&&i){var f=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+$n(f)+'"][href="'+$n(i)+'"]',T=b;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=h(i)}if(!es.has(T)&&(i=De({rel:"modulepreload",href:i},s),es.set(T,i),c.querySelector(b)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(m(T)))return}f=c.createElement("link"),en(f,"link",i),Er(f),c.head.appendChild(f)}}}function Dp(i,s,c){Us.S(i,s,c);var f=vo;if(f&&i){var b=ma(f).hoistableStyles,T=n(i);s=s||"default";var j=b.get(T);if(!j){var H={loading:0,preload:null};if(j=f.querySelector(t(T)))H.loading=5;else{i=De({rel:"stylesheet",href:i,"data-precedence":s},c),(c=es.get(T))&&v(i,c);var ye=j=f.createElement("link");Er(ye),en(ye,"link",i),ye._p=new Promise(function(Fe,Je){ye.onload=Fe,ye.onerror=Je}),ye.addEventListener("load",function(){H.loading|=1}),ye.addEventListener("error",function(){H.loading|=2}),H.loading|=4,x(j,s,f)}j={type:"stylesheet",instance:j,count:1,state:H},b.set(T,j)}}}function Rp(i,s){Us.X(i,s);var c=vo;if(c&&i){var f=ma(c).hoistableScripts,b=h(i),T=f.get(b);T||(T=c.querySelector(m(b)),T||(i=De({src:i,async:!0},s),(s=es.get(b))&&M(i,s),T=c.createElement("script"),Er(T),en(T,"link",i),c.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},f.set(b,T))}}function Lp(i,s){Us.M(i,s);var c=vo;if(c&&i){var f=ma(c).hoistableScripts,b=h(i),T=f.get(b);T||(T=c.querySelector(m(b)),T||(i=De({src:i,async:!0,type:"module"},s),(s=es.get(b))&&M(i,s),T=c.createElement("script"),Er(T),en(T,"link",i),c.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},f.set(b,T))}}function kf(i,s,c,f){var b=(b=Gt.current)?zh(b):null;if(!b)throw Error(A(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=n(c.href),c=ma(b).hoistableStyles,f=c.get(s),f||(f={type:"style",instance:null,count:0,state:null},c.set(s,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=n(c.href);var T=ma(b).hoistableStyles,j=T.get(i);if(j||(b=b.ownerDocument||b,j={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(i,j),(T=b.querySelector(t(i)))&&!T._p&&(j.instance=T,j.state.loading=5),es.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},es.set(i,c),T||o(b,i,c,j.state))),s&&f===null)throw Error(A(528,""));return j}if(s&&f!==null)throw Error(A(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=h(c),c=ma(b).hoistableScripts,f=c.get(s),f||(f={type:"script",instance:null,count:0,state:null},c.set(s,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(A(444,i))}}function n(i){return'href="'+$n(i)+'"'}function t(i){return'link[rel="stylesheet"]['+i+"]"}function r(i){return De({},i,{"data-precedence":i.precedence,precedence:null})}function o(i,s,c,f){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?f.loading=1:(s=i.createElement("link"),f.preload=s,s.addEventListener("load",function(){return f.loading|=1}),s.addEventListener("error",function(){return f.loading|=2}),en(s,"link",c),Er(s),i.head.appendChild(s))}function h(i){return'[src="'+$n(i)+'"]'}function m(i){return"script[async]"+i}function y(i,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var f=i.querySelector('style[data-href~="'+$n(c.href)+'"]');if(f)return s.instance=f,Er(f),f;var b=De({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(i.ownerDocument||i).createElement("style"),Er(f),en(f,"style",b),x(f,c.precedence,i),s.instance=f;case"stylesheet":b=n(c.href);var T=i.querySelector(t(b));if(T)return s.state.loading|=4,s.instance=T,Er(T),T;f=r(c),(b=es.get(b))&&v(f,b),T=(i.ownerDocument||i).createElement("link"),Er(T);var j=T;return j._p=new Promise(function(H,ye){j.onload=H,j.onerror=ye}),en(T,"link",f),s.state.loading|=4,x(T,c.precedence,i),s.instance=T;case"script":return T=h(c.src),(b=i.querySelector(m(T)))?(s.instance=b,Er(b),b):(f=c,(b=es.get(T))&&(f=De({},c),M(f,b)),i=i.ownerDocument||i,b=i.createElement("script"),Er(b),en(b,"link",f),i.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(A(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(f=s.instance,s.state.loading|=4,x(f,c.precedence,i));return s.instance}function x(i,s,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=f.length?f[f.length-1]:null,T=b,j=0;j<f.length;j++){var H=f[j];if(H.dataset.precedence===s)T=H;else if(T!==b)break}T?T.parentNode.insertBefore(i,T.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(i,s.firstChild))}function v(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function M(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var k=null;function P(i,s,c){if(k===null){var f=new Map,b=k=new Map;b.set(c,f)}else b=k,f=b.get(c),f||(f=new Map,b.set(c,f));if(f.has(i))return f;for(f.set(i,null),c=c.getElementsByTagName(i),b=0;b<c.length;b++){var T=c[b];if(!(T[Zt]||T[di]||i==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var j=T.getAttribute(s)||"";j=i+j;var H=f.get(j);H?H.push(T):f.set(j,[T])}}return f}function B(i,s,c){i=i.ownerDocument||i,i.head.insertBefore(c,s==="title"?i.querySelector("head > title"):null)}function U(i,s,c){if(c===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function V(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function q(i,s,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=n(f.href),T=s.querySelector(t(b));if(T){s=T._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(i.count++,i=Ce.bind(i),s.then(i,i)),c.state.loading|=4,c.instance=T,Er(T);return}T=s.ownerDocument||s,f=r(f),(b=es.get(b))&&v(f,b),T=T.createElement("link"),Er(T);var j=T;j._p=new Promise(function(H,ye){j.onload=H,j.onerror=ye}),en(T,"link",f),c.instance=T}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(i.count++,c=Ce.bind(i),s.addEventListener("load",c),s.addEventListener("error",c))}}var Y=0;function ae(i,s){return i.stylesheets&&i.count===0&&me(i,i.stylesheets),0<i.count||0<i.imgCount?function(c){var f=setTimeout(function(){if(i.stylesheets&&me(i,i.stylesheets),i.unsuspend){var T=i.unsuspend;i.unsuspend=null,T()}},6e4+s);0<i.imgBytes&&Y===0&&(Y=62500*gf());var b=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&me(i,i.stylesheets),i.unsuspend)){var T=i.unsuspend;i.unsuspend=null,T()}},(i.imgBytes>Y?50:800)+s);return i.unsuspend=c,function(){i.unsuspend=null,clearTimeout(f),clearTimeout(b)}}:null}function Ce(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)me(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var ue=null;function me(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,ue=new Map,s.forEach(je,i),ue=null,Ce.call(i))}function je(i,s){if(!(s.state.loading&4)){var c=ue.get(i);if(c)var f=c.get(null);else{c=new Map,ue.set(i,c);for(var b=i.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<b.length;T++){var j=b[T];(j.nodeName==="LINK"||j.getAttribute("media")!=="not all")&&(c.set(j.dataset.precedence,j),f=j)}f&&c.set(null,f)}b=s.instance,j=b.getAttribute("data-precedence"),T=c.get(j)||f,T===f&&c.set(null,b),c.set(j,b),this.count++,f=Ce.bind(this),b.addEventListener("load",f),b.addEventListener("error",f),T?T.parentNode.insertBefore(b,T.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(b,i.firstChild)),s.state.loading|=4}}var Ue={$$typeof:$t,Provider:null,Consumer:null,_currentValue:Ot,_currentValue2:Ot,_threadCount:0};function it(i,s,c,f,b,T,j,H,ye){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ki(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ki(0),this.hiddenUpdates=ki(null),this.identifierPrefix=f,this.onUncaughtError=b,this.onCaughtError=T,this.onRecoverableError=j,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ye,this.incompleteTransitions=new Map}function mt(i,s,c,f,b,T,j,H,ye,Fe,Je,rt){return i=new it(i,s,c,j,ye,Fe,Je,rt,H),s=1,T===!0&&(s|=24),T=ta(3,null,null,s),i.current=T,T.stateNode=i,s=vn(),s.refCount++,i.pooledCache=s,s.refCount++,T.memoizedState={element:f,isDehydrated:c,cache:s},Za(T),i}function lt(i){return i?(i=li,i):li}function pt(i,s,c,f,b,T){b=lt(b),f.context===null?f.context=b:f.pendingContext=b,f=co(s),f.payload={element:c},T=T===void 0?null:T,T!==null&&(f.callback=T),c=qa(i,f,s),c!==null&&(Xn(c,i,s),uo(c,i,s))}function It(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<s?c:s}}function ut(i,s){It(i,s),(i=i.alternate)&&It(i,s)}function ft(i){if(i.tag===13||i.tag===31){var s=va(i,67108864);s!==null&&Xn(s,i,67108864),ut(i,67108864)}}function We(i){if(i.tag===13||i.tag===31){var s=ka();s=pe(s);var c=va(i,s);c!==null&&Xn(c,i,s),ut(i,s)}}var Ut=!0;function Qt(i,s,c,f){var b=He.T;He.T=null;var T=gt.p;try{gt.p=2,Ct(i,s,c,f)}finally{gt.p=T,He.T=b}}function Lt(i,s,c,f){var b=He.T;He.T=null;var T=gt.p;try{gt.p=8,Ct(i,s,c,f)}finally{gt.p=T,He.T=b}}function Ct(i,s,c,f){if(Ut){var b=fi(f);if(b===null)bd(i,s,f,pr,c),Ea(i,f);else if(pa(b,i,s,c,f))f.stopPropagation();else if(Ea(i,f),s&4&&-1<Wn.indexOf(i)){for(;b!==null;){var T=Ra(b);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var j=_e(T.pendingLanes);if(j!==0){var H=T;for(H.pendingLanes|=2,H.entangledLanes|=2;j;){var ye=1<<31-fe(j);H.entanglements[1]|=ye,j&=~ye}Bs(T),(Oi&6)===0&&(Ec=dr()+500,zc(0))}}break;case 31:case 13:H=va(T,2),H!==null&&Xn(H,T,2),dd(),ut(T,2)}if(T=fi(f),T===null&&bd(i,s,f,pr,c),T===b)break;b=T}b!==null&&f.stopPropagation()}else bd(i,s,f,null,c)}}function fi(i){return i=Mo(i),Or(i)}var pr=null;function Or(i){if(pr=null,i=Da(i),i!==null){var s=ie(i);if(s===null)i=null;else{var c=s.tag;if(c===13){if(i=z(s),i!==null)return i;i=null}else if(c===31){if(i=u(s),i!==null)return i;i=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return pr=i,null}function yn(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(fa()){case rn:return 2;case st:return 8;case Pt:case Et:return 32;case ne:return 268435456;default:return 32}default:return 32}}var da=!1,Gr=null,wr=null,Zi=null,Pr=new Map,Br=new Map,Sr=[],Wn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ea(i,s){switch(i){case"focusin":case"focusout":Gr=null;break;case"dragenter":case"dragleave":wr=null;break;case"mouseover":case"mouseout":Zi=null;break;case"pointerover":case"pointerout":Pr.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Br.delete(s.pointerId)}}function Dr(i,s,c,f,b,T){return i===null||i.nativeEvent!==T?(i={blockedOn:s,domEventName:c,eventSystemFlags:f,nativeEvent:T,targetContainers:[b]},s!==null&&(s=Ra(s),s!==null&&ft(s)),i):(i.eventSystemFlags|=f,s=i.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),i)}function pa(i,s,c,f,b){switch(s){case"focusin":return Gr=Dr(Gr,i,s,c,f,b),!0;case"dragenter":return wr=Dr(wr,i,s,c,f,b),!0;case"mouseover":return Zi=Dr(Zi,i,s,c,f,b),!0;case"pointerover":var T=b.pointerId;return Pr.set(T,Dr(Pr.get(T)||null,i,s,c,f,b)),!0;case"gotpointercapture":return T=b.pointerId,Br.set(T,Dr(Br.get(T)||null,i,s,c,f,b)),!0}return!1}function Zr(i){var s=Da(i.target);if(s!==null){var c=ie(s);if(c!==null){if(s=c.tag,s===13){if(s=z(c),s!==null){i.blockedOn=s,ot(i.priority,function(){We(c)});return}}else if(s===31){if(s=u(c),s!==null){i.blockedOn=s,ot(i.priority,function(){We(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Nr(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var c=fi(i.nativeEvent);if(c===null){c=i.nativeEvent;var f=new c.constructor(c.type,c);Nc=f,c.target.dispatchEvent(f),Nc=null}else return s=Ra(c),s!==null&&ft(s),i.blockedOn=c,!1;s.shift()}return!0}function tn(i,s,c){Nr(i)&&c.delete(s)}function qr(){da=!1,Gr!==null&&Nr(Gr)&&(Gr=null),wr!==null&&Nr(wr)&&(wr=null),Zi!==null&&Nr(Zi)&&(Zi=null),Pr.forEach(tn),Br.forEach(tn)}function er(i,s){i.blockedOn===s&&(i.blockedOn=null,da||(da=!0,re.unstable_scheduleCallback(re.unstable_NormalPriority,qr)))}var Aa=null;function Pc(i){Aa!==i&&(Aa=i,re.unstable_scheduleCallback(re.unstable_NormalPriority,function(){Aa===i&&(Aa=null);for(var s=0;s<i.length;s+=3){var c=i[s],f=i[s+1],b=i[s+2];if(typeof f!="function"){if(Or(f||c)===null)continue;break}var T=Ra(c);T!==null&&(i.splice(s,3),s-=3,ds(T,{pending:!0,data:b,method:c.method,action:f},f,b))}}))}function Yn(i){function s(ye){return er(ye,i)}Gr!==null&&er(Gr,i),wr!==null&&er(wr,i),Zi!==null&&er(Zi,i),Pr.forEach(s),Br.forEach(s);for(var c=0;c<Sr.length;c++){var f=Sr[c];f.blockedOn===i&&(f.blockedOn=null)}for(;0<Sr.length&&(c=Sr[0],c.blockedOn===null);)Zr(c),c.blockedOn===null&&Sr.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var b=c[f],T=c[f+1],j=b[Ze]||null;if(typeof T=="function")j||Pc(c);else if(j){var H=null;if(T&&T.hasAttribute("formAction")){if(b=T,j=T[Ze]||null)H=j.formAction;else if(Or(b)!==null)continue}else H=j.action;typeof H=="function"?c[f+1]=H:(c.splice(f,3),f-=3),Pc(c)}}}function Cf(){function i(T){T.canIntercept&&T.info==="react-transition"&&T.intercept({handler:function(){return new Promise(function(j){return b=j})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var T=navigation.currentEntry;T&&T.url!=null&&navigation.navigate(T.url,{state:T.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,b=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function Vl(i){this._internalRoot=i}bo.prototype.render=Vl.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(A(409));var c=s.current,f=ka();pt(c,f,i,s,null,null)},bo.prototype.unmount=Vl.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;pt(i.current,2,null,i,null,null),dd(),s[dt]=null}};function bo(i){this._internalRoot=i}bo.prototype.unstable_scheduleHydration=function(i){if(i){var s=ht();i={blockedOn:null,target:i,priority:s};for(var c=0;c<Sr.length&&s!==0&&s<Sr[c].priority;c++);Sr.splice(c,0,i),c===0&&Zr(i)}};var Dc=C.version;if(Dc!=="19.2.0")throw Error(A(527,Dc,"19.2.0"));gt.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(A(188)):(i=Object.keys(i).join(","),Error(A(268,i)));return i=te(s),i=i!==null?xe(i):null,i=i===null?null:i.stateNode,i};var Pu={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:He,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{G=al.inject(Pu),ee=al}catch{}}return Op.createRoot=function(i,s){if(!X(i))throw Error(A(299));var c=!1,f="",b=$d,T=Fp,j=Qh;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(f=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(T=s.onCaughtError),s.onRecoverableError!==void 0&&(j=s.onRecoverableError)),s=mt(i,1,!1,null,null,c,f,null,b,T,j,Cf),i[dt]=s.current,vd(i),new Vl(s)},Op.hydrateRoot=function(i,s,c){if(!X(i))throw Error(A(299));var f=!1,b="",T=$d,j=Fp,H=Qh,ye=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(T=c.onUncaughtError),c.onCaughtError!==void 0&&(j=c.onCaughtError),c.onRecoverableError!==void 0&&(H=c.onRecoverableError),c.formState!==void 0&&(ye=c.formState)),s=mt(i,1,!0,s,c??null,f,b,ye,T,j,H,Cf),s.context=lt(null),c=s.current,f=ka(),f=pe(f),b=co(f),b.callback=null,qa(c,b,f),c=f,s.current.lanes=c,mr(s,c),Bs(s),i[dt]=s.current,vd(i),new bo(s)},Op.version="19.2.0",Op}var ym;function Vm(){if(ym)return Kf.exports;ym=1;function re(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(re)}catch(C){console.error(C)}}return re(),Kf.exports=$m(),Kf.exports}var Gm=Vm(),Xe=am();const Ef=km(Xe);var zf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.10.0/LICENSE.txt
 */var Zm=zf.exports,_m;function qm(){return _m||(_m=1,(function(re,C){(function(N,A){re.exports=A()})(Zm,(function(){var N={},A={};function X(z,u,W){if(A[z]=W,z==="index"){var te="var sharedModule = {}; ("+A.shared+")(sharedModule); ("+A.worker+")(sharedModule);",xe={};return A.shared(xe),A.index(N,xe),typeof window<"u"&&N.setWorkerUrl(window.URL.createObjectURL(new Blob([te],{type:"text/javascript"}))),N}}X("shared",["exports"],(function(z){function u(n,t,r,o){return new(r||(r=Promise))((function(h,m){function y(M){try{v(o.next(M))}catch(k){m(k)}}function x(M){try{v(o.throw(M))}catch(k){m(k)}}function v(M){var k;M.done?h(M.value):(k=M.value,k instanceof r?k:new r((function(P){P(k)}))).then(y,x)}v((o=o.apply(n,t||[])).next())}))}function W(n,t){this.x=n,this.y=t}function te(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var xe,De;typeof SuppressedError=="function"&&SuppressedError,W.prototype={clone(){return new W(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,t){return this.clone()._rotateAround(n,t)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult(n){const t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const t=Math.cos(n),r=Math.sin(n),o=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=o,this},_rotateAround(n,t){const r=Math.cos(n),o=Math.sin(n),h=t.y+o*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-o*(this.y-t.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:W},W.convert=function(n){if(n instanceof W)return n;if(Array.isArray(n))return new W(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new W(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var we=(function(){if(De)return xe;function n(t,r,o,h){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=h}return De=1,xe=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,h=0;h<8;h++){var m=this.sampleCurveX(o)-t;if(Math.abs(m)<r)return o;var y=this.sampleCurveDerivativeX(o);if(Math.abs(y)<1e-6)break;o-=m/y}var x=0,v=1;for(o=t,h=0;h<20&&(m=this.sampleCurveX(o),!(Math.abs(m-t)<r));h++)t>m?x=o:v=o,o=.5*(v-x)+x;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},xe})(),Ee=te(we);let Qe,ve;function St(){return Qe==null&&(Qe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Qe}function wt(){if(ve==null&&(ve=!1,St())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const h=4*o;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&r[o]!==o){ve=!0;break}}}return ve||!1}var jt=1e-6,$t=typeof Float32Array<"u"?Float32Array:Array;function Fi(){var n=new $t(9);return $t!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Rt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function vt(){var n=new $t(3);return $t!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ft(n){var t=n[0],r=n[1],o=n[2];return Math.sqrt(t*t+r*r+o*o)}function wi(n,t,r){var o=new $t(3);return o[0]=n,o[1]=t,o[2]=r,o}function Ui(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n}function Ri(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function Yi(n,t,r){var o=t[0],h=t[1],m=t[2],y=r[0],x=r[1],v=r[2];return n[0]=h*v-m*x,n[1]=m*y-o*v,n[2]=o*x-h*y,n}var Ci,Vt=Ft;function Kt(n,t,r){var o=t[0],h=t[1],m=t[2],y=t[3];return n[0]=r[0]*o+r[4]*h+r[8]*m+r[12]*y,n[1]=r[1]*o+r[5]*h+r[9]*m+r[13]*y,n[2]=r[2]*o+r[6]*h+r[10]*m+r[14]*y,n[3]=r[3]*o+r[7]*h+r[11]*m+r[15]*y,n}function qi(){var n=new $t(4);return $t!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function He(n,t,r,o){var h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",m=Math.PI/360;t*=m,o*=m,r*=m;var y=Math.sin(t),x=Math.cos(t),v=Math.sin(r),M=Math.cos(r),k=Math.sin(o),P=Math.cos(o);switch(h){case"xyz":n[0]=y*M*P+x*v*k,n[1]=x*v*P-y*M*k,n[2]=x*M*k+y*v*P,n[3]=x*M*P-y*v*k;break;case"xzy":n[0]=y*M*P-x*v*k,n[1]=x*v*P-y*M*k,n[2]=x*M*k+y*v*P,n[3]=x*M*P+y*v*k;break;case"yxz":n[0]=y*M*P+x*v*k,n[1]=x*v*P-y*M*k,n[2]=x*M*k-y*v*P,n[3]=x*M*P+y*v*k;break;case"yzx":n[0]=y*M*P+x*v*k,n[1]=x*v*P+y*M*k,n[2]=x*M*k-y*v*P,n[3]=x*M*P-y*v*k;break;case"zxy":n[0]=y*M*P-x*v*k,n[1]=x*v*P+y*M*k,n[2]=x*M*k+y*v*P,n[3]=x*M*P-y*v*k;break;case"zyx":n[0]=y*M*P-x*v*k,n[1]=x*v*P+y*M*k,n[2]=x*M*k-y*v*P,n[3]=x*M*P+y*v*k;break;default:throw new Error("Unknown angle order "+h)}return n}function gt(){var n=new $t(2);return $t!=Float32Array&&(n[0]=0,n[1]=0),n}function Ot(n,t){var r=new $t(2);return r[0]=n,r[1]=t,r}vt(),Ci=new $t(4),$t!=Float32Array&&(Ci[0]=0,Ci[1]=0,Ci[2]=0,Ci[3]=0),vt(),wi(1,0,0),wi(0,1,0),qi(),qi(),Fi(),gt();const At=8192;function mi(n,t,r){return t*(At/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function be(n,t){return(n%t+t)%t}function Ye(n,t,r){return n*(1-r)+t*r}function yt(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function kt(n,t,r,o){const h=new Ee(n,t,r,o);return m=>h.solve(m)}const Ht=kt(.25,.1,.25,1);function Gt(n,t,r){return Math.min(r,Math.max(t,n))}function ei(n,t,r){const o=r-t,h=((n-t)%o+o)%o+t;return h===t?r:h}function $i(n,...t){for(const r of t)for(const o in r)n[o]=r[o];return n}let vi=1;function Cn(n,t,r){const o={};for(const h in n)o[h]=t.call(this,n[h],h,n);return o}function _n(n,t,r){const o={};for(const h in n)t.call(this,n[h],h,n)&&(o[h]=n[h]);return o}function Tr(n){return Array.isArray(n)?n.map(Tr):typeof n=="object"&&n?Cn(n,Tr):n}const En={};function zi(n){En[n]||(typeof console<"u"&&console.warn(n),En[n]=!0)}function Bi(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function cn(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let Pa=null;function Ei(n){if(Pa==null){const t=n.navigator?n.navigator.userAgent:null;Pa=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Pa}function An(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Fn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Hr(n,t,r,o,h){return u(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(n,{timestamp:0});try{const y=m?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const x=y.startsWith("BGR"),v=new Uint8ClampedArray(o*h*4);if(yield m.copyTo(v,(function(M,k,P,B,U){const V=4*Math.max(-k,0),q=(Math.max(0,P)-P)*B*4+V,Y=4*B,ae=Math.max(0,k),Ce=Math.max(0,P);return{rect:{x:ae,y:Ce,width:Math.min(M.width,k+B)-ae,height:Math.min(M.height,P+U)-Ce},layout:[{offset:q,stride:Y}]}})(n,t,r,o,h)),x)for(let M=0;M<v.length;M+=4){const k=v[M];v[M]=v[M+2],v[M+2]=k}return v}finally{m.close()}}))}let Qn,un;function dr(n,t,r,o){return n.addEventListener(t,r,o),{unsubscribe:()=>{n.removeEventListener(t,r,o)}}}function fa(n){return n*Math.PI/180}function rn(n){return n/Math.PI*180}const st={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Pt={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Et="AbortError";function ne(){return new Error(Et)}const O={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function F(n){return O.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const G="global-dispatcher";class ee extends Error{constructor(t,r,o,h){super(`AJAXError: ${r} (${t}): ${o}`),this.status=t,this.statusText=r,this.url=o,this.body=h}}const le=()=>cn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,fe=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=F(n.url);if(o)return o(n,t);if(cn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:G},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(le())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,h){return u(this,void 0,void 0,(function*(){const m=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:le(),signal:h.signal});let y,x;o.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");try{y=yield fetch(m)}catch(M){throw new ee(0,M.message,o.url,new Blob)}if(!y.ok){const M=yield y.blob();throw new ee(y.status,y.statusText,o.url,M)}x=o.type==="arrayBuffer"||o.type==="image"?y.arrayBuffer():o.type==="json"?y.json():y.text();const v=yield x;if(h.signal.aborted)throw ne();return{data:v,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}}))})(n,t);if(cn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:G},t)}var r;return(function(o,h){return new Promise(((m,y)=>{var x;const v=new XMLHttpRequest;v.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(v.responseType="arraybuffer");for(const M in o.headers)v.setRequestHeader(M,o.headers[M]);o.type==="json"&&(v.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||v.setRequestHeader("Accept","application/json")),v.withCredentials=o.credentials==="include",v.onerror=()=>{y(new Error(v.statusText))},v.onload=()=>{if(!h.signal.aborted)if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let M=v.response;if(o.type==="json")try{M=JSON.parse(v.response)}catch(k){return void y(k)}m({data:M,cacheControl:v.getResponseHeader("Cache-Control"),expires:v.getResponseHeader("Expires")})}else{const M=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});y(new ee(v.status,v.statusText,o.url,M))}},h.signal.addEventListener("abort",(()=>{v.abort(),y(ne())})),v.send(o.body)}))})(n,t)};function Pe(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Se(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function Ae(n,t,r){if(r&&r[n]){const o=r[n].indexOf(t);o!==-1&&r[n].splice(o,1)}}class Ge{constructor(t,r={}){$i(this,r),this.type=t}}class Ve extends Ge{constructor(t,r={}){super("error",$i({error:t},r))}}class ct{on(t,r){return this._listeners=this._listeners||{},Se(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return Ae(t,r,this._listeners),Ae(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Se(t,r,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,r){typeof t=="string"&&(t=new Ge(t,r||{}));const o=t.type;if(this.listens(o)){t.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of h)x.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of m)Ae(o,x,this._oneTimeListeners),x.call(this,t);const y=this._eventedParent;y&&($i(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof Ve&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const qt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ii(n,t){const r={};for(const o in n)o!=="ref"&&(r[o]=n[o]);return qt.forEach((o=>{o in t&&(r[o]=t[o])})),r}function zt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!zt(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!zt(n[r],t[r]))return!1;return!0}return n===t}function oi(n,t){n.push(t)}function ki(n,t,r){oi(r,{command:"addSource",args:[n,t[n]]})}function mr(n,t,r){oi(t,{command:"removeSource",args:[n]}),r[n]=!0}function nr(n,t,r,o){mr(n,r,o),ki(n,t,r)}function gi(n,t,r){let o;for(o in n[r])if(Object.prototype.hasOwnProperty.call(n[r],o)&&o!=="data"&&!zt(n[r][o],t[r][o]))return!1;for(o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&o!=="data"&&!zt(n[r][o],t[r][o]))return!1;return!0}function ze(n,t,r,o,h,m){n=n||{},t=t||{};for(const y in n)Object.prototype.hasOwnProperty.call(n,y)&&(zt(n[y],t[y])||r.push({command:m,args:[o,y,t[y],h]}));for(const y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(n,y)&&(zt(n[y],t[y])||r.push({command:m,args:[o,y,t[y],h]}))}function Ke(n){return n.id}function pe(n,t){return n[t.id]=t,n}class Me{constructor(t,r,o,h){this.message=(t?`${t}: `:"")+o,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function ht(n,...t){for(const r of t)for(const o in r)n[o]=r[o];return n}class ot extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class ri{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[o,h]of r)this.bindings[o]=h}concat(t){return new ri(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const di={kind:"null"},Ze={kind:"number"},dt={kind:"string"},Bt={kind:"boolean"},xt={kind:"color"},Si={kind:"projectionDefinition"},Un={kind:"object"},Zt={kind:"value"},gs={kind:"collator"},Da={kind:"formatted"},Ra={kind:"padding"},ys={kind:"colorArray"},ma={kind:"numberArray"},Er={kind:"resolvedImage"},ts={kind:"variableAnchorOffsetCollection"};function xn(n,t){return{kind:"array",itemType:n,N:t}}function ni(n){if(n.kind==="array"){const t=ni(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const sl=[di,Ze,dt,Bt,xt,Si,Da,Un,xn(Zt),Ra,ma,ys,Er,ts];function ol(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ol(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of sl)if(!ol(r,t))return null}}return`Expected ${ni(n)} but found ${ni(t)} instead.`}function $s(n,t){return t.some((r=>r.kind===n.kind))}function _s(n,t){return t.some((r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n))}function Vs(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Gl=.96422,ll=.82521,is=4/29,nn=6/29,Du=3*nn*nn,Od=nn*nn*nn,Ru=Math.PI/180,Rh=180/Math.PI;function Zl(n){return(n%=360)<0&&(n+=360),n}function Lh([n,t,r,o]){let h,m;const y=cl((.2225045*(n=$n(n))+.7168786*(t=$n(t))+.0606169*(r=$n(r)))/1);n===t&&t===r?h=m=y:(h=cl((.4360747*n+.3850649*t+.1430804*r)/Gl),m=cl((.0139322*n+.0971045*t+.7141733*r)/ll));const x=116*y-16;return[x<0?0:x,500*(h-y),200*(y-m),o]}function $n(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function cl(n){return n>Od?Math.pow(n,1/3):n/Du+is}function To([n,t,r,o]){let h=(n+16)/116,m=isNaN(t)?h:h+t/500,y=isNaN(r)?h:h-r/200;return h=1*Gs(h),m=Gl*Gs(m),y=ll*Gs(y),[ql(3.1338561*m-1.6168667*h-.4906146*y),ql(-.9787684*m+1.9161415*h+.033454*y),ql(.0719453*m-.2289914*h+1.4052427*y),o]}function ql(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Gs(n){return n>nn?n*n*n:Du*(n-is)}const ul=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function hl(n,t){return ul(n,t)?n[t]:void 0}function xs(n){return parseInt(n.padEnd(2,n),16)/255}function jh(n,t){return Zs(t?n/100:n,0,1)}function Zs(n,t,r){return Math.min(Math.max(t,n),r)}function Bc(n){return!n.some(Number.isNaN)}const ga={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ui(n,t,r){return n+r*(t-n)}function La(n,t,r){return n.map(((o,h)=>ui(o,t[h],r)))}class ti{constructor(t,r,o,h=1,m=!0){this.r=t,this.g=r,this.b=o,this.a=h,m||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,r,o,h]))}static parse(t){if(t instanceof ti)return t;if(typeof t!="string")return;const r=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=hl(ga,o);if(h){const[y,x,v]=h;return[y/255,x/255,v/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const y=o.length<6?1:2;let x=1;return[xs(o.slice(x,x+=y)),xs(o.slice(x,x+=y)),xs(o.slice(x,x+=y)),xs(o.slice(x,x+y)||"ff")]}if(o.startsWith("rgb")){const y=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[x,v,M,k,P,B,U,V,q,Y,ae,Ce]=y,ue=[k||" ",U||" ",Y].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const me=[M,B,q].join(""),je=me==="%%%"?100:me===""?255:0;if(je){const Ue=[Zs(+v/je,0,1),Zs(+P/je,0,1),Zs(+V/je,0,1),ae?jh(+ae,Ce):1];if(Bc(Ue))return Ue}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,x,v,M,k,P,B,U,V]=m,q=[v||" ",k||" ",B].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const Y=[+x,Zs(+M,0,100),Zs(+P,0,100),U?jh(+U,V):1];if(Bc(Y))return(function([ae,Ce,ue,me]){function je(Ue){const it=(Ue+ae/30)%12,mt=Ce*Math.min(ue,1-ue);return ue-mt*Math.max(-1,Math.min(it-3,9-it,1))}return ae=Zl(ae),Ce/=100,ue/=100,[je(0),je(8),je(4),me]})(Y)}}})(t);return r?new ti(...r,!1):void 0}get rgb(){const{r:t,g:r,b:o,a:h}=this,m=h||1/0;return this.overwriteGetter("rgb",[t/m,r/m,o/m,h])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[r,o,h,m]=Lh(t),y=Math.sqrt(o*o+h*h);return[Math.round(1e4*y)?Zl(Math.atan2(h,o)*Rh):NaN,y,r,m]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Lh(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,o,h]=this.rgb;return`rgba(${[t,r,o].map((m=>Math.round(255*m))).join(",")},${h})`}static interpolate(t,r,o,h="rgb"){switch(h){case"rgb":{const[m,y,x,v]=La(t.rgb,r.rgb,o);return new ti(m,y,x,v,!1)}case"hcl":{const[m,y,x,v]=t.hcl,[M,k,P,B]=r.hcl;let U,V;if(isNaN(m)||isNaN(M))isNaN(m)?isNaN(M)?U=NaN:(U=M,x!==1&&x!==0||(V=k)):(U=m,P!==1&&P!==0||(V=y));else{let ue=M-m;M>m&&ue>180?ue-=360:M<m&&m-M>180&&(ue+=360),U=m+o*ue}const[q,Y,ae,Ce]=(function([ue,me,je,Ue]){return ue=isNaN(ue)?0:ue*Ru,To([je,Math.cos(ue)*me,Math.sin(ue)*me,Ue])})([U,V??ui(y,k,o),ui(x,P,o),ui(v,B,o)]);return new ti(q,Y,ae,Ce,!1)}case"lab":{const[m,y,x,v]=To(La(t.lab,r.lab,o));return new ti(m,y,x,v,!1)}}}}ti.black=new ti(0,0,0,1),ti.white=new ti(1,1,1,1),ti.transparent=new ti(0,0,0,0),ti.red=new ti(1,0,0,1);class ya{constructor(t,r,o){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Nc=["bottom","center","top"];class Mo{constructor(t,r,o,h,m,y){this.text=t,this.image=r,this.scale=o,this.fontStack=h,this.textColor=m,this.verticalAlign=y}}class Ar{constructor(t){this.sections=t}static fromString(t){return new Ar([new Mo(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Ar?t:Ar.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Mr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Mr)return t;if(typeof t=="number")return new Mr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Mr(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new Mr(La(t.values,r.values,o))}}class hn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof hn)return t;if(typeof t=="number")return new hn([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new hn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new hn(La(t.values,r.values,o))}}class Rr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Rr)return t;if(typeof t=="string"){const o=ti.parse(t);return o?new Rr([o]):void 0}if(!Array.isArray(t))return;const r=[];for(const o of t){if(typeof o!="string")return;const h=ti.parse(o);if(!h)return;r.push(h)}return new Rr(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o,h="rgb"){const m=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let y=0;y<t.values.length;y++)m.push(ti.interpolate(t.values[y],r.values[y],o,h));return new Rr(m)}}class ar extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Hl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const o=t[r],h=t[r+1];if(typeof o!="string"||!Hl.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new gr(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){const h=t.values,m=r.values;if(h.length!==m.length)throw new ar(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const y=[];for(let x=0;x<h.length;x+=2){if(h[x]!==m[x])throw new ar(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${h[x]}, to[${x}]: ${m[x]}`);y.push(h[x]);const[v,M]=h[x+1],[k,P]=m[x+1];y.push([ui(v,k,o),ui(M,P,o)])}return new gr(y)}}class Xr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Xr({name:t,available:!1}):null}}class an{constructor(t,r,o){this.from=t,this.to=r,this.transition=o}static interpolate(t,r,o){return new an(t,r,o)}static parse(t){return t instanceof an?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new an(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new an(t.from,t.to,t.transition):typeof t=="string"?new an(t,t,1):void 0}}function rs(n,t,r,o){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,t,r,o]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qs(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof an||n instanceof ti||n instanceof ya||n instanceof Ar||n instanceof Mr||n instanceof hn||n instanceof Rr||n instanceof gr||n instanceof Xr)return!0;if(Array.isArray(n)){for(const t of n)if(!qs(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!qs(n[t]))return!1;return!0}return!1}function sr(n){if(n===null)return di;if(typeof n=="string")return dt;if(typeof n=="boolean")return Bt;if(typeof n=="number")return Ze;if(n instanceof ti)return xt;if(n instanceof an)return Si;if(n instanceof ya)return gs;if(n instanceof Ar)return Da;if(n instanceof Mr)return Ra;if(n instanceof hn)return ma;if(n instanceof Rr)return ys;if(n instanceof gr)return ts;if(n instanceof Xr)return Er;if(Array.isArray(n)){const t=n.length;let r;for(const o of n){const h=sr(o);if(r){if(r===h)continue;r=Zt;break}r=h}return xn(r||Zt,t)}return Un}function Hi(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof ti||n instanceof an||n instanceof Ar||n instanceof Mr||n instanceof hn||n instanceof Rr||n instanceof gr||n instanceof Xr?n.toString():JSON.stringify(n)}class _a{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!qs(t[1]))return r.error("invalid value");const o=t[1];let h=sr(o);const m=r.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new _a(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const pi={string:dt,number:Ze,boolean:Bt,object:Un};class Xt{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o,h=1;const m=t[0];if(m==="array"){let x,v;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in pi)||M==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=pi[M],h++}else x=Zt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=t[2],h++}o=xn(x,v)}else{if(!pi[m])throw new Error(`Types doesn't contain name = ${m}`);o=pi[m]}const y=[];for(;h<t.length;h++){const x=r.parse(t[h],h,Zt);if(!x)return null;y.push(x)}return new Xt(o,y)}evaluate(t){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(t);if(!ol(this.type,sr(o)))return o;if(r===this.args.length-1)throw new ar(`Expected value to be of type ${ni(this.type)}, but found ${ni(sr(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const dn={"to-boolean":Bt,"to-color":xt,"to-number":Ze,"to-string":dt};class ai{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[0];if(!dn[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return r.error("Expected one argument.");const h=dn[o],m=[];for(let y=1;y<t.length;y++){const x=r.parse(t[y],y,Zt);if(!x)return null;m.push(x)}return new ai(h,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,o;for(const h of this.args){if(r=h.evaluate(t),o=null,r instanceof ti)return r;if(typeof r=="string"){const m=t.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:rs(r[0],r[1],r[2],r[3]),!o))return new ti(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ar(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(t);const h=Mr.parse(r);if(h)return h}throw new ar(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const o of this.args){r=o.evaluate(t);const h=hn.parse(r);if(h)return h}throw new ar(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const o of this.args){r=o.evaluate(t);const h=Rr.parse(r);if(h)return h}throw new ar(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(t);const h=gr.parse(r);if(h)return h}throw new ar(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(t),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new ar(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Ar.fromString(Hi(this.args[0].evaluate(t)));case"resolvedImage":return Xr.fromString(Hi(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Hi(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const dl=["Unknown","Point","LineString","Polygon"];class Vn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=ti.parse(t),this._parseColorCache.set(t,r)),r}}class pl{constructor(t,r,o=[],h,m=new ri,y=[]){this.registry=t,this.path=o,this.key=o.map((x=>`[${x}]`)).join(""),this.scope=m,this.errors=y,this.expectedType=h,this._isConstant=r}parse(t,r,o,h,m={}){return r?this.concat(r,o,h)._parse(t,m):this._parse(t,m)}_parse(t,r){function o(h,m,y){return y==="assert"?new Xt(m,[h]):y==="coerce"?new ai(m,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let y=m.parse(t,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,v=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||v.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(v.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(v.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(v.kind)||x.kind==="colorArray"&&["value","string","array"].includes(v.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(v.kind))y=o(y,x,r.typeAnnotation||"coerce");else if(this.checkSubtype(x,v))return null}else y=o(y,x,r.typeAnnotation||"assert")}if(!(y instanceof _a)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const x=new Vn;try{y=new _a(y.type,y.evaluate(x))}catch(v){return this.error(v.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,o){const h=typeof t=="number"?this.path.concat(t):this.path,m=o?this.scope.concat(o):this.scope;return new pl(this.registry,this._isConstant,h,r||null,m,this.errors)}error(t,...r){const o=`${this.key}${r.map((h=>`[${h}]`)).join("")}`;this.errors.push(new ot(o,t))}checkSubtype(t,r){const o=ol(t,r);return o&&this.error(o),o}}class vs{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let m=1;m<t.length-1;m+=2){const y=t[m];if(typeof y!="string")return r.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=r.parse(t[m+1],m+1);if(!x)return null;o.push([y,x])}const h=r.parse(t[t.length-1],t.length-1,r.expectedType,o);return h?new vs(o,h):null}outputDefined(){return this.result.outputDefined()}}class ko{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=t[1];return r.scope.has(o)?new ko(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class bs{constructor(t,r,o){this.type=t,this.index=r,this.input=o}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Ze),h=r.parse(t[2],2,xn(r.expectedType||Zt));return o&&h?new bs(h.type.itemType,o,h):null}evaluate(t){const r=this.index.evaluate(t),o=this.input.evaluate(t);if(r<0)throw new ar(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new ar(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new ar(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Co{constructor(t,r){this.type=Bt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Zt),h=r.parse(t[2],2,Zt);return o&&h?$s(o.type,[Bt,dt,Ze,di,Zt])?new Co(o,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ni(o.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!_s(r,["boolean","string","number","null"]))throw new ar(`Expected first argument to be of type boolean, string, number or null, but found ${ni(sr(r))} instead.`);if(!_s(o,["string","array"]))throw new ar(`Expected second argument to be of type array or string, but found ${ni(sr(o))} instead.`);return o.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Xl{constructor(t,r,o){this.type=Ze,this.needle=t,this.haystack=r,this.fromIndex=o}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Zt),h=r.parse(t[2],2,Zt);if(!o||!h)return null;if(!$s(o.type,[Bt,dt,Ze,di,Zt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ni(o.type)} instead`);if(t.length===4){const m=r.parse(t[3],3,Ze);return m?new Xl(o,h,m):null}return new Xl(o,h)}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!_s(r,["boolean","string","number","null"]))throw new ar(`Expected first argument to be of type boolean, string, number or null, but found ${ni(sr(r))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),_s(o,["string"])){const m=o.indexOf(r,h);return m===-1?-1:[...o.slice(0,m)].length}if(_s(o,["array"]))return o.indexOf(r,h);throw new ar(`Expected second argument to be of type array or string, but found ${ni(sr(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Fc{constructor(t,r,o,h,m,y){this.inputType=t,this.type=r,this.input=o,this.cases=h,this.outputs=m,this.otherwise=y}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let o,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const m={},y=[];for(let M=2;M<t.length-1;M+=2){let k=t[M];const P=t[M+1];Array.isArray(k)||(k=[k]);const B=r.concat(M);if(k.length===0)return B.error("Expected at least one branch label.");for(const V of k){if(typeof V!="number"&&typeof V!="string")return B.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,sr(V)))return null}else o=sr(V);if(m[String(V)]!==void 0)return B.error("Branch labels must be unique.");m[String(V)]=y.length}const U=r.parse(P,M,h);if(!U)return null;h=h||U.type,y.push(U)}const x=r.parse(t[1],1,Zt);if(!x)return null;const v=r.parse(t[t.length-1],t.length-1,h);return v?x.type.kind!=="value"&&r.concat(1).checkSubtype(o,x.type)?null:new Fc(o,h,x,m,y,v):null}evaluate(t){const r=this.input.evaluate(t);return(sr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Uc{constructor(t,r,o){this.type=t,this.branches=r,this.otherwise=o}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const h=[];for(let y=1;y<t.length-1;y+=2){const x=r.parse(t[y],y,Bt);if(!x)return null;const v=r.parse(t[y+1],y+1,o);if(!v)return null;h.push([x,v]),o=o||v.type}const m=r.parse(t[t.length-1],t.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Uc(o,h,m)}evaluate(t){for(const[r,o]of this.branches)if(r.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,o]of this.branches)t(r),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class ja{constructor(t,r,o,h){this.type=t,this.input=r,this.beginIndex=o,this.endIndex=h}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Zt),h=r.parse(t[2],2,Ze);if(!o||!h)return null;if(!$s(o.type,[xn(Zt),dt,Zt]))return r.error(`Expected first argument to be of type array or string, but found ${ni(o.type)} instead`);if(t.length===4){const m=r.parse(t[3],3,Ze);return m?new ja(o.type,o,h,m):null}return new ja(o.type,o,h)}evaluate(t){const r=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),_s(r,["string"]))return[...r].slice(o,h).join("");if(_s(r,["array"]))return r.slice(o,h);throw new ar(`Expected first argument to be of type array or string, but found ${ni(sr(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Lr(n,t){const r=n.length-1;let o,h,m=0,y=r,x=0;for(;m<=y;)if(x=Math.floor((m+y)/2),o=n[x],h=n[x+1],o<=t){if(x===r||t<h)return x;m=x+1}else{if(!(o>t))throw new ar("Input is not a number.");y=x-1}return 0}class Hs{constructor(t,r,o){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[h,m]of o)this.labels.push(h),this.outputs.push(m)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(t[1],1,Ze);if(!o)return null;const h=[];let m=null;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let y=1;y<t.length;y+=2){const x=y===1?-1/0:t[y],v=t[y+1],M=y,k=y+1;if(typeof x!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(h.length&&h[h.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const P=r.parse(v,k,m);if(!P)return null;m=m||P.type,h.push([x,P])}return new Hs(m,o,h)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=r[0])return o[0].evaluate(t);const m=r.length;return h>=r[m-1]?o[m-1].evaluate(t):o[Lr(r,h)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Oh(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fl,Wr,Bh=(function(){if(Wr)return fl;function n(t,r,o,h){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=h}return Wr=1,fl=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,h=0;h<8;h++){var m=this.sampleCurveX(o)-t;if(Math.abs(m)<r)return o;var y=this.sampleCurveDerivativeX(o);if(Math.abs(y)<1e-6)break;o-=m/y}var x=0,v=1;for(o=t,h=0;h<20&&(m=this.sampleCurveX(o),!(Math.abs(m-t)<r));h++)t>m?x=o:v=o,o=.5*(v-x)+x;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},fl})(),$c=Oh(Bh);class zn{constructor(t,r,o,h,m){this.type=t,this.operator=r,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[y,x]of m)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(t,r,o,h){let m=0;if(t.name==="exponential")m=Lu(r,t.base,o,h);else if(t.name==="linear")m=Lu(r,1,o,h);else if(t.name==="cubic-bezier"){const y=t.controlPoints;m=new $c(y[0],y[1],y[2],y[3]).solve(Lu(r,1,o,h))}return m}static parse(t,r){let[o,h,m,...y]=t;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const M=h[1];if(typeof M!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:M}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const M=h.slice(1);if(M.length!==4||M.some((k=>typeof k!="number"||k<0||k>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,Ze),!m)return null;const x=[];let v=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||r.expectedType==ys?r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType):v=xt;for(let M=0;M<y.length;M+=2){const k=y[M],P=y[M+1],B=M+3,U=M+4;if(typeof k!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(x.length&&x[x.length-1][0]>=k)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const V=r.parse(P,U,v);if(!V)return null;v=v||V.type,x.push([k,V])}return Vs(v,Ze)||Vs(v,Si)||Vs(v,xt)||Vs(v,Ra)||Vs(v,ma)||Vs(v,ys)||Vs(v,ts)||Vs(v,xn(Ze))?new zn(v,o,h,m,x):r.error(`Type ${ni(v)} is not interpolatable.`)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=r[0])return o[0].evaluate(t);const m=r.length;if(h>=r[m-1])return o[m-1].evaluate(t);const y=Lr(r,h),x=zn.interpolationFactor(this.interpolation,h,r[y],r[y+1]),v=o[y].evaluate(t),M=o[y+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ui(v,M,x);case"color":return ti.interpolate(v,M,x);case"padding":return Mr.interpolate(v,M,x);case"colorArray":return Rr.interpolate(v,M,x);case"numberArray":return hn.interpolate(v,M,x);case"variableAnchorOffsetCollection":return gr.interpolate(v,M,x);case"array":return La(v,M,x);case"projectionDefinition":return an.interpolate(v,M,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return ti.interpolate(v,M,x,"hcl");case"colorArray":return Rr.interpolate(v,M,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ti.interpolate(v,M,x,"lab");case"colorArray":return Rr.interpolate(v,M,x,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Lu(n,t,r,o){const h=o-r,m=n-r;return h===0?0:t===1?m/h:(Math.pow(t,m)-1)/(Math.pow(t,h)-1)}const In={color:ti.interpolate,number:ui,padding:Mr.interpolate,numberArray:hn.interpolate,colorArray:Rr.interpolate,variableAnchorOffsetCollection:gr.interpolate,array:La};class Eo{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o=null;const h=r.expectedType;h&&h.kind!=="value"&&(o=h);const m=[];for(const x of t.slice(1)){const v=r.parse(x,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!v)return null;o=o||v.type,m.push(v)}if(!o)throw new Error("No output type");const y=h&&m.some((x=>ol(h,x.type)));return new Eo(y?Zt:o,m)}evaluate(t){let r,o=null,h=0;for(const m of this.args)if(h++,o=m.evaluate(t),o&&o instanceof Xr&&!o.available&&(r||(r=o.name),o=null,h===this.args.length&&(o=r)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function ml(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Nh(n,t,r,o){return o.compare(t,r)===0}function Ao(n,t,r){const o=n!=="=="&&n!=="!=";return class Cm{constructor(m,y,x){this.type=Bt,this.lhs=m,this.rhs=y,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const x=m[0];let v=y.parse(m[1],1,Zt);if(!v)return null;if(!ml(x,v.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${ni(v.type)}'.`);let M=y.parse(m[2],2,Zt);if(!M)return null;if(!ml(x,M.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${ni(M.type)}'.`);if(v.type.kind!==M.type.kind&&v.type.kind!=="value"&&M.type.kind!=="value")return y.error(`Cannot compare types '${ni(v.type)}' and '${ni(M.type)}'.`);o&&(v.type.kind==="value"&&M.type.kind!=="value"?v=new Xt(M.type,[v]):v.type.kind!=="value"&&M.type.kind==="value"&&(M=new Xt(v.type,[M])));let k=null;if(m.length===4){if(v.type.kind!=="string"&&M.type.kind!=="string"&&v.type.kind!=="value"&&M.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(m[3],3,gs),!k)return null}return new Cm(v,M,k)}evaluate(m){const y=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const v=sr(y),M=sr(x);if(v.kind!==M.kind||v.kind!=="string"&&v.kind!=="number")throw new ar(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${v.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const v=sr(y),M=sr(x);if(v.kind!=="string"||M.kind!=="string")return t(m,y,x)}return this.collator?r(m,y,x,this.collator.evaluate(m)):t(m,y,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const Vc=Ao("==",(function(n,t,r){return t===r}),Nh),Wl=Ao("!=",(function(n,t,r){return t!==r}),(function(n,t,r,o){return!Nh(0,t,r,o)})),Oa=Ao("<",(function(n,t,r){return t<r}),(function(n,t,r,o){return o.compare(t,r)<0})),Fh=Ao(">",(function(n,t,r){return t>r}),(function(n,t,r,o){return o.compare(t,r)>0})),Gc=Ao("<=",(function(n,t,r){return t<=r}),(function(n,t,r,o){return o.compare(t,r)<=0})),Bd=Ao(">=",(function(n,t,r){return t>=r}),(function(n,t,r,o){return o.compare(t,r)>=0}));class gl{constructor(t,r,o){this.type=gs,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const h=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Bt);if(!h)return null;const m=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Bt);if(!m)return null;let y=null;return o.locale&&(y=r.parse(o.locale,1,dt),!y)?null:new gl(h,m,y)}evaluate(t){return new ya(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class ju{constructor(t,r,o,h,m){this.type=dt,this.number=t,this.locale=r,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const o=r.parse(t[1],1,Ze);if(!o)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=r.parse(h.locale,1,dt),!m))return null;let y=null;if(h.currency&&(y=r.parse(h.currency,1,dt),!y))return null;let x=null;if(h["min-fraction-digits"]&&(x=r.parse(h["min-fraction-digits"],1,Ze),!x))return null;let v=null;return h["max-fraction-digits"]&&(v=r.parse(h["max-fraction-digits"],1,Ze),!v)?null:new ju(o,m,y,x,v)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Zc{constructor(t){this.type=Da,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const h=[];let m=!1;for(let y=1;y<=t.length-1;++y){const x=t[y];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let v=null;if(x["font-scale"]&&(v=r.parse(x["font-scale"],1,Ze),!v))return null;let M=null;if(x["text-font"]&&(M=r.parse(x["text-font"],1,xn(dt)),!M))return null;let k=null;if(x["text-color"]&&(k=r.parse(x["text-color"],1,xt),!k))return null;let P=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!Nc.includes(x["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(P=r.parse(x["vertical-align"],1,dt),!P)return null}const B=h[h.length-1];B.scale=v,B.font=M,B.textColor=k,B.verticalAlign=P}else{const v=r.parse(t[y],1,Zt);if(!v)return null;const M=v.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:v,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Zc(h)}evaluate(t){return new Ar(this.sections.map((r=>{const o=r.content.evaluate(t);return sr(o)===Er?new Mo("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new Mo(Hi(o),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Ou{constructor(t){this.type=Er,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const o=r.parse(t[1],1,dt);return o?new Ou(o):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),o=Xr.fromString(r);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(r)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Bu{constructor(t){this.type=Ze,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=r.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ni(o.type)} instead.`):new Bu(o):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new ar(`Expected value to be of type string or array, but found ${ni(sr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Pn=8192;function Yl(n,t){const r=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(r*h*Pn),Math.round(o*h*Pn)]}function qc(n,t){const r=Math.pow(2,t.z);return[(h=(n[0]/Pn+t.x)/r,360*h-180),(o=(n[1]/Pn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,h}function zo(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function yl(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Nu(n,t,r){const o=n[0]-t[0],h=n[1]-t[1],m=n[0]-r[0],y=n[1]-r[1];return o*y-m*h==0&&o*m<=0&&h*y<=0}function Kl(n,t,r,o){return(h=[o[0]-r[0],o[1]-r[1]])[0]*(m=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*m[0]!=0&&!(!Hc(n,t,r,o)||!Hc(r,o,n,t));var h,m}function Uh(n,t,r){for(const o of r)for(let h=0;h<o.length-1;++h)if(Kl(n,t,o[h],o[h+1]))return!0;return!1}function Ba(n,t,r=!1){let o=!1;for(const x of t)for(let v=0;v<x.length-1;v++){if(Nu(n,x[v],x[v+1]))return r;(m=x[v])[1]>(h=n)[1]!=(y=x[v+1])[1]>h[1]&&h[0]<(y[0]-m[0])*(h[1]-m[1])/(y[1]-m[1])+m[0]&&(o=!o)}var h,m,y;return o}function Nd(n,t){for(const r of t)if(Ba(n,r))return!0;return!1}function $h(n,t){for(const r of n)if(!Ba(r,t))return!1;for(let r=0;r<n.length-1;++r)if(Uh(n[r],n[r+1],t))return!1;return!0}function Vh(n,t){for(const r of t)if($h(n,r))return!0;return!1}function Hc(n,t,r,o){const h=o[0]-r[0],m=o[1]-r[1],y=(n[0]-r[0])*m-h*(n[1]-r[1]),x=(t[0]-r[0])*m-h*(t[1]-r[1]);return y>0&&x<0||y<0&&x>0}function Ql(n,t,r){const o=[];for(let h=0;h<n.length;h++){const m=[];for(let y=0;y<n[h].length;y++){const x=Yl(n[h][y],r);zo(t,x),m.push(x)}o.push(m)}return o}function _l(n,t,r){const o=[];for(let h=0;h<n.length;h++){const m=Ql(n[h],t,r);o.push(m)}return o}function xl(n,t,r,o){if(n[0]<r[0]||n[0]>r[2]){const h=.5*o;let m=n[0]-r[0]>h?-o:r[0]-n[0]>h?o:0;m===0&&(m=n[0]-r[2]>h?-o:r[2]-n[0]>h?o:0),n[0]+=m}zo(t,n)}function Gh(n,t,r,o){const h=Math.pow(2,o.z)*Pn,m=[o.x*Pn,o.y*Pn],y=[];for(const x of n)for(const v of x){const M=[v.x+m[0],v.y+m[1]];xl(M,t,r,h),y.push(M)}return y}function Jl(n,t,r,o){const h=Math.pow(2,o.z)*Pn,m=[o.x*Pn,o.y*Pn],y=[];for(const v of n){const M=[];for(const k of v){const P=[k.x+m[0],k.y+m[1]];zo(t,P),M.push(P)}y.push(M)}if(t[2]-t[0]<=h/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const v of y)for(const M of v)xl(M,t,r,h)}var x;return y}class Na{constructor(t,r){this.type=Bt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(qs(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const h=[];for(const m of o.features){const{type:y,coordinates:x}=m.geometry;y==="Polygon"&&h.push(x),y==="MultiPolygon"&&h.push(...x)}if(h.length)return new Na(o,{type:"MultiPolygon",coordinates:h})}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Na(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Na(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,o){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(o.type==="Polygon"){const x=Ql(o.coordinates,m,y),v=Gh(r.geometry(),h,m,y);if(!yl(h,m))return!1;for(const M of v)if(!Ba(M,x))return!1}if(o.type==="MultiPolygon"){const x=_l(o.coordinates,m,y),v=Gh(r.geometry(),h,m,y);if(!yl(h,m))return!1;for(const M of v)if(!Nd(M,x))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,o){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(o.type==="Polygon"){const x=Ql(o.coordinates,m,y),v=Jl(r.geometry(),h,m,y);if(!yl(h,m))return!1;for(const M of v)if(!$h(M,x))return!1}if(o.type==="MultiPolygon"){const x=_l(o.coordinates,m,y),v=Jl(r.geometry(),h,m,y);if(!yl(h,m))return!1;for(const M of v)if(!Vh(M,x))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Fu=class{constructor(n=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,o=t[n];for(;n>0;){const h=n-1>>1,m=t[h];if(r(o,m)>=0)break;t[n]=m,n=h}t[n]=o}_down(n){const{data:t,compare:r}=this,o=this.length>>1,h=t[n];for(;n<o;){let m=1+(n<<1);const y=m+1;if(y<this.length&&r(t[y],t[m])<0&&(m=y),r(t[m],h)>=0)break;t[n]=t[m],n=m}t[n]=h}};function Xc(n,t,r=0,o=n.length-1,h=Zh){for(;o>r;){if(o-r>600){const v=o-r+1,M=t-r+1,k=Math.log(v),P=.5*Math.exp(2*k/3),B=.5*Math.sqrt(k*P*(v-P)/v)*(M-v/2<0?-1:1);Xc(n,t,Math.max(r,Math.floor(t-M*P/v+B)),Math.min(o,Math.floor(t+(v-M)*P/v+B)),h)}const m=n[t];let y=r,x=o;for(Io(n,r,t),h(n[o],m)>0&&Io(n,r,o);y<x;){for(Io(n,y,x),y++,x--;h(n[y],m)<0;)y++;for(;h(n[x],m)>0;)x--}h(n[r],m)===0?Io(n,r,x):(x++,Io(n,x,o)),x<=t&&(r=x+1),t<=x&&(o=x-1)}}function Io(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}function Zh(n,t){return n<t?-1:n>t?1:0}function Po(n,t){if(n.length<=1)return[n];const r=[];let o,h;for(const m of n){const y=Fd(m);y!==0&&(m.area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(o&&r.push(o),o=[m]):o.push(m))}if(o&&r.push(o),t>1)for(let m=0;m<r.length;m++)r[m].length<=t||(Xc(r[m],t,1,r[m].length-1,Uu),r[m]=r[m].slice(0,t));return r}function Uu(n,t){return t.area-n.area}function Fd(n){let t=0;for(let r,o,h=0,m=n.length,y=m-1;h<m;y=h++)r=n[h],o=n[y],t+=(o.x-r.x)*(r.y+o.y);return t}const qh=1/298.257223563,$u=qh*(2-qh),Vu=Math.PI/180;class Gu{constructor(t){const r=6378.137*Vu*1e3,o=Math.cos(t*Vu),h=1/(1-$u*(1-o*o)),m=Math.sqrt(h);this.kx=r*m*o,this.ky=r*m*h*(1-$u)}distance(t,r){const o=this.wrap(t[0]-r[0])*this.kx,h=(t[1]-r[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(t,r){let o,h,m,y,x=1/0;for(let v=0;v<t.length-1;v++){let M=t[v][0],k=t[v][1],P=this.wrap(t[v+1][0]-M)*this.kx,B=(t[v+1][1]-k)*this.ky,U=0;P===0&&B===0||(U=(this.wrap(r[0]-M)*this.kx*P+(r[1]-k)*this.ky*B)/(P*P+B*B),U>1?(M=t[v+1][0],k=t[v+1][1]):U>0&&(M+=P/this.kx*U,k+=B/this.ky*U)),P=this.wrap(r[0]-M)*this.kx,B=(r[1]-k)*this.ky;const V=P*P+B*B;V<x&&(x=V,o=M,h=k,m=v,y=U)}return{point:[o,h],index:m,t:Math.max(0,Math.min(1,y))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Gn(n,t){return t[0]-n[0]}function Xs(n){return n[1]-n[0]+1}function Fa(n,t){return n[1]>=n[0]&&n[1]<t}function Wc(n,t){if(n[0]>n[1])return[null,null];const r=Xs(n);if(t){if(r===2)return[n,null];const h=Math.floor(r/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(r===1)return[n,null];const o=Math.floor(r/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function Yc(n,t){if(!Fa(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)zo(r,n[o]);return r}function Kc(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const o of r)zo(t,o);return t}function Qc(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Li(n,t,r){if(!Qc(n)||!Qc(t))return NaN;let o=0,h=0;return n[2]<t[0]&&(o=t[0]-n[2]),n[0]>t[2]&&(o=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),r.distance([0,0],[o,h])}function xa(n,t,r){const o=r.pointOnLine(t,n);return r.distance(n,o.point)}function ec(n,t,r,o,h){const m=Math.min(xa(n,[r,o],h),xa(t,[r,o],h)),y=Math.min(xa(r,[n,t],h),xa(o,[n,t],h));return Math.min(m,y)}function tc(n,t,r,o,h){if(!Fa(t,n.length)||!Fa(o,r.length))return 1/0;let m=1/0;for(let y=t[0];y<t[1];++y){const x=n[y],v=n[y+1];for(let M=o[0];M<o[1];++M){const k=r[M],P=r[M+1];if(Kl(x,v,k,P))return 0;m=Math.min(m,ec(x,v,k,P,h))}}return m}function Zu(n,t,r,o,h){if(!Fa(t,n.length)||!Fa(o,r.length))return NaN;let m=1/0;for(let y=t[0];y<=t[1];++y)for(let x=o[0];x<=o[1];++x)if(m=Math.min(m,h.distance(n[y],r[x])),m===0)return m;return m}function Hh(n,t,r){if(Ba(n,t,!0))return 0;let o=1/0;for(const h of t){const m=h[0],y=h[h.length-1];if(m!==y&&(o=Math.min(o,xa(n,[y,m],r)),o===0))return o;const x=r.pointOnLine(h,n);if(o=Math.min(o,r.distance(n,x.point)),o===0)return o}return o}function Do(n,t,r,o){if(!Fa(t,n.length))return NaN;for(let m=t[0];m<=t[1];++m)if(Ba(n[m],r,!0))return 0;let h=1/0;for(let m=t[0];m<t[1];++m){const y=n[m],x=n[m+1];for(const v of r)for(let M=0,k=v.length,P=k-1;M<k;P=M++){const B=v[P],U=v[M];if(Kl(y,x,B,U))return 0;h=Math.min(h,ec(y,x,B,U,o))}}return h}function Ro(n,t){for(const r of n)for(const o of r)if(Ba(o,t,!0))return!0;return!1}function qu(n,t,r,o=1/0){const h=Kc(n),m=Kc(t);if(o!==1/0&&Li(h,m,r)>=o)return o;if(yl(h,m)){if(Ro(n,t))return 0}else if(Ro(t,n))return 0;let y=1/0;for(const x of n)for(let v=0,M=x.length,k=M-1;v<M;k=v++){const P=x[k],B=x[v];for(const U of t)for(let V=0,q=U.length,Y=q-1;V<q;Y=V++){const ae=U[Y],Ce=U[V];if(Kl(P,B,ae,Ce))return 0;y=Math.min(y,ec(P,B,ae,Ce,r))}}return y}function Hu(n,t,r,o,h,m){if(!m)return;const y=Li(Yc(o,m),h,r);y<t&&n.push([y,m,[0,0]])}function ns(n,t,r,o,h,m,y){if(!m||!y)return;const x=Li(Yc(o,m),Yc(h,y),r);x<t&&n.push([x,m,y])}function ic(n,t,r,o,h=1/0){let m=Math.min(o.distance(n[0],r[0][0]),h);if(m===0)return m;const y=new Fu([[0,[0,n.length-1],[0,0]]],Gn),x=Kc(r);for(;y.length>0;){const v=y.pop();if(v[0]>=m)continue;const M=v[1],k=t?50:100;if(Xs(M)<=k){if(!Fa(M,n.length))return NaN;if(t){const P=Do(n,M,r,o);if(isNaN(P)||P===0)return P;m=Math.min(m,P)}else for(let P=M[0];P<=M[1];++P){const B=Hh(n[P],r,o);if(m=Math.min(m,B),m===0)return 0}}else{const P=Wc(M,t);Hu(y,m,o,n,x,P[0]),Hu(y,m,o,n,x,P[1])}}return m}function rc(n,t,r,o,h,m=1/0){let y=Math.min(m,h.distance(n[0],r[0]));if(y===0)return y;const x=new Fu([[0,[0,n.length-1],[0,r.length-1]]],Gn);for(;x.length>0;){const v=x.pop();if(v[0]>=y)continue;const M=v[1],k=v[2],P=t?50:100,B=o?50:100;if(Xs(M)<=P&&Xs(k)<=B){if(!Fa(M,n.length)&&Fa(k,r.length))return NaN;let U;if(t&&o)U=tc(n,M,r,k,h),y=Math.min(y,U);else if(t&&!o){const V=n.slice(M[0],M[1]+1);for(let q=k[0];q<=k[1];++q)if(U=xa(r[q],V,h),y=Math.min(y,U),y===0)return y}else if(!t&&o){const V=r.slice(k[0],k[1]+1);for(let q=M[0];q<=M[1];++q)if(U=xa(n[q],V,h),y=Math.min(y,U),y===0)return y}else U=Zu(n,M,r,k,h),y=Math.min(y,U)}else{const U=Wc(M,t),V=Wc(k,o);ns(x,y,h,n,r,U[0],V[0]),ns(x,y,h,n,r,U[0],V[1]),ns(x,y,h,n,r,U[1],V[0]),ns(x,y,h,n,r,U[1],V[1])}}return y}function Jc(n){return n.type==="MultiPolygon"?n.coordinates.map((t=>({type:"Polygon",coordinates:t}))):n.type==="MultiLineString"?n.coordinates.map((t=>({type:"LineString",coordinates:t}))):n.type==="MultiPoint"?n.coordinates.map((t=>({type:"Point",coordinates:t}))):[n]}class Lo{constructor(t,r){this.type=Ze,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(qs(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Lo(o,o.features.map((h=>Jc(h.geometry))).flat());if(o.type==="Feature")return new Lo(o,Jc(o.geometry));if("type"in o&&"coordinates"in o)return new Lo(o,Jc(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,o){const h=r.geometry(),m=h.flat().map((v=>qc([v.x,v.y],r.canonical)));if(h.length===0)return NaN;const y=new Gu(m[0][1]);let x=1/0;for(const v of o){switch(v.type){case"Point":x=Math.min(x,rc(m,!1,[v.coordinates],!1,y,x));break;case"LineString":x=Math.min(x,rc(m,!1,v.coordinates,!0,y,x));break;case"Polygon":x=Math.min(x,ic(m,!1,v.coordinates,y,x))}if(x===0)return x}return x})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,o){const h=r.geometry(),m=h.flat().map((v=>qc([v.x,v.y],r.canonical)));if(h.length===0)return NaN;const y=new Gu(m[0][1]);let x=1/0;for(const v of o){switch(v.type){case"Point":x=Math.min(x,rc(m,!0,[v.coordinates],!1,y,x));break;case"LineString":x=Math.min(x,rc(m,!0,v.coordinates,!0,y,x));break;case"Polygon":x=Math.min(x,ic(m,!0,v.coordinates,y,x))}if(x===0)return x}return x})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(r,o){const h=r.geometry();if(h.length===0||h[0].length===0)return NaN;const m=Po(h,0).map((v=>v.map((M=>M.map((k=>qc([k.x,k.y],r.canonical))))))),y=new Gu(m[0][0][0][1]);let x=1/0;for(const v of o)for(const M of m){switch(v.type){case"Point":x=Math.min(x,ic([v.coordinates],!1,M,y,x));break;case"LineString":x=Math.min(x,ic(v.coordinates,!0,M,y,x));break;case"Polygon":x=Math.min(x,qu(M,v.coordinates,y,x))}if(x===0)return x}return x})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class nc{constructor(t){this.type=Zt,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?r.error("Global state property must be defined."):typeof o!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new nc(o)}evaluate(t){var r;const o=(r=t.globals)===null||r===void 0?void 0:r.globalState;return o&&Object.keys(o).length!==0?hl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const vl={"==":Vc,"!=":Wl,">":Fh,"<":Oa,">=":Bd,"<=":Gc,array:Xt,at:bs,boolean:Xt,case:Uc,coalesce:Eo,collator:gl,format:Zc,image:Ou,in:Co,"index-of":Xl,interpolate:zn,"interpolate-hcl":zn,"interpolate-lab":zn,length:Bu,let:vs,literal:_a,match:Fc,number:Xt,"number-format":ju,object:Xt,slice:ja,step:Hs,string:Xt,"to-boolean":ai,"to-color":ai,"to-number":ai,"to-string":ai,var:ko,within:Na,distance:Lo,"global-state":nc};class Jn{constructor(t,r,o,h){this.name=t,this.type=r,this._evaluate=o,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const o=t[0],h=Jn.definitions[o];if(!h)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=y.filter((([M])=>!Array.isArray(M)||M.length===t.length-1));let v=null;for(const[M,k]of x){v=new pl(r.registry,Dn,r.path,null,r.scope);const P=[];let B=!1;for(let U=1;U<t.length;U++){const V=t[U],q=Array.isArray(M)?M[U-1]:M.type,Y=v.parse(V,1+P.length,q);if(!Y){B=!0;break}P.push(Y)}if(!B)if(Array.isArray(M)&&M.length!==P.length)v.error(`Expected ${M.length} arguments, but found ${P.length} instead.`);else{for(let U=0;U<P.length;U++){const V=Array.isArray(M)?M[U]:M.type,q=P[U];v.concat(U+1).checkSubtype(V,q.type)}if(v.errors.length===0)return new Jn(o,m,k,P)}}if(x.length===1)r.errors.push(...v.errors);else{const M=(x.length?x:y).map((([P])=>{return B=P,Array.isArray(B)?`(${B.map(ni).join(", ")})`:`(${ni(B.type)}...)`;var B})).join(" | "),k=[];for(let P=1;P<t.length;P++){const B=r.parse(t[P],1+k.length);if(!B)return null;k.push(ni(B.type))}r.error(`Expected arguments of type ${M}, but found (${k.join(", ")}) instead.`)}return null}static register(t,r){Jn.definitions=r;for(const o in r)t[o]=Jn}}function Xu(n,[t,r,o,h]){t=t.evaluate(n),r=r.evaluate(n),o=o.evaluate(n);const m=h?h.evaluate(n):1,y=rs(t,r,o,m);if(y)throw new ar(y);return new ti(t/255,r/255,o/255,m,!1)}function eu(n,t){return n in t}function ea(n,t){const r=t[n];return r===void 0?null:r}function as(n){return{type:n}}function Dn(n){if(n instanceof ko)return Dn(n.boundExpression);if(n instanceof Jn&&n.name==="error"||n instanceof gl||n instanceof Na||n instanceof Lo||n instanceof nc)return!1;const t=n instanceof ai||n instanceof Xt;let r=!0;return n.eachChild((o=>{r=t?r&&Dn(o):r&&o instanceof _a})),!!r&&ws(n)&&Oo(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ws(n){if(n instanceof Jn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Na||n instanceof Lo)return!1;let t=!0;return n.eachChild((r=>{t&&!ws(r)&&(t=!1)})),t}function jo(n){if(n instanceof Jn&&n.name==="feature-state")return!1;let t=!0;return n.eachChild((r=>{t&&!jo(r)&&(t=!1)})),t}function Oo(n,t){if(n instanceof Jn&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild((o=>{r&&!Oo(o,t)&&(r=!1)})),r}function ac(n){return{result:"success",value:n}}function Ws(n){return{result:"error",value:n}}function va(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Wu(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function bl(n){return!!n.expression&&n.expression.interpolated}function li(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function wl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&sr(n)===Un}function ta(n){return n}function tu(n,t){const r=n.stops&&typeof n.stops[0][0]=="object",o=r||!(r||n.property!==void 0),h=n.type||(bl(t)?"exponential":"interval"),m=(function(k){switch(k.type){case"color":return ti.parse;case"padding":return Mr.parse;case"numberArray":return hn.parse;case"colorArray":return Rr.parse;default:return null}})(t);if(m&&((n=ht({},n)).stops&&(n.stops=n.stops.map((k=>[k[0],m(k[1])]))),n.default=m(n.default?n.default:t.default)),n.colorSpace&&(y=n.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var y;const x=(function(k){switch(k){case"exponential":return Ys;case"interval":return iu;case"categorical":return Yu;case"identity":return Sl;default:throw new Error(`Unknown function type "${k}"`)}})(h);let v,M;if(h==="categorical"){v=Object.create(null);for(const k of n.stops)v[k[0]]=k[1];M=typeof n.stops[0][0]}if(r){const k={},P=[];for(let V=0;V<n.stops.length;V++){const q=n.stops[V],Y=q[0].zoom;k[Y]===void 0&&(k[Y]={zoom:Y,type:n.type,property:n.property,default:n.default,stops:[]},P.push(Y)),k[Y].stops.push([q[0].value,q[1]])}const B=[];for(const V of P)B.push([k[V].zoom,tu(k[V],t)]);const U={name:"linear"};return{kind:"composite",interpolationType:U,interpolationFactor:zn.interpolationFactor.bind(void 0,U),zoomStops:B.map((V=>V[0])),evaluate:({zoom:V},q)=>Ys({stops:B,base:n.base},t,V).evaluate(V,q)}}if(o){const k=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:zn.interpolationFactor.bind(void 0,k),zoomStops:n.stops.map((P=>P[0])),evaluate:({zoom:P})=>x(n,t,P,v,M)}}return{kind:"source",evaluate(k,P){const B=P&&P.properties?P.properties[n.property]:void 0;return B===void 0?ia(n.default,t.default):x(n,t,B,v,M)}}}function ia(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function Yu(n,t,r,o,h){return ia(typeof r===h?o[r]:void 0,n.default,t.default)}function iu(n,t,r){if(li(r)!=="number")return ia(n.default,t.default);const o=n.stops.length;if(o===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[o-1][0])return n.stops[o-1][1];const h=Lr(n.stops.map((m=>m[0])),r);return n.stops[h][1]}function Ys(n,t,r){const o=n.base!==void 0?n.base:1;if(li(r)!=="number")return ia(n.default,t.default);const h=n.stops.length;if(h===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];const m=Lr(n.stops.map((k=>k[0])),r),y=(function(k,P,B,U){const V=U-B,q=k-B;return V===0?0:P===1?q/V:(Math.pow(P,q)-1)/(Math.pow(P,V)-1)})(r,o,n.stops[m][0],n.stops[m+1][0]),x=n.stops[m][1],v=n.stops[m+1][1],M=In[t.type]||ta;return typeof x.evaluate=="function"?{evaluate(...k){const P=x.evaluate.apply(void 0,k),B=v.evaluate.apply(void 0,k);if(P!==void 0&&B!==void 0)return M(P,B,y,n.colorSpace)}}:M(x,v,y,n.colorSpace)}function Sl(n,t,r){switch(t.type){case"color":r=ti.parse(r);break;case"formatted":r=Ar.fromString(r.toString());break;case"resolvedImage":r=Xr.fromString(r.toString());break;case"padding":r=Mr.parse(r);break;case"colorArray":r=Rr.parse(r);break;case"numberArray":r=hn.parse(r);break;default:li(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ia(r,n.default,t.default)}Jn.register(vl,{error:[{kind:"error"},[dt],(n,[t])=>{throw new ar(t.evaluate(n))}],typeof:[dt,[Zt],(n,[t])=>ni(sr(t.evaluate(n)))],"to-rgba":[xn(Ze,4),[xt],(n,[t])=>{const[r,o,h,m]=t.evaluate(n).rgb;return[255*r,255*o,255*h,m]}],rgb:[xt,[Ze,Ze,Ze],Xu],rgba:[xt,[Ze,Ze,Ze,Ze],Xu],has:{type:Bt,overloads:[[[dt],(n,[t])=>eu(t.evaluate(n),n.properties())],[[dt,Un],(n,[t,r])=>eu(t.evaluate(n),r.evaluate(n))]]},get:{type:Zt,overloads:[[[dt],(n,[t])=>ea(t.evaluate(n),n.properties())],[[dt,Un],(n,[t,r])=>ea(t.evaluate(n),r.evaluate(n))]]},"feature-state":[Zt,[dt],(n,[t])=>ea(t.evaluate(n),n.featureState||{})],properties:[Un,[],n=>n.properties()],"geometry-type":[dt,[],n=>n.geometryType()],id:[Zt,[],n=>n.id()],zoom:[Ze,[],n=>n.globals.zoom],"heatmap-density":[Ze,[],n=>n.globals.heatmapDensity||0],elevation:[Ze,[],n=>n.globals.elevation||0],"line-progress":[Ze,[],n=>n.globals.lineProgress||0],accumulated:[Zt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ze,as(Ze),(n,t)=>{let r=0;for(const o of t)r+=o.evaluate(n);return r}],"*":[Ze,as(Ze),(n,t)=>{let r=1;for(const o of t)r*=o.evaluate(n);return r}],"-":{type:Ze,overloads:[[[Ze,Ze],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Ze],(n,[t])=>-t.evaluate(n)]]},"/":[Ze,[Ze,Ze],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Ze,[Ze,Ze],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Ze,[],()=>Math.LN2],pi:[Ze,[],()=>Math.PI],e:[Ze,[],()=>Math.E],"^":[Ze,[Ze,Ze],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Ze,[Ze],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Ze,[Ze],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Ze,[Ze],(n,[t])=>Math.log(t.evaluate(n))],log2:[Ze,[Ze],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Ze,[Ze],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Ze,[Ze],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Ze,[Ze],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Ze,[Ze],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Ze,[Ze],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Ze,[Ze],(n,[t])=>Math.atan(t.evaluate(n))],min:[Ze,as(Ze),(n,t)=>Math.min(...t.map((r=>r.evaluate(n))))],max:[Ze,as(Ze),(n,t)=>Math.max(...t.map((r=>r.evaluate(n))))],abs:[Ze,[Ze],(n,[t])=>Math.abs(t.evaluate(n))],round:[Ze,[Ze],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ze,[Ze],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Ze,[Ze],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Bt,[dt,Zt],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Bt,[Zt],(n,[t])=>n.id()===t.value],"filter-type-==":[Bt,[dt],(n,[t])=>n.geometryType()===t.value],"filter-<":[Bt,[dt,Zt],(n,[t,r])=>{const o=n.properties()[t.value],h=r.value;return typeof o==typeof h&&o<h}],"filter-id-<":[Bt,[Zt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r<o}],"filter->":[Bt,[dt,Zt],(n,[t,r])=>{const o=n.properties()[t.value],h=r.value;return typeof o==typeof h&&o>h}],"filter-id->":[Bt,[Zt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r>o}],"filter-<=":[Bt,[dt,Zt],(n,[t,r])=>{const o=n.properties()[t.value],h=r.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[Bt,[Zt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r<=o}],"filter->=":[Bt,[dt,Zt],(n,[t,r])=>{const o=n.properties()[t.value],h=r.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[Bt,[Zt],(n,[t])=>{const r=n.id(),o=t.value;return typeof r==typeof o&&r>=o}],"filter-has":[Bt,[Zt],(n,[t])=>t.value in n.properties()],"filter-has-id":[Bt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Bt,[xn(dt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Bt,[xn(Zt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Bt,[dt,xn(Zt)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Bt,[dt,xn(Zt)],(n,[t,r])=>(function(o,h,m,y){for(;m<=y;){const x=m+y>>1;if(h[x]===o)return!0;h[x]>o?y=x-1:m=x+1}return!1})(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Bt,overloads:[[[Bt,Bt],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[as(Bt),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Bt,overloads:[[[Bt,Bt],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[as(Bt),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Bt,[Bt],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Bt,[dt],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[dt,[dt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[dt,[dt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[dt,as(Zt),(n,t)=>t.map((r=>Hi(r.evaluate(n)))).join("")],"resolved-locale":[dt,[gs],(n,[t])=>t.evaluate(n).resolvedLocale()]});class sc{constructor(t,r,o){this.expression=t,this._warningHistory={},this._evaluator=new Vn,this._defaultValue=r?(function(h){if(h.type==="color"&&wl(h.default))return new ti(0,0,0,0);switch(h.type){case"color":return ti.parse(h.default)||null;case"padding":return Mr.parse(h.default)||null;case"numberArray":return hn.parse(h.default)||null;case"colorArray":return Rr.parse(h.default)||null;case"variableAnchorOffsetCollection":return gr.parse(h.default)||null;case"projectionDefinition":return an.parse(h.default)||null;default:return h.default===void 0?null:h.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=o}evaluateWithoutErrorHandling(t,r,o,h,m,y){return this._globalState&&(t=pn(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,r,o,h,m,y){this._globalState&&(t=pn(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new ar(`Expected value to be one of ${Object.keys(this._enumValues).map((v=>JSON.stringify(v))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Tl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in vl}function oc(n,t,r){const o=new pl(vl,Dn,[],t?(function(m){const y={color:xt,string:dt,number:Ze,enum:dt,boolean:Bt,formatted:Da,padding:Ra,numberArray:ma,colorArray:ys,projectionDefinition:Si,resolvedImage:Er,variableAnchorOffsetCollection:ts};return m.type==="array"?xn(y[m.value]||Zt,m.length):y[m.type]})(t):void 0),h=o.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?ac(new sc(h,t,r)):Ws(o.errors)}class Rn{constructor(t,r,o){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!jo(r.expression),this.globalStateRefs=Ln(r.expression),this._globalState=o}evaluateWithoutErrorHandling(t,r,o,h,m,y){return this._globalState&&(t=pn(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,r,o,h,m,y)}evaluate(t,r,o,h,m,y){return this._globalState&&(t=pn(t,this._globalState)),this._styleExpression.evaluate(t,r,o,h,m,y)}}class Ks{constructor(t,r,o,h,m){this.kind=t,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!jo(r.expression),this.globalStateRefs=Ln(r.expression),this.interpolationType=h,this._globalState=m}evaluateWithoutErrorHandling(t,r,o,h,m,y){return this._globalState&&(t=pn(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,r,o,h,m,y)}evaluate(t,r,o,h,m,y){return this._globalState&&(t=pn(t,this._globalState)),this._styleExpression.evaluate(t,r,o,h,m,y)}interpolationFactor(t,r,o){return this.interpolationType?zn.interpolationFactor(this.interpolationType,t,r,o):0}}function Bo(n,t,r){const o=oc(n,t,r);if(o.result==="error")return o;const h=o.value.expression,m=ws(h);if(!m&&!va(t))return Ws([new ot("","data expressions not supported")]);const y=Oo(h,["zoom"]);if(!y&&!Wu(t))return Ws([new ot("","zoom expressions not supported")]);const x=Ss(h);return x||y?x instanceof ot?Ws([x]):x instanceof zn&&!bl(t)?Ws([new ot("",'"interpolate" expressions cannot be used with this property')]):ac(x?new Ks(m?"camera":"composite",o.value,x.labels,x instanceof zn?x.interpolation:void 0,r):new Rn(m?"constant":"source",o.value,r)):Ws([new ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qs{constructor(t,r){this._parameters=t,this._specification=r,ht(this,tu(this._parameters,this._specification))}static deserialize(t){return new Qs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ss(n){let t=null;if(n instanceof vs)t=Ss(n.result);else if(n instanceof Eo){for(const r of n.args)if(t=Ss(r),t)break}else(n instanceof Hs||n instanceof zn)&&n.input instanceof Jn&&n.input.name==="zoom"&&(t=n);return t instanceof ot||n.eachChild((r=>{const o=Ss(r);o instanceof ot?t=o:!t&&o?t=new ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Ln(n,t=new Set){return n instanceof nc&&t.add(n.key),n.eachChild((r=>{Ln(r,t)})),t}function pn(n,t){const{zoom:r,heatmapDensity:o,elevation:h,lineProgress:m,isSupportedScript:y,accumulated:x}=n??{};return{zoom:r,heatmapDensity:o,elevation:h,lineProgress:m,isSupportedScript:y,accumulated:x,globalState:t}}function Ua(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!Ua(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const $a={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function jn(n,t){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ua(n)||(n=Ml(n));const r=oc(n,$a,t);if(r.result==="error")throw new Error(r.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,h,m)=>r.value.evaluate(o,h,{},m),needGeometry:Ku(n),getGlobalStateRefs:()=>Ln(r.value.expression)}}function Ts(n,t){return n<t?-1:n>t?1:0}function Ku(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Ku(n[t]))return!0;return!1}function Ml(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?lc(n[1],n[2],"=="):t==="!="?Xi(lc(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?lc(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(Ml))):t==="all"?["all"].concat(n.slice(1).map(Ml)):t==="none"?["all"].concat(n.slice(1).map(Ml).map(Xi)):t==="in"?ru(n[1],n.slice(2)):t==="!in"?Xi(ru(n[1],n.slice(2))):t==="has"?Yr(n[1]):t!=="!has"||Xi(Yr(n[1]));var r}function lc(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function ru(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((r=>typeof r!=typeof t[0]))?["filter-in-large",n,["literal",t.sort(Ts)]]:["filter-in-small",n,["literal",t]]}}function Yr(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Xi(n){return["!",n]}function bi(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const m of n)h+=`${bi(m)},`;return`${h}]`}const r=Object.keys(n).sort();let o="{";for(let h=0;h<r.length;h++)o+=`${JSON.stringify(r[h])}:${bi(n[r[h]])},`;return`${o}}`}function ss(n){let t="";for(const r of qt)t+=`/${bi(n[r])}`;return t}function On(n){const t=n.value;return t?[new Me(n.key,t,"constants have been deprecated as of v8")]:[]}function or(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Zn(n){if(Array.isArray(n))return n.map(Zn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Zn(n[r]);return t}return or(n)}function ra(n){const t=n.key,r=n.value,o=n.valueSpec||{},h=n.objectElementValidators||{},m=n.style,y=n.styleSpec,x=n.validateSpec;let v=[];const M=li(r);if(M!=="object")return[new Me(t,r,`object expected, ${M} found`)];for(const k in r){const P=k.split(".")[0],B=hl(o,P)||o["*"];let U;if(hl(h,P))U=h[P];else if(hl(o,P))U=x;else if(h["*"])U=h["*"];else{if(!o["*"]){v.push(new Me(t,r[k],`unknown property "${k}"`));continue}U=x}v=v.concat(U({key:(t&&`${t}.`)+k,value:r[k],valueSpec:B,style:m,styleSpec:y,object:r,objectKey:k,validateSpec:x},r))}for(const k in o)h[k]||o[k].required&&o[k].default===void 0&&r[k]===void 0&&v.push(new Me(t,r,`missing required property "${k}"`));return v}function nu(n){const t=n.value,r=n.valueSpec,o=n.style,h=n.styleSpec,m=n.key,y=n.arrayElementValidator||n.validateSpec;if(li(t)!=="array")return[new Me(m,t,`array expected, ${li(t)} found`)];if(r.length&&t.length!==r.length)return[new Me(m,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Me(m,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let x={type:r.value,values:r.values};h.$version<7&&(x.function=r.function),li(r.value)==="object"&&(x=r.value);let v=[];for(let M=0;M<t.length;M++)v=v.concat(y({array:t,arrayIndex:M,value:t[M],valueSpec:x,validateSpec:n.validateSpec,style:o,styleSpec:h,key:`${m}[${M}]`}));return v}function Ms(n){const t=n.key,r=n.value,o=n.valueSpec;let h=li(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new Me(t,r,`number expected, ${h} found`)]:"minimum"in o&&r<o.minimum?[new Me(t,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Me(t,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function Js(n){const t=n.valueSpec,r=or(n.value.type);let o,h,m,y={};const x=r!=="categorical"&&n.value.property===void 0,v=!x,M=li(n.value.stops)==="array"&&li(n.value.stops[0])==="array"&&li(n.value.stops[0][0])==="object",k=ra({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(U){if(r==="identity")return[new Me(U.key,U.value,'identity function may not have a "stops" property')];let V=[];const q=U.value;return V=V.concat(nu({key:U.key,value:q,valueSpec:U.valueSpec,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:P})),li(q)==="array"&&q.length===0&&V.push(new Me(U.key,q,"array must have at least one stop")),V},default:function(U){return U.validateSpec({key:U.key,value:U.value,valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec})}}});return r==="identity"&&x&&k.push(new Me(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||k.push(new Me(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!bl(n.valueSpec)&&k.push(new Me(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(v&&!va(n.valueSpec)?k.push(new Me(n.key,n.value,"property functions not supported")):x&&!Wu(n.valueSpec)&&k.push(new Me(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!M||n.value.property!==void 0||k.push(new Me(n.key,n.value,'"property" property is required')),k;function P(U){let V=[];const q=U.value,Y=U.key;if(li(q)!=="array")return[new Me(Y,q,`array expected, ${li(q)} found`)];if(q.length!==2)return[new Me(Y,q,`array length 2 expected, length ${q.length} found`)];if(M){if(li(q[0])!=="object")return[new Me(Y,q,`object expected, ${li(q[0])} found`)];if(q[0].zoom===void 0)return[new Me(Y,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Me(Y,q,"object stop key must have value")];if(m&&m>or(q[0].zoom))return[new Me(Y,q[0].zoom,"stop zoom values must appear in ascending order")];or(q[0].zoom)!==m&&(m=or(q[0].zoom),h=void 0,y={}),V=V.concat(ra({key:`${Y}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Ms,value:B}}))}else V=V.concat(B({key:`${Y}[0]`,value:q[0],validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec},q));return Tl(Zn(q[1]))?V.concat([new Me(`${Y}[1]`,q[1],"expressions are not allowed in function stops.")]):V.concat(U.validateSpec({key:`${Y}[1]`,value:q[1],valueSpec:t,validateSpec:U.validateSpec,style:U.style,styleSpec:U.styleSpec}))}function B(U,V){const q=li(U.value),Y=or(U.value),ae=U.value!==null?U.value:V;if(o){if(q!==o)return[new Me(U.key,ae,`${q} stop domain type must match previous stop domain type ${o}`)]}else o=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Me(U.key,ae,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let Ce=`number expected, ${q} found`;return va(t)&&r===void 0&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Me(U.key,ae,Ce)]}return r!=="categorical"||q!=="number"||isFinite(Y)&&Math.floor(Y)===Y?r!=="categorical"&&q==="number"&&h!==void 0&&Y<h?[new Me(U.key,ae,"stop domain values must appear in ascending order")]:(h=Y,r==="categorical"&&Y in y?[new Me(U.key,ae,"stop domain values must be unique")]:(y[Y]=!0,[])):[new Me(U.key,ae,`integer expected, found ${Y}`)]}}function eo(n){const t=(n.expressionContext==="property"?Bo:oc)(Zn(n.value),n.valueSpec);if(t.result==="error")return t.value.map((o=>new Me(`${n.key}${o.key}`,n.value,o.message)));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Me(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!jo(r))return[new Me(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!jo(r))return[new Me(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Oo(r,["zoom","feature-state"]))return[new Me(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ws(r))return[new Me(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function to(n){const t=n.key,r=n.value,o=li(r);return o!=="string"?[new Me(t,r,`color expected, ${o} found`)]:ti.parse(String(r))?[]:[new Me(t,r,`color expected, "${r}" found`)]}function io(n){const t=n.key,r=n.value,o=n.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(or(r))===-1&&h.push(new Me(t,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(or(r))===-1&&h.push(new Me(t,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function ba(n){return Ua(Zn(n.value))?eo(ht({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):os(n)}function os(n){const t=n.value,r=n.key;if(li(t)!=="array")return[new Me(r,t,`array expected, ${li(t)} found`)];const o=n.styleSpec;let h,m=[];if(t.length<1)return[new Me(r,t,"filter array must have at least 1 element")];switch(m=m.concat(io({key:`${r}[0]`,value:t[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),or(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&or(t[1])==="$type"&&m.push(new Me(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Me(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=li(t[1]),h!=="string"&&m.push(new Me(`${r}[1]`,t[1],`string expected, ${h} found`)));for(let y=2;y<t.length;y++)h=li(t[y]),or(t[1])==="$type"?m=m.concat(io({key:`${r}[${y}]`,value:t[y],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&m.push(new Me(`${r}[${y}]`,t[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)m=m.concat(os({key:`${r}[${y}]`,value:t[y],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=li(t[1]),t.length!==2?m.push(new Me(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&m.push(new Me(`${r}[1]`,t[1],`string expected, ${h} found`))}return m}function ls(n,t){const r=n.key,o=n.validateSpec,h=n.style,m=n.styleSpec,y=n.value,x=n.objectKey,v=m[`${t}_${n.layerType}`];if(!v)return[];const M=x.match(/^(.*)-transition$/);if(t==="paint"&&M&&v[M[1]]&&v[M[1]].transition)return o({key:r,value:y,valueSpec:m.transition,style:h,styleSpec:m});const k=n.valueSpec||v[x];if(!k)return[new Me(r,y,`unknown property "${x}"`)];let P;if(li(y)==="string"&&va(k)&&!k.tokens&&(P=/^{([^}]+)}$/.exec(y)))return[new Me(r,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const B=[];return n.layerType==="symbol"&&(x==="text-field"&&h&&!h.glyphs&&B.push(new Me(r,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&wl(Zn(y))&&or(y.type)==="identity"&&B.push(new Me(r,y,'"text-font" does not support identity functions'))),B.concat(o({key:n.key,value:y,valueSpec:k,style:h,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:x}))}function Va(n){return ls(n,"paint")}function au(n){return ls(n,"layout")}function cc(n){let t=[];const r=n.value,o=n.key,h=n.style,m=n.styleSpec;if(li(r)!=="object")return[new Me(o,r,`object expected, ${li(r)} found`)];r.type||r.ref||t.push(new Me(o,r,'either "type" or "ref" is required'));let y=or(r.type);const x=or(r.ref);if(r.id){const v=or(r.id);for(let M=0;M<n.arrayIndex;M++){const k=h.layers[M];or(k.id)===v&&t.push(new Me(o,r.id,`duplicate layer id "${r.id}", previously used at line ${k.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach((M=>{M in r&&t.push(new Me(o,r[M],`"${M}" is prohibited for ref layers`))})),h.layers.forEach((M=>{or(M.id)===x&&(v=M)})),v?v.ref?t.push(new Me(o,r.ref,"ref cannot reference another ref layer")):y=or(v.type):t.push(new Me(o,r.ref,`ref layer "${x}" not found`))}else if(y!=="background")if(r.source){const v=h.sources&&h.sources[r.source],M=v&&or(v.type);v?M==="vector"&&y==="raster"?t.push(new Me(o,r.source,`layer "${r.id}" requires a raster source`)):M!=="raster-dem"&&y==="hillshade"||M!=="raster-dem"&&y==="color-relief"?t.push(new Me(o,r.source,`layer "${r.id}" requires a raster-dem source`)):M==="raster"&&y!=="raster"?t.push(new Me(o,r.source,`layer "${r.id}" requires a vector source`)):M!=="vector"||r["source-layer"]?M==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?t.push(new Me(o,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||M==="geojson"&&v.lineMetrics||t.push(new Me(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Me(o,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Me(o,r.source,`source "${r.source}" not found`))}else t.push(new Me(o,r,'missing required property "source"'));return t=t.concat(ra({key:o,value:r,valueSpec:m.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:r.type,valueSpec:m.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:ba,layout:v=>ra({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":M=>au(ht({layerType:y},M))}}),paint:v=>ra({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":M=>Va(ht({layerType:y},M))}})}})),t}function na(n){const t=n.value,r=n.key,o=li(t);return o!=="string"?[new Me(r,t,`string expected, ${o} found`)]:[]}const ks={promoteId:function({key:n,value:t}){if(li(t)==="string")return na({key:n,value:t});{const r=[];for(const o in t)r.push(...na({key:`${n}.${o}`,value:t[o]}));return r}}};function ro(n){const t=n.value,r=n.key,o=n.styleSpec,h=n.style,m=n.validateSpec;if(!t.type)return[new Me(r,t,'"type" is required')];const y=or(t.type);let x;switch(y){case"vector":case"raster":return x=ra({key:r,value:t,valueSpec:o[`source_${y.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:ks,validateSpec:m}),x;case"raster-dem":return x=(function(v){var M;const k=(M=v.sourceName)!==null&&M!==void 0?M:"",P=v.value,B=v.styleSpec,U=B.source_raster_dem,V=v.style;let q=[];const Y=li(P);if(P===void 0)return q;if(Y!=="object")return q.push(new Me("source_raster_dem",P,`object expected, ${Y} found`)),q;const ae=or(P.encoding)==="custom",Ce=["redFactor","greenFactor","blueFactor","baseShift"],ue=v.value.encoding?`"${v.value.encoding}"`:"Default";for(const me in P)!ae&&Ce.includes(me)?q.push(new Me(me,P[me],`In "${k}": "${me}" is only valid when "encoding" is set to "custom". ${ue} encoding found`)):U[me]?q=q.concat(v.validateSpec({key:me,value:P[me],valueSpec:U[me],validateSpec:v.validateSpec,style:V,styleSpec:B})):q.push(new Me(me,P[me],`unknown property "${me}"`));return q})({sourceName:r,value:t,style:n.style,styleSpec:o,validateSpec:m}),x;case"geojson":if(x=ra({key:r,value:t,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:m,objectElementValidators:ks}),t.cluster)for(const v in t.clusterProperties){const[M,k]=t.clusterProperties[v],P=typeof M=="string"?[M,["accumulated"],["get",v]]:M;x.push(...eo({key:`${r}.${v}.map`,value:k,expressionContext:"cluster-map"})),x.push(...eo({key:`${r}.${v}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return x;case"video":return ra({key:r,value:t,valueSpec:o.source_video,style:h,validateSpec:m,styleSpec:o});case"image":return ra({key:r,value:t,valueSpec:o.source_image,style:h,validateSpec:m,styleSpec:o});case"canvas":return[new Me(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return io({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function sn(n){const t=n.value,r=n.styleSpec,o=r.light,h=n.style;let m=[];const y=li(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new Me("light",t,`object expected, ${y} found`)]),m;for(const x in t){const v=x.match(/^(.*)-transition$/);m=m.concat(v&&o[v[1]]&&o[v[1]].transition?n.validateSpec({key:x,value:t[x],valueSpec:r.transition,validateSpec:n.validateSpec,style:h,styleSpec:r}):o[x]?n.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Me(x,t[x],`unknown property "${x}"`)])}return m}function uc(n){const t=n.value,r=n.styleSpec,o=r.sky,h=n.style,m=li(t);if(t===void 0)return[];if(m!=="object")return[new Me("sky",t,`object expected, ${m} found`)];let y=[];for(const x in t)y=y.concat(o[x]?n.validateSpec({key:x,value:t[x],valueSpec:o[x],style:h,styleSpec:r}):[new Me(x,t[x],`unknown property "${x}"`)]);return y}function Qu(n){const t=n.value,r=n.styleSpec,o=r.terrain,h=n.style;let m=[];const y=li(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new Me("terrain",t,`object expected, ${y} found`)]),m;for(const x in t)m=m.concat(o[x]?n.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Me(x,t[x],`unknown property "${x}"`)]);return m}function Xh(n){let t=[];const r=n.value,o=n.key;if(Array.isArray(r)){const h=[],m=[];for(const y in r)r[y].id&&h.includes(r[y].id)&&t.push(new Me(o,r,`all the sprites' ids must be unique, but ${r[y].id} is duplicated`)),h.push(r[y].id),r[y].url&&m.includes(r[y].url)&&t.push(new Me(o,r,`all the sprites' URLs must be unique, but ${r[y].url} is duplicated`)),m.push(r[y].url),t=t.concat(ra({key:`${o}[${y}]`,value:r[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return na({key:o,value:r})}function Wh(n){return t=n.value,t&&t.constructor===Object?[]:[new Me(n.key,n.value,`object expected, ${li(n.value)} found`)];var t}const kl={"*":()=>[],array:nu,boolean:function(n){const t=n.value,r=n.key,o=li(t);return o!=="boolean"?[new Me(r,t,`boolean expected, ${o} found`)]:[]},number:Ms,color:to,constants:On,enum:io,filter:ba,function:Js,layer:cc,object:ra,source:ro,light:sn,sky:uc,terrain:Qu,projection:function(n){const t=n.value,r=n.styleSpec,o=r.projection,h=n.style,m=li(t);if(t===void 0)return[];if(m!=="object")return[new Me("projection",t,`object expected, ${m} found`)];let y=[];for(const x in t)y=y.concat(o[x]?n.validateSpec({key:x,value:t[x],valueSpec:o[x],style:h,styleSpec:r}):[new Me(x,t[x],`unknown property "${x}"`)]);return y},projectionDefinition:function(n){const t=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const o=li(r);return o!=="array"||(function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"})(r)||(function(h){return!!["interpolate","step","literal"].includes(h[0])})(r)?["array","string"].includes(o)?[]:[new Me(t,r,`projection expected, invalid type "${o}" found`)]:[new Me(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:na,formatted:function(n){return na(n).length===0?[]:eo(n)},resolvedImage:function(n){return na(n).length===0?[]:eo(n)},padding:function(n){const t=n.key,r=n.value;if(li(r)==="array"){if(r.length<1||r.length>4)return[new Me(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let h=[];for(let m=0;m<r.length;m++)h=h.concat(n.validateSpec({key:`${t}[${m}]`,value:r[m],validateSpec:n.validateSpec,valueSpec:o}));return h}return Ms({key:t,value:r,valueSpec:{}})},numberArray:function(n){const t=n.key,r=n.value;if(li(r)==="array"){const o={type:"number"};if(r.length<1)return[new Me(t,r,"array length at least 1 expected, length 0 found")];let h=[];for(let m=0;m<r.length;m++)h=h.concat(n.validateSpec({key:`${t}[${m}]`,value:r[m],validateSpec:n.validateSpec,valueSpec:o}));return h}return Ms({key:t,value:r,valueSpec:{}})},colorArray:function(n){const t=n.key,r=n.value;if(li(r)==="array"){if(r.length<1)return[new Me(t,r,"array length at least 1 expected, length 0 found")];let o=[];for(let h=0;h<r.length;h++)o=o.concat(to({key:`${t}[${h}]`,value:r[h]}));return o}return to({key:t,value:r})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,o=li(r),h=n.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Me(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let y=0;y<r.length;y+=2)m=m.concat(io({key:`${t}[${y}]`,value:r[y],valueSpec:h.layout_symbol["text-anchor"]})),m=m.concat(nu({key:`${t}[${y+1}]`,value:r[y+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return m},sprite:Xh,state:Wh};function lr(n){const t=n.value,r=n.valueSpec,o=n.styleSpec;return n.validateSpec=lr,r.expression&&wl(or(t))?Js(n):r.expression&&Tl(Zn(t))?eo(n):r.type&&kl[r.type]?kl[r.type](n):ra(ht({},n,{valueSpec:r.type?o[r.type]:r}))}function vn(n){const t=n.value,r=n.key,o=na(n);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Me(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Me(r,t,'"glyphs" url must include a "{range}" token'))),o}function Fr(n,t=_e){let r=[];return r=r.concat(lr({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:lr,objectElementValidators:{glyphs:vn,"*":()=>[]}})),n.constants&&(r=r.concat(On({key:"constants",value:n.constants}))),su(r)}function bn(n){return function(t){return n(Object.assign({},t,{validateSpec:lr}))}}function su(n){return[].concat(n).sort(((t,r)=>t.line-r.line))}function wn(n){return function(...t){return su(n.apply(this,t))}}Fr.source=wn(bn(ro)),Fr.sprite=wn(bn(Xh)),Fr.glyphs=wn(bn(vn)),Fr.light=wn(bn(sn)),Fr.sky=wn(bn(uc)),Fr.terrain=wn(bn(Qu)),Fr.state=wn(bn(Wh)),Fr.layer=wn(bn(cc)),Fr.filter=wn(bn(ba)),Fr.paintProperty=wn(bn(Va)),Fr.layoutProperty=wn(bn(au));const Bn=Fr,Yh=Bn.light,ou=Bn.sky,Ud=Bn.paintProperty,lu=Bn.layoutProperty;function no(n,t){let r=!1;if(t&&t.length)for(const o of t)n.fire(new Ve(new Error(o.message))),r=!0;return r}class Ga{constructor(t,r,o){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(r=y[1])+2*(o=y[2]);for(let v=0;v<this.d*this.d;v++){const M=y[3+v],k=y[3+v+1];h.push(M===k?null:y.subarray(M,k))}const x=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],x),this.bboxes=y.subarray(x),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=o,this.scale=r/t,this.uid=0;const m=o/r*t;this.min=-m,this.max=t+m}insert(t,r,o,h,m){this._forEachCell(r,o,h,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,o,h,m,y){this.cells[m].push(y)}query(t,r,o,h,m){const y=this.min,x=this.max;if(t<=y&&r<=y&&x<=o&&x<=h&&!m)return Array.prototype.slice.call(this.keys);{const v=[];return this._forEachCell(t,r,o,h,this._queryCell,v,{},m),v}}_queryCell(t,r,o,h,m,y,x,v){const M=this.cells[m];if(M!==null){const k=this.keys,P=this.bboxes;for(let B=0;B<M.length;B++){const U=M[B];if(x[U]===void 0){const V=4*U;(v?v(P[V+0],P[V+1],P[V+2],P[V+3]):t<=P[V+2]&&r<=P[V+3]&&o>=P[V+0]&&h>=P[V+1])?(x[U]=!0,y.push(k[U])):x[U]=!1}}}}_forEachCell(t,r,o,h,m,y,x,v){const M=this._convertToCellCoord(t),k=this._convertToCellCoord(r),P=this._convertToCellCoord(o),B=this._convertToCellCoord(h);for(let U=M;U<=P;U++)for(let V=k;V<=B;V++){const q=this.d*V+U;if((!v||v(this._convertFromCellCoord(U),this._convertFromCellCoord(V),this._convertFromCellCoord(U+1),this._convertFromCellCoord(V+1)))&&m.call(this,t,r,o,h,q,y,x,v))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let o=0;for(let y=0;y<this.cells.length;y++)o+=this.cells[y].length;const h=new Int32Array(r+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let m=r;for(let y=0;y<t.length;y++){const x=t[y];h[3+y]=m,h.set(x,m),m+=x.length}return h[3+t.length]=m,h.set(this.keys,m),m+=this.keys.length,h[3+t.length+1]=m,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer}static serialize(t,r){const o=t.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(t){return new Ga(t.buffer)}}const wa={};function _t(n,t,r={}){if(wa[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),wa[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}_t("Object",Object),_t("Set",Set),_t("TransferableGridIndex",Ga),_t("Color",ti),_t("Error",Error),_t("AJAXError",ee),_t("ResolvedImage",Xr),_t("StylePropertyFunction",Qs),_t("StyleExpression",sc,{omit:["_evaluator"]}),_t("ZoomDependentExpression",Ks),_t("ZoomConstantExpression",Rn),_t("CompoundExpression",Jn,{omit:["_evaluate"]});for(const n in vl)vl[n]._classRegistryKey||_t(`Expression_${n}`,vl[n]);function No(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Cs(n){return n.$name||n.constructor._classRegistryKey}function hc(n){return!(function(t){if(t===null||typeof t!="object")return!1;const r=Cs(t);return!(!r||r==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||No(n)||An(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function ao(n,t){if(hc(n))return(No(n)||An(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const m=[];for(const y of n)m.push(ao(y,t));return m}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=Cs(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!wa[r])throw new Error(`${r} is not registered.`);const{klass:o}=wa[r],h=o.serialize?o.serialize(n,t):{};if(o.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in n){if(!n.hasOwnProperty(m)||wa[r].omit.indexOf(m)>=0)continue;const y=n[m];h[m]=wa[r].shallow.indexOf(m)>=0?y:ao(y,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(h.$name=r),h}function Es(n){if(hc(n))return n;if(Array.isArray(n))return n.map(Es);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=Cs(n)||"Object";if(!wa[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=wa[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const o=Object.create(r.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const m=n[h];o[h]=wa[t].shallow.indexOf(h)>=0?m:Es(m)}return o}class cu{constructor(){this.first=!0}update(t,r){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const si={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Sa(n){for(const t of n)if(so(t.charCodeAt(0)))return!0;return!1}function Ju(n){for(const t of n)if(!Cl(t.charCodeAt(0)))return!1;return!0}function dc(n){const t=n.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(t.join("|"),"u")}const Fo=dc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Cl(n){return!Fo.test(String.fromCodePoint(n))}const Uo=dc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function so(n){return!(n!==746&&n!==747&&(n<4352||!(si["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||si["CJK Compatibility"](n)||si["CJK Strokes"](n)||!(!si["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||si["Enclosed CJK Letters and Months"](n)||si["Ideographic Description Characters"](n)||si.Kanbun(n)||si.Katakana(n)&&n!==12540||!(!si["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!si["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||si["Vertical Forms"](n)||si["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Uo.test(String.fromCodePoint(n)))))}function pc(n){return!(so(n)||(function(t){return!!(si["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||si["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||si["Letterlike Symbols"](t)||si["Number Forms"](t)||si["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||si["Control Pictures"](t)&&t!==9251||si["Optical Character Recognition"](t)||si["Enclosed Alphanumerics"](t)||si["Geometric Shapes"](t)||si["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||si["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||si["CJK Symbols and Punctuation"](t)||si.Katakana(t)||si["Private Use Area"](t)||si["CJK Compatibility Forms"](t)||si["Small Form Variants"](t)||si["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}const eh=dc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function oo(n){return eh.test(String.fromCodePoint(n))}function th(n,t){return!(!t&&oo(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||si.Khmer(n))}function lo(n){for(const t of n)if(oo(t.charCodeAt(0)))return!0;return!1}const Za=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Za.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return u(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,o=new Promise((m=>{this.loadScriptResolve=m}));t(r);const h=new Promise((m=>setTimeout((()=>m()),this.TIMEOUT)));if(yield Promise.race([o,h]),this.isParsed()){const m={pluginStatus:"loaded",pluginURL:r};return this.setState(m),m}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class Vi{constructor(t,r){this.isSupportedScript=co,this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new cu,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cu,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}function co(n){return(function(t,r){for(const o of t)if(!th(o.charCodeAt(0),r))return!1;return!0})(n,Za.getRTLTextPluginStatus()==="loaded")}class qa{constructor(t,r,o){this.property=t,this.value=r,this.expression=(function(h,m,y){if(wl(h))return new Qs(h,m);if(Tl(h)){const x=Bo(h,m,y);if(x.result==="error")throw new Error(x.value.map((v=>`${v.key}: ${v.message}`)).join(", "));return x.value}{let x=h;return m.type==="color"&&typeof h=="string"?x=ti.parse(h):m.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?m.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?m.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?x=gr.parse(h):m.type==="projectionDefinition"&&typeof h=="string"&&(x=an.parse(h)):x=Rr.parse(h):x=hn.parse(h):x=Mr.parse(h),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>x}}})(r===void 0?t.specification.default:r,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,o){return this.property.possiblyEvaluate(this,t,r,o)}}class uo{constructor(t,r){this.property=t,this.value=new qa(t,void 0,r)}transitioned(t,r){return new mc(this.property,this.value,r,$i({},t.transition,this.transition),t.now)}untransitioned(){return new mc(this.property,this.value,null,{},0)}}class fc{constructor(t,r){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=r}getValue(t){return Tr(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new uo(this._values[t].property,this._globalState)),this._values[t].value=new qa(this._values[t].property,r===null?void 0:Tr(r),this._globalState)}getTransition(t){return Tr(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new uo(this._values[t].property,this._globalState)),this._values[t].transition=Tr(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o);const h=this.getTransition(r);h!==void 0&&(t[`${r}-transition`]=h)}return t}transitioned(t,r){const o=new $o(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(t,r._values[h]);return o}untransitioned(){const t=new $o(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class mc{constructor(t,r,o,h,m){this.property=t,this.value=r,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(t,r,o){const h=t.now||0,m=this.value.possiblyEvaluate(t,r,o),y=this.prior;if(y){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return y.possiblyEvaluate(t,r,o);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,r,o),m,yt(x))}}return m}}class $o{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,o){const h=new Vo(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(t,r,o);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ho{constructor(t,r){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=r}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Tr(this._values[t].value)}setValue(t,r){this._values[t]=new qa(this._values[t].property,r===null?void 0:Tr(r),this._globalState)}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o)}return t}possiblyEvaluate(t,r,o){const h=new Vo(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(t,r,o);return h}}class Ha{constructor(t,r,o){this.property=t,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,o,h){return this.property.evaluate(this.value,this.parameters,t,r,o,h)}}class Vo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Mt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,o){const h=In[this.specification.type];return h?h(t,r,o):t}}class Nt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,o,h){return new Ha(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},o,h)}:t.expression,r)}interpolate(t,r,o){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Ha(this,{kind:"constant",value:void 0},t.parameters);const h=In[this.specification.type];if(h){const m=h(t.value.value,r.value.value,o);return new Ha(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,r,o,h,m,y){return t.kind==="constant"?t.value:t.evaluate(r,o,h,m,y)}}class Go extends Nt{possiblyEvaluate(t,r,o,h){if(t.value===void 0)return new Ha(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const m=t.expression.evaluate(r,null,{},o,h),y=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,x=this._calculate(y,y,y,r);return new Ha(this,{kind:"constant",value:x},r)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Ha(this,{kind:"constant",value:m},r)}return new Ha(this,t.expression,r)}evaluate(t,r,o,h,m,y){if(t.kind==="source"){const x=t.evaluate(r,o,h,m,y);return this._calculate(x,x,x,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},o,h),t.evaluate({zoom:Math.floor(r.zoom)},o,h),t.evaluate({zoom:Math.floor(r.zoom)+1},o,h),r):t.value}_calculate(t,r,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class gc{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(r,null,{},o,h);return this._calculate(m,m,m,r)}return this._calculate(t.expression.evaluate(new Vi(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Vi(Math.floor(r.zoom),r)),t.expression.evaluate(new Vi(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class Zo{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,h){return!!t.expression.evaluate(r,null,{},o,h)}interpolate(){return!1}}class cr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new qa(o,void 0,void 0),m=this.defaultTransitionablePropertyValues[r]=new uo(o,void 0);this.defaultTransitioningPropertyValues[r]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}_t("DataDrivenProperty",Nt),_t("DataConstantProperty",Mt),_t("CrossFadedDataDrivenProperty",Go),_t("CrossFadedProperty",gc),_t("ColorRampProperty",Zo);const aa="-transition";class on extends ct{constructor(t,r,o){if(super(),this.id=t.id,this.type=t.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=jn(t.filter,o)),r.layout&&(this._unevaluatedLayout=new ho(r.layout,o)),r.paint)){this._transitionablePaint=new fc(r.paint,o);for(const h in t.paint)this.setPaintProperty(h,t.paint[h],{validate:!1});for(const h in t.layout)this.setLayoutProperty(h,t.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vo(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=jn(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[r];for(const h of o.getGlobalStateRefs())t.add(h)}for(const r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}getPaintAffectingGlobalStateRefs(){var t;const r=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const h=this._transitionablePaint._values[o].value;for(const m of h.getGlobalStateRefs()){const y=(t=r.get(m))!==null&&t!==void 0?t:[];y.push({name:o,value:h.value}),r.set(m,y)}}return r}setLayoutProperty(t,r,o={}){r!=null&&this._validate(lu,`layers.${this.id}.layout.${t}`,t,r,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(aa)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,o={}){if(r!=null&&this._validate(Ud,`layers.${this.id}.paint.${t}`,t,r,o))return!1;if(t.endsWith(aa))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[t],m=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const v=this._transitionablePaint._values[t].value;return v.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(t,x,v)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,o){return!1}isHidden(t,r=!1){return!!(this.minzoom&&t<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),_n(t,((r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length)))}_validate(t,r,o,h,m={}){return(!m||m.validate!==!1)&&no(this,t.call(Bn,{key:r,layerType:this.type,objectKey:o,value:h,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Ha&&va(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let uu;var Kh={get paint(){return uu=uu||new cr({"raster-opacity":new Mt(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Mt(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mt(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mt(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new Mt(_e.paint_raster["raster-saturation"]),"raster-contrast":new Mt(_e.paint_raster["raster-contrast"]),"raster-resampling":new Mt(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new Mt(_e.paint_raster["raster-fade-duration"])})}};class sa extends on{constructor(t,r){super(t,Kh,r)}}const oa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yr{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ur{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gi(n,t=1){let r=0,o=0;return{members:n.map((h=>{const m=oa[h.type].BYTES_PER_ELEMENT,y=r=hi(r,Math.max(t,m)),x=h.components||1;return o=Math.max(o,m),r+=m*x,{name:h.name,type:h.type,components:x,offset:y}})),size:hi(r,Math.max(o,t)),alignment:t}}function hi(n,t){return Math.ceil(n/t)*t}class Ni extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const h=2*t;return this.int16[h+0]=r,this.int16[h+1]=o,t}}Ni.prototype.bytesPerElement=4,_t("StructArrayLayout2i4",Ni);class Ki extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const m=3*t;return this.int16[m+0]=r,this.int16[m+1]=o,this.int16[m+2]=h,t}}Ki.prototype.bytesPerElement=6,_t("StructArrayLayout3i6",Ki);class qo extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,h)}emplace(t,r,o,h,m){const y=4*t;return this.int16[y+0]=r,this.int16[y+1]=o,this.int16[y+2]=h,this.int16[y+3]=m,t}}qo.prototype.bytesPerElement=8,_t("StructArrayLayout4i8",qo);class cs extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,o,h,m,y)}emplace(t,r,o,h,m,y,x){const v=6*t;return this.int16[v+0]=r,this.int16[v+1]=o,this.int16[v+2]=h,this.int16[v+3]=m,this.int16[v+4]=y,this.int16[v+5]=x,t}}cs.prototype.bytesPerElement=12,_t("StructArrayLayout2i4i12",cs);class us extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,o,h,m,y)}emplace(t,r,o,h,m,y,x){const v=4*t,M=8*t;return this.int16[v+0]=r,this.int16[v+1]=o,this.uint8[M+4]=h,this.uint8[M+5]=m,this.uint8[M+6]=y,this.uint8[M+7]=x,t}}us.prototype.bytesPerElement=8,_t("StructArrayLayout2i4ub8",us);class hs extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const h=2*t;return this.float32[h+0]=r,this.float32[h+1]=o,t}}hs.prototype.bytesPerElement=8,_t("StructArrayLayout2f8",hs);class Ho extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y,x,v,M,k){const P=this.length;return this.resize(P+1),this.emplace(P,t,r,o,h,m,y,x,v,M,k)}emplace(t,r,o,h,m,y,x,v,M,k,P){const B=10*t;return this.uint16[B+0]=r,this.uint16[B+1]=o,this.uint16[B+2]=h,this.uint16[B+3]=m,this.uint16[B+4]=y,this.uint16[B+5]=x,this.uint16[B+6]=v,this.uint16[B+7]=M,this.uint16[B+8]=k,this.uint16[B+9]=P,t}}Ho.prototype.bytesPerElement=20,_t("StructArrayLayout10ui20",Ho);class Xa extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y,x,v){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,o,h,m,y,x,v)}emplace(t,r,o,h,m,y,x,v,M){const k=8*t;return this.uint16[k+0]=r,this.uint16[k+1]=o,this.uint16[k+2]=h,this.uint16[k+3]=m,this.uint16[k+4]=y,this.uint16[k+5]=x,this.uint16[k+6]=v,this.uint16[k+7]=M,t}}Xa.prototype.bytesPerElement=16,_t("StructArrayLayout8ui16",Xa);class Xo extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y,x,v,M,k,P,B){const U=this.length;return this.resize(U+1),this.emplace(U,t,r,o,h,m,y,x,v,M,k,P,B)}emplace(t,r,o,h,m,y,x,v,M,k,P,B,U){const V=12*t;return this.int16[V+0]=r,this.int16[V+1]=o,this.int16[V+2]=h,this.int16[V+3]=m,this.uint16[V+4]=y,this.uint16[V+5]=x,this.uint16[V+6]=v,this.uint16[V+7]=M,this.int16[V+8]=k,this.int16[V+9]=P,this.int16[V+10]=B,this.int16[V+11]=U,t}}Xo.prototype.bytesPerElement=24,_t("StructArrayLayout4i4ui4i24",Xo);class vr extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const m=3*t;return this.float32[m+0]=r,this.float32[m+1]=o,this.float32[m+2]=h,t}}vr.prototype.bytesPerElement=12,_t("StructArrayLayout3f12",vr);class El extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}El.prototype.bytesPerElement=4,_t("StructArrayLayout1ul4",El);class As extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y,x,v,M){const k=this.length;return this.resize(k+1),this.emplace(k,t,r,o,h,m,y,x,v,M)}emplace(t,r,o,h,m,y,x,v,M,k){const P=10*t,B=5*t;return this.int16[P+0]=r,this.int16[P+1]=o,this.int16[P+2]=h,this.int16[P+3]=m,this.int16[P+4]=y,this.int16[P+5]=x,this.uint32[B+3]=v,this.uint16[P+8]=M,this.uint16[P+9]=k,t}}As.prototype.bytesPerElement=20,_t("StructArrayLayout6i1ul2ui20",As);class hu extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,o,h,m,y)}emplace(t,r,o,h,m,y,x){const v=6*t;return this.int16[v+0]=r,this.int16[v+1]=o,this.int16[v+2]=h,this.int16[v+3]=m,this.int16[v+4]=y,this.int16[v+5]=x,t}}hu.prototype.bytesPerElement=12,_t("StructArrayLayout2i2i2i12",hu);class du extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,o,h,m)}emplace(t,r,o,h,m,y){const x=4*t,v=8*t;return this.float32[x+0]=r,this.float32[x+1]=o,this.float32[x+2]=h,this.int16[v+6]=m,this.int16[v+7]=y,t}}du.prototype.bytesPerElement=16,_t("StructArrayLayout2f1f2i16",du);class pu extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,t,r,o,h,m,y)}emplace(t,r,o,h,m,y,x){const v=16*t,M=4*t,k=8*t;return this.uint8[v+0]=r,this.uint8[v+1]=o,this.float32[M+1]=h,this.float32[M+2]=m,this.int16[k+6]=y,this.int16[k+7]=x,t}}pu.prototype.bytesPerElement=16,_t("StructArrayLayout2ub2f2i16",pu);class Al extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const m=3*t;return this.uint16[m+0]=r,this.uint16[m+1]=o,this.uint16[m+2]=h,t}}Al.prototype.bytesPerElement=6,_t("StructArrayLayout3ui6",Al);class p extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y,x,v,M,k,P,B,U,V,q,Y,ae){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,t,r,o,h,m,y,x,v,M,k,P,B,U,V,q,Y,ae)}emplace(t,r,o,h,m,y,x,v,M,k,P,B,U,V,q,Y,ae,Ce){const ue=24*t,me=12*t,je=48*t;return this.int16[ue+0]=r,this.int16[ue+1]=o,this.uint16[ue+2]=h,this.uint16[ue+3]=m,this.uint32[me+2]=y,this.uint32[me+3]=x,this.uint32[me+4]=v,this.uint16[ue+10]=M,this.uint16[ue+11]=k,this.uint16[ue+12]=P,this.float32[me+7]=B,this.float32[me+8]=U,this.uint8[je+36]=V,this.uint8[je+37]=q,this.uint8[je+38]=Y,this.uint32[me+10]=ae,this.int16[ue+22]=Ce,t}}p.prototype.bytesPerElement=48,_t("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",p);class e extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,h,m,y,x,v,M,k,P,B,U,V,q,Y,ae,Ce,ue,me,je,Ue,it,mt,lt,pt,It,ut){const ft=this.length;return this.resize(ft+1),this.emplace(ft,t,r,o,h,m,y,x,v,M,k,P,B,U,V,q,Y,ae,Ce,ue,me,je,Ue,it,mt,lt,pt,It,ut)}emplace(t,r,o,h,m,y,x,v,M,k,P,B,U,V,q,Y,ae,Ce,ue,me,je,Ue,it,mt,lt,pt,It,ut,ft){const We=32*t,Ut=16*t;return this.int16[We+0]=r,this.int16[We+1]=o,this.int16[We+2]=h,this.int16[We+3]=m,this.int16[We+4]=y,this.int16[We+5]=x,this.int16[We+6]=v,this.int16[We+7]=M,this.uint16[We+8]=k,this.uint16[We+9]=P,this.uint16[We+10]=B,this.uint16[We+11]=U,this.uint16[We+12]=V,this.uint16[We+13]=q,this.uint16[We+14]=Y,this.uint16[We+15]=ae,this.uint16[We+16]=Ce,this.uint16[We+17]=ue,this.uint16[We+18]=me,this.uint16[We+19]=je,this.uint16[We+20]=Ue,this.uint16[We+21]=it,this.uint16[We+22]=mt,this.uint32[Ut+12]=lt,this.float32[Ut+13]=pt,this.float32[Ut+14]=It,this.uint16[We+30]=ut,this.uint16[We+31]=ft,t}}e.prototype.bytesPerElement=64,_t("StructArrayLayout8i15ui1ul2f2ui64",e);class a extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}a.prototype.bytesPerElement=4,_t("StructArrayLayout1f4",a);class l extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const m=3*t;return this.uint16[6*t+0]=r,this.float32[m+1]=o,this.float32[m+2]=h,t}}l.prototype.bytesPerElement=12,_t("StructArrayLayout1ui2f12",l);class d extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,o)}emplace(t,r,o,h){const m=4*t;return this.uint32[2*t+0]=r,this.uint16[m+2]=o,this.uint16[m+3]=h,t}}d.prototype.bytesPerElement=8,_t("StructArrayLayout1ul2ui8",d);class g extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const h=2*t;return this.uint16[h+0]=r,this.uint16[h+1]=o,t}}g.prototype.bytesPerElement=4,_t("StructArrayLayout2ui4",g);class _ extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}_.prototype.bytesPerElement=2,_t("StructArrayLayout1ui2",_);class w extends ur{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,h)}emplace(t,r,o,h,m){const y=4*t;return this.float32[y+0]=r,this.float32[y+1]=o,this.float32[y+2]=h,this.float32[y+3]=m,t}}w.prototype.bytesPerElement=16,_t("StructArrayLayout4f16",w);class S extends yr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new W(this.anchorPointX,this.anchorPointY)}}S.prototype.size=20;class E extends As{get(t){return new S(this,t)}}_t("CollisionBoxArray",E);class I extends yr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}I.prototype.size=48;class L extends p{get(t){return new I(this,t)}}_t("PlacedSymbolArray",L);class R extends yr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}R.prototype.size=64;class $ extends e{get(t){return new R(this,t)}}_t("SymbolInstanceArray",$);class Z extends a{getoffsetX(t){return this.float32[1*t+0]}}_t("GlyphOffsetArray",Z);class K extends Ki{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}_t("SymbolLineVertexArray",K);class Q extends yr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Q.prototype.size=12;class J extends l{get(t){return new Q(this,t)}}_t("TextAnchorOffsetArray",J);class oe extends yr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}oe.prototype.size=8;class he extends d{get(t){return new oe(this,t)}}_t("FeatureIndexArray",he);class se extends Ni{}class de extends Ni{}class ge extends Ni{}class ce extends cs{}class Te extends us{}class Oe extends hs{}class Re extends Ho{}class Le extends Xa{}class Be extends Xo{}class nt extends vr{}class at extends El{}class et extends hu{}class bt extends pu{}class Wt extends Al{}class Ai extends g{}const Qi=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:tr}=Qi;class ci{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,o,h){const m=this.segments[this.segments.length-1];return t>ci.MAX_VERTEX_ARRAY_LENGTH&&zi(`Max vertices per segment is ${ci.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${ci.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!m||m.vertexLength+t>ci.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h?this.createNewSegment(r,o,h):m}createNewSegment(t,r,o){const h={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(h.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(t,r,o){return this.prepareSegment(0,t,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,o,h){return new ci([{vertexOffset:t,primitiveOffset:r,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function ir(n,t){return 256*(n=Gt(Math.floor(n),0,255))+Gt(Math.floor(t),0,255)}ci.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t("SegmentVector",ci);const Ur=Gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),_r=Gi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Kr,kr,zr,$r={exports:{}},zs={exports:{}},Is={exports:{}},Ps=(function(){if(zr)return $r.exports;zr=1;var n=(Kr||(Kr=1,zs.exports=function(r,o){var h,m,y,x,v,M,k,P;for(m=r.length-(h=3&r.length),y=o,v=3432918353,M=461845907,P=0;P<m;)k=255&r.charCodeAt(P)|(255&r.charCodeAt(++P))<<8|(255&r.charCodeAt(++P))<<16|(255&r.charCodeAt(++P))<<24,++P,y=27492+(65535&(x=5*(65535&(y=(y^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*M+(((k>>>16)*M&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(k=0,h){case 3:k^=(255&r.charCodeAt(P+2))<<16;case 2:k^=(255&r.charCodeAt(P+1))<<8;case 1:y^=k=(65535&(k=(k=(65535&(k^=255&r.charCodeAt(P)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*M+(((k>>>16)*M&65535)<<16)&4294967295}return y^=r.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),zs.exports),t=(kr||(kr=1,Is.exports=function(r,o){for(var h,m=r.length,y=o^m,x=0;m>=4;)h=1540483477*(65535&(h=255&r.charCodeAt(x)|(255&r.charCodeAt(++x))<<8|(255&r.charCodeAt(++x))<<16|(255&r.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++x;switch(m){case 3:y^=(255&r.charCodeAt(x+2))<<16;case 2:y^=(255&r.charCodeAt(x+1))<<8;case 1:y=1540483477*(65535&(y^=255&r.charCodeAt(x)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),Is.exports);return $r.exports=n,$r.exports.murmur3=n,$r.exports.murmur2=t,$r.exports})(),Ds=te(Ps);class po{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,o,h){this.ids.push(yc(t)),this.positions.push(r,o,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=yc(t);let o=0,h=this.ids.length-1;for(;o<h;){const y=o+h>>1;this.ids[y]>=r?h=y:o=y+1}const m=[];for(;this.ids[o]===r;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(t,r){const o=new Float64Array(t.ids),h=new Uint32Array(t.positions);return ds(o,h,0,o.length-1),r&&r.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(t){const r=new po;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function yc(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ds(String(n))}function ds(n,t,r,o){for(;r<o;){const h=n[r+o>>1];let m=r-1,y=o+1;for(;;){do m++;while(n[m]<h);do y--;while(n[y]>h);if(m>=y)break;Sn(n,m,y),Sn(t,3*m,3*y),Sn(t,3*m+1,3*y+1),Sn(t,3*m+2,3*y+2)}y-r<o-y?(ds(n,t,r,y),r=y+1):(ds(n,t,y+1,o),o=y)}}function Sn(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}_t("FeaturePositionMap",po);class fn{constructor(t,r){this.gl=t.gl,this.location=r}}class Ta extends fn{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Wo extends fn{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class jr extends fn{constructor(t,r){super(t,r),this.current=ti.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ln=new Float32Array(16);function qn(n){return[ir(255*n.r,255*n.g),ir(255*n.b,255*n.a)]}class Cr{constructor(t,r,o){this.value=t,this.uniformNames=r.map((h=>`u_${h}`)),this.type=o}setUniform(t,r,o){t.set(o.constantOr(this.value))}getBinding(t,r,o){return this.type==="color"?new jr(t,r):new Ta(t,r)}}class Wa{constructor(t,r){this.uniformNames=r.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,r){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(t,r,o,h){let m=null;h==="u_pattern_to"?m=this.patternTo:h==="u_pattern_from"?m=this.patternFrom:h==="u_dasharray_to"?m=this.dashTo:h==="u_dasharray_from"?m=this.dashFrom:h==="u_pixel_ratio_to"?m=this.pixelRatioTo:h==="u_pixel_ratio_from"&&(m=this.pixelRatioFrom),m!==null&&t.set(m)}getBinding(t,r,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Wo(t,r):new Ta(t,r)}}class Ya{constructor(t,r,o,h){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map((m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(t,r,o){const h=this.paintVertexArray.length,m=this.expression.evaluate(new Vi(0,o),r,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(h,t,m)}updatePaintArray(t,r,o,h,m){const y=this.expression.evaluate(new Vi(0,m),o,h);this._setPaintValue(t,r,y)}_setPaintValue(t,r,o){if(this.type==="color"){const h=qn(o);for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hn{constructor(t,r,o,h,m,y){this.expression=t,this.uniformNames=r.map((x=>`u_${x}_t`)),this.type=o,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=r.map((x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new y}populatePaintArray(t,r,o){const h=this.expression.evaluate(new Vi(this.zoom,o),r,{},o.canonical,[],o.formattedSection),m=this.expression.evaluate(new Vi(this.zoom+1,o),r,{},o.canonical,[],o.formattedSection),y=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(y,t,h,m)}updatePaintArray(t,r,o,h,m){const y=this.expression.evaluate(new Vi(this.zoom,m),o,h),x=this.expression.evaluate(new Vi(this.zoom+1,m),o,h);this._setPaintValue(t,r,y,x)}_setPaintValue(t,r,o,h){if(this.type==="color"){const m=qn(o),y=qn(h);for(let x=t;x<r;x++)this.paintVertexArray.emplace(x,m[0],m[1],y[0],y[1])}else{for(let m=t;m<r;m++)this.paintVertexArray.emplace(m,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=Gt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,r,o){return new Ta(t,r)}}class Rs{constructor(t,r,o,h,m,y){this.expression=t,this.type=r,this.useIntegerZoom=o,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,r,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,this.getPositionIds(r),o)}updatePaintArray(t,r,o,h,m){this._setPaintValues(t,r,this.getPositionIds(o),m)}_setPaintValues(t,r,o,h){const m=this.getPositions(h);if(!m||!o)return;const y=m[o.min],x=m[o.mid],v=m[o.max];if(y&&x&&v)for(let M=t;M<r;M++)this.emplace(this.zoomInPaintVertexArray,M,x,y),this.emplace(this.zoomOutPaintVertexArray,M,x,v)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ih extends Rs{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return Ur.members}emplace(t,r,o,h){t.emplace(r,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],o.pixelRatio,h.pixelRatio)}}class zl extends Rs{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return _r.members}emplace(t,r,o,h){t.emplace(r,0,o.y,o.height,o.width,0,h.y,h.height,h.width)}}class Ls{constructor(t,r,o){this.binders={},this._buffers=[];const h=[];for(const m in t.paint._values){if(!o(m))continue;const y=t.paint.get(m);if(!(y instanceof Ha&&va(y.property.specification)))continue;const x=rh(m,t.type),v=y.value,M=y.property.specification.type,k=y.property.useIntegerZoom,P=y.property.specification["property-type"],B=P==="cross-faded"||P==="cross-faded-data-driven";if(v.kind==="constant")this.binders[m]=B?new Wa(v.value,x):new Cr(v.value,x,M),h.push(`/u_${m}`);else if(v.kind==="source"||B){const U=_c(m,M,"source");this.binders[m]=B?m==="line-dasharray"?new zl(v,M,k,r,U,t.id):new ih(v,M,k,r,U,t.id):new Ya(v,x,M,U),h.push(`/a_${m}`)}else{const U=_c(m,M,"composite");this.binders[m]=new Hn(v,x,M,k,r,U),h.push(`/z_${m}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Ya||r instanceof Hn?r.maxValue:0}populatePaintArrays(t,r,o){for(const h in this.binders){const m=this.binders[h];(m instanceof Ya||m instanceof Hn||m instanceof Rs)&&m.populatePaintArray(t,r,o)}}setConstantPatternPositions(t,r){for(const o in this.binders){const h=this.binders[o];h instanceof Wa&&h.setConstantPatternPositions(t,r)}}setConstantDashPositions(t,r){for(const o in this.binders){const h=this.binders[o];h instanceof Wa&&h.setConstantDashPositions(t,r)}}updatePaintArrays(t,r,o,h,m){let y=!1;for(const x in t){const v=r.getPositions(x);for(const M of v){const k=o.feature(M.index);for(const P in this.binders){const B=this.binders[P];if((B instanceof Ya||B instanceof Hn||B instanceof Rs)&&B.expression.isStateDependent===!0){const U=h.paint.get(P);B.expression=U.value,B.updatePaintArray(M.start,M.end,k,t[x],m),y=!0}}}}return y}defines(){const t=[];for(const r in this.binders){const o=this.binders[r];(o instanceof Cr||o instanceof Wa)&&t.push(...o.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Ya||o instanceof Hn)for(let h=0;h<o.paintVertexAttributes.length;h++)t.push(o.paintVertexAttributes[h].name);else if(o instanceof Rs){const h=o.getVertexAttributes();for(const m of h)t.push(m.name)}}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Cr||o instanceof Wa||o instanceof Hn)for(const h of o.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const o=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Cr||m instanceof Wa||m instanceof Hn){for(const y of m.uniformNames)if(r[y]){const x=m.getBinding(t,r[y],y);o.push({name:y,property:h,binding:x})}}}return o}setUniforms(t,r,o,h){for(const{name:m,property:y,binding:x}of r)this.binders[y].setUniform(x,h,o.get(y),m)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(t&&o instanceof Rs){const h=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof Ya||o instanceof Hn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const r in this.binders){const o=this.binders[r];(o instanceof Ya||o instanceof Hn||o instanceof Rs)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Ya||r instanceof Hn||r instanceof Rs)&&r.destroy()}}}class ps{constructor(t,r,o=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Ls(h,r,o);this.needsUpload=!1,this._featureMap=new po,this._bufferOffset=0}populatePaintArrays(t,r,o,h){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(t,r,h);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,o,h){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,r,m,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function rh(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function _c(n,t,r){const o={color:{source:hs,composite:w},number:{source:a,composite:hs}},h=(function(m){return{"line-pattern":{source:Re,composite:Re},"fill-pattern":{source:Re,composite:Re},"fill-extrusion-pattern":{source:Re,composite:Re},"line-dasharray":{source:Le,composite:Le}}[m]})(n);return h&&h[r]||o[t][r]}_t("ConstantBinder",Cr),_t("CrossFadedConstantBinder",Wa),_t("SourceExpressionBinder",Ya),_t("CrossFadedPatternBinder",ih),_t("CrossFadedDasharrayBinder",zl),_t("CompositeExpressionBinder",Hn),_t("ProgramConfiguration",Ls,{omit:["_buffers"]}),_t("ProgramConfigurationSet",ps);const Yo=Math.pow(2,14)-1,fu=-Yo-1;function fs(n){const t=At/n.extent,r=n.loadGeometry();for(let o=0;o<r.length;o++){const h=r[o];for(let m=0;m<h.length;m++){const y=h[m],x=Math.round(y.x*t),v=Math.round(y.y*t);y.x=Gt(x,fu,Yo),y.y=Gt(v,fu,Yo),(x<y.x||x>y.x+1||v<y.y||v>y.y+1)&&zi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ka(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?fs(n):[]}}const $d=-32768;function Fp(n,t,r,o,h){n.emplaceBack($d+8*t+o,$d+8*r+h)}class Qh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new de,this.indexArray=new Wt,this.segments=new ci,this.programConfigurations=new ps(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,o){const h=this.layers[0],m=[];let y=null,x=!1,v=h.type==="heatmap";if(h.type==="circle"){const k=h;y=k.layout.get("circle-sort-key"),x=!y.isConstant(),v=v||k.paint.get("circle-pitch-alignment")==="map"}const M=v?r.subdivisionGranularity.circle:1;for(const{feature:k,id:P,index:B,sourceLayerIndex:U}of t){const V=this.layers[0]._featureFilter.needGeometry,q=Ka(k,V);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),q,o))continue;const Y=x?y.evaluate(q,{},o):void 0,ae={id:P,properties:k.properties,type:k.type,sourceLayerIndex:U,index:B,geometry:V?q.geometry:fs(k),patterns:{},sortKey:Y};m.push(ae)}x&&m.sort(((k,P)=>k.sortKey-P.sortKey));for(const k of m){const{geometry:P,index:B,sourceLayerIndex:U}=k,V=t[B].feature;this.addFeature(k,P,B,o,M),r.featureIndex.insert(V,P,B,U,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,o,h,m=1){let y;switch(m){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${m}; valid values are 1, 3, 5, 7.`)}const x=y.length;for(const v of r)for(const M of v){const k=M.x,P=M.y;if(k<0||k>=At||P<0||P>=At)continue;const B=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,t.sortKey),U=B.vertexLength;for(let V=0;V<x;V++)for(let q=0;q<x;q++)Fp(this.layoutVertexArray,k,P,y[q],y[V]);for(let V=0;V<x-1;V++)for(let q=0;q<x-1;q++){const Y=U+V*x+q,ae=U+(V+1)*x+q;this.indexArray.emplaceBack(Y,ae+1,Y+1),this.indexArray.emplaceBack(Y,ae,ae+1)}B.vertexLength+=x*x,B.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:{},canonical:h})}}function nh(n,t){for(let r=0;r<n.length;r++)if(xc(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(xc(n,t[r]))return!0;return!!ed(n,t)}function ah(n,t,r){return!!xc(n,t)||!!sh(t,n,r)}function Jh(n,t){if(n.length===1)return Tn(t,n[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let h=0;h<o.length;h++)if(xc(n,o[h]))return!0}for(let r=0;r<n.length;r++)if(Tn(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(ed(n,t[r]))return!0;return!1}function Up(n,t,r){if(n.length>1){if(ed(n,t))return!0;for(let o=0;o<t.length;o++)if(sh(t[o],n,r))return!0}for(let o=0;o<n.length;o++)if(sh(n[o],t,r))return!0;return!1}function ed(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const o=n[r],h=n[r+1];for(let m=0;m<t.length-1;m++)if(Rf(o,h,t[m],t[m+1]))return!0}return!1}function Rf(n,t,r,o){return Bi(n,r,o)!==Bi(t,r,o)&&Bi(n,t,r)!==Bi(n,t,o)}function sh(n,t,r){const o=r*r;if(t.length===1)return n.distSqr(t[0])<o;for(let h=1;h<t.length;h++)if(Qr(n,t[h-1],t[h])<o)return!0;return!1}function Qr(n,t,r){const o=t.distSqr(r);if(o===0)return n.distSqr(t);const h=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/o;return n.distSqr(h<0?t:h>1?r:r.sub(t)._mult(h)._add(t))}function Tn(n,t){let r,o,h,m=!1;for(let y=0;y<n.length;y++){r=n[y];for(let x=0,v=r.length-1;x<r.length;v=x++)o=r[x],h=r[v],o.y>t.y!=h.y>t.y&&t.x<(h.x-o.x)*(t.y-o.y)/(h.y-o.y)+o.x&&(m=!m)}return m}function xc(n,t){let r=!1;for(let o=0,h=n.length-1;o<n.length;h=o++){const m=n[o],y=n[h];m.y>t.y!=y.y>t.y&&t.x<(y.x-m.x)*(t.y-m.y)/(y.y-m.y)+m.x&&(r=!r)}return r}function $p(n,t,r){const o=r[0],h=r[2];if(n.x<o.x&&t.x<o.x||n.x>h.x&&t.x>h.x||n.y<o.y&&t.y<o.y||n.y>h.y&&t.y>h.y)return!1;const m=Bi(n,t,r[0]);return m!==Bi(n,t,r[1])||m!==Bi(n,t,r[2])||m!==Bi(n,t,r[3])}function vc(n,t,r){const o=t.paint.get(n).value;return o.kind==="constant"?o.value:r.programConfigurations.get(t.id).getMaxValue(n)}function oh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Il(n,t,r,o,h){if(!t[0]&&!t[1])return n;const m=W.convert(t)._mult(h);r==="viewport"&&m._rotate(-o);const y=[];for(let x=0;x<n.length;x++)y.push(n[x].sub(m));return y}function Vp({queryGeometry:n,size:t},r){return ah(n,r,t)}function td({queryGeometry:n,size:t,transform:r,unwrappedTileID:o,getElevation:h},m){return ah(n,m,t*(r.projectTileCoordinates(m.x,m.y,o,h).signedDistanceFromCamera/r.cameraToCenterDistance))}function Gp({queryGeometry:n,size:t,transform:r,unwrappedTileID:o,getElevation:h},m){const y=r.projectTileCoordinates(m.x,m.y,o,h).signedDistanceFromCamera,x=t*(r.cameraToCenterDistance/y);return ah(n,ch(m,r,o,h),x)}function Lf({queryGeometry:n,size:t,transform:r,unwrappedTileID:o,getElevation:h},m){return ah(n,ch(m,r,o,h),t)}function lh({queryGeometry:n,size:t,transform:r,unwrappedTileID:o,getElevation:h,pitchAlignment:m="map",pitchScale:y="map"},x){const v=m==="map"?y==="map"?Vp:td:y==="map"?Gp:Lf,M={queryGeometry:n,size:t,transform:r,unwrappedTileID:o,getElevation:h};for(const k of x)for(const P of k)if(v(M,P))return!0;return!1}function ch(n,t,r,o){const h=t.projectTileCoordinates(n.x,n.y,r,o).point;return new W((.5*h.x+.5)*t.width,(.5*-h.y+.5)*t.height)}let Vd,Gd;_t("CircleBucket",Qh,{omit:["layers"]});var Zp={get paint(){return Gd=Gd||new cr({"circle-radius":new Nt(_e.paint_circle["circle-radius"]),"circle-color":new Nt(_e.paint_circle["circle-color"]),"circle-blur":new Nt(_e.paint_circle["circle-blur"]),"circle-opacity":new Nt(_e.paint_circle["circle-opacity"]),"circle-translate":new Mt(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new Mt(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mt(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mt(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Nt(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Nt(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Nt(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return Vd=Vd||new cr({"circle-sort-key":new Nt(_e.layout_circle["circle-sort-key"])})}};class Zd extends on{constructor(t,r){super(t,Zp,r)}createBucket(t){return new Qh(t)}queryRadius(t){const r=t;return vc("circle-radius",this,r)+vc("circle-stroke-width",this,r)+oh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:h,transform:m,pixelsToTileUnits:y,unwrappedTileID:x,getElevation:v}){const M=Il(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-m.bearingInRadians,y),k=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),P=this.paint.get("circle-pitch-scale"),B=this.paint.get("circle-pitch-alignment");let U,V;return B==="map"?(U=M,V=k*y):(U=(function(q,Y,ae,Ce){return q.map((ue=>ch(ue,Y,ae,Ce)))})(M,m,x,v),V=k),lh({queryGeometry:U,size:V,transform:m,unwrappedTileID:x,getElevation:v,pitchAlignment:B,pitchScale:P},h)}}class id extends Qh{}let rd;_t("HeatmapBucket",id,{omit:["layers"]});var qp={get paint(){return rd=rd||new cr({"heatmap-radius":new Nt(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Nt(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mt(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zo(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mt(_e.paint_heatmap["heatmap-opacity"])})}};function uh(n,{width:t,height:r},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*r*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*r*o}`)}else h=new Uint8Array(t*r*o);return n.width=t,n.height=r,n.data=h,n}function hh(n,{width:t,height:r},o){if(t===n.width&&r===n.height)return;const h=uh({},{width:t,height:r},o);dh(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},o),n.width=t,n.height=r,n.data=h.data}function dh(n,t,r,o,h,m){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||o.x>t.width-h.width||o.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=n.data,x=t.data;if(y===x)throw new Error("srcData equals dstData, so image is already copied");for(let v=0;v<h.height;v++){const M=((r.y+v)*n.width+r.x)*m,k=((o.y+v)*t.width+o.x)*m;for(let P=0;P<h.width*m;P++)x[k+P]=y[M+P]}return t}class mu{constructor(t,r){uh(this,t,1,r)}resize(t){hh(this,t,1)}clone(){return new mu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,h,m){dh(t,r,o,h,m,1)}}class Nn{constructor(t,r){uh(this,t,4,r)}resize(t){hh(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Nn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,h,m){dh(t,r,o,h,m,4)}setPixel(t,r,o){const h=4*(t*this.width+r);this.data[h+0]=Math.round(255*o.r/o.a),this.data[h+1]=Math.round(255*o.g/o.a),this.data[h+2]=Math.round(255*o.b/o.a),this.data[h+3]=Math.round(255*o.a)}}function qd(n){const t={},r=n.resolution||256,o=n.clips?n.clips.length:1,h=n.image||new Nn({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const m=(y,x,v)=>{t[n.evaluationKey]=v;const M=n.expression.evaluate(t);h.setPixel(y/4/r,x/4,M)};if(n.clips)for(let y=0,x=0;y<o;++y,x+=4*r)for(let v=0,M=0;v<r;v++,M+=4){const k=v/(r-1),{start:P,end:B}=n.clips[y];m(x,M,P*(1-k)+B*k)}else for(let y=0,x=0;y<r;y++,x+=4)m(0,x,y/(r-1));return h}_t("AlphaImage",mu),_t("RGBAImage",Nn);const js="big-fb";class Hd extends on{createBucket(t){return new id(t)}constructor(t,r){super(t,qp,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(js)&&this.heatmapFbos.delete(js)}queryRadius(t){return vc("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:h,transform:m,pixelsToTileUnits:y,unwrappedTileID:x,getElevation:v}){return lh({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(r,o)*y,transform:m,unwrappedTileID:x,getElevation:v},h)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Hp;var Xp={get paint(){return Hp=Hp||new cr({"hillshade-illumination-direction":new Mt(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Mt(_e.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Mt(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mt(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mt(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mt(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mt(_e.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Mt(_e.paint_hillshade["hillshade-method"])})}};class Ko extends on{constructor(t,r){super(t,Xp,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const m=Math.max(t.length,r.length,o.length,h.length);t=t.concat(Array(m-t.length).fill(t.at(-1))),r=r.concat(Array(m-r.length).fill(r.at(-1))),o=o.concat(Array(m-o.length).fill(o.at(-1))),h=h.concat(Array(m-h.length).fill(h.at(-1)));const y=r.map(fa);return{directionRadians:t.map(fa),altitudeRadians:y,shadowColor:h,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let nd;var Wp={get paint(){return nd=nd||new cr({"color-relief-opacity":new Mt(_e["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Zo(_e["paint_color-relief"]["color-relief-color"])})}};class gu{constructor(t,r,o,h){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(r,h)}update(t,r,o){const{width:h,height:m}=t,y=!(this.size&&this.size[0]===h&&this.size[1]===m||o),{context:x}=this,{gl:v}=x;if(this.useMipmap=!!(r&&r.useMipmap),v.bindTexture(v.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!r||r.premultiply!==!1)),y)this.size=[h,m],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||An(t)?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,h,m,0,this.format,v.UNSIGNED_BYTE,t.data);else{const{x:M,y:k}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||An(t)?v.texSubImage2D(v.TEXTURE_2D,0,M,k,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,M,k,h,m,v.RGBA,v.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&v.generateMipmap(v.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,o){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),o!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=m.LINEAR),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,o||t),this.filter=t),r!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,r),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class yu{constructor(t,r,o,h=1,m=1,y=1,x=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void zi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const v=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=m,this.blueFactor=y,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<v;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(v,M)]=this.data[this._idx(v-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,v)]=this.data[this._idx(M,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<v;M++)for(let k=0;k<v;k++){const P=this.get(M,k);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,r){const o=new Uint8Array(this.data.buffer),h=4*this._idx(t,r);return this.unpack(o[h],o[h+1],o[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,o){return t*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return br(t,this.getUnpackVector())}getPixels(){return new Nn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,m=r*this.dim+this.dim,y=o*this.dim,x=o*this.dim+this.dim;switch(r){case-1:h=m-1;break;case 1:m=h+1}switch(o){case-1:y=x-1;break;case 1:x=y+1}const v=-r*this.dim,M=-o*this.dim;for(let k=y;k<x;k++)for(let P=h;P<m;P++)this.data[this._idx(P,k)]=t.data[this._idx(P+v,k+M)]}}function br(n,t){const r=t[0],o=t[1],h=t[2],m=t[3],y=Math.min(r,o,h),x=Math.round((n+m)/y);return{r:Math.floor(x*y/r)%256,g:Math.floor(x*y/o)%256,b:Math.floor(x*y/h)%256}}_t("DEMData",yu);class jf extends on{constructor(t,r){super(t,Wp,r)}_createColorRamp(t){const r={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Rn&&o._styleExpression.expression instanceof zn){this.colorRampExpression=o;const y=o._styleExpression.expression;r.elevationStops=y.labels,r.colorStops=[];for(const x of r.elevationStops)r.colorStops.push(y.evaluate({globals:{elevation:x}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[ti.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;const h={elevationStops:[],colorStops:[]},m=(r.elevationStops.length-1)/(t-1);for(let y=0;y<r.elevationStops.length-.5;y+=m)h.elevationStops.push(r.elevationStops[Math.round(y)]),h.colorStops.push(r.colorStops[Math.round(y)]);return zi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(r),m=new Nn({width:h.colorStops.length,height:1}),y=new Nn({width:h.colorStops.length,height:1});for(let x=0;x<h.elevationStops.length;x++){const v=br(h.elevationStops[x],o);y.setPixel(0,x,new ti(v.r/255,v.g/255,v.b/255,1)),m.setPixel(0,x,h.colorStops[x])}return this.colorRampTextures={elevationTexture:new gu(t,y,t.gl.RGBA),colorTexture:new gu(t,m,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Of=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yp}=Of;function Pl(n,t,r){const o=r.patternDependencies;let h=!1;for(const m of t){const y=m.paint.get(`${n}-pattern`);y.isConstant()||(h=!0);const x=y.constantOr(null);x&&(h=!0,o[x.to]=!0,o[x.from]=!0)}return h}function fo(n,t,r,o,h){const{zoom:m}=o,y=h.patternDependencies;for(const x of t){const v=x.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let M=v.evaluate({zoom:m-1},r,{},h.availableImages),k=v.evaluate({zoom:m},r,{},h.availableImages),P=v.evaluate({zoom:m+1},r,{},h.availableImages);M=M&&M.name?M.name:M,k=k&&k.name?k.name:k,P=P&&P.name?P.name:P,y[M]=!0,y[k]=!0,y[P]=!0,r.patterns[x.id]={min:M,mid:k,max:P}}}return r}function Xd(n,t,r,o,h){let m;if(h===(function(y,x,v,M){let k=0;for(let P=x,B=v-M;P<v;P+=M)k+=(y[B]-y[P])*(y[P+1]+y[B+1]),B=P;return k})(n,t,r,o)>0)for(let y=t;y<r;y+=o)m=Jd(y/o|0,n[y],n[y+1],m);else for(let y=r-o;y>=t;y-=o)m=Jd(y/o|0,n[y],n[y+1],m);return m&&_u(m,m.next)&&(xu(m),m=m.next),m}function Dl(n,t){if(!n)return n;t||(t=n);let r,o=n;do if(r=!1,o.steiner||!_u(o,o.next)&&Ti(o.prev,o,o.next)!==0)o=o.next;else{if(xu(o),o=t=o.prev,o===o.next)break;r=!0}while(r||o!==t);return t}function Qo(n,t,r,o,h,m,y){if(!n)return;!y&&m&&(function(v,M,k,P){let B=v;do B.z===0&&(B.z=sd(B.x,B.y,M,k,P)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==v);B.prevZ.nextZ=null,B.prevZ=null,(function(U){let V,q=1;do{let Y,ae=U;U=null;let Ce=null;for(V=0;ae;){V++;let ue=ae,me=0;for(let Ue=0;Ue<q&&(me++,ue=ue.nextZ,ue);Ue++);let je=q;for(;me>0||je>0&&ue;)me!==0&&(je===0||!ue||ae.z<=ue.z)?(Y=ae,ae=ae.nextZ,me--):(Y=ue,ue=ue.nextZ,je--),Ce?Ce.nextZ=Y:U=Y,Y.prevZ=Ce,Ce=Y;ae=ue}Ce.nextZ=null,q*=2}while(V>1)})(B)})(n,o,h,m);let x=n;for(;n.prev!==n.next;){const v=n.prev,M=n.next;if(m?Kp(n,o,h,m):mo(n))t.push(v.i,n.i,M.i),xu(n),n=M.next,x=M.next;else if((n=M)===x){y?y===1?Qo(n=Wd(Dl(n),t),t,r,o,h,m,2):y===2&&Qp(n,t,r,o,h,m):Qo(Dl(n),t,r,o,h,m,1);break}}}function mo(n){const t=n.prev,r=n,o=n.next;if(Ti(t,r,o)>=0)return!1;const h=t.x,m=r.x,y=o.x,x=t.y,v=r.y,M=o.y,k=Math.min(h,m,y),P=Math.min(x,v,M),B=Math.max(h,m,y),U=Math.max(x,v,M);let V=o.next;for(;V!==t;){if(V.x>=k&&V.x<=B&&V.y>=P&&V.y<=U&&bc(h,x,m,v,y,M,V.x,V.y)&&Ti(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function Kp(n,t,r,o){const h=n.prev,m=n,y=n.next;if(Ti(h,m,y)>=0)return!1;const x=h.x,v=m.x,M=y.x,k=h.y,P=m.y,B=y.y,U=Math.min(x,v,M),V=Math.min(k,P,B),q=Math.max(x,v,M),Y=Math.max(k,P,B),ae=sd(U,V,t,r,o),Ce=sd(q,Y,t,r,o);let ue=n.prevZ,me=n.nextZ;for(;ue&&ue.z>=ae&&me&&me.z<=Ce;){if(ue.x>=U&&ue.x<=q&&ue.y>=V&&ue.y<=Y&&ue!==h&&ue!==y&&bc(x,k,v,P,M,B,ue.x,ue.y)&&Ti(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,me.x>=U&&me.x<=q&&me.y>=V&&me.y<=Y&&me!==h&&me!==y&&bc(x,k,v,P,M,B,me.x,me.y)&&Ti(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;ue&&ue.z>=ae;){if(ue.x>=U&&ue.x<=q&&ue.y>=V&&ue.y<=Y&&ue!==h&&ue!==y&&bc(x,k,v,P,M,B,ue.x,ue.y)&&Ti(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;me&&me.z<=Ce;){if(me.x>=U&&me.x<=q&&me.y>=V&&me.y<=Y&&me!==h&&me!==y&&bc(x,k,v,P,M,B,me.x,me.y)&&Ti(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function Wd(n,t){let r=n;do{const o=r.prev,h=r.next.next;!_u(o,h)&&Qd(o,r,r.next,h)&&Mn(o,h)&&Mn(h,o)&&(t.push(o.i,r.i,h.i),xu(r),xu(r.next),r=n=h),r=r.next}while(r!==n);return Dl(r)}function Qp(n,t,r,o,h,m){let y=n;do{let x=y.next.next;for(;x!==y.prev;){if(y.i!==x.i&&Jp(y,x)){let v=go(y,x);return y=Dl(y,y.next),v=Dl(v,v.next),Qo(y,t,r,o,h,m,0),void Qo(v,t,r,o,h,m,0)}x=x.next}y=y.next}while(y!==n)}function Yd(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function Kd(n,t){const r=(function(h,m){let y=m;const x=h.x,v=h.y;let M,k=-1/0;if(_u(h,y))return y;do{if(_u(h,y.next))return y.next;if(v<=y.y&&v>=y.next.y&&y.next.y!==y.y){const q=y.x+(v-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(q<=x&&q>k&&(k=q,M=y.x<y.next.x?y:y.next,q===x))return M}y=y.next}while(y!==m);if(!M)return null;const P=M,B=M.x,U=M.y;let V=1/0;y=M;do{if(x>=y.x&&y.x>=B&&x!==y.x&&Jr(v<U?x:k,v,B,U,v<U?k:x,v,y.x,y.y)){const q=Math.abs(v-y.y)/(x-y.x);Mn(y,h)&&(q<V||q===V&&(y.x>M.x||y.x===M.x&&ad(M,y)))&&(M=y,V=q)}y=y.next}while(y!==P);return M})(n,t);if(!r)return t;const o=go(r,n);return Dl(o,o.next),Dl(r,r.next)}function ad(n,t){return Ti(n.prev,n,t.prev)<0&&Ti(t.next,n,n.next)<0}function sd(n,t,r,o,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jo(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function Jr(n,t,r,o,h,m,y,x){return(h-y)*(t-x)>=(n-y)*(m-x)&&(n-y)*(o-x)>=(r-y)*(t-x)&&(r-y)*(m-x)>=(h-y)*(o-x)}function bc(n,t,r,o,h,m,y,x){return!(n===y&&t===x)&&Jr(n,t,r,o,h,m,y,x)}function Jp(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(r,o){let h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==o.i&&h.next.i!==o.i&&Qd(h,h.next,r,o))return!0;h=h.next}while(h!==r);return!1})(n,t)&&(Mn(n,t)&&Mn(t,n)&&(function(r,o){let h=r,m=!1;const y=(r.x+o.x)/2,x=(r.y+o.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&y<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==r);return m})(n,t)&&(Ti(n.prev,n,t.prev)||Ti(n,t.prev,t))||_u(n,t)&&Ti(n.prev,n,n.next)>0&&Ti(t.prev,t,t.next)>0)}function Ti(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function _u(n,t){return n.x===t.x&&n.y===t.y}function Qd(n,t,r,o){const h=xr(Ti(n,t,r)),m=xr(Ti(n,t,o)),y=xr(Ti(r,o,n)),x=xr(Ti(r,o,t));return h!==m&&y!==x||!(h!==0||!ph(n,r,t))||!(m!==0||!ph(n,o,t))||!(y!==0||!ph(r,n,o))||!(x!==0||!ph(r,t,o))}function ph(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function xr(n){return n>0?1:n<0?-1:0}function Mn(n,t){return Ti(n.prev,n,n.next)<0?Ti(n,t,n.next)>=0&&Ti(n,n.prev,t)>=0:Ti(n,t,n.prev)<0||Ti(n,n.next,t)<0}function go(n,t){const r=od(n.i,n.x,n.y),o=od(t.i,t.x,t.y),h=n.next,m=t.prev;return n.next=t,t.prev=n,r.next=h,h.prev=r,o.next=r,r.prev=o,m.next=o,o.prev=m,o}function Jd(n,t,r,o){const h=od(n,t,r);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function xu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function od(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class vu{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class wc{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}wc.noSubdivision=new wc({fill:new vu(0,0),line:new vu(0,0),tile:new vu(0,0),stencil:new vu(0,0),circle:1}),_t("SubdivisionGranularityExpression",vu),_t("SubdivisionGranularitySetting",wc);const mn=-32768,la=32767;class ef{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=At/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),h=0|Math.round(r),m=this._getKey(o,h);if(this._vertexDictionary.has(m))return this._vertexDictionary.get(m);const y=this._vertexBuffer.length/2;return this._vertexDictionary.set(m,y),this._vertexBuffer.push(o,h),y}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(h,m){const y=[];for(let x=0;x<m.length;x+=3){const v=m[x],M=m[x+1],k=m[x+2],P=h[2*v],B=h[2*v+1];(h[2*M]-P)*(h[2*k+1]-B)-(h[2*M+1]-B)*(h[2*k]-P)>0?(y.push(v),y.push(k),y.push(M)):(y.push(v),y.push(M),y.push(k))}return y})(this._vertexBuffer,t);const r=[],o=t.length;for(let h=0;h<o;h+=3){const m=[t[h+0],t[h+1],t[h+2]],y=[this._vertexBuffer[2*t[h+0]+0],this._vertexBuffer[2*t[h+0]+1],this._vertexBuffer[2*t[h+1]+0],this._vertexBuffer[2*t[h+1]+1],this._vertexBuffer[2*t[h+2]+0],this._vertexBuffer[2*t[h+2]+1]];let x=1/0,v=1/0,M=-1/0,k=-1/0;for(let q=0;q<3;q++){const Y=y[2*q],ae=y[2*q+1];x=Math.min(x,Y),M=Math.max(M,Y),v=Math.min(v,ae),k=Math.max(k,ae)}if(x===M||v===k)continue;const P=Math.floor(x/this._granularityCellSize),B=Math.ceil(M/this._granularityCellSize),U=Math.floor(v/this._granularityCellSize),V=Math.ceil(k/this._granularityCellSize);if(P!==B||U!==V)for(let q=U;q<V;q++){const Y=this._scanlineGenerateVertexRingForCellRow(q,y,m);el(this._vertexBuffer,Y,r)}else r.push(...m)}return r}_scanlineGenerateVertexRingForCellRow(t,r,o){const h=t*this._granularityCellSize,m=h+this._granularityCellSize,y=[];for(let x=0;x<3;x++){const v=r[2*x],M=r[2*x+1],k=r[2*(x+1)%6],P=r[(2*(x+1)+1)%6],B=r[2*(x+2)%6],U=r[(2*(x+2)+1)%6],V=k-v,q=P-M,Y=V===0,ae=q===0,Ce=(h-M)/q,ue=(m-M)/q,me=Math.min(Ce,ue),je=Math.max(Ce,ue);if(!ae&&(me>=1||je<=0)||ae&&(M<h||M>m)){P>=h&&P<=m&&y.push(o[(x+1)%3]);continue}!ae&&me>0&&y.push(this._vertexToIndex(v+V*me,M+q*me));const Ue=v+V*Math.max(me,0),it=v+V*Math.min(je,1);Y||this._generateIntraEdgeVertices(y,v,M,k,P,Ue,it),!ae&&je<1&&y.push(this._vertexToIndex(v+V*je,M+q*je)),(ae||P>=h&&P<=m)&&y.push(o[(x+1)%3]),!ae&&(P<=h||P>=m)&&this._generateInterEdgeVertices(y,v,M,k,P,B,U,it,h,m)}return y}_generateIntraEdgeVertices(t,r,o,h,m,y,x){const v=h-r,M=m-o,k=M===0,P=k?Math.min(r,h):Math.min(y,x),B=k?Math.max(r,h):Math.max(y,x),U=Math.floor(P/this._granularityCellSize)+1,V=Math.ceil(B/this._granularityCellSize)-1;if(k?r<h:y<x)for(let q=U;q<=V;q++){const Y=q*this._granularityCellSize;t.push(this._vertexToIndex(Y,o+M*(Y-r)/v))}else for(let q=V;q>=U;q--){const Y=q*this._granularityCellSize;t.push(this._vertexToIndex(Y,o+M*(Y-r)/v))}}_generateInterEdgeVertices(t,r,o,h,m,y,x,v,M,k){const P=m-o,B=y-h,U=x-m,V=(M-m)/U,q=(k-m)/U,Y=Math.min(V,q),ae=Math.max(V,q),Ce=h+B*Y;let ue=Math.floor(Math.min(Ce,v)/this._granularityCellSize)+1,me=Math.ceil(Math.max(Ce,v)/this._granularityCellSize)-1,je=v<Ce;const Ue=U===0;if(Ue&&(x===M||x===k))return;if(Ue||Y>=1||ae<=0){const mt=o-x,lt=y+(r-y)*Math.min((M-x)/mt,(k-x)/mt);ue=Math.floor(Math.min(lt,v)/this._granularityCellSize)+1,me=Math.ceil(Math.max(lt,v)/this._granularityCellSize)-1,je=v<lt}const it=P>0?k:M;if(je)for(let mt=ue;mt<=me;mt++)t.push(this._vertexToIndex(mt*this._granularityCellSize,it));else for(let mt=me;mt>=ue;mt--)t.push(this._vertexToIndex(mt*this._granularityCellSize,it))}_generateOutline(t){const r=[];for(const o of t){const h=Rl(o,this._granularity,!0),m=this._pointArrayToIndices(h),y=[];for(let x=1;x<m.length;x++)y.push(m[x-1]),y.push(m[x]);r.push(y)}return r}_handlePoles(t){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(t,r,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const o=t[r+1];o===mn&&(t[r+1]=-32767),o===la&&(t[r+1]=32766)}}_generatePoleQuad(t,r,o,h,m,y){h>m!=(y===mn)?(t.push(r),t.push(o),t.push(this._vertexToIndex(h,y)),t.push(o),t.push(this._vertexToIndex(m,y)),t.push(this._vertexToIndex(h,y))):(t.push(o),t.push(r),t.push(this._vertexToIndex(h,y)),t.push(this._vertexToIndex(m,y)),t.push(o),t.push(this._vertexToIndex(h,y)))}_fillPoles(t,r,o){const h=this._vertexBuffer,m=At,y=t.length;for(let x=2;x<y;x+=3){const v=t[x-2],M=t[x-1],k=t[x],P=h[2*v],B=h[2*v+1],U=h[2*M],V=h[2*M+1],q=h[2*k],Y=h[2*k+1];r&&(B===0&&V===0&&this._generatePoleQuad(t,v,M,P,U,mn),V===0&&Y===0&&this._generatePoleQuad(t,M,k,U,q,mn),Y===0&&B===0&&this._generatePoleQuad(t,k,v,q,P,mn)),o&&(B===m&&V===m&&this._generatePoleQuad(t,v,M,P,U,la),V===m&&Y===m&&this._generatePoleQuad(t,M,k,U,q,la),Y===m&&B===m&&this._generatePoleQuad(t,k,v,q,P,la))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:h}=(function(x){const v=[],M=[];for(const k of x)if(k.length!==0){k!==x[0]&&v.push(M.length/2);for(let P=0;P<k.length;P++)M.push(k[P].x),M.push(k[P].y)}return{flattened:M,holeIndices:v}})(t);let m;this._initializeVertices(o);try{const x=(function(M,k,P=2){const B=k&&k.length,U=B?k[0]*P:M.length;let V=Xd(M,0,U,P,!0);const q=[];if(!V||V.next===V.prev)return q;let Y,ae,Ce;if(B&&(V=(function(ue,me,je,Ue){const it=[];for(let mt=0,lt=me.length;mt<lt;mt++){const pt=Xd(ue,me[mt]*Ue,mt<lt-1?me[mt+1]*Ue:ue.length,Ue,!1);pt===pt.next&&(pt.steiner=!0),it.push(Jo(pt))}it.sort(Yd);for(let mt=0;mt<it.length;mt++)je=Kd(it[mt],je);return je})(M,k,V,P)),M.length>80*P){Y=M[0],ae=M[1];let ue=Y,me=ae;for(let je=P;je<U;je+=P){const Ue=M[je],it=M[je+1];Ue<Y&&(Y=Ue),it<ae&&(ae=it),Ue>ue&&(ue=Ue),it>me&&(me=it)}Ce=Math.max(ue-Y,me-ae),Ce=Ce!==0?32767/Ce:0}return Qo(V,q,P,Y,ae,Ce,0),q})(o,h),v=this._convertIndices(o,x);m=this._subdivideTrianglesScanline(v)}catch(x){console.error(x)}let y=[];return r&&(y=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(m),{verticesFlattened:this._vertexBuffer,indicesTriangles:m,indicesLineList:y}}_convertIndices(t,r){const o=[];for(let h=0;h<r.length;h++)o.push(this._vertexToIndex(t[2*r[h]],t[2*r[h]+1]));return o}_pointArrayToIndices(t){const r=[];for(let o=0;o<t.length;o++){const h=t[o];r.push(this._vertexToIndex(h.x,h.y))}return r}}function ca(n,t,r,o=!0){return new ef(r,t).subdividePolygonInternal(n,o)}function Rl(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],h=n[n.length-1],m=r&&(o.x!==h.x||o.y!==h.y);if(t<2)return m?[...n,n[0]]:[...n];const y=Math.floor(At/t),x=[];x.push(new W(n[0].x,n[0].y));const v=n.length,M=m?v:v-1;for(let k=0;k<M;k++){const P=n[k],B=k<v-1?n[k+1]:n[0],U=P.x,V=P.y,q=B.x,Y=B.y,ae=U!==q,Ce=V!==Y;if(!ae&&!Ce)continue;const ue=q-U,me=Y-V,je=Math.abs(ue),Ue=Math.abs(me);let it=U,mt=V;for(;;){const pt=ue>0?(Math.floor(it/y)+1)*y:(Math.ceil(it/y)-1)*y,It=me>0?(Math.floor(mt/y)+1)*y:(Math.ceil(mt/y)-1)*y,ut=Math.abs(it-pt),ft=Math.abs(mt-It),We=Math.abs(it-q),Ut=Math.abs(mt-Y),Qt=ae?ut/je:Number.POSITIVE_INFINITY,Lt=Ce?ft/Ue:Number.POSITIVE_INFINITY;if((We<=ut||!ae)&&(Ut<=ft||!Ce))break;if(Qt<Lt&&ae||!Ce){it=pt,mt+=me*Qt;const Ct=new W(it,Math.round(mt));x[x.length-1].x===Ct.x&&x[x.length-1].y===Ct.y||x.push(Ct)}else{it+=ue*Lt,mt=It;const Ct=new W(Math.round(it),mt);x[x.length-1].x===Ct.x&&x[x.length-1].y===Ct.y||x.push(Ct)}}const lt=new W(q,Y);x[x.length-1].x===lt.x&&x[x.length-1].y===lt.y||x.push(lt)}return x}function el(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,h=n[2*t[0]];for(let v=1;v<t.length;v++){const M=n[2*t[v]];M<h&&(h=M,o=v)}const m=t.length;let y=o,x=(y+1)%m;for(;;){const v=y-1>=0?y-1:m-1,M=(x+1)%m,k=n[2*t[v]],P=n[2*t[M]],B=n[2*t[y]],U=n[2*t[y]+1],V=n[2*t[x]+1];let q=!1;if(k<P)q=!0;else if(k>P)q=!1;else{const Y=V-U,ae=-(n[2*t[x]]-B),Ce=U<V?1:-1;((k-B)*Y+(n[2*t[v]+1]-U)*ae)*Ce>((P-B)*Y+(n[2*t[M]+1]-U)*ae)*Ce&&(q=!0)}if(q){const Y=t[v],ae=t[y],Ce=t[x];Y!==ae&&Y!==Ce&&ae!==Ce&&r.push(Ce,ae,Y),y--,y<0&&(y=m-1)}else{const Y=t[M],ae=t[y],Ce=t[x];Y!==ae&&Y!==Ce&&ae!==Ce&&r.push(Ce,ae,Y),x++,x>=m&&(x=0)}if(v===M)break}}function Ll(n,t,r,o,h,m,y,x,v){const M=h.length/2,k=y&&x&&v;if(M<ci.MAX_VERTEX_ARRAY_LENGTH){const P=t.prepareSegment(M,r,o),B=P.vertexLength;for(let q=0;q<m.length;q+=3)o.emplaceBack(B+m[q],B+m[q+1],B+m[q+2]);let U,V;P.vertexLength+=M,P.primitiveLength+=m.length/3,k&&(V=y.prepareSegment(M,r,x),U=V.vertexLength,V.vertexLength+=M);for(let q=0;q<h.length;q+=2)n(h[q],h[q+1]);if(k)for(let q=0;q<v.length;q++){const Y=v[q];for(let ae=1;ae<Y.length;ae+=2)x.emplaceBack(U+Y[ae-1],U+Y[ae]);V.primitiveLength+=Y.length/2}}else(function(P,B,U,V,q,Y){const ae=[];for(let Ue=0;Ue<V.length/2;Ue++)ae.push(-1);const Ce={count:0};let ue=0,me=P.getOrCreateLatestSegment(B,U),je=me.vertexLength;for(let Ue=2;Ue<q.length;Ue+=3){const it=q[Ue-2],mt=q[Ue-1],lt=q[Ue];let pt=ae[it]<ue,It=ae[mt]<ue,ut=ae[lt]<ue;me.vertexLength+((pt?1:0)+(It?1:0)+(ut?1:0))>ci.MAX_VERTEX_ARRAY_LENGTH&&(me=P.createNewSegment(B,U),ue=Ce.count,pt=!0,It=!0,ut=!0,je=0);const ft=Qa(ae,V,Y,Ce,it,pt,me),We=Qa(ae,V,Y,Ce,mt,It,me),Ut=Qa(ae,V,Y,Ce,lt,ut,me);U.emplaceBack(je+ft-ue,je+We-ue,je+Ut-ue),me.primitiveLength++}})(t,r,o,h,m,n),k&&(function(P,B,U,V,q,Y){const ae=[];for(let Ue=0;Ue<V.length/2;Ue++)ae.push(-1);const Ce={count:0};let ue=0,me=P.getOrCreateLatestSegment(B,U),je=me.vertexLength;for(let Ue=0;Ue<q.length;Ue++){const it=q[Ue];for(let mt=1;mt<q[Ue].length;mt+=2){const lt=it[mt-1],pt=it[mt];let It=ae[lt]<ue,ut=ae[pt]<ue;me.vertexLength+((It?1:0)+(ut?1:0))>ci.MAX_VERTEX_ARRAY_LENGTH&&(me=P.createNewSegment(B,U),ue=Ce.count,It=!0,ut=!0,je=0);const ft=Qa(ae,V,Y,Ce,lt,It,me),We=Qa(ae,V,Y,Ce,pt,ut,me);U.emplaceBack(je+ft-ue,je+We-ue),me.primitiveLength++}}})(y,r,x,h,v,n),t.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function Qa(n,t,r,o,h,m,y){if(m){const x=o.count;return r(t[2*h],t[2*h+1]),n[h]=o.count,o.count++,y.vertexLength++,x}return n[h]}class fh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ge,this.indexArray=new Wt,this.indexArray2=new Ai,this.programConfigurations=new ps(t.layers,t.zoom),this.segments=new ci,this.segments2=new ci,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,o){this.hasDependencies=Pl("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),m=!h.isConstant(),y=[];for(const{feature:x,id:v,index:M,sourceLayerIndex:k}of t){const P=this.layers[0]._featureFilter.needGeometry,B=Ka(x,P);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),B,o))continue;const U=m?h.evaluate(B,{},o,r.availableImages):void 0,V={id:v,properties:x.properties,type:x.type,sourceLayerIndex:k,index:M,geometry:P?B.geometry:fs(x),patterns:{},sortKey:U};y.push(V)}m&&y.sort(((x,v)=>x.sortKey-v.sortKey));for(const x of y){const{geometry:v,index:M,sourceLayerIndex:k}=x;if(this.hasDependencies){const P=fo("fill",this.layers,x,{zoom:this.zoom},r);this.patternFeatures.push(P)}else this.addFeature(x,v,M,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[M].feature,v,M,k,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,r,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,o,h,m,y){for(const x of Po(r,500)){const v=ca(x,h,y.fill.getGranularityForZoomLevel(h.z)),M=this.layoutVertexArray;Ll(((k,P)=>{M.emplaceBack(k,P)}),this.segments,this.layoutVertexArray,this.indexArray,v.verticesFlattened,v.indicesTriangles,this.segments2,this.indexArray2,v.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:m,canonical:h})}}let ld,ms;_t("FillBucket",fh,{omit:["layers","patternFeatures"]});var tf={get paint(){return ms=ms||new cr({"fill-antialias":new Mt(_e.paint_fill["fill-antialias"]),"fill-opacity":new Nt(_e.paint_fill["fill-opacity"]),"fill-color":new Nt(_e.paint_fill["fill-color"]),"fill-outline-color":new Nt(_e.paint_fill["fill-outline-color"]),"fill-translate":new Mt(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new Mt(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Go(_e.paint_fill["fill-pattern"])})},get layout(){return ld=ld||new cr({"fill-sort-key":new Nt(_e.layout_fill["fill-sort-key"])})}};class bu extends on{constructor(t,r){super(t,tf,r)}recalculate(t,r){super.recalculate(t,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new fh(t)}queryRadius(){return oh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:o,pixelsToTileUnits:h}){return Jh(Il(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,h),r)}isTileClipped(){return!0}}const mh=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),gh=Gi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:wu}=mh;class Sc{constructor(t,r,o,h,m){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=m,t.readFields(rf,this,r)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos,o=[];let h,m=1,y=0,x=0,v=0;for(;t.pos<r;){if(y<=0){const M=t.readVarint();m=7&M,y=M>>3}if(y--,m===1||m===2)x+=t.readSVarint(),v+=t.readSVarint(),m===1&&(h&&o.push(h),h=[]),h&&h.push(new W(x,v));else{if(m!==7)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&o.push(h),o}bbox(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos;let o=1,h=0,m=0,y=0,x=1/0,v=-1/0,M=1/0,k=-1/0;for(;t.pos<r;){if(h<=0){const P=t.readVarint();o=7&P,h=P>>3}if(h--,o===1||o===2)m+=t.readSVarint(),y+=t.readSVarint(),m<x&&(x=m),m>v&&(v=m),y<M&&(M=y),y>k&&(k=y);else if(o!==7)throw new Error(`unknown command ${o}`)}return[x,M,v,k]}toGeoJSON(t,r,o){const h=this.extent*Math.pow(2,o),m=this.extent*t,y=this.extent*r,x=this.loadGeometry();function v(B){return[360*(B.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(B.y+y)/h)*Math.PI))-90]}function M(B){return B.map(v)}let k;if(this.type===1){const B=[];for(const V of x)B.push(V[0]);const U=M(B);k=B.length===1?{type:"Point",coordinates:U[0]}:{type:"MultiPoint",coordinates:U}}else if(this.type===2){const B=x.map(M);k=B.length===1?{type:"LineString",coordinates:B[0]}:{type:"MultiLineString",coordinates:B}}else{if(this.type!==3)throw new Error("unknown feature type");{const B=(function(V){const q=V.length;if(q<=1)return[V];const Y=[];let ae,Ce;for(let ue=0;ue<q;ue++){const me=yh(V[ue]);me!==0&&(Ce===void 0&&(Ce=me<0),Ce===me<0?(ae&&Y.push(ae),ae=[V[ue]]):ae&&ae.push(V[ue]))}return ae&&Y.push(ae),Y})(x),U=[];for(const V of B)U.push(V.map(M));k=U.length===1?{type:"Polygon",coordinates:U[0]}:{type:"MultiPolygon",coordinates:U}}}const P={type:"Feature",geometry:k,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function rf(n,t,r){n===1?t.id=r.readVarint():n===2?(function(o,h){const m=o.readVarint()+o.pos;for(;o.pos<m;){const y=h._keys[o.readVarint()],x=h._values[o.readVarint()];h.properties[y]=x}})(r,t):n===3?t.type=r.readVarint():n===4&&(t._geometry=r.pos)}function yh(n){let t=0;for(let r,o,h=0,m=n.length,y=m-1;h<m;y=h++)r=n[h],o=n[y],t+=(o.x-r.x)*(r.y+o.y);return t}Sc.types=["Unknown","Point","LineString","Polygon"];class ep{constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(cd,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const r=this._pbf.readVarint()+this._pbf.pos;return new Sc(this._pbf,r,this.extent,this._keys,this._values)}}function cd(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push((function(o){let h=null;const m=o.readVarint()+o.pos;for(;o.pos<m;){const y=o.readVarint()>>3;h=y===1?o.readString():y===2?o.readFloat():y===3?o.readDouble():y===4?o.readVarint64():y===5?o.readVarint():y===6?o.readSVarint():y===7?o.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(r))}class tp{constructor(t,r){this.layers=t.readFields(Bf,{},r)}}function Bf(n,t,r){if(n===3){const o=new ep(r,r.readVarint()+r.pos);o.length&&(t[o.name]=o)}}const ip=Math.pow(2,13);function Oi(n,t,r,o,h,m,y,x){n.emplaceBack(t,r,2*Math.floor(o*ip)+y,h*ip*2,m*ip*2,Math.round(x))}class hr{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new ce,this.centroidVertexArray=new se,this.indexArray=new Wt,this.programConfigurations=new ps(t.layers,t.zoom),this.segments=new ci,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,o){this.features=[],this.hasDependencies=Pl("fill-extrusion",this.layers,r);for(const{feature:h,id:m,index:y,sourceLayerIndex:x}of t){const v=this.layers[0]._featureFilter.needGeometry,M=Ka(h,v);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),M,o))continue;const k={id:m,sourceLayerIndex:x,index:y,geometry:v?M.geometry:fs(h),properties:h.properties,type:h.type,patterns:{}};this.hasDependencies?this.features.push(fo("fill-extrusion",this.layers,k,{zoom:this.zoom},r)):this.addFeature(k,k.geometry,y,o,{},r.subdivisionGranularity),r.featureIndex.insert(h,k.geometry,y,x,this.index,!0)}}addFeatures(t,r,o){for(const h of this.features){const{geometry:m}=h;this.addFeature(h,m,h.index,r,o,t.subdivisionGranularity)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,wu),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,gh.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,o,h,m,y){for(const x of Po(r,500)){const v={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(v,h,t,x,y);const k=this.layoutVertexArray.length-M,P=Math.floor(v.x/v.sampleCount),B=Math.floor(v.y/v.sampleCount);for(let U=0;U<k;U++)this.centroidVertexArray.emplaceBack(P,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:m,canonical:h})}processPolygon(t,r,o,h,m){if(h.length<1||rr(h[0]))return;for(const P of h)P.length!==0&&Pi(t,P);const y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=m.fill.getGranularityForZoomLevel(r.z),v=Sc.types[o.type]==="Polygon";for(const P of h){if(P.length===0||rr(P))continue;const B=Rl(P,x,v);this._generateSideFaces(B,y)}if(!v)return;const M=ca(h,r,x,!1),k=this.layoutVertexArray;Ll(((P,B)=>{Oi(k,P,B,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(t,r){let o=0;for(let h=1;h<t.length;h++){const m=t[h],y=t[h-1];if(ji(m,y))continue;r.segment.vertexLength+4>ci.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const x=m.sub(y)._perp()._unit(),v=y.dist(m);o+v>32768&&(o=0),Oi(this.layoutVertexArray,m.x,m.y,x.x,x.y,0,0,o),Oi(this.layoutVertexArray,m.x,m.y,x.x,x.y,0,1,o),o+=v,Oi(this.layoutVertexArray,y.x,y.y,x.x,x.y,0,0,o),Oi(this.layoutVertexArray,y.x,y.y,x.x,x.y,0,1,o);const M=r.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Pi(n,t){for(let r=0;r<t.length;r++){const o=t[r];r===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function ji(n,t){return n.x===t.x&&(n.x<0||n.x>At)||n.y===t.y&&(n.y<0||n.y>At)}function rr(n){return n.every((t=>t.x<0))||n.every((t=>t.x>At))||n.every((t=>t.y<0))||n.every((t=>t.y>At))}let Ma;_t("FillExtrusionBucket",hr,{omit:["layers","features"]});var jl={get paint(){return Ma=Ma||new cr({"fill-extrusion-opacity":new Mt(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Nt(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mt(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mt(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Go(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Nt(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Nt(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Mt(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Su extends on{constructor(t,r){super(t,jl,r)}createBucket(t){return new hr(t)}queryRadius(){return oh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:h,transform:m,pixelsToTileUnits:y,pixelPosMatrix:x}){const v=Il(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-m.bearingInRadians,y),M=this.paint.get("fill-extrusion-height").evaluate(r,o),k=this.paint.get("fill-extrusion-base").evaluate(r,o),P=(function(U,V){const q=[];for(const Y of U){const ae=[Y.x,Y.y,0,1];Kt(ae,ae,V),q.push(new W(ae[0]/ae[3],ae[1]/ae[3]))}return q})(v,x),B=(function(U,V,q,Y){const ae=[],Ce=[],ue=Y[8]*V,me=Y[9]*V,je=Y[10]*V,Ue=Y[11]*V,it=Y[8]*q,mt=Y[9]*q,lt=Y[10]*q,pt=Y[11]*q;for(const It of U){const ut=[],ft=[];for(const We of It){const Ut=We.x,Qt=We.y,Lt=Y[0]*Ut+Y[4]*Qt+Y[12],Ct=Y[1]*Ut+Y[5]*Qt+Y[13],fi=Y[2]*Ut+Y[6]*Qt+Y[14],pr=Y[3]*Ut+Y[7]*Qt+Y[15],Or=fi+je,yn=pr+Ue,da=Lt+it,Gr=Ct+mt,wr=fi+lt,Zi=pr+pt,Pr=new W((Lt+ue)/yn,(Ct+me)/yn);Pr.z=Or/yn,ut.push(Pr);const Br=new W(da/Zi,Gr/Zi);Br.z=wr/Zi,ft.push(Br)}ae.push(ut),Ce.push(ft)}return[ae,Ce]})(h,k,M,x);return(function(U,V,q){let Y=1/0;Jh(q,V)&&(Y=yo(q,V[0]));for(let ae=0;ae<V.length;ae++){const Ce=V[ae],ue=U[ae];for(let me=0;me<Ce.length-1;me++){const je=Ce[me],Ue=[je,Ce[me+1],ue[me+1],ue[me],je];nh(q,Ue)&&(Y=Math.min(Y,yo(q,Ue)))}}return Y!==1/0&&Y})(B[0],B[1],P)}}function Tc(n,t){return n.x*t.x+n.y*t.y}function yo(n,t){if(n.length===1){let r=0;const o=t[r++];let h;for(;!h||o.equals(h);)if(h=t[r++],!h)return 1/0;for(;r<t.length;r++){const m=t[r],y=n[0],x=h.sub(o),v=m.sub(o),M=y.sub(o),k=Tc(x,x),P=Tc(x,v),B=Tc(v,v),U=Tc(M,x),V=Tc(M,v),q=k*B-P*P,Y=(B*U-P*V)/q,ae=(k*V-P*U)/q,Ce=o.z*(1-Y-ae)+h.z*Y+m.z*ae;if(isFinite(Ce))return Ce}return 1/0}{let r=1/0;for(const o of t)r=Math.min(r,o.z);return r}}const Vr=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ol}=Vr,Mc=Gi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rp}=Mc,Ja=Math.cos(Math.PI/180*37.5),kc=Math.pow(2,14)/.5;class Cc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new Te,this.layoutVertexArray2=new Oe,this.indexArray=new Wt,this.programConfigurations=new ps(t.layers,t.zoom),this.segments=new ci,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,o){this.hasDependencies=Pl("line",this.layers,r)||this.hasLineDasharray(this.layers);const h=this.layers[0].layout.get("line-sort-key"),m=!h.isConstant(),y=[];for(const{feature:x,id:v,index:M,sourceLayerIndex:k}of t){const P=this.layers[0]._featureFilter.needGeometry,B=Ka(x,P);if(!this.layers[0]._featureFilter.filter(new Vi(this.zoom),B,o))continue;const U=m?h.evaluate(B,{},o):void 0,V={id:v,properties:x.properties,type:x.type,sourceLayerIndex:k,index:M,geometry:P?B.geometry:fs(x),patterns:{},dashes:{},sortKey:U};y.push(V)}m&&y.sort(((x,v)=>x.sortKey-v.sortKey));for(const x of y){const{geometry:v,index:M,sourceLayerIndex:k}=x;this.hasDependencies?(Pl("line",this.layers,r)?fo("line",this.layers,x,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,x,this.zoom,r),this.patternFeatures.push(x)):this.addFeature(x,v,M,o,{},{},r.subdivisionGranularity),r.featureIndex.insert(t[M].feature,v,M,k,this.index)}}update(t,r,o,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,{imagePositions:o,dashPositions:h})}addFeatures(t,r,o,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,o,h,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,rp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ol),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,o,h,m,y,x){const v=this.layers[0].layout,M=v.get("line-join").evaluate(t,{}),k=v.get("line-cap"),P=v.get("line-miter-limit"),B=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const U of r)this.addLine(U,t,M,k,P,B,h,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:m,dashPositions:y,canonical:h})}addLine(t,r,o,h,m,y,x,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Rl(t,x?v.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<t.length-1;ue++)this.totalDistance+=t[ue].dist(t[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Sc.types[r.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let P=0;for(;P<k-1&&t[P].equals(t[P+1]);)P++;if(k<(M?3:2))return;o==="bevel"&&(m=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,U=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let V,q,Y,ae,Ce;this.e1=this.e2=-1,M&&(V=t[k-2],Ce=t[P].sub(V)._unit()._perp());for(let ue=P;ue<k;ue++){if(Y=ue===k-1?M?t[P+1]:void 0:t[ue+1],Y&&t[ue].equals(Y))continue;Ce&&(ae=Ce),V&&(q=V),V=t[ue],Ce=Y?Y.sub(V)._unit()._perp():ae,ae=ae||Ce;let me=ae.add(Ce);me.x===0&&me.y===0||me._unit();const je=ae.x*Ce.x+ae.y*Ce.y,Ue=me.x*Ce.x+me.y*Ce.y,it=Ue!==0?1/Ue:1/0,mt=2*Math.sqrt(2-2*Ue),lt=Ue<Ja&&q&&Y,pt=ae.x*Ce.y-ae.y*Ce.x>0;if(lt&&ue>P){const ft=V.dist(q);if(ft>2*B){const We=V.sub(V.sub(q)._mult(B/ft)._round());this.updateDistance(q,We),this.addCurrentVertex(We,ae,0,0,U),q=We}}const It=q&&Y;let ut=It?o:M?"butt":h;if(It&&ut==="round"&&(it<y?ut="miter":it<=2&&(ut="fakeround")),ut==="miter"&&it>m&&(ut="bevel"),ut==="bevel"&&(it>2&&(ut="flipbevel"),it<m&&(ut="miter")),q&&this.updateDistance(q,V),ut==="miter")me._mult(it),this.addCurrentVertex(V,me,0,0,U);else if(ut==="flipbevel"){if(it>100)me=Ce.mult(-1);else{const ft=it*ae.add(Ce).mag()/ae.sub(Ce).mag();me._perp()._mult(ft*(pt?-1:1))}this.addCurrentVertex(V,me,0,0,U),this.addCurrentVertex(V,me.mult(-1),0,0,U)}else if(ut==="bevel"||ut==="fakeround"){const ft=-Math.sqrt(it*it-1),We=pt?ft:0,Ut=pt?0:ft;if(q&&this.addCurrentVertex(V,ae,We,Ut,U),ut==="fakeround"){const Qt=Math.round(180*mt/Math.PI/20);for(let Lt=1;Lt<Qt;Lt++){let Ct=Lt/Qt;if(Ct!==.5){const pr=Ct-.5;Ct+=Ct*pr*(Ct-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*pr*pr+(.848013+je*(.215638*je-1.06021)))}const fi=Ce.sub(ae)._mult(Ct)._add(ae)._unit()._mult(pt?-1:1);this.addHalfVertex(V,fi.x,fi.y,!1,pt,0,U)}}Y&&this.addCurrentVertex(V,Ce,-We,-Ut,U)}else if(ut==="butt")this.addCurrentVertex(V,me,0,0,U);else if(ut==="square"){const ft=q?1:-1;this.addCurrentVertex(V,me,ft,ft,U)}else ut==="round"&&(q&&(this.addCurrentVertex(V,ae,0,0,U),this.addCurrentVertex(V,ae,1,1,U,!0)),Y&&(this.addCurrentVertex(V,Ce,-1,-1,U,!0),this.addCurrentVertex(V,Ce,0,0,U)));if(lt&&ue<k-1){const ft=V.dist(Y);if(ft>2*B){const We=V.add(Y.sub(V)._mult(B/ft)._round());this.updateDistance(V,We),this.addCurrentVertex(We,Ce,0,0,U),V=We}}}}addCurrentVertex(t,r,o,h,m,y=!1){const x=r.y*h-r.x,v=-r.y-r.x*h;this.addHalfVertex(t,r.x+r.y*o,r.y-r.x*o,y,!1,o,m),this.addHalfVertex(t,x,v,y,!0,-h,m),this.distance>kc/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,o,h,m,y))}addHalfVertex({x:t,y:r},o,h,m,y,x,v){const M=.5*(this.lineClips?this.scaledDistance*(kc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(r<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,k,this.e2),v.primitiveLength++),y?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}hasLineDasharray(t){for(const r of t){const o=r.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(t,r,o,h){for(const m of t){const y=m.paint.get("line-dasharray");if(!y||y.value.kind==="constant")continue;const x=m.layout.get("line-cap")==="round",v={dasharray:y.value.evaluate({zoom:o-1},r,{}),round:x},M={dasharray:y.value.evaluate({zoom:o},r,{}),round:x},k={dasharray:y.value.evaluate({zoom:o+1},r,{}),round:x},P=`${v.dasharray.join(",")},${v.round}`,B=`${M.dasharray.join(",")},${M.round}`,U=`${k.dasharray.join(",")},${k.round}`;h.dashDependencies[P]=v,h.dashDependencies[B]=M,h.dashDependencies[U]=k,r.dashes[m.id]={min:P,mid:B,max:U}}}}let ua,ud;_t("LineBucket",Cc,{omit:["layers","patternFeatures"]});var _h={get paint(){return ud=ud||new cr({"line-opacity":new Nt(_e.paint_line["line-opacity"]),"line-color":new Nt(_e.paint_line["line-color"]),"line-translate":new Mt(_e.paint_line["line-translate"]),"line-translate-anchor":new Mt(_e.paint_line["line-translate-anchor"]),"line-width":new Nt(_e.paint_line["line-width"]),"line-gap-width":new Nt(_e.paint_line["line-gap-width"]),"line-offset":new Nt(_e.paint_line["line-offset"]),"line-blur":new Nt(_e.paint_line["line-blur"]),"line-dasharray":new Go(_e.paint_line["line-dasharray"]),"line-pattern":new Go(_e.paint_line["line-pattern"]),"line-gradient":new Zo(_e.paint_line["line-gradient"])})},get layout(){return ua=ua||new cr({"line-cap":new Mt(_e.layout_line["line-cap"]),"line-join":new Nt(_e.layout_line["line-join"]),"line-miter-limit":new Mt(_e.layout_line["line-miter-limit"]),"line-round-limit":new Mt(_e.layout_line["line-round-limit"]),"line-sort-key":new Nt(_e.layout_line["line-sort-key"])})}};class nf extends Nt{possiblyEvaluate(t,r){return r=new Vi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,o,h){return r=$i({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,o,h)}}let Ec;class hd extends on{constructor(t,r){super(t,_h,r),this.gradientVersion=0,Ec||(Ec=new nf(_h.paint.properties["line-width"].specification),Ec.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof Hs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Ec.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Cc(t)}queryRadius(t){const r=t,o=tl(vc("line-width",this,r),vc("line-gap-width",this,r)),h=vc("line-offset",this,r);return o/2+Math.abs(h)+oh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:h,transform:m,pixelsToTileUnits:y}){const x=Il(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-m.bearingInRadians,y),v=y/2*tl(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),M=this.paint.get("line-offset").evaluate(r,o);return M&&(h=(function(k,P){const B=[];for(let U=0;U<k.length;U++){const V=k[U],q=[];for(let Y=0;Y<V.length;Y++){const ae=V[Y-1],Ce=V[Y],ue=V[Y+1],me=Y===0?new W(0,0):Ce.sub(ae)._unit()._perp(),je=Y===V.length-1?new W(0,0):ue.sub(Ce)._unit()._perp(),Ue=me._add(je)._unit(),it=Ue.x*je.x+Ue.y*je.y;it!==0&&Ue._mult(1/it),q.push(Ue._mult(P)._add(Ce))}B.push(q)}return B})(h,M*y)),(function(k,P,B){for(let U=0;U<P.length;U++){const V=P[U];if(k.length>=3){for(let q=0;q<V.length;q++)if(xc(k,V[q]))return!0}if(Up(k,V,B))return!0}return!1})(x,h,v)}isTileClipped(){return!0}}function tl(n,t){return t>0?t+2*n:n}const gn=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bl=Gi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tu=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _o=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),np=Gi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ap(n,t,r){return n.sections.forEach((o=>{o.text=(function(h,m,y){const x=m.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),Za.applyArabicShaping&&(h=Za.applyArabicShaping(h)),h})(o.text,t,r)})),n}Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Mu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Ir=24;const xh=4294967296,ka=1/xh,sp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Xn{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,r,o=this.length){for(;this.pos<o;){const h=this.readVarint(),m=h>>3,y=this.pos;this.type=7&h,t(m,r,this),this.pos===y&&this.skip(h)}return r}readMessage(t,r){return this.readFields(t,r,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*xh;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*xh;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const r=this.buf;let o,h;return h=r[this.pos++],o=127&h,h<128?o:(h=r[this.pos++],o|=(127&h)<<7,h<128?o:(h=r[this.pos++],o|=(127&h)<<14,h<128?o:(h=r[this.pos++],o|=(127&h)<<21,h<128?o:(h=r[this.pos],o|=(15&h)<<28,(function(m,y,x){const v=x.buf;let M,k;if(k=v[x.pos++],M=(112&k)>>4,k<128||(k=v[x.pos++],M|=(127&k)<<3,k<128)||(k=v[x.pos++],M|=(127&k)<<10,k<128)||(k=v[x.pos++],M|=(127&k)<<17,k<128)||(k=v[x.pos++],M|=(127&k)<<24,k<128)||(k=v[x.pos++],M|=(1&k)<<31,k<128))return Ac(m,M,y);throw new Error("Expected varint not more than 10 bytes")})(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=12&&sp?sp.decode(this.buf.subarray(r,t)):(function(o,h,m){let y="",x=h;for(;x<m;){const v=o[x];let M,k,P,B=null,U=v>239?4:v>223?3:v>191?2:1;if(x+U>m)break;U===1?v<128&&(B=v):U===2?(M=o[x+1],(192&M)==128&&(B=(31&v)<<6|63&M,B<=127&&(B=null))):U===3?(M=o[x+1],k=o[x+2],(192&M)==128&&(192&k)==128&&(B=(15&v)<<12|(63&M)<<6|63&k,(B<=2047||B>=55296&&B<=57343)&&(B=null))):U===4&&(M=o[x+1],k=o[x+2],P=o[x+3],(192&M)==128&&(192&k)==128&&(192&P)==128&&(B=(15&v)<<18|(63&M)<<12|(63&k)<<6|63&P,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,U=1):B>65535&&(B-=65536,y+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),y+=String.fromCharCode(B),x+=U}return y})(this.buf,r,t)}readBytes(){const t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r}readPackedVarint(t=[],r){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(r));return t}readPackedSVarint(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const r=7&t;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(t,r){this.writeVarint(t<<3|r)}realloc(t){let r=this.length||16;for(;r<this.pos+t;)r*=2;if(r!==this.length){const o=new Uint8Array(r);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ka),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ka),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(r,o){let h,m;if(r>=0?(h=r%4294967296|0,m=r/4294967296|0):(h=~(-r%4294967296),m=~(-r/4294967296),4294967295^h?h=h+1|0:(h=0,m=m+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(y,x,v){v.buf[v.pos++]=127&y|128,y>>>=7,v.buf[v.pos++]=127&y|128,y>>>=7,v.buf[v.pos++]=127&y|128,y>>>=7,v.buf[v.pos++]=127&y|128,v.buf[v.pos]=127&(y>>>=7)})(h,0,o),(function(y,x){const v=(7&y)<<4;x.buf[x.pos++]|=v|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))})(m,o)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const r=this.pos;this.pos=(function(h,m,y){for(let x,v,M=0;M<m.length;M++){if(x=m.charCodeAt(M),x>55295&&x<57344){if(!v){x>56319||M+1===m.length?(h[y++]=239,h[y++]=191,h[y++]=189):v=x;continue}if(x<56320){h[y++]=239,h[y++]=191,h[y++]=189,v=x;continue}x=v-55296<<10|x-56320|65536,v=null}else v&&(h[y++]=239,h[y++]=191,h[y++]=189,v=null);x<128?h[y++]=x:(x<2048?h[y++]=x>>6|192:(x<65536?h[y++]=x>>12|224:(h[y++]=x>>18|240,h[y++]=x>>12&63|128),h[y++]=x>>6&63|128),h[y++]=63&x|128)}return y})(this.buf,t,this.pos);const o=this.pos-r;o>=128&&op(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const r=t.length;this.writeVarint(r),this.realloc(r);for(let o=0;o<r;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,r){this.pos++;const o=this.pos;t(r,this);const h=this.pos-o;h>=128&&op(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h}writeMessage(t,r,o){this.writeTag(t,2),this.writeRawMessage(r,o)}writePackedVarint(t,r){r.length&&this.writeMessage(t,Nf,r)}writePackedSVarint(t,r){r.length&&this.writeMessage(t,Nl,r)}writePackedBoolean(t,r){r.length&&this.writeMessage(t,ku,r)}writePackedFloat(t,r){r.length&&this.writeMessage(t,dd,r)}writePackedDouble(t,r){r.length&&this.writeMessage(t,lp,r)}writePackedFixed32(t,r){r.length&&this.writeMessage(t,af,r)}writePackedSFixed32(t,r){r.length&&this.writeMessage(t,sf,r)}writePackedFixed64(t,r){r.length&&this.writeMessage(t,of,r)}writePackedSFixed64(t,r){r.length&&this.writeMessage(t,lf,r)}writeBytesField(t,r){this.writeTag(t,2),this.writeBytes(r)}writeFixed32Field(t,r){this.writeTag(t,5),this.writeFixed32(r)}writeSFixed32Field(t,r){this.writeTag(t,5),this.writeSFixed32(r)}writeFixed64Field(t,r){this.writeTag(t,1),this.writeFixed64(r)}writeSFixed64Field(t,r){this.writeTag(t,1),this.writeSFixed64(r)}writeVarintField(t,r){this.writeTag(t,0),this.writeVarint(r)}writeSVarintField(t,r){this.writeTag(t,0),this.writeSVarint(r)}writeStringField(t,r){this.writeTag(t,2),this.writeString(r)}writeFloatField(t,r){this.writeTag(t,5),this.writeFloat(r)}writeDoubleField(t,r){this.writeTag(t,1),this.writeDouble(r)}writeBooleanField(t,r){this.writeVarintField(t,+r)}}function Ac(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function op(n,t,r){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(o);for(let h=r.pos-1;h>=n;h--)r.buf[h+o]=r.buf[h]}function Nf(n,t){for(let r=0;r<n.length;r++)t.writeVarint(n[r])}function Nl(n,t){for(let r=0;r<n.length;r++)t.writeSVarint(n[r])}function dd(n,t){for(let r=0;r<n.length;r++)t.writeFloat(n[r])}function lp(n,t){for(let r=0;r<n.length;r++)t.writeDouble(n[r])}function ku(n,t){for(let r=0;r<n.length;r++)t.writeBoolean(n[r])}function af(n,t){for(let r=0;r<n.length;r++)t.writeFixed32(n[r])}function sf(n,t){for(let r=0;r<n.length;r++)t.writeSFixed32(n[r])}function of(n,t){for(let r=0;r<n.length;r++)t.writeFixed64(n[r])}function lf(n,t){for(let r=0;r<n.length;r++)t.writeSFixed64(n[r])}function pd(n,t,r){n===1&&r.readMessage(cp,t)}function cp(n,t,r){if(n===3){const{id:o,bitmap:h,width:m,height:y,left:x,top:v,advance:M}=r.readMessage(Ff,{});t.push({id:o,bitmap:new mu({width:m+6,height:y+6},h),metrics:{width:m,height:y,left:x,top:v,advance:M}})}}function Ff(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}function cf(n){let t=0,r=0;for(const y of n)t+=y.w*y.h,r=Math.max(r,y.w);n.sort(((y,x)=>x.h-y.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let h=0,m=0;for(const y of n)for(let x=o.length-1;x>=0;x--){const v=o[x];if(!(y.w>v.w||y.h>v.h)){if(y.x=v.x,y.y=v.y,m=Math.max(m,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===v.w&&y.h===v.h){const M=o.pop();M&&x<o.length&&(o[x]=M)}else y.h===v.h?(v.x+=y.w,v.w-=y.w):y.w===v.w?(v.y+=y.h,v.h-=y.h):(o.push({x:v.x+y.w,y:v.y,w:v.w-y.w,h:y.h}),v.y+=y.h,v.h-=y.h);break}}return{w:h,h:m,fill:t/(h*m)||0}}class up{constructor(t,{pixelRatio:r,version:o,stretchX:h,stretchY:m,content:y,textFitWidth:x,textFitHeight:v}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=h,this.stretchY=m,this.content=y,this.version=o,this.textFitWidth=x,this.textFitHeight=v}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class hp{constructor(t,r){const o={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,o,m),this.addImages(r,h,m);const{w:y,h:x}=cf(m),v=new Nn({width:y||1,height:x||1});for(const M in t){const k=t[M],P=o[M].paddedRect;Nn.copy(k.data,v,{x:0,y:0},{x:P.x+1,y:P.y+1},k.data)}for(const M in r){const k=r[M],P=h[M].paddedRect,B=P.x+1,U=P.y+1,V=k.data.width,q=k.data.height;Nn.copy(k.data,v,{x:0,y:0},{x:B,y:U},k.data),Nn.copy(k.data,v,{x:0,y:q-1},{x:B,y:U-1},{width:V,height:1}),Nn.copy(k.data,v,{x:0,y:0},{x:B,y:U+q},{width:V,height:1}),Nn.copy(k.data,v,{x:V-1,y:0},{x:B-1,y:U},{width:1,height:q}),Nn.copy(k.data,v,{x:0,y:0},{x:B+V,y:U},{width:1,height:q})}this.image=v,this.iconPositions=o,this.patternPositions=h}addImages(t,r,o){for(const h in t){const m=t[h],y={x:0,y:0,w:m.data.width+2,h:m.data.height+2};o.push(y),r[h]=new up(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),r)}patchUpdatedImage(t,r,o){if(!t||!r||t.version===r.version)return;t.version=r.version;const[h,m]=t.tl;o.update(r.data,void 0,{x:h,y:m})}}var il;_t("ImagePosition",up),_t("ImageAtlas",hp),z.ao=void 0,(il=z.ao||(z.ao={}))[il.none=0]="none",il[il.horizontal=1]="horizontal",il[il.vertical=2]="vertical",il[il.horizontalOnly=3]="horizontalOnly";class xo{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,o){const h=new xo;return h.scale=t||1,h.fontStack=r,h.verticalAlign=o||"bottom",h}static forImage(t,r){const o=new xo;return o.imageName=t,o.verticalAlign=r||"bottom",o}}class rl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const o=new rl;for(let h=0;h<t.sections.length;h++){const m=t.sections[h];m.image?o.addImageSection(m):o.addTextSection(m,r)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let r="";for(let o=0;o<t.length;o++){const h=t.charCodeAt(o+1)||null,m=t.charCodeAt(o-1)||null;r+=h&&pc(h)&&!Mu[t[o+1]]||m&&pc(m)&&!Mu[t[o-1]]||!Mu[t[o]]?t[o]:Mu[t[o]]}return r})(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&bh[this.text.charCodeAt(o)];o++)t++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&bh[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const o=new rl;return o.text=this.text.substring(t,r),o.sectionIndex=this.sectionIndex.slice(t,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,r)=>Math.max(t,this.sections[r].scale)),0)}getMaxImageSize(t){let r=0,o=0;for(let h=0;h<this.length();h++){const m=this.getSection(h);if(m.imageName){const y=t[m.imageName];if(!y)continue;const x=y.displaySize;r=Math.max(r,x[0]),o=Math.max(o,x[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(t,r){this.text+=t.text,this.sections.push(xo.forText(t.scale,t.fontStack||r,t.verticalAlign));const o=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(o)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void zi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(xo.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vh(n,t,r,o,h,m,y,x,v,M,k,P,B,U,V){const q=rl.fromFeature(n,h);let Y;P===z.ao.vertical&&q.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:Ce}=Za;if(ae&&q.sections.length===1){Y=[];const je=ae(q.toString(),Ji(q,M,m,t,o,U));for(const Ue of je){const it=new rl;it.text=Ue,it.sections=q.sections;for(let mt=0;mt<Ue.length;mt++)it.sectionIndex.push(0);Y.push(it)}}else if(Ce){Y=[];const je=Ce(q.text,q.sectionIndex,Ji(q,M,m,t,o,U));for(const Ue of je){const it=new rl;it.text=Ue[0],it.sectionIndex=Ue[1],it.sections=q.sections,Y.push(it)}}else Y=(function(je,Ue){const it=[],mt=je.text;let lt=0;for(const pt of Ue)it.push(je.substring(lt,pt)),lt=pt;return lt<mt.length&&it.push(je.substring(lt,mt.length)),it})(q,Ji(q,M,m,t,o,U));const ue=[],me={positionedLines:ue,text:q.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:P,iconsInText:!1,verticalizable:!1};return(function(je,Ue,it,mt,lt,pt,It,ut,ft,We,Ut,Qt){let Lt=0,Ct=0,fi=0,pr=0;const Or=ut==="right"?1:ut==="left"?0:.5,yn=Ir/Qt;let da=0;for(const Zi of lt){Zi.trim();const Pr=Zi.getMaxScale(),Br={positionedGlyphs:[],lineOffset:0};je.positionedLines[da]=Br;const Sr=Br.positionedGlyphs;let Wn=0;if(!Zi.length()){Ct+=pt,++da;continue}const Ea=Uf(mt,Zi,yn);for(let pa=0;pa<Zi.length();pa++){const Zr=Zi.getSection(pa),Nr=Zi.getSectionIndex(pa),tn=Zi.getCharCode(pa),qr=$f(ft,Ut,tn);let er;if(Zr.imageName){if(je.iconsInText=!0,Zr.scale=Zr.scale*yn,er=Gf(Zr,qr,Pr,Ea,mt),!er)continue;Wn=Math.max(Wn,er.imageOffset)}else if(er=Vf(Zr,tn,qr,Ea,Ue,it),!er)continue;const{rect:Aa,metrics:Pc,baselineOffset:Yn}=er;Sr.push({glyph:tn,imageName:Zr.imageName,x:Lt,y:Ct+Yn+-17,vertical:qr,scale:Zr.scale,fontStack:Zr.fontStack,sectionIndex:Nr,metrics:Pc,rect:Aa}),qr?(je.verticalizable=!0,Lt+=(Zr.imageName?Pc.advance:Ir)*Zr.scale+We):Lt+=Pc.advance*Zr.scale+We}Sr.length!==0&&(fi=Math.max(Lt-We,fi),md(Sr,0,Sr.length-1,Or)),Lt=0,Br.lineOffset=Math.max(Wn,(Pr-1)*Ir);const Dr=pt*Pr+Wn;Ct+=Dr,pr=Math.max(Dr,pr),++da}const{horizontalAlign:Gr,verticalAlign:wr}=wh(It);(function(Zi,Pr,Br,Sr,Wn,Ea,Dr,pa,Zr){const Nr=(Pr-Br)*Wn;let tn=0;tn=Ea!==Dr?-pa*Sr- -17:-Sr*Zr*Dr+.5*Dr;for(const qr of Zi)for(const er of qr.positionedGlyphs)er.x+=Nr,er.y+=tn})(je.positionedLines,Or,Gr,wr,fi,pr,pt,Ct,lt.length),je.top+=-wr*Ct,je.bottom=je.top+Ct,je.left+=-Gr*fi,je.right=je.left+fi})(me,t,r,o,Y,y,x,v,P,M,B,V),!(function(je){for(const Ue of je)if(Ue.positionedGlyphs.length!==0)return!1;return!0})(ue)&&me}const bh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},uf={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},hf={40:!0};function dp(n,t,r,o,h,m){if(t.imageName){const y=o[t.imageName];return y?y.displaySize[0]*t.scale*Ir/m+h:0}{const y=r[t.fontStack],x=y&&y[n];return x?x.metrics.advance*t.scale+h:0}}function pp(n,t,r,o){const h=Math.pow(n-t,2);return o?n<t?h/2:2*h:h+Math.abs(r)*r}function fd(n,t,r){let o=0;return n===10&&(o-=1e4),r&&(o+=150),n!==40&&n!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function fp(n,t,r,o,h,m){let y=null,x=pp(t,r,h,m);for(const v of o){const M=pp(t-v.x,r,h,m)+v.badness;M<=x&&(y=v,x=M)}return{index:n,x:t,priorBreak:y,badness:x}}function mp(n){return n?mp(n.priorBreak).concat(n.index):[]}function Ji(n,t,r,o,h,m){if(!n)return[];const y=[],x=(function(P,B,U,V,q,Y){let ae=0;for(let Ce=0;Ce<P.length();Ce++){const ue=P.getSection(Ce);ae+=dp(P.getCharCode(Ce),ue,V,q,B,Y)}return ae/Math.max(1,Math.ceil(ae/U))})(n,t,r,o,h,m),v=n.text.indexOf("​")>=0;let M=0;for(let P=0;P<n.length();P++){const B=n.getSection(P),U=n.getCharCode(P);if(bh[U]||(M+=dp(U,B,o,h,t,m)),P<n.length()-1){const V=!((k=U)<11904)&&(!!si["CJK Compatibility Forms"](k)||!!si["CJK Compatibility"](k)||!!si["CJK Strokes"](k)||!!si["CJK Symbols and Punctuation"](k)||!!si["Enclosed CJK Letters and Months"](k)||!!si["Halfwidth and Fullwidth Forms"](k)||!!si["Ideographic Description Characters"](k)||!!si["Vertical Forms"](k)||Uo.test(String.fromCodePoint(k)));(uf[U]||V||B.imageName||P!==n.length()-2&&hf[n.getCharCode(P+1)])&&y.push(fp(P+1,M,x,y,fd(U,n.getCharCode(P+1),V&&v),!1))}}var k;return mp(fp(n.length(),M,x,y,0,!0))}function wh(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Uf(n,t,r){const o=t.getMaxScale()*Ir,{maxImageWidth:h,maxImageHeight:m}=t.getMaxImageSize(n),y=Math.max(o,m*r);return{verticalLineContentWidth:Math.max(o,h*r),horizontalLineContentHeight:y}}function gp(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function $f(n,t,r){return!(n===z.ao.horizontal||!t&&!so(r)||t&&(bh[r]||(o=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Vf(n,t,r,o,h,m){const y=m[n.fontStack],x=(function(M,k,P,B){if(M&&M.rect)return M;const U=k[P.fontStack],V=U&&U[B];return V?{rect:null,metrics:V.metrics}:null})(y&&y[t],h,n,t);if(x===null)return null;let v;if(r)v=o.verticalLineContentWidth-n.scale*Ir;else{const M=gp(n.verticalAlign);v=(o.horizontalLineContentHeight-n.scale*Ir)*M}return{rect:x.rect,metrics:x.metrics,baselineOffset:v}}function Gf(n,t,r,o,h){const m=h[n.imageName];if(!m)return null;const y=m.paddedRect,x=m.displaySize,v={width:x[0],height:x[1],left:1,top:-3,advance:t?x[1]:x[0]};let M;if(t)M=o.verticalLineContentWidth-x[1]*n.scale;else{const k=gp(n.verticalAlign);M=(o.horizontalLineContentHeight-x[1]*n.scale)*k}return{rect:y,metrics:v,baselineOffset:M,imageOffset:(t?x[0]:x[1])*n.scale-Ir*r}}function md(n,t,r,o){if(o===0)return;const h=n[r],m=(n[r].x+h.metrics.advance*h.scale)*o;for(let y=t;y<=r;y++)n[y].x-=m}function Cu(n,t,r){const{horizontalAlign:o,verticalAlign:h}=wh(r),m=t[0]-n.displaySize[0]*o,y=t[1]-n.displaySize[1]*h;return{image:n,top:y,bottom:y+n.displaySize[1],left:m,right:m+n.displaySize[0]}}function gd(n){var t,r;let o=n.left,h=n.top,m=n.right-o,y=n.bottom-h;const x=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",v=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",M=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(v==="proportional"){if(x==="stretchOnly"&&m/y<M||x==="proportional"){const k=Math.ceil(y*M);o*=k/m,m=k}}else if(x==="proportional"&&v==="stretchOnly"&&M!==0&&m/y>M){const k=Math.ceil(m/M);h*=k/y,y=k}return{x1:o,y1:h,x2:o+m,y2:h+y}}function Sh(n,t,r,o,h,m){const y=n.image;let x;if(y.content){const Y=y.content,ae=y.pixelRatio||1;x=[Y[0]/ae,Y[1]/ae,y.displaySize[0]-Y[2]/ae,y.displaySize[1]-Y[3]/ae]}const v=t.left*m,M=t.right*m;let k,P,B,U;r==="width"||r==="both"?(U=h[0]+v-o[3],P=h[0]+M+o[1]):(U=h[0]+(v+M-y.displaySize[0])/2,P=U+y.displaySize[0]);const V=t.top*m,q=t.bottom*m;return r==="height"||r==="both"?(k=h[1]+V-o[0],B=h[1]+q+o[2]):(k=h[1]+(V+q-y.displaySize[1])/2,B=k+y.displaySize[1]),{image:y,top:k,right:P,bottom:B,left:U,collisionPadding:x}}const Os=128,ha=32640;function Bs(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Vi(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=r;let m=0;for(;m<o.length&&o[m]<=n;)m++;m=Math.max(0,m-1);let y=m;for(;y<o.length&&o[y]<n+1;)y++;y=Math.min(o.length-1,y);const x=o[m],v=o[y];return r.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:v,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:v,minSize:r.evaluate(new Vi(x)),maxSize:r.evaluate(new Vi(v)),interpolationType:h}}}function zc(n,t,r){let o="never";const h=n.get(t);return h?o=h:n.get(r)&&(o="always"),o}const Zf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Th(n,t,r,o,h,m,y,x,v,M,k,P,B){const U=x?Math.min(ha,Math.round(x[0])):0,V=x?Math.min(ha,Math.round(x[1])):0;n.emplaceBack(t,r,Math.round(32*o),Math.round(32*h),m,y,(U<<1)+(v?1:0),V,16*M,16*k,256*P,256*B)}function yd(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function df(n){for(const t of n.sections)if(lo(t.text))return!0;return!1}class _d{constructor(t){this.layoutVertexArray=new Be,this.indexArray=new Wt,this.programConfigurations=t,this.segments=new ci,this.dynamicLayoutVertexArray=new nt,this.opacityVertexArray=new at,this.hasVisibleVertices=!1,this.placedSymbolArray=new L}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gn.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Bl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Zf,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_t("SymbolBuffers",_d);class yp{constructor(t,r,o){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new o,this.segments=new ci,this.collisionVertexArray=new bt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Tu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}_t("CollisionBuffers",yp);class Fl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=Ei(globalThis)?Math.min(t.overscaling,128):t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((y=>y.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bs(this.zoom,r["text-size"]),this.iconSizeData=Bs(this.zoom,r["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=zc(o,"text-overlap","text-allow-overlap")!=="never"||zc(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((y=>z.ao[y]))),this.stateDependentLayerIds=this.layers.filter((y=>y.isStateDependent())).map((y=>y.id)),this.sourceID=t.sourceID}createArrays(){this.text=new _d(new ps(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new _d(new ps(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Z,this.lineVertexArray=new K,this.symbolInstances=new $,this.textAnchorOffsets=new J}calculateGlyphDependencies(t,r,o,h,m){for(let y=0;y<t.length;y++)if(r[t.charCodeAt(y)]=!0,(o||h)&&m){const x=Mu[t.charAt(y)];x&&(r[x.charCodeAt(0)]=!0)}}populate(t,r,o){const h=this.layers[0],m=h.layout,y=m.get("text-font"),x=m.get("text-field"),v=m.get("icon-image"),M=(x.value.kind!=="constant"||x.value.value instanceof Ar&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),k=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,P=m.get("symbol-sort-key");if(this.features=[],!M&&!k)return;const B=r.iconDependencies,U=r.glyphDependencies,V=r.availableImages,q=new Vi(this.zoom);for(const{feature:Y,id:ae,index:Ce,sourceLayerIndex:ue}of t){const me=h._featureFilter.needGeometry,je=Ka(Y,me);if(!h._featureFilter.filter(q,je,o))continue;let Ue,it;if(me||(je.geometry=fs(Y)),M){const lt=h.getValueAndResolveTokens("text-field",je,o,V),pt=Ar.factory(lt),It=this.hasRTLText=this.hasRTLText||df(pt);(!It||Za.getRTLTextPluginStatus()==="unavailable"||It&&Za.isParsed())&&(Ue=ap(pt,h,je))}if(k){const lt=h.getValueAndResolveTokens("icon-image",je,o,V);it=lt instanceof Xr?lt:Xr.fromString(lt)}if(!Ue&&!it)continue;const mt=this.sortFeaturesByKey?P.evaluate(je,{},o):void 0;if(this.features.push({id:ae,text:Ue,icon:it,index:Ce,sourceLayerIndex:ue,geometry:je.geometry,properties:Y.properties,type:Sc.types[Y.type],sortKey:mt}),it&&(B[it.name]=!0),Ue){const lt=y.evaluate(je,{},o).join(","),pt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(z.ao.vertical)>=0;for(const It of Ue.sections)if(It.image)B[It.image.name]=!0;else{const ut=Sa(Ue.toString()),ft=It.fontStack||lt,We=U[ft]=U[ft]||{};this.calculateGlyphDependencies(It.text,We,pt,this.allowVerticalPlacement,ut)}}}m.get("symbol-placement")==="line"&&(this.features=(function(Y){const ae={},Ce={},ue=[];let me=0;function je(lt){ue.push(Y[lt]),me++}function Ue(lt,pt,It){const ut=Ce[lt];return delete Ce[lt],Ce[pt]=ut,ue[ut].geometry[0].pop(),ue[ut].geometry[0]=ue[ut].geometry[0].concat(It[0]),ut}function it(lt,pt,It){const ut=ae[pt];return delete ae[pt],ae[lt]=ut,ue[ut].geometry[0].shift(),ue[ut].geometry[0]=It[0].concat(ue[ut].geometry[0]),ut}function mt(lt,pt,It){const ut=It?pt[0][pt[0].length-1]:pt[0][0];return`${lt}:${ut.x}:${ut.y}`}for(let lt=0;lt<Y.length;lt++){const pt=Y[lt],It=pt.geometry,ut=pt.text?pt.text.toString():null;if(!ut){je(lt);continue}const ft=mt(ut,It),We=mt(ut,It,!0);if(ft in Ce&&We in ae&&Ce[ft]!==ae[We]){const Ut=it(ft,We,It),Qt=Ue(ft,We,ue[Ut].geometry);delete ae[ft],delete Ce[We],Ce[mt(ut,ue[Qt].geometry,!0)]=Qt,ue[Ut].geometry=null}else ft in Ce?Ue(ft,We,It):We in ae?it(ft,We,It):(je(lt),ae[ft]=me-1,Ce[We]=me-1)}return ue.filter((lt=>lt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Y,ae)=>Y.sortKey-ae.sortKey))}update(t,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const o=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(r[t.segment+1]),m=t.dist(r[t.segment]);const y={};for(let x=t.segment+1;x<r.length;x++)y[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:h},x<r.length-1&&(h+=r[x+1].dist(r[x]));for(let x=t.segment||0;x>=0;x--)y[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:m},x>0&&(m+=r[x-1].dist(r[x]));for(let x=0;x<r.length;x++){const v=y[x];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,r,o,h,m,y,x,v,M,k,P,B){const U=t.indexArray,V=t.layoutVertexArray,q=t.segments.prepareSegment(4*r.length,V,U,this.canOverlap?y.sortKey:void 0),Y=this.glyphOffsetArray.length,ae=q.vertexLength,Ce=this.allowVerticalPlacement&&x===z.ao.vertical?Math.PI/2:0,ue=y.text&&y.text.sections;for(let me=0;me<r.length;me++){const{tl:je,tr:Ue,bl:it,br:mt,tex:lt,pixelOffsetTL:pt,pixelOffsetBR:It,minFontScaleX:ut,minFontScaleY:ft,glyphOffset:We,isSDF:Ut,sectionIndex:Qt}=r[me],Lt=q.vertexLength,Ct=We[1];Th(V,v.x,v.y,je.x,Ct+je.y,lt.x,lt.y,o,Ut,pt.x,pt.y,ut,ft),Th(V,v.x,v.y,Ue.x,Ct+Ue.y,lt.x+lt.w,lt.y,o,Ut,It.x,pt.y,ut,ft),Th(V,v.x,v.y,it.x,Ct+it.y,lt.x,lt.y+lt.h,o,Ut,pt.x,It.y,ut,ft),Th(V,v.x,v.y,mt.x,Ct+mt.y,lt.x+lt.w,lt.y+lt.h,o,Ut,It.x,It.y,ut,ft),yd(t.dynamicLayoutVertexArray,v,Ce),U.emplaceBack(Lt,Lt+2,Lt+1),U.emplaceBack(Lt+1,Lt+2,Lt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(We[0]),me!==r.length-1&&Qt===r[me+1].sectionIndex||t.programConfigurations.populatePaintArrays(V.length,y,y.index,{imagePositions:{},canonical:B,formattedSection:ue&&ue[Qt]})}t.placedSymbolArray.emplaceBack(v.x,v.y,Y,this.glyphOffsetArray.length-Y,ae,M,k,v.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],x,0,!1,0,P)}_addCollisionDebugVertex(t,r,o,h,m,y){return r.emplaceBack(0,0),t.emplaceBack(o.x,o.y,h,m,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,r,o,h,m,y,x){const v=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),M=v.vertexLength,k=m.layoutVertexArray,P=m.collisionVertexArray,B=x.anchorX,U=x.anchorY;this._addCollisionDebugVertex(k,P,y,B,U,new W(t,r)),this._addCollisionDebugVertex(k,P,y,B,U,new W(o,r)),this._addCollisionDebugVertex(k,P,y,B,U,new W(o,h)),this._addCollisionDebugVertex(k,P,y,B,U,new W(t,h)),v.vertexLength+=4;const V=m.indexArray;V.emplaceBack(M,M+1),V.emplaceBack(M+1,M+2),V.emplaceBack(M+2,M+3),V.emplaceBack(M+3,M),v.primitiveLength+=4}addDebugCollisionBoxes(t,r,o,h){for(let m=t;m<r;m++){const y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yp(et,_o.members,Ai),this.iconCollisionBox=new yp(et,_o.members,Ai);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,o,h,m,y,x,v,M){const k={};for(let P=r;P<o;P++){const B=t.get(P);k.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.textFeatureIndex=B.featureIndex;break}for(let P=h;P<m;P++){const B=t.get(P);k.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.verticalTextFeatureIndex=B.featureIndex;break}for(let P=y;P<x;P++){const B=t.get(P);k.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.iconFeatureIndex=B.featureIndex;break}for(let P=v;P<M;P++){const B=t.get(P);k.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.verticalIconFeatureIndex=B.featureIndex;break}return k}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const o=t.placedSymbolArray.get(r),h=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<h;m+=4)t.indexArray.emplaceBack(m,m+2,m+1),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),o=Math.cos(t),h=[],m=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const v=this.symbolInstances.get(x);h.push(0|Math.round(r*v.anchorX+o*v.anchorY)),m.push(v.featureIndex)}return y.sort(((x,v)=>h[x]-h[v]||m[v]-m[x])),y}addToSortKeyRanges(t,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((h,m,y)=>{h>=0&&y.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let _p,xp;_t("SymbolBucket",Fl,{omit:["layers","collisionBoxArray","features","compareText"]}),Fl.MAX_GLYPHS=65535,Fl.addDynamicAttributes=yd;var vp={get paint(){return xp=xp||new cr({"icon-opacity":new Nt(_e.paint_symbol["icon-opacity"]),"icon-color":new Nt(_e.paint_symbol["icon-color"]),"icon-halo-color":new Nt(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Nt(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Nt(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new Mt(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mt(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new Nt(_e.paint_symbol["text-opacity"]),"text-color":new Nt(_e.paint_symbol["text-color"],{runtimeType:xt,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Nt(_e.paint_symbol["text-halo-color"]),"text-halo-width":new Nt(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new Nt(_e.paint_symbol["text-halo-blur"]),"text-translate":new Mt(_e.paint_symbol["text-translate"]),"text-translate-anchor":new Mt(_e.paint_symbol["text-translate-anchor"])})},get layout(){return _p=_p||new cr({"symbol-placement":new Mt(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new Mt(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mt(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Nt(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mt(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Mt(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Mt(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Mt(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mt(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mt(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Nt(_e.layout_symbol["icon-size"]),"icon-text-fit":new Mt(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mt(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Nt(_e.layout_symbol["icon-image"]),"icon-rotate":new Nt(_e.layout_symbol["icon-rotate"]),"icon-padding":new Nt(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new Mt(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new Nt(_e.layout_symbol["icon-offset"]),"icon-anchor":new Nt(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mt(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mt(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mt(_e.layout_symbol["text-rotation-alignment"]),"text-field":new Nt(_e.layout_symbol["text-field"]),"text-font":new Nt(_e.layout_symbol["text-font"]),"text-size":new Nt(_e.layout_symbol["text-size"]),"text-max-width":new Nt(_e.layout_symbol["text-max-width"]),"text-line-height":new Mt(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new Nt(_e.layout_symbol["text-letter-spacing"]),"text-justify":new Nt(_e.layout_symbol["text-justify"]),"text-radial-offset":new Nt(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mt(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Nt(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Nt(_e.layout_symbol["text-anchor"]),"text-max-angle":new Mt(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new Mt(_e.layout_symbol["text-writing-mode"]),"text-rotate":new Nt(_e.layout_symbol["text-rotate"]),"text-padding":new Mt(_e.layout_symbol["text-padding"]),"text-keep-upright":new Mt(_e.layout_symbol["text-keep-upright"]),"text-transform":new Nt(_e.layout_symbol["text-transform"]),"text-offset":new Nt(_e.layout_symbol["text-offset"]),"text-allow-overlap":new Mt(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new Mt(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new Mt(_e.layout_symbol["text-ignore-placement"]),"text-optional":new Mt(_e.layout_symbol["text-optional"])})}};class xd{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:di,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t("FormatSectionOverride",xd,{omit:["defaultValue"]});class Eu extends on{constructor(t,r){super(t,vp,r)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const m of o)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,o,h){const m=this.layout.get(t).evaluate(r,{},o,h),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||Tl(y.value)||!m?m:(function(x,v){return v.replace(/{([^{}]+)}/g,((M,k)=>x&&k in x?String(x[k]):""))})(r.properties,m)}createBucket(t){return new Fl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of vp.paint.overridableProperties){if(!Eu.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),o=new xd(r),h=new sc(o,r.property.specification);let m=null;m=r.value.kind==="constant"||r.value.kind==="source"?new Rn("source",h):new Ks("composite",h,r.value.zoomStops),this.paint._values[t]=new Ha(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Eu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const o=t.get("text-field"),h=vp.paint.properties[r];let m=!1;const y=x=>{for(const v of x)if(h.overrides&&h.overrides.hasOverride(v))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Ar)y(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const x=M=>{m||(M instanceof _a&&sr(M.value)===Da?y(M.value.sections):M instanceof Zc?y(M.sections):M.eachChild(x))},v=o.value;v._styleExpression&&x(v._styleExpression.expression)}return m}}let pf;var qf={get paint(){return pf=pf||new cr({"background-color":new Mt(_e.paint_background["background-color"]),"background-pattern":new gc(_e.paint_background["background-pattern"]),"background-opacity":new Mt(_e.paint_background["background-opacity"])})}};class Mh extends on{constructor(t,r){super(t,qf,r)}}class Hf extends on{constructor(t,r){super(t,{},r),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ff{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Di={once:!0},kh=63710088e-1;class Ns{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ns(ei(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,o=this.lat*r,h=t.lat*r,m=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((t.lng-this.lng)*r);return kh*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof Ns)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ns(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ns(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vd=2*Math.PI*kh;function bp(n){return vd*Math.cos(n*Math.PI/180)}function bd(n){return(180+n)/360}function Au(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ch(n,t){return n/bp(t)}function wp(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Sp(n,t){return n*bp(wp(t))}class Eh{constructor(t,r,o=0){this.x=+t,this.y=+r,this.z=+o}static fromLngLat(t,r=0){const o=Ns.convert(t);return new Eh(bd(o.lng),Au(o.lat),Ch(r,o.lat))}toLngLat(){return new Ns(360*this.x-180,wp(this.y))}toAltitude(){return Sp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vd*(t=wp(this.y),1/Math.cos(t*Math.PI/180));var t}}function mf(n,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[n*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class wd{constructor(t,r,o){if(!(function(h,m,y){return!(h<0||h>25||y<0||y>=Math.pow(2,h)||m<0||m>=Math.pow(2,h))})(t,r,o))throw new Error(`x=${r}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=o,this.key=Ul(0,t,t,r,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,o){const h=(y=this.y,x=this.z,v=mf(256*(m=this.x),256*(y=Math.pow(2,x)-y-1),x),M=mf(256*(m+1),256*(y+1),x),v[0]+","+v[1]+","+M[0]+","+M[1]);var m,y,x,v,M;const k=(function(P,B,U){let V,q="";for(let Y=P;Y>0;Y--)V=1<<Y-1,q+=(B&V?1:0)+(U&V?2:0);return q})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new W((t.x*r-this.x)*At,(t.y*r-this.y)*At)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tp{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Ul(t,r.z,r.z,r.x,r.y)}}class Mi{constructor(t,r,o,h,m){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=r,this.canonical=new wd(o,+h,+m),this.key=Ul(r,t,o,h,m)}clone(){return new Mi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Mi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mi(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Ul(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Ul(this.wrap*+r,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-t.canonical.z;return!(r<0)&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Mi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new Mi(r,this.wrap,r,o,h),new Mi(r,this.wrap,r,o+1,h),new Mi(r,this.wrap,r,o,h+1),new Mi(r,this.wrap,r,o+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Mi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Mi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Eh(t.x-this.wrap,t.y))}}function Ul(n,t,r,o,h){(n*=2)<0&&(n=-1*n-1);const m=1<<r;return(m*m*n+m*h+o).toString(36)+r.toString(36)+t.toString(36)}function en(n,t){return t?n.properties[t]:n.id}_t("CanonicalTileID",wd),_t("OverscaledTileID",Mi,{omit:["terrainRttPosMatrix32f"]});class Ic{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const r=new Ic;return r.extend(t(new W(this.minX,this.minY))),r.extend(t(new W(this.maxX,this.minY))),r.extend(t(new W(this.minX,this.maxY))),r.extend(t(new W(this.maxX,this.maxY))),r}static fromPoints(t){const r=new Ic;for(const o of t)r.extend(o);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Mp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const o=t[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class gf{constructor(t,r,o,h,m){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=o,t._y=h,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Sd{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ga(At,16,0),this.grid3D=new Ga(At,16,0),this.featureIndexArray=new he,this.promoteId=r}insert(t,r,o,h,m,y){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,m);const v=y?this.grid3D:this.grid;for(let M=0;M<r.length;M++){const k=r[M],P=[1/0,1/0,-1/0,-1/0];for(let B=0;B<k.length;B++){const U=k[B];P[0]=Math.min(P[0],U.x),P[1]=Math.min(P[1],U.y),P[2]=Math.max(P[2],U.x),P[3]=Math.max(P[3],U.y)}P[0]<At&&P[1]<At&&P[2]>=0&&P[3]>=0&&v.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new tp(new Xn(this.rawTileData)).layers,this.sourceLayerCoder=new Mp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,o,h){this.loadVTLayers();const m=t.params,y=At/t.tileSize/t.scale,x=jn(m.filter,m.globalState),v=t.queryGeometry,M=t.queryPadding*y,k=Ic.fromPoints(v),P=this.grid.query(k.minX-M,k.minY-M,k.maxX+M,k.maxY+M),B=Ic.fromPoints(t.cameraQueryGeometry).expandBy(M),U=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,((Y,ae,Ce,ue)=>(function(me,je,Ue,it,mt){for(const pt of me)if(je<=pt.x&&Ue<=pt.y&&it>=pt.x&&mt>=pt.y)return!0;const lt=[new W(je,Ue),new W(je,mt),new W(it,mt),new W(it,Ue)];if(me.length>2){for(const pt of lt)if(xc(me,pt))return!0}for(let pt=0;pt<me.length-1;pt++)if($p(me[pt],me[pt+1],lt))return!0;return!1})(t.cameraQueryGeometry,Y-M,ae-M,Ce+M,ue+M)));for(const Y of U)P.push(Y);P.sort(Md);const V={};let q;for(let Y=0;Y<P.length;Y++){const ae=P[Y];if(ae===q)continue;q=ae;const Ce=this.featureIndexArray.get(ae);let ue=null;this.loadMatchingFeature(V,Ce.bucketIndex,Ce.sourceLayerIndex,Ce.featureIndex,x,m.layers,m.availableImages,r,o,h,((me,je,Ue)=>(ue||(ue=fs(me)),je.queryIntersectsFeature({queryGeometry:v,feature:me,featureState:Ue,geometry:ue,zoom:this.z,transform:t.transform,pixelsToTileUnits:y,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return V}loadMatchingFeature(t,r,o,h,m,y,x,v,M,k,P){const B=this.bucketLayerIDs[r];if(y&&!B.some((Y=>y.has(Y))))return;const U=this.sourceLayerCoder.decode(o),V=this.vtLayers[U].feature(h);if(m.needGeometry){const Y=Ka(V,!0);if(!m.filter(new Vi(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!m.filter(new Vi(this.tileID.overscaledZ),V))return;const q=this.getId(V,U);for(let Y=0;Y<B.length;Y++){const ae=B[Y];if(y&&!y.has(ae))continue;const Ce=v[ae];if(!Ce)continue;let ue={};q&&k&&(ue=k.getState(Ce.sourceLayer||"_geojsonTileLayer",q));const me=$i({},M[ae]);me.paint=Td(me.paint,Ce.paint,V,ue,x),me.layout=Td(me.layout,Ce.layout,V,ue,x);const je=!P||P(V,Ce,ue);if(!je)continue;const Ue=new gf(V,this.z,this.x,this.y,q);Ue.layer=me;let it=t[ae];it===void 0&&(it=t[ae]=[]),it.push({featureIndex:h,feature:Ue,intersectionZ:je})}}lookupSymbolFeatures(t,r,o,h,m,y,x,v){const M={};this.loadVTLayers();const k=jn(m.filterSpec,m.globalState);for(const P of t)this.loadMatchingFeature(M,o,h,P,k,y,x,v,r);return M}hasLayer(t){for(const r of this.bucketLayerIDs)for(const o of r)if(t===o)return!0;return!1}getId(t,r){var o;let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(h=Number(t.properties.cluster_id))),h}}function Td(n,t,r,o,h){return Cn(n,((m,y)=>{const x=t instanceof Vo?t.get(y):null;return x&&x.evaluate?x.evaluate(r,o,h):x}))}function Md(n,t){return t-n}function kp(n,t,r,o,h){const m=[];for(let y=0;y<n.length;y++){const x=n[y];let v;for(let M=0;M<x.length-1;M++){let k=x[M],P=x[M+1];k.x<t&&P.x<t||(k.x<t?k=new W(t,k.y+(t-k.x)/(P.x-k.x)*(P.y-k.y))._round():P.x<t&&(P=new W(t,k.y+(t-k.x)/(P.x-k.x)*(P.y-k.y))._round()),k.y<r&&P.y<r||(k.y<r?k=new W(k.x+(r-k.y)/(P.y-k.y)*(P.x-k.x),r)._round():P.y<r&&(P=new W(k.x+(r-k.y)/(P.y-k.y)*(P.x-k.x),r)._round()),k.x>=o&&P.x>=o||(k.x>=o?k=new W(o,k.y+(o-k.x)/(P.x-k.x)*(P.y-k.y))._round():P.x>=o&&(P=new W(o,k.y+(o-k.x)/(P.x-k.x)*(P.y-k.y))._round()),k.y>=h&&P.y>=h||(k.y>=h?k=new W(k.x+(h-k.y)/(P.y-k.y)*(P.x-k.x),h)._round():P.y>=h&&(P=new W(k.x+(h-k.y)/(P.y-k.y)*(P.x-k.x),h)._round()),v&&k.equals(v[v.length-1])||(v=[k],m.push(v)),v.push(P)))))}}return m}_t("FeatureIndex",Sd,{omit:["rawTileData","sourceLayerCoder"]});class nl extends W{constructor(t,r,o,h){super(t,r),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new nl(this.x,this.y,this.angle,this.segment)}}function kd(n,t,r,o,h){if(t.segment===void 0||r===0)return!0;let m=t,y=t.segment+1,x=0;for(;x>-r/2;){if(y--,y<0)return!1;x-=n[y].dist(m),m=n[y]}x+=n[y].dist(n[y+1]),y++;const v=[];let M=0;for(;x<r/2;){const k=n[y],P=n[y+1];if(!P)return!1;let B=n[y-1].angleTo(k)-k.angleTo(P);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:x,angleDelta:B}),M+=B;x-v[0].distance>o;)M-=v.shift().angleDelta;if(M>h)return!1;y++,x+=k.dist(P)}return!0}function Cd(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function yf(n,t,r){return n?.6*t*r:0}function Cp(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function Xf(n,t,r,o,h,m){const y=yf(r,h,m),x=Cp(r,o)*m;let v=0;const M=Cd(n)/2;for(let k=0;k<n.length-1;k++){const P=n[k],B=n[k+1],U=P.dist(B);if(v+U>M){const V=(M-v)/U,q=In.number(P.x,B.x,V),Y=In.number(P.y,B.y,V),ae=new nl(q,Y,B.angleTo(P),k);return ae._round(),!y||kd(n,ae,x,y,t)?ae:void 0}v+=U}}function _f(n,t,r,o,h,m,y,x,v){const M=yf(o,m,y),k=Cp(o,h),P=k*y,B=n[0].x===0||n[0].x===v||n[0].y===0||n[0].y===v;return t-P<t/4&&(t=P+t/4),xf(n,B?t/2*x%t:(k/2+2*m)*y*x%t,t,M,r,P,B,!1,v)}function xf(n,t,r,o,h,m,y,x,v){const M=m/2,k=Cd(n);let P=0,B=t-r,U=[];for(let V=0;V<n.length-1;V++){const q=n[V],Y=n[V+1],ae=q.dist(Y),Ce=Y.angleTo(q);for(;B+r<P+ae;){B+=r;const ue=(B-P)/ae,me=In.number(q.x,Y.x,ue),je=In.number(q.y,Y.y,ue);if(me>=0&&me<v&&je>=0&&je<v&&B-M>=0&&B+M<=k){const Ue=new nl(me,je,Ce,V);Ue._round(),o&&!kd(n,Ue,m,o,h)||U.push(Ue)}}P+=ae}return x||U.length||y||(U=xf(n,P/2,r,o,h,m,y,!0,v)),U}function vf(n,t,r,o){const h=[],m=n.image,y=m.pixelRatio,x=m.paddedRect.w-2,v=m.paddedRect.h-2;let M={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const k=m.stretchX||[[0,x]],P=m.stretchY||[[0,v]],B=(We,Ut)=>We+Ut[1]-Ut[0],U=k.reduce(B,0),V=P.reduce(B,0),q=x-U,Y=v-V;let ae=0,Ce=U,ue=0,me=V,je=0,Ue=q,it=0,mt=Y;if(m.content&&o){const We=m.content,Ut=We[2]-We[0],Qt=We[3]-We[1];(m.textFitWidth||m.textFitHeight)&&(M=gd(n)),ae=Fs(k,0,We[0]),ue=Fs(P,0,We[1]),Ce=Fs(k,We[0],We[2]),me=Fs(P,We[1],We[3]),je=We[0]-ae,it=We[1]-ue,Ue=Ut-Ce,mt=Qt-me}const lt=M.x1,pt=M.y1,It=M.x2-lt,ut=M.y2-pt,ft=(We,Ut,Qt,Lt)=>{const Ct=Ah(We.stretch-ae,Ce,It,lt),fi=zu(We.fixed-je,Ue,We.stretch,U),pr=Ah(Ut.stretch-ue,me,ut,pt),Or=zu(Ut.fixed-it,mt,Ut.stretch,V),yn=Ah(Qt.stretch-ae,Ce,It,lt),da=zu(Qt.fixed-je,Ue,Qt.stretch,U),Gr=Ah(Lt.stretch-ue,me,ut,pt),wr=zu(Lt.fixed-it,mt,Lt.stretch,V),Zi=new W(Ct,pr),Pr=new W(yn,pr),Br=new W(yn,Gr),Sr=new W(Ct,Gr),Wn=new W(fi/y,Or/y),Ea=new W(da/y,wr/y),Dr=t*Math.PI/180;if(Dr){const Nr=Math.sin(Dr),tn=Math.cos(Dr),qr=[tn,-Nr,Nr,tn];Zi._matMult(qr),Pr._matMult(qr),Sr._matMult(qr),Br._matMult(qr)}const pa=We.stretch+We.fixed,Zr=Ut.stretch+Ut.fixed;return{tl:Zi,tr:Pr,bl:Sr,br:Br,tex:{x:m.paddedRect.x+1+pa,y:m.paddedRect.y+1+Zr,w:Qt.stretch+Qt.fixed-pa,h:Lt.stretch+Lt.fixed-Zr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Wn,pixelOffsetBR:Ea,minFontScaleX:Ue/y/It,minFontScaleY:mt/y/ut,isSDF:r}};if(o&&(m.stretchX||m.stretchY)){const We=Ep(k,q,U),Ut=Ep(P,Y,V);for(let Qt=0;Qt<We.length-1;Qt++){const Lt=We[Qt],Ct=We[Qt+1];for(let fi=0;fi<Ut.length-1;fi++)h.push(ft(Lt,Ut[fi],Ct,Ut[fi+1]))}}else h.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:v+1}));return h}function Fs(n,t,r){let o=0;for(const h of n)o+=Math.max(t,Math.min(r,h[1]))-Math.max(t,Math.min(r,h[0]));return o}function Ep(n,t,r){const o=[{fixed:-1,stretch:0}];for(const[h,m]of n){const y=o[o.length-1];o.push({fixed:h-y.stretch,stretch:y.stretch}),o.push({fixed:h-y.stretch,stretch:y.stretch+(m-h)})}return o.push({fixed:t+1,stretch:r}),o}function Ah(n,t,r,o){return n/t*r+o}function zu(n,t,r,o){return n-t*r/o}_t("Anchor",nl);class Ed{constructor(t,r,o,h,m,y,x,v,M,k){var P;if(this.boxStartIndex=t.length,M){let B=y.top,U=y.bottom;const V=y.collisionPadding;V&&(B-=V[1],U+=V[3]);let q=U-B;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const B=!((P=y.image)===null||P===void 0)&&P.content&&(y.image.textFitWidth||y.image.textFitHeight)?gd(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};B.y1=B.y1*x-v[0],B.y2=B.y2*x+v[2],B.x1=B.x1*x-v[3],B.x2=B.x2*x+v[1];const U=y.collisionPadding;if(U&&(B.x1-=U[0]*x,B.y1-=U[1]*x,B.x2+=U[2]*x,B.y2+=U[3]*x),k){const V=new W(B.x1,B.y1),q=new W(B.x2,B.y1),Y=new W(B.x1,B.y2),ae=new W(B.x2,B.y2),Ce=k*Math.PI/180;V._rotate(Ce),q._rotate(Ce),Y._rotate(Ce),ae._rotate(Ce),B.x1=Math.min(V.x,q.x,Y.x,ae.x),B.x2=Math.max(V.x,q.x,Y.x,ae.x),B.y1=Math.min(V.y,q.y,Y.y,ae.y),B.y2=Math.max(V.y,q.y,Y.y,ae.y)}t.emplaceBack(r.x,r.y,B.x1,B.y1,B.x2,B.y2,o,h,m)}this.boxEndIndex=t.length}}class Wf{constructor(t=[],r=(o,h)=>o<h?-1:o>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:o}=this,h=r[t];for(;t>0;){const m=t-1>>1,y=r[m];if(o(h,y)>=0)break;r[t]=y,t=m}r[t]=h}_down(t){const{data:r,compare:o}=this,h=this.length>>1,m=r[t];for(;t<h;){let y=1+(t<<1);const x=y+1;if(x<this.length&&o(r[x],r[y])<0&&(y=x),o(r[y],m)>=0)break;r[t]=r[y],t=y}r[t]=m}}function bf(n,t=1,r=!1){const o=Ic.fromPoints(n[0]),h=Math.min(o.width(),o.height());let m=h/2;const y=new Wf([],Ap),{minX:x,minY:v,maxX:M,maxY:k}=o;if(h===0)return new W(x,v);for(let U=x;U<M;U+=h)for(let V=v;V<k;V+=h)y.push(new $l(U+m,V+m,m,n));let P=(function(U){let V=0,q=0,Y=0;const ae=U[0];for(let Ce=0,ue=ae.length,me=ue-1;Ce<ue;me=Ce++){const je=ae[Ce],Ue=ae[me],it=je.x*Ue.y-Ue.x*je.y;q+=(je.x+Ue.x)*it,Y+=(je.y+Ue.y)*it,V+=3*it}return new $l(q/V,Y/V,0,U)})(n),B=y.length;for(;y.length;){const U=y.pop();(U.d>P.d||!P.d)&&(P=U,r&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,B)),U.max-P.d<=t||(m=U.h/2,y.push(new $l(U.p.x-m,U.p.y-m,m,n)),y.push(new $l(U.p.x+m,U.p.y-m,m,n)),y.push(new $l(U.p.x-m,U.p.y+m,m,n)),y.push(new $l(U.p.x+m,U.p.y+m,m,n)),B+=4)}return r&&(console.log(`num probes: ${B}`),console.log(`best distance: ${P.d}`)),P.p}function Ap(n,t){return t.max-n.max}function $l(n,t,r,o){this.p=new W(n,t),this.h=r,this.d=(function(h,m){let y=!1,x=1/0;for(let v=0;v<m.length;v++){const M=m[v];for(let k=0,P=M.length,B=P-1;k<P;B=k++){const U=M[k],V=M[B];U.y>h.y!=V.y>h.y&&h.x<(V.x-U.x)*(h.y-U.y)/(V.y-U.y)+U.x&&(y=!y),x=Math.min(x,Qr(h,U,V))}}return(y?1:-1)*Math.sqrt(x)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var kn;z.aE=void 0,(kn=z.aE||(z.aE={}))[kn.center=1]="center",kn[kn.left=2]="left",kn[kn.right=3]="right",kn[kn.top=4]="top",kn[kn.bottom=5]="bottom",kn[kn["top-left"]=6]="top-left",kn[kn["top-right"]=7]="top-right",kn[kn["bottom-left"]=8]="bottom-left",kn[kn["bottom-right"]=9]="bottom-right";const Ca=Number.POSITIVE_INFINITY;function Ad(n,t){return t[1]!==Ca?(function(r,o,h){let m=0,y=0;switch(o=Math.abs(o),h=Math.abs(h),r){case"top-right":case"top-left":case"top":y=h-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-h}switch(r){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,y]})(n,t[0],t[1]):(function(r,o){let h=0,m=0;o<0&&(o=0);const y=o/Math.SQRT2;switch(r){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-o;break;case"top":m=o-7}switch(r){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=o;break;case"right":h=-o}return[h,m]})(n,t[0])}function zp(n,t,r){var o;const h=n.layout,m=(o=h.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},r);if(m){const x=m.values,v=[];for(let M=0;M<x.length;M+=2){const k=v[M]=x[M],P=x[M+1].map((B=>B*Ir));k.startsWith("top")?P[1]-=7:k.startsWith("bottom")&&(P[1]+=7),v[M+1]=P}return new gr(v)}const y=h.get("text-variable-anchor");if(y){let x;x=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},r)*Ir,Ca]:h.get("text-offset").evaluate(t,{},r).map((M=>M*Ir));const v=[];for(const M of y)v.push(M,Ad(M,x));return new gr(v)}return null}function zd(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wf(n,t,r,o,h,m,y,x,v,M,k,P){let B=m.textMaxSize.evaluate(t,{});B===void 0&&(B=y);const U=n.layers[0].layout,V=U.get("icon-offset").evaluate(t,{},k),q=es(r.horizontal),Y=y/24,ae=n.tilePixelRatio*Y,Ce=n.tilePixelRatio*B/24,ue=n.tilePixelRatio*x,me=n.tilePixelRatio*U.get("symbol-spacing"),je=U.get("text-padding")*n.tilePixelRatio,Ue=(function(Qt,Lt,Ct,fi=1){const pr=Qt.get("icon-padding").evaluate(Lt,{},Ct),Or=pr&&pr.values;return[Or[0]*fi,Or[1]*fi,Or[2]*fi,Or[3]*fi]})(U,t,k,n.tilePixelRatio),it=U.get("text-max-angle")/180*Math.PI,mt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",lt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",pt=U.get("symbol-placement"),It=me/2,ut=U.get("icon-text-fit");let ft;o&&ut!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(ft=Sh(o,r.vertical,ut,U.get("icon-text-fit-padding"),V,Y)),q&&(o=Sh(o,q,ut,U.get("icon-text-fit-padding"),V,Y)));const We=k?P.line.getGranularityForZoomLevel(k.z):1,Ut=(Qt,Lt)=>{Lt.x<0||Lt.x>=At||Lt.y<0||Lt.y>=At||(function(Ct,fi,pr,Or,yn,da,Gr,wr,Zi,Pr,Br,Sr,Wn,Ea,Dr,pa,Zr,Nr,tn,qr,er,Aa,Pc,Yn,Cf){const Vl=Ct.addToLineVertexArray(fi,pr);let bo,Dc,Pu,al,i=0,s=0,c=0,f=0,b=-1,T=-1;const j={};let H=Ds("");if(Ct.allowVerticalPlacement&&Or.vertical){const Tt=wr.layout.get("text-rotate").evaluate(er,{},Yn)+90;Pu=new Ed(Zi,fi,Pr,Br,Sr,Or.vertical,Wn,Ea,Dr,Tt),Gr&&(al=new Ed(Zi,fi,Pr,Br,Sr,Gr,Zr,Nr,Dr,Tt))}if(yn){const Tt=wr.layout.get("icon-rotate").evaluate(er,{}),Jt=wr.layout.get("icon-text-fit")!=="none",yi=vf(yn,Tt,Pc,Jt),_i=Gr?vf(Gr,Tt,Pc,Jt):void 0;Dc=new Ed(Zi,fi,Pr,Br,Sr,yn,Zr,Nr,!1,Tt),i=4*yi.length;const za=Ct.iconSizeData;let wo=null;za.kind==="source"?(wo=[Os*wr.layout.get("icon-size").evaluate(er,{})],wo[0]>ha&&zi(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):za.kind==="composite"&&(wo=[Os*Aa.compositeIconSizes[0].evaluate(er,{},Yn),Os*Aa.compositeIconSizes[1].evaluate(er,{},Yn)],(wo[0]>ha||wo[1]>ha)&&zi(`${Ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ct.addSymbols(Ct.icon,yi,wo,qr,tn,er,z.ao.none,fi,Vl.lineStartIndex,Vl.lineLength,-1,Yn),b=Ct.icon.placedSymbolArray.length-1,_i&&(s=4*_i.length,Ct.addSymbols(Ct.icon,_i,wo,qr,tn,er,z.ao.vertical,fi,Vl.lineStartIndex,Vl.lineLength,-1,Yn),T=Ct.icon.placedSymbolArray.length-1)}const ye=Object.keys(Or.horizontal);for(const Tt of ye){const Jt=Or.horizontal[Tt];if(!bo){H=Ds(Jt.text);const _i=wr.layout.get("text-rotate").evaluate(er,{},Yn);bo=new Ed(Zi,fi,Pr,Br,Sr,Jt,Wn,Ea,Dr,_i)}const yi=Jt.positionedLines.length===1;if(c+=Iu(Ct,fi,Jt,da,wr,Dr,er,pa,Vl,Or.vertical?z.ao.horizontal:z.ao.horizontalOnly,yi?ye:[Tt],j,b,Aa,Yn),yi)break}Or.vertical&&(f+=Iu(Ct,fi,Or.vertical,da,wr,Dr,er,pa,Vl,z.ao.vertical,["vertical"],j,T,Aa,Yn));const Fe=bo?bo.boxStartIndex:Ct.collisionBoxArray.length,Je=bo?bo.boxEndIndex:Ct.collisionBoxArray.length,rt=Pu?Pu.boxStartIndex:Ct.collisionBoxArray.length,$e=Pu?Pu.boxEndIndex:Ct.collisionBoxArray.length,qe=Dc?Dc.boxStartIndex:Ct.collisionBoxArray.length,Dt=Dc?Dc.boxEndIndex:Ct.collisionBoxArray.length,ii=al?al.boxStartIndex:Ct.collisionBoxArray.length,fr=al?al.boxEndIndex:Ct.collisionBoxArray.length;let Ie=-1;const ke=(Tt,Jt)=>Tt&&Tt.circleDiameter?Math.max(Tt.circleDiameter,Jt):Jt;Ie=ke(bo,Ie),Ie=ke(Pu,Ie),Ie=ke(Dc,Ie),Ie=ke(al,Ie);const Ne=Ie>-1?1:0;Ne&&(Ie*=Cf/Ir),Ct.glyphOffsetArray.length>=Fl.MAX_GLYPHS&&zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),er.sortKey!==void 0&&Ct.addToSortKeyRanges(Ct.symbolInstances.length,er.sortKey);const tt=zp(wr,er,Yn),[Yt,Wi]=(function(Tt,Jt){const yi=Tt.length,_i=Jt?.values;if(_i?.length>0)for(let za=0;za<_i.length;za+=2){const wo=_i[za+1];Tt.emplaceBack(z.aE[_i[za]],wo[0],wo[1])}return[yi,Tt.length]})(Ct.textAnchorOffsets,tt);Ct.symbolInstances.emplaceBack(fi.x,fi.y,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical||-1,b,T,H,Fe,Je,rt,$e,qe,Dt,ii,fr,Pr,c,f,i,s,Ne,0,Wn,Ie,Yt,Wi)})(n,Lt,Qt,r,o,h,ft,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,ae,[je,je,je,je],mt,v,ue,Ue,lt,V,t,m,M,k,y)};if(pt==="line")for(const Qt of kp(t.geometry,0,0,At,At)){const Lt=Rl(Qt,We),Ct=_f(Lt,me,it,r.vertical||q,o,24,Ce,n.overscaling,At);for(const fi of Ct)q&&Sf(n,q.text,It,fi)||Ut(Lt,fi)}else if(pt==="line-center"){for(const Qt of t.geometry)if(Qt.length>1){const Lt=Rl(Qt,We),Ct=Xf(Lt,it,r.vertical||q,o,24,Ce);Ct&&Ut(Lt,Ct)}}else if(t.type==="Polygon")for(const Qt of Po(t.geometry,0)){const Lt=bf(Qt,16);Ut(Rl(Qt[0],We,!0),new nl(Lt.x,Lt.y,0))}else if(t.type==="LineString")for(const Qt of t.geometry){const Lt=Rl(Qt,We);Ut(Lt,new nl(Lt[0].x,Lt[0].y,0))}else if(t.type==="Point")for(const Qt of t.geometry)for(const Lt of Qt)Ut([Lt],new nl(Lt.x,Lt.y,0))}function Iu(n,t,r,o,h,m,y,x,v,M,k,P,B,U,V){const q=(function(Ce,ue,me,je,Ue,it,mt,lt){const pt=je.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,It=[];for(const ut of ue.positionedLines)for(const ft of ut.positionedGlyphs){if(!ft.rect)continue;const We=ft.rect||{};let Ut=4,Qt=!0,Lt=1,Ct=0;const fi=(Ue||lt)&&ft.vertical,pr=ft.metrics.advance*ft.scale/2;if(lt&&ue.verticalizable&&(Ct=ut.lineOffset/2-(ft.imageName?-(Ir-ft.metrics.width*ft.scale)/2:(ft.scale-1)*Ir)),ft.imageName){const Nr=mt[ft.imageName];Qt=Nr.sdf,Lt=Nr.pixelRatio,Ut=1/Lt}const Or=Ue?[ft.x+pr,ft.y]:[0,0];let yn=Ue?[0,0]:[ft.x+pr+me[0],ft.y+me[1]-Ct],da=[0,0];fi&&(da=yn,yn=[0,0]);const Gr=ft.metrics.isDoubleResolution?2:1,wr=(ft.metrics.left-Ut)*ft.scale-pr+yn[0],Zi=(-ft.metrics.top-Ut)*ft.scale+yn[1],Pr=wr+We.w/Gr*ft.scale/Lt,Br=Zi+We.h/Gr*ft.scale/Lt,Sr=new W(wr,Zi),Wn=new W(Pr,Zi),Ea=new W(wr,Br),Dr=new W(Pr,Br);if(fi){const Nr=new W(-pr,pr- -17),tn=-Math.PI/2,qr=12-pr,er=new W(22-qr,-(ft.imageName?qr:0)),Aa=new W(...da);Sr._rotateAround(tn,Nr)._add(er)._add(Aa),Wn._rotateAround(tn,Nr)._add(er)._add(Aa),Ea._rotateAround(tn,Nr)._add(er)._add(Aa),Dr._rotateAround(tn,Nr)._add(er)._add(Aa)}if(pt){const Nr=Math.sin(pt),tn=Math.cos(pt),qr=[tn,-Nr,Nr,tn];Sr._matMult(qr),Wn._matMult(qr),Ea._matMult(qr),Dr._matMult(qr)}const pa=new W(0,0),Zr=new W(0,0);It.push({tl:Sr,tr:Wn,bl:Ea,br:Dr,tex:We,writingMode:ue.writingMode,glyphOffset:Or,sectionIndex:ft.sectionIndex,isSDF:Qt,pixelOffsetTL:pa,pixelOffsetBR:Zr,minFontScaleX:0,minFontScaleY:0})}return It})(0,r,x,h,m,y,o,n.allowVerticalPlacement),Y=n.textSizeData;let ae=null;Y.kind==="source"?(ae=[Os*h.layout.get("text-size").evaluate(y,{})],ae[0]>ha&&zi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Y.kind==="composite"&&(ae=[Os*U.compositeTextSizes[0].evaluate(y,{},V),Os*U.compositeTextSizes[1].evaluate(y,{},V)],(ae[0]>ha||ae[1]>ha)&&zi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,q,ae,x,m,y,M,t,v.lineStartIndex,v.lineLength,B,V);for(const Ce of k)P[Ce]=n.text.placedSymbolArray.length-1;return 4*q.length}function es(n){for(const t in n)return n[t];return null}function Sf(n,t,r,o){const h=n.compareText;if(t in h){const m=h[t];for(let y=m.length-1;y>=0;y--)if(o.dist(m[y])<r)return!0}else h[t]=[];return h[t].push(o),!1}const zh=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Us{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=zh[15&o];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Us(x,y,m,t)}constructor(t,r=64,o=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=zh.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+v,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+v),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+v,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=r,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ip(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:x}=this,v=[0,m.length-1,0],M=[];for(;v.length;){const k=v.pop()||0,P=v.pop()||0,B=v.pop()||0;if(P-B<=x){for(let Y=B;Y<=P;Y++){const ae=y[2*Y],Ce=y[2*Y+1];ae>=t&&ae<=o&&Ce>=r&&Ce<=h&&M.push(m[Y])}continue}const U=B+P>>1,V=y[2*U],q=y[2*U+1];V>=t&&V<=o&&q>=r&&q<=h&&M.push(m[U]),(k===0?t<=V:r<=q)&&(v.push(B),v.push(U-1),v.push(1-k)),(k===0?o>=V:h>=q)&&(v.push(U+1),v.push(P),v.push(1-k))}return M}within(t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:y}=this,x=[0,h.length-1,0],v=[],M=o*o;for(;x.length;){const k=x.pop()||0,P=x.pop()||0,B=x.pop()||0;if(P-B<=y){for(let Y=B;Y<=P;Y++)Mf(m[2*Y],m[2*Y+1],t,r)<=M&&v.push(h[Y]);continue}const U=B+P>>1,V=m[2*U],q=m[2*U+1];Mf(V,q,t,r)<=M&&v.push(h[U]),(k===0?t-o<=V:r-o<=q)&&(x.push(B),x.push(U-1),x.push(1-k)),(k===0?t+o>=V:r+o>=q)&&(x.push(U+1),x.push(P),x.push(1-k))}return v}}function Ip(n,t,r,o,h,m){if(h-o<=r)return;const y=o+h>>1;Tf(n,t,y,o,h,m),Ip(n,t,r,o,y-1,1-m),Ip(n,t,r,y+1,h,1-m)}function Tf(n,t,r,o,h,m){for(;h>o;){if(h-o>600){const M=h-o+1,k=r-o+1,P=Math.log(M),B=.5*Math.exp(2*P/3),U=.5*Math.sqrt(P*B*(M-B)/M)*(k-M/2<0?-1:1);Tf(n,t,r,Math.max(o,Math.floor(r-k*B/M+U)),Math.min(h,Math.floor(r+(M-k)*B/M+U)),m)}const y=t[2*r+m];let x=o,v=h;for(vo(n,t,o,r),t[2*h+m]>y&&vo(n,t,o,h);x<v;){for(vo(n,t,x,v),x++,v--;t[2*x+m]<y;)x++;for(;t[2*v+m]>y;)v--}t[2*o+m]===y?vo(n,t,o,v):(v++,vo(n,t,v,h)),v<=r&&(o=v+1),r<=v&&(h=v-1)}}function vo(n,t,r,o){Id(n,r,o),Id(t,2*r,2*o),Id(t,2*r+1,2*o+1)}function Id(n,t,r){const o=n[t];n[t]=n[r],n[r]=o}function Mf(n,t,r,o){const h=n-r,m=t-o;return h*h+m*m}var Pp;z.cx=void 0,(Pp=z.cx||(z.cx={})).create="create",Pp.load="load",Pp.fullLoad="fullLoad";let Pd=null,Ih=[];const Dp=1e3/60,Rp="loadTime",Lp="fullLoadTime",kf={mark(n){performance.mark(n)},frame(n){const t=n;Pd!=null&&Ih.push(t-Pd),Pd=t},clearMetrics(){Pd=null,Ih=[],performance.clearMeasures(Rp),performance.clearMeasures(Lp);for(const n in z.cx)performance.clearMarks(z.cx[n])},getPerformanceMetrics(){performance.measure(Rp,z.cx.create,z.cx.load),performance.measure(Lp,z.cx.create,z.cx.fullLoad);const n=performance.getEntriesByName(Rp)[0].duration,t=performance.getEntriesByName(Lp)[0].duration,r=Ih.length,o=1/(Ih.reduce(((m,y)=>m+y),0)/r/1e3),h=Ih.filter((m=>m>Dp)).reduce(((m,y)=>m+(y-Dp)/Dp),0);return{loadTime:n,fullLoadTime:t,fps:o,percentDroppedFrames:h/(r+h)*100,totalFrames:r}}};z.$=At,z.A=$t,z.B=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},z.C=In,z.D=Mt,z.E=ct,z.F=Vi,z.G=ou,z.H=Ei,z.I=up,z.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ff((()=>this.process())),this.subscription=dr(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=cn(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise(((r,o)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),m=t?dr(t.signal,"abort",(()=>{m?.unsubscribe(),delete this.resolveRejects[h];const v={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)}),Di):null;this.resolveRejects[h]={resolve:v=>{m?.unsubscribe(),r(v)},reject:v=>{m?.unsubscribe(),o(v)}};const y=[],x=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:ao(n.data,y)});this.target.postMessage(x,{transfer:y})}))}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(cn(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return u(this,void 0,void 0,(function*(){if(t.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(Es(t.error)):h.resolve(Es(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Es(t.data),o=new AbortController;this.abortControllers[n]=o;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,r,o);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}}))}completeTask(n,t,r){const o=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ao(t):null,data:ao(r,o)};this.target.postMessage(h,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},z.K=G,z.L=function(){var n=new $t(16);return $t!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},z.M=function(n,t,r){var o,h,m,y,x,v,M,k,P,B,U,V,q=r[0],Y=r[1],ae=r[2];return t===n?(n[12]=t[0]*q+t[4]*Y+t[8]*ae+t[12],n[13]=t[1]*q+t[5]*Y+t[9]*ae+t[13],n[14]=t[2]*q+t[6]*Y+t[10]*ae+t[14],n[15]=t[3]*q+t[7]*Y+t[11]*ae+t[15]):(h=t[1],m=t[2],y=t[3],x=t[4],v=t[5],M=t[6],k=t[7],P=t[8],B=t[9],U=t[10],V=t[11],n[0]=o=t[0],n[1]=h,n[2]=m,n[3]=y,n[4]=x,n[5]=v,n[6]=M,n[7]=k,n[8]=P,n[9]=B,n[10]=U,n[11]=V,n[12]=o*q+x*Y+P*ae+t[12],n[13]=h*q+v*Y+B*ae+t[13],n[14]=m*q+M*Y+U*ae+t[14],n[15]=y*q+k*Y+V*ae+t[15]),n},z.N=function(n,t,r){var o=r[0],h=r[1],m=r[2];return n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*m,n[9]=t[9]*m,n[10]=t[10]*m,n[11]=t[11]*m,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},z.O=function(n,t,r){var o=t[0],h=t[1],m=t[2],y=t[3],x=t[4],v=t[5],M=t[6],k=t[7],P=t[8],B=t[9],U=t[10],V=t[11],q=t[12],Y=t[13],ae=t[14],Ce=t[15],ue=r[0],me=r[1],je=r[2],Ue=r[3];return n[0]=ue*o+me*x+je*P+Ue*q,n[1]=ue*h+me*v+je*B+Ue*Y,n[2]=ue*m+me*M+je*U+Ue*ae,n[3]=ue*y+me*k+je*V+Ue*Ce,n[4]=(ue=r[4])*o+(me=r[5])*x+(je=r[6])*P+(Ue=r[7])*q,n[5]=ue*h+me*v+je*B+Ue*Y,n[6]=ue*m+me*M+je*U+Ue*ae,n[7]=ue*y+me*k+je*V+Ue*Ce,n[8]=(ue=r[8])*o+(me=r[9])*x+(je=r[10])*P+(Ue=r[11])*q,n[9]=ue*h+me*v+je*B+Ue*Y,n[10]=ue*m+me*M+je*U+Ue*ae,n[11]=ue*y+me*k+je*V+Ue*Ce,n[12]=(ue=r[12])*o+(me=r[13])*x+(je=r[14])*P+(Ue=r[15])*q,n[13]=ue*h+me*v+je*B+Ue*Y,n[14]=ue*m+me*M+je*U+Ue*ae,n[15]=ue*y+me*k+je*V+Ue*Ce,n},z.P=W,z.Q=function(n,t){const r={};for(let o=0;o<t.length;o++){const h=t[o];h in n&&(r[h]=n[h])}return r},z.R=Nn,z.S=Ns,z.T=gu,z.U=Au,z.V=bd,z.W=St,z.X=wt,z.Y=Hr,z.Z=Mi,z._=u,z.a=O,z.a$=Vt,z.a0=function(n,t){var r,o,h,m,y;if(!n)return t??{};if(!t)return n;let x=Object.assign({},n);if(t.removeAll&&(x={removeAll:!0}),t.remove){const v=new Set(t.remove);x.add&&(x.add=x.add.filter((k=>!v.has(k.id)))),x.update&&(x.update=x.update.filter((k=>!v.has(k.id))));const M=new Set(((r=n.add)!==null&&r!==void 0?r:[]).map((k=>k.id)));t.remove=t.remove.filter((k=>!M.has(k)))}if(t.remove){const v=new Set(x.remove?x.remove.concat(t.remove):t.remove);x.remove=Array.from(v.values())}if(t.add){const v=x.add?x.add.concat(t.add):t.add,M=new Map(v.map((k=>[k.id,k])));x.add=Array.from(M.values())}if(t.update){const v=new Map((o=x.update)===null||o===void 0?void 0:o.map((M=>[M.id,M])));for(const M of t.update){const k=(h=v.get(M.id))!==null&&h!==void 0?h:{id:M.id};M.newGeometry&&(k.newGeometry=M.newGeometry),M.addOrUpdateProperties&&(k.addOrUpdateProperties=((m=k.addOrUpdateProperties)!==null&&m!==void 0?m:[]).concat(M.addOrUpdateProperties)),M.removeProperties&&(k.removeProperties=((y=k.removeProperties)!==null&&y!==void 0?y:[]).concat(M.removeProperties)),M.removeAllProperties&&(k.removeAllProperties=!0),v.set(M.id,k)}x.update=Array.from(v.values())}return x.remove&&x.add&&(x.remove=x.remove.filter((v=>x.add.findIndex((M=>M.id===v))===-1))),x},z.a1=Eh,z.a2=Ic,z.a3=25,z.a4=wd,z.a5=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((r=>{t.onloadstart=()=>{r(t)};for(const o of n){const h=window.document.createElement("source");Pe(o)||(t.crossOrigin="Anonymous"),h.src=o,t.appendChild(h)}}))},z.a6=Me,z.a7=function(){return vi++},z.a8=E,z.a9=Fl,z.aA=function(n){let t=1/0,r=1/0,o=-1/0,h=-1/0;for(const m of n)t=Math.min(t,m.x),r=Math.min(r,m.y),o=Math.max(o,m.x),h=Math.max(h,m.y);return[t,r,o,h]},z.aB=Ir,z.aC=mi,z.aD=function(n,t,r,o,h=!1){if(!r[0]&&!r[1])return[0,0];const m=h?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(m){const y=Math.sin(m),x=Math.cos(m);r=[r[0]*x-r[1]*y,r[0]*y+r[1]*x]}return[h?r[0]:mi(t,r[0],n.zoom),h?r[1]:mi(t,r[1],n.zoom)]},z.aF=zc,z.aG=zd,z.aH=wh,z.aI=Us,z.aJ=Gi,z.aK=wc,z.aL=se,z.aM=ci,z.aN=Wt,z.aO=ei,z.aP=rn,z.aQ=Sp,z.aR=Ri,z.aS=Ui,z.aT=function(n){var t=new $t(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},z.aU=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},z.aV=function(n,t){var r=t[0],o=t[1],h=t[2],m=r*r+o*o+h*h;return m>0&&(m=1/Math.sqrt(m)),n[0]=t[0]*m,n[1]=t[1]*m,n[2]=t[2]*m,n},z.aW=Yi,z.aX=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},z.aY=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},z.aZ=Ft,z.a_=function(n,t,r){const o=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return o===0?null:(-(n[0]*r[0]+n[1]*r[1]+n[2]*r[2])-r[3])/o},z.aa=jn,z.ab=Ka,z.ac=gf,z.ad=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,o,h,m)=>{const y=h||m;return t[o]=!y||y.toLowerCase(),""})),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},z.ae=Gt,z.af=85.051129,z.ag=fa,z.ah=function(n){return Math.pow(2,n)},z.ai=Rt,z.aj=Ch,z.ak=function(n){return Math.log(n)/Math.LN2},z.al=function(n){var t=n[0],r=n[1];return t*t+r*r},z.am=function(n){if(!n.length)return new Set;const t=Math.max(...n.map((v=>v.canonical.z)));let r=1/0,o=-1/0,h=1/0,m=-1/0;const y=[];for(const v of n){const{x:M,y:k,z:P}=v.canonical,B=Math.pow(2,t-P),U=M*B,V=k*B;y.push({id:v,x:U,y:V}),U<r&&(r=U),U>o&&(o=U),V<h&&(h=V),V>m&&(m=V)}const x=new Set;for(const v of y)v.x!==r&&v.x!==o&&v.y!==h&&v.y!==m||x.add(v.id);return x},z.an=function(n,t){let r=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:m,maxZoom:y}=n,x=h?Gt(zn.interpolationFactor(h,t,m,y),0,1):0;n.kind==="camera"?o=In.number(n.minSize,n.maxSize,x):r=x}return{uSizeT:r,uSize:o}},z.ap=function(n,{uSize:t,uSizeT:r},{lowerSize:o,upperSize:h}){return n.kind==="source"?o/Os:n.kind==="composite"?In.number(o/Os,h/Os,r):t},z.aq=function(n,t){var r=t[0],o=t[1],h=t[2],m=t[3],y=t[4],x=t[5],v=t[6],M=t[7],k=t[8],P=t[9],B=t[10],U=t[11],V=t[12],q=t[13],Y=t[14],ae=t[15],Ce=r*x-o*y,ue=r*v-h*y,me=r*M-m*y,je=o*v-h*x,Ue=o*M-m*x,it=h*M-m*v,mt=k*q-P*V,lt=k*Y-B*V,pt=k*ae-U*V,It=P*Y-B*q,ut=P*ae-U*q,ft=B*ae-U*Y,We=Ce*ft-ue*ut+me*It+je*pt-Ue*lt+it*mt;return We?(n[0]=(x*ft-v*ut+M*It)*(We=1/We),n[1]=(h*ut-o*ft-m*It)*We,n[2]=(q*it-Y*Ue+ae*je)*We,n[3]=(B*Ue-P*it-U*je)*We,n[4]=(v*pt-y*ft-M*lt)*We,n[5]=(r*ft-h*pt+m*lt)*We,n[6]=(Y*me-V*it-ae*ue)*We,n[7]=(k*it-B*me+U*ue)*We,n[8]=(y*ut-x*pt+M*mt)*We,n[9]=(o*pt-r*ut-m*mt)*We,n[10]=(V*Ue-q*me+ae*Ce)*We,n[11]=(P*me-k*Ue-U*Ce)*We,n[12]=(x*lt-y*It-v*mt)*We,n[13]=(r*It-o*lt+h*mt)*We,n[14]=(q*ue-V*je-Y*Ce)*We,n[15]=(k*je-P*ue+B*Ce)*We,n):null},z.ar=gt,z.as=function(n){var t=n[0],r=n[1];return Math.sqrt(t*t+r*r)},z.at=function(n){return n[0]=0,n[1]=0,n},z.au=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},z.av=yd,z.aw=Kt,z.ax=function(n,t,r,o){const h=t.y-n.y,m=t.x-n.x,y=o.y-r.y,x=o.x-r.x,v=y*m-x*h;if(v===0)return null;const M=(x*(n.y-r.y)-y*(n.x-r.x))/v;return new W(n.x+M*m,n.y+M*h)},z.ay=kp,z.az=nh,z.b=An,z.b$=class extends fn{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},z.b0=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},z.b1=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},z.b2=Tp,z.b3=Ul,z.b4=function(n,t,r,o,h){var m=1/Math.tan(t/2);if(n[0]=m/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0){var y=1/(o-h);n[10]=(h+o)*y,n[14]=2*h*o*y}else n[10]=-1,n[14]=-2*o;return n},z.b5=function(n){var t=new $t(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},z.b6=function(n,t,r){var o=Math.sin(r),h=Math.cos(r),m=t[0],y=t[1],x=t[2],v=t[3],M=t[4],k=t[5],P=t[6],B=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=m*h+M*o,n[1]=y*h+k*o,n[2]=x*h+P*o,n[3]=v*h+B*o,n[4]=M*h-m*o,n[5]=k*h-y*o,n[6]=P*h-x*o,n[7]=B*h-v*o,n},z.b7=function(n,t,r){var o=Math.sin(r),h=Math.cos(r),m=t[4],y=t[5],x=t[6],v=t[7],M=t[8],k=t[9],P=t[10],B=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=m*h+M*o,n[5]=y*h+k*o,n[6]=x*h+P*o,n[7]=v*h+B*o,n[8]=M*h-m*o,n[9]=k*h-y*o,n[10]=P*h-x*o,n[11]=B*h-v*o,n},z.b8=function(){const n=new Float32Array(16);return Rt(n),n},z.b9=function(){const n=new Float64Array(16);return Rt(n),n},z.bA=function(n,t){const r=be(n,360),o=be(t,360),h=o-r,m=o>r?h-360:h+360;return Math.abs(h)<Math.abs(m)?h:m},z.bB=function(n){return n[0]=0,n[1]=0,n[2]=0,n},z.bC=function(n,t,r,o){const h=Math.sqrt(n*n+t*t),m=Math.sqrt(r*r+o*o);n/=h,t/=h,r/=m,o/=m;const y=Math.acos(n*r+t*o);return-t*r+n*o>0?y:-y},z.bD=function(n,t){const r=be(n,2*Math.PI),o=be(t,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},z.bE=function(){const n={},t=_e.$version;for(const r in _e.$root){const o=_e.$root[r];if(o.required){let h=null;h=r==="version"?t:o.type==="array"?[]:{},h!=null&&(n[r]=h)}}return n},z.bF=cu,z.bG=le,z.bH=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!n(t[o],r[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(!n(t[o],r[o]))return!1;return!0}return t===r},z.bI=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=Ii(n[r],t[n[r].ref]));return n},z.bJ=function(n,t){if(n.type==="custom")return new Hf(n,t);switch(n.type){case"background":return new Mh(n,t);case"circle":return new Zd(n,t);case"color-relief":return new jf(n,t);case"fill":return new bu(n,t);case"fill-extrusion":return new Su(n,t);case"heatmap":return new Hd(n,t);case"hillshade":return new Ko(n,t);case"line":return new hd(n,t);case"raster":return new sa(n,t);case"symbol":return new Eu(n,t)}},z.bK=n=>n.type==="raster",z.bL=Tr,z.bM=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!zt(n.version,t.version))return[{command:"setStyle",args:[t]}];zt(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),zt(n.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),zt(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),zt(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),zt(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),zt(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),zt(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),zt(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),zt(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),zt(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),zt(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),zt(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),zt(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),zt(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const o={},h=[];(function(y,x,v,M){let k;for(k in x=x||{},y=y||{})Object.prototype.hasOwnProperty.call(y,k)&&(Object.prototype.hasOwnProperty.call(x,k)||mr(k,v,M));for(k in x)Object.prototype.hasOwnProperty.call(x,k)&&(Object.prototype.hasOwnProperty.call(y,k)?zt(y[k],x[k])||(y[k].type==="geojson"&&x[k].type==="geojson"&&gi(y,x,k)?oi(v,{command:"setGeoJSONSourceData",args:[k,x[k].data]}):nr(k,x,v,M)):ki(k,x,v))})(n.sources,t.sources,h,o);const m=[];n.layers&&n.layers.forEach((y=>{"source"in y&&o[y.source]?r.push({command:"removeLayer",args:[y.id]}):m.push(y)})),r=r.concat(h),(function(y,x,v){x=x||[];const M=(y=y||[]).map(Ke),k=x.map(Ke),P=y.reduce(pe,{}),B=x.reduce(pe,{}),U=M.slice(),V=Object.create(null);let q,Y,ae,Ce,ue;for(let me=0,je=0;me<M.length;me++)q=M[me],Object.prototype.hasOwnProperty.call(B,q)?je++:(oi(v,{command:"removeLayer",args:[q]}),U.splice(U.indexOf(q,je),1));for(let me=0,je=0;me<k.length;me++)q=k[k.length-1-me],U[U.length-1-me]!==q&&(Object.prototype.hasOwnProperty.call(P,q)?(oi(v,{command:"removeLayer",args:[q]}),U.splice(U.lastIndexOf(q,U.length-je),1)):je++,Ce=U[U.length-me],oi(v,{command:"addLayer",args:[B[q],Ce]}),U.splice(U.length-me,0,q),V[q]=!0);for(let me=0;me<k.length;me++)if(q=k[me],Y=P[q],ae=B[q],!V[q]&&!zt(Y,ae))if(zt(Y.source,ae.source)&&zt(Y["source-layer"],ae["source-layer"])&&zt(Y.type,ae.type)){for(ue in ze(Y.layout,ae.layout,v,q,null,"setLayoutProperty"),ze(Y.paint,ae.paint,v,q,null,"setPaintProperty"),zt(Y.filter,ae.filter)||oi(v,{command:"setFilter",args:[q,ae.filter]}),zt(Y.minzoom,ae.minzoom)&&zt(Y.maxzoom,ae.maxzoom)||oi(v,{command:"setLayerZoomRange",args:[q,ae.minzoom,ae.maxzoom]}),Y)Object.prototype.hasOwnProperty.call(Y,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?ze(Y[ue],ae[ue],v,q,ue.slice(6),"setPaintProperty"):zt(Y[ue],ae[ue])||oi(v,{command:"setLayerProperty",args:[q,ue,ae[ue]]}));for(ue in ae)Object.prototype.hasOwnProperty.call(ae,ue)&&!Object.prototype.hasOwnProperty.call(Y,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?ze(Y[ue],ae[ue],v,q,ue.slice(6),"setPaintProperty"):zt(Y[ue],ae[ue])||oi(v,{command:"setLayerProperty",args:[q,ue,ae[ue]]}))}else oi(v,{command:"removeLayer",args:[q]}),Ce=U[U.lastIndexOf(q)+1],oi(v,{command:"addLayer",args:[ae,Ce]})})(m,t.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[t]}]}return r},z.bN=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},z.bO=Cn,z.bP=_n,z.bQ=class extends fn{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},z.bR=jr,z.bS=class extends fn{constructor(n,t){super(n,t),this.current=ln}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},z.bT=Wo,z.bU=class extends fn{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},z.bV=class extends fn{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},z.bW=Fi,z.bX=function(n,t){var r=Math.sin(t),o=Math.cos(t);return n[0]=o,n[1]=r,n[2]=0,n[3]=-r,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},z.bY=function(n,t,r){var o=t[0],h=t[1],m=t[2];return n[0]=o*r[0]+h*r[3]+m*r[6],n[1]=o*r[1]+h*r[4]+m*r[7],n[2]=o*r[2]+h*r[5]+m*r[8],n},z.bZ=function(n,t,r,o,h,m,y){var x=1/(t-r),v=1/(o-h),M=1/(m-y);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*v,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*M,n[11]=0,n[12]=(t+r)*x,n[13]=(h+o)*v,n[14]=(y+m)*M,n[15]=1,n},z.b_=class extends fn{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;const t=new Float32Array(4*n.length);for(let r=0;r<n.length;r++)t[4*r]=n[r].r,t[4*r+1]=n[r].g,t[4*r+2]=n[r].b,t[4*r+3]=n[r].a;this.gl.uniform4fv(this.location,t)}}},z.ba=function(){return new Float64Array(16)},z.bb=function(n,t,r){const o=new Float64Array(4);return He(o,n,t-90,r),o},z.bc=function(n,t,r,o){var h,m,y,x,v,M=t[0],k=t[1],P=t[2],B=t[3],U=r[0],V=r[1],q=r[2],Y=r[3];return(m=M*U+k*V+P*q+B*Y)<0&&(m=-m,U=-U,V=-V,q=-q,Y=-Y),1-m>jt?(h=Math.acos(m),y=Math.sin(h),x=Math.sin((1-o)*h)/y,v=Math.sin(o*h)/y):(x=1-o,v=o),n[0]=x*M+v*U,n[1]=x*k+v*V,n[2]=x*P+v*q,n[3]=x*B+v*Y,n},z.bd=function(n){const t=new Float64Array(9);var r,o,h,m,y,x,v,M,k,P,B,U,V,q,Y,ae,Ce,ue;P=(h=(o=n)[0])*(v=h+h),B=(m=o[1])*v,V=(y=o[2])*v,q=y*(M=m+m),ae=(x=o[3])*v,Ce=x*M,ue=x*(k=y+y),(r=t)[0]=1-(U=m*M)-(Y=y*k),r[3]=B-ue,r[6]=V+Ce,r[1]=B+ue,r[4]=1-P-Y,r[7]=q-ae,r[2]=V-Ce,r[5]=q+ae,r[8]=1-P-U;const me=rn(-Math.asin(Gt(t[2],-1,1)));let je,Ue;return Math.hypot(t[5],t[8])<.001?(je=0,Ue=-rn(Math.atan2(t[3],t[4]))):(je=rn(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Ue=rn(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:je,pitch:me+90,bearing:Ue}},z.be=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},z.bf=ti,z.bg=Ta,z.bh=mn,z.bi=la,z.bj=vu,z.bk=Ye,z.bl=yt,z.bm=an,z.bn=function(n,t,r,o,h){return Ye(o,h,Gt((n-t)/(r-t),0,1))},z.bo=be,z.bp=function(){return new Float64Array(3)},z.bq=function(n,t,r,o){return n[0]=t[0]+r[0]*o,n[1]=t[1]+r[1]*o,n[2]=t[2]+r[2]*o,n},z.br=He,z.bs=function(n,t,r){var o=r[0],h=r[1],m=r[2],y=r[3],x=t[0],v=t[1],M=t[2],k=h*M-m*v,P=m*x-o*M,B=o*v-h*x;return n[0]=x+y*(k+=k)+h*(B+=B)-m*(P+=P),n[1]=v+y*P+m*k-o*B,n[2]=M+y*B+o*P-h*k,n},z.bt=function(n,t,r){const o=(h=[n[0],n[1],n[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((k=h[8])*(y=h[4])-(x=h[5])*(M=h[7]))+h[1]*(-k*(m=h[3])+x*(v=h[6]))+h[2]*(M*m-y*v);var h,m,y,x,v,M,k;if(o===0)return null;const P=Yi([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),B=Yi([],[r[0],r[1],r[2]],[n[0],n[1],n[2]]),U=Yi([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),V=Ri([],P,-n[3]);return Ui(V,V,Ri([],B,-t[3])),Ui(V,V,Ri([],U,-r[3])),Ri(V,V,1/o),V},z.bu=kh,z.bv=function(){return new Float64Array(4)},z.bw=function(n,t,r,o){var h=[],m=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],m[0]=h[0]*Math.cos(o)-h[1]*Math.sin(o),m[1]=h[0]*Math.sin(o)+h[1]*Math.cos(o),m[2]=h[2],n[0]=m[0]+r[0],n[1]=m[1]+r[1],n[2]=m[2]+r[2],n},z.bx=function(n,t,r,o){var h=[],m=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],m[0]=h[0],m[1]=h[1]*Math.cos(o)-h[2]*Math.sin(o),m[2]=h[1]*Math.sin(o)+h[2]*Math.cos(o),n[0]=m[0]+r[0],n[1]=m[1]+r[1],n[2]=m[2]+r[2],n},z.by=function(n,t,r,o){var h=[],m=[];return h[0]=t[0]-r[0],h[1]=t[1]-r[1],h[2]=t[2]-r[2],m[0]=h[2]*Math.sin(o)+h[0]*Math.cos(o),m[1]=h[1],m[2]=h[2]*Math.cos(o)-h[0]*Math.sin(o),n[0]=m[0]+r[0],n[1]=m[1]+r[1],n[2]=m[2]+r[2],n},z.bz=function(n,t,r){var o=Math.sin(r),h=Math.cos(r),m=t[0],y=t[1],x=t[2],v=t[3],M=t[8],k=t[9],P=t[10],B=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=m*h-M*o,n[1]=y*h-k*o,n[2]=x*h-P*o,n[3]=v*h-B*o,n[8]=m*o+M*h,n[9]=y*o+k*h,n[10]=x*o+P*h,n[11]=v*o+B*h,n},z.c=ne,z.c0=class extends du{},z.c1=np,z.c2=class extends Al{},z.c3=js,z.c4=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},z.c5=qd,z.c6=function(n,t,r){var o=t[0],h=t[1],m=t[2],y=r[3]*o+r[7]*h+r[11]*m+r[15];return n[0]=(r[0]*o+r[4]*h+r[8]*m+r[12])/(y=y||1),n[1]=(r[1]*o+r[5]*h+r[9]*m+r[13])/y,n[2]=(r[2]*o+r[6]*h+r[10]*m+r[14])/y,n},z.c7=class extends qo{},z.c8=class extends _{},z.c9=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},z.cA=function(n,t){O.REGISTERED_PROTOCOLS[n]=t},z.cB=function(n){delete O.REGISTERED_PROTOCOLS[n]},z.cC=function(n,t){const r={};for(let h=0;h<n.length;h++){const m=t&&t[n[h].id]||ss(n[h]);t&&(t[n[h].id]=m);let y=r[m];y||(y=r[m]=[]),y.push(n[h])}const o=[];for(const h in r)o.push(r[h]);return o},z.cD=_t,z.cE=Mp,z.cF=Sd,z.cG=hp,z.cH=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=At/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,o=t._unevaluatedLayout._values,h={layoutIconSize:o["icon-size"].possiblyEvaluate(new Vi(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Vi(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Vi(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:k}=n.bucket.textSizeData;h.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Vi(M),n.canonical),o["text-size"].possiblyEvaluate(new Vi(k),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:k}=n.bucket.iconSizeData;h.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Vi(M),n.canonical),o["icon-size"].possiblyEvaluate(new Vi(k),n.canonical)]}const m=r.get("text-line-height")*Ir,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",x=r.get("text-keep-upright"),v=r.get("text-size");for(const M of n.bucket.features){const k=r.get("text-font").evaluate(M,{},n.canonical).join(","),P=v.evaluate(M,{},n.canonical),B=h.layoutTextSize.evaluate(M,{},n.canonical),U=h.layoutIconSize.evaluate(M,{},n.canonical),V={horizontal:{},vertical:void 0},q=M.text;let Y,ae=[0,0];if(q){const me=q.toString(),je=r.get("text-letter-spacing").evaluate(M,{},n.canonical)*Ir,Ue=Ju(me)?je:0,it=r.get("text-anchor").evaluate(M,{},n.canonical),mt=zp(t,M,n.canonical);if(!mt){const ut=r.get("text-radial-offset").evaluate(M,{},n.canonical);ae=ut?Ad(it,[ut*Ir,Ca]):r.get("text-offset").evaluate(M,{},n.canonical).map((ft=>ft*Ir))}let lt=y?"center":r.get("text-justify").evaluate(M,{},n.canonical);const pt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(M,{},n.canonical)*Ir:1/0,It=()=>{n.bucket.allowVerticalPlacement&&Sa(me)&&(V.vertical=vh(q,n.glyphMap,n.glyphPositions,n.imagePositions,k,pt,m,it,"left",Ue,ae,z.ao.vertical,!0,B,P))};if(!y&&mt){const ut=new Set;if(lt==="auto")for(let We=0;We<mt.values.length;We+=2)ut.add(zd(mt.values[We]));else ut.add(lt);let ft=!1;for(const We of ut)if(!V.horizontal[We])if(ft)V.horizontal[We]=V.horizontal[0];else{const Ut=vh(q,n.glyphMap,n.glyphPositions,n.imagePositions,k,pt,m,"center",We,Ue,ae,z.ao.horizontal,!1,B,P);Ut&&(V.horizontal[We]=Ut,ft=Ut.positionedLines.length===1)}It()}else{lt==="auto"&&(lt=zd(it));const ut=vh(q,n.glyphMap,n.glyphPositions,n.imagePositions,k,pt,m,it,lt,Ue,ae,z.ao.horizontal,!1,B,P);ut&&(V.horizontal[lt]=ut),It(),Sa(me)&&y&&x&&(V.vertical=vh(q,n.glyphMap,n.glyphPositions,n.imagePositions,k,pt,m,it,lt,Ue,ae,z.ao.vertical,!1,B,P))}}let Ce=!1;if(M.icon&&M.icon.name){const me=n.imageMap[M.icon.name];me&&(Y=Cu(n.imagePositions[M.icon.name],r.get("icon-offset").evaluate(M,{},n.canonical),r.get("icon-anchor").evaluate(M,{},n.canonical)),Ce=!!me.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Ce:n.bucket.sdfIcons!==Ce&&zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(me.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const ue=es(V.horizontal)||V.vertical;n.bucket.iconsInText=!!ue&&ue.iconsInText,(ue||Y)&&wf(n.bucket,M,V,Y,n.imageMap,h,B,U,ae,Ce,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},z.cI=fh,z.cJ=hr,z.cK=Cc,z.cL=tp,z.cM=Xn,z.cN=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},z.cO=function(n,t,r,o,h){return u(this,void 0,void 0,(function*(){if(wt())try{return yield Hr(n,t,r,o,h)}catch{}return(function(m,y,x,v,M){const k=m.width,P=m.height;Qn&&un||(Qn=new OffscreenCanvas(k,P),un=Qn.getContext("2d",{willReadFrequently:!0})),Qn.width=k,Qn.height=P,un.drawImage(m,0,0,k,P);const B=un.getImageData(y,x,v,M);return un.clearRect(0,0,k,P),B.data})(n,t,r,o,h)}))},z.cP=yu,z.cQ=te,z.cR=ep,z.cS=Sc,z.cT=oc,z.cU=function(n,t){const r=new Map;if(n!=null)if(n.type==="Feature")r.set(en(n,t),n);else for(const o of n.features)r.set(en(o,t),o);return r},z.cV=function(n,t){if(n==null)return!0;if(n.type==="Feature")return en(n,t)!=null;if(n.type==="FeatureCollection"){const r=new Set;for(const o of n.features){const h=en(o,t);if(h==null||r.has(h))return!1;r.add(h)}return!0}return!1},z.cW=function(n,t,r){var o,h,m,y;if(t.removeAll&&n.clear(),t.remove)for(const x of t.remove)n.delete(x);if(t.add)for(const x of t.add){const v=en(x,r);v!=null&&n.set(v,x)}if(t.update)for(const x of t.update){let v=n.get(x.id);if(v==null)continue;const M=!x.removeAllProperties&&(((o=x.removeProperties)===null||o===void 0?void 0:o.length)>0||((h=x.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0);if((x.newGeometry||x.removeAllProperties||M)&&(v=Object.assign({},v),n.set(x.id,v),M&&(v.properties=Object.assign({},v.properties))),x.newGeometry&&(v.geometry=x.newGeometry),x.removeAllProperties)v.properties={};else if(((m=x.removeProperties)===null||m===void 0?void 0:m.length)>0)for(const k of x.removeProperties)Object.prototype.hasOwnProperty.call(v.properties,k)&&delete v.properties[k];if(((y=x.addOrUpdateProperties)===null||y===void 0?void 0:y.length)>0)for(const{key:k,value:P}of x.addOrUpdateProperties)v.properties[k]=P}},z.cX=Za,z.ca=function(n,t){var r=n[0],o=n[1],h=n[2],m=n[3],y=n[4],x=n[5],v=n[6],M=n[7],k=n[8],P=n[9],B=n[10],U=n[11],V=n[12],q=n[13],Y=n[14],ae=n[15],Ce=t[0],ue=t[1],me=t[2],je=t[3],Ue=t[4],it=t[5],mt=t[6],lt=t[7],pt=t[8],It=t[9],ut=t[10],ft=t[11],We=t[12],Ut=t[13],Qt=t[14],Lt=t[15];return Math.abs(r-Ce)<=jt*Math.max(1,Math.abs(r),Math.abs(Ce))&&Math.abs(o-ue)<=jt*Math.max(1,Math.abs(o),Math.abs(ue))&&Math.abs(h-me)<=jt*Math.max(1,Math.abs(h),Math.abs(me))&&Math.abs(m-je)<=jt*Math.max(1,Math.abs(m),Math.abs(je))&&Math.abs(y-Ue)<=jt*Math.max(1,Math.abs(y),Math.abs(Ue))&&Math.abs(x-it)<=jt*Math.max(1,Math.abs(x),Math.abs(it))&&Math.abs(v-mt)<=jt*Math.max(1,Math.abs(v),Math.abs(mt))&&Math.abs(M-lt)<=jt*Math.max(1,Math.abs(M),Math.abs(lt))&&Math.abs(k-pt)<=jt*Math.max(1,Math.abs(k),Math.abs(pt))&&Math.abs(P-It)<=jt*Math.max(1,Math.abs(P),Math.abs(It))&&Math.abs(B-ut)<=jt*Math.max(1,Math.abs(B),Math.abs(ut))&&Math.abs(U-ft)<=jt*Math.max(1,Math.abs(U),Math.abs(ft))&&Math.abs(V-We)<=jt*Math.max(1,Math.abs(V),Math.abs(We))&&Math.abs(q-Ut)<=jt*Math.max(1,Math.abs(q),Math.abs(Ut))&&Math.abs(Y-Qt)<=jt*Math.max(1,Math.abs(Y),Math.abs(Qt))&&Math.abs(ae-Lt)<=jt*Math.max(1,Math.abs(ae),Math.abs(Lt))},z.cb=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},z.cc=n=>n.type==="symbol",z.cd=n=>n.type==="circle",z.ce=n=>n.type==="heatmap",z.cf=n=>n.type==="line",z.cg=n=>n.type==="fill",z.ch=n=>n.type==="fill-extrusion",z.ci=n=>n.type==="hillshade",z.cj=n=>n.type==="color-relief",z.ck=n=>n.type==="background",z.cl=n=>n.type==="custom",z.cm=kt,z.cn=function(n,t,r){const o=Ot(t.x-r.x,t.y-r.y),h=Ot(n.x-r.x,n.y-r.y);var m,y;return rn(Math.atan2(o[0]*h[1]-o[1]*h[0],(m=o)[0]*(y=h)[0]+m[1]*y[1]))},z.co=Ht,z.cp=function(n,t){return Pt[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},z.cq=function(n,t){return st[t]&&"touches"in n},z.cr=function(n){return st[n]||Pt[n]},z.cs=function(n,t,r){var o=t[0],h=t[1];return n[0]=r[0]*o+r[4]*h+r[12],n[1]=r[1]*o+r[5]*h+r[13],n},z.ct=function(n,t){const{x:r,y:o}=Eh.fromLngLat(t);return!(n<0||n>25||o<0||o>=1||r<0||r>=1)},z.cu=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},z.cv=class extends Ki{},z.cw=kf,z.cy=function(n){return n.message===Et},z.cz=ee,z.d=Pe,z.e=$i,z.f=n=>u(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),z.g=F,z.h=n=>new Promise(((t,r)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=Fn}))},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(h):Fn})),z.i=cn,z.j=(n,t)=>fe($i(n,{type:"json"}),t),z.k=Ve,z.l=Ge,z.m=fe,z.n=(n,t)=>fe($i(n,{type:"arrayBuffer"}),t),z.o=function(n){return new Xn(n).readFields(pd,[])},z.p=cf,z.q=mu,z.r=cr,z.s=dr,z.t=fc,z.u=si,z.v=_e,z.w=zi,z.x=Yh,z.y=no,z.z=Bn})),X("worker",["./shared"],(function(z){class u{constructor(O,F){this.keyCache={},O&&this.replace(O,F)}replace(O,F){this._layerConfigs={},this._layers={},this.update(O,[],F)}update(O,F,G){for(const le of O){this._layerConfigs[le.id]=le;const fe=this._layers[le.id]=z.bJ(le,G);fe._featureFilter=z.aa(fe.filter,G),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of F)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const ee=z.cC(Object.values(this._layerConfigs),this.keyCache);for(const le of ee){const fe=le.map((ct=>this._layers[ct.id])),Pe=fe[0];if(Pe.visibility==="none")continue;const Se=Pe.source||"";let Ae=this.familiesBySource[Se];Ae||(Ae=this.familiesBySource[Se]={});const Ge=Pe.sourceLayer||"_geojsonTileLayer";let Ve=Ae[Ge];Ve||(Ve=Ae[Ge]=[]),Ve.push(fe)}}}class W{constructor(O){const F={},G=[];for(const Pe in O){const Se=O[Pe],Ae=F[Pe]={};for(const Ge in Se){const Ve=Se[+Ge];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const ct={x:0,y:0,w:Ve.bitmap.width+2,h:Ve.bitmap.height+2};G.push(ct),Ae[Ge]={rect:ct,metrics:Ve.metrics}}}const{w:ee,h:le}=z.p(G),fe=new z.q({width:ee||1,height:le||1});for(const Pe in O){const Se=O[Pe];for(const Ae in Se){const Ge=Se[+Ae];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const Ve=F[Pe][Ae].rect;z.q.copy(Ge.bitmap,fe,{x:0,y:0},{x:Ve.x+1,y:Ve.y+1},Ge.bitmap)}}this.image=fe,this.positions=F}}z.cD("GlyphAtlas",W);class te{constructor(O){this.tileID=new z.Z(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[]}parse(O,F,G,ee,le){return z._(this,void 0,void 0,(function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new z.a8;const fe=new z.cE(Object.keys(O.layers).sort()),Pe=new z.cF(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const Se={},Ae={featureIndex:Pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:G,subdivisionGranularity:le},Ge=F.familiesBySource[this.source];for(const Me in Ge){const ht=O.layers[Me];if(!ht)continue;ht.version===1&&z.w(`Vector tile source "${this.source}" layer "${Me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ot=fe.encode(Me),ri=[];for(let di=0;di<ht.length;di++){const Ze=ht.feature(di),dt=Pe.getId(Ze,Me);ri.push({feature:Ze,id:dt,index:di,sourceLayerIndex:ot})}for(const di of Ge[Me]){const Ze=di[0];Ze.source!==this.source&&z.w(`layer.source = ${Ze.source} does not equal this.source = ${this.source}`),Ze.isHidden(this.zoom,!0)||(xe(di,this.zoom,G),(Se[Ze.id]=Ze.createBucket({index:Pe.bucketLayerIDs.length,layers:di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ot,sourceID:this.source})).populate(ri,Ae,this.tileID.canonical),Pe.bucketLayerIDs.push(di.map((dt=>dt.id))))}}const Ve=z.bO(Ae.glyphDependencies,(Me=>Object.keys(Me).map(Number)));this.inFlightDependencies.forEach((Me=>Me?.abort())),this.inFlightDependencies=[];let ct=Promise.resolve({});if(Object.keys(Ve).length){const Me=new AbortController;this.inFlightDependencies.push(Me),ct=ee.sendAsync({type:"GG",data:{stacks:Ve,source:this.source,tileID:this.tileID,type:"glyphs"}},Me)}const _e=Object.keys(Ae.iconDependencies);let qt=Promise.resolve({});if(_e.length){const Me=new AbortController;this.inFlightDependencies.push(Me),qt=ee.sendAsync({type:"GI",data:{icons:_e,source:this.source,tileID:this.tileID,type:"icons"}},Me)}const Ii=Object.keys(Ae.patternDependencies);let zt=Promise.resolve({});if(Ii.length){const Me=new AbortController;this.inFlightDependencies.push(Me),zt=ee.sendAsync({type:"GI",data:{icons:Ii,source:this.source,tileID:this.tileID,type:"patterns"}},Me)}const oi=Ae.dashDependencies;let ki=Promise.resolve({});if(Object.keys(oi).length){const Me=new AbortController;this.inFlightDependencies.push(Me),ki=ee.sendAsync({type:"GDA",data:{dashes:oi}},Me)}const[mr,nr,gi,ze]=yield Promise.all([ct,qt,zt,ki]),Ke=new W(mr),pe=new z.cG(nr,gi);for(const Me in Se){const ht=Se[Me];ht instanceof z.a9?(xe(ht.layers,this.zoom,G),z.cH({bucket:ht,glyphMap:mr,glyphPositions:Ke.positions,imageMap:nr,imagePositions:pe.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ae.subdivisionGranularity})):ht.hasDependencies&&(ht instanceof z.cI||ht instanceof z.cJ||ht instanceof z.cK)&&(xe(ht.layers,this.zoom,G),ht.addFeatures(Ae,this.tileID.canonical,pe.patternPositions,ze))}return this.status="done",{buckets:Object.values(Se).filter((Me=>!Me.isEmpty())),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ke.image,imageAtlas:pe,dashPositions:ze,glyphMap:this.returnDependencies?mr:null,iconMap:this.returnDependencies?nr:null,glyphPositions:this.returnDependencies?Ke.positions:null}}))}}function xe(ne,O,F){const G=new z.F(O);for(const ee of ne)ee.recalculate(G,F)}class De{constructor(O,F,G){this.actor=O,this.layerIndex=F,this.availableImages=G,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,F){return z._(this,void 0,void 0,(function*(){const G=yield z.n(O.request,F);try{return{vectorTile:new z.cL(new z.cM(G.data)),rawData:G.data,cacheControl:G.cacheControl,expires:G.expires}}catch(ee){const le=new Uint8Array(G.data);let fe=`Unable to parse the tile at ${O.request.url}, `;throw fe+=le[0]===31&&le[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ee.message}`,new Error(fe)}}))}loadTile(O){return z._(this,void 0,void 0,(function*(){const F=O.uid,G=!!(O&&O.request&&O.request.collectResourceTiming)&&new z.cN(O.request),ee=new te(O);this.loading[F]=ee;const le=new AbortController;ee.abort=le;try{const fe=yield this.loadVectorTile(O,le);if(delete this.loading[F],!fe)return null;const Pe=fe.rawData,Se={};fe.expires&&(Se.expires=fe.expires),fe.cacheControl&&(Se.cacheControl=fe.cacheControl);const Ae={};if(G){const Ve=G.finish();Ve&&(Ae.resourceTiming=JSON.parse(JSON.stringify(Ve)))}ee.vectorTile=fe.vectorTile;const Ge=ee.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity);this.loaded[F]=ee,this.fetching[F]={rawTileData:Pe,cacheControl:Se,resourceTiming:Ae};try{const Ve=yield Ge;return z.e({rawTileData:Pe.slice(0)},Ve,Se,Ae)}finally{delete this.fetching[F]}}catch(fe){throw delete this.loading[F],ee.status="done",this.loaded[F]=ee,fe}}))}reloadTile(O){return z._(this,void 0,void 0,(function*(){const F=O.uid;if(!this.loaded||!this.loaded[F])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const G=this.loaded[F];if(G.showCollisionBoxes=O.showCollisionBoxes,G.status==="parsing"){const ee=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity);let le;if(this.fetching[F]){const{rawTileData:fe,cacheControl:Pe,resourceTiming:Se}=this.fetching[F];delete this.fetching[F],le=z.e({rawTileData:fe.slice(0)},ee,Pe,Se)}else le=ee;return le}if(G.status==="done"&&G.vectorTile)return G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity)}))}abortTile(O){return z._(this,void 0,void 0,(function*(){const F=this.loading,G=O.uid;F&&F[G]&&F[G].abort&&(F[G].abort.abort(),delete F[G])}))}removeTile(O){return z._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]}))}}class we{constructor(){this.loaded={}}loadTile(O){return z._(this,void 0,void 0,(function*(){const{uid:F,encoding:G,rawImageData:ee,redFactor:le,greenFactor:fe,blueFactor:Pe,baseShift:Se}=O,Ae=ee.width+2,Ge=ee.height+2,Ve=z.b(ee)?new z.R({width:Ae,height:Ge},yield z.cO(ee,-1,-1,Ae,Ge)):ee,ct=new z.cP(F,Ve,G,le,fe,Pe,Se);return this.loaded=this.loaded||{},this.loaded[F]=ct,ct}))}removeTile(O){const F=this.loaded,G=O.uid;F&&F[G]&&delete F[G]}}var Ee,Qe,ve=(function(){if(Qe)return Ee;function ne(F,G){if(F.length!==0){O(F[0],G);for(var ee=1;ee<F.length;ee++)O(F[ee],!G)}}function O(F,G){for(var ee=0,le=0,fe=0,Pe=F.length,Se=Pe-1;fe<Pe;Se=fe++){var Ae=(F[fe][0]-F[Se][0])*(F[Se][1]+F[fe][1]),Ge=ee+Ae;le+=Math.abs(ee)>=Math.abs(Ae)?ee-Ge+Ae:Ae-Ge+ee,ee=Ge}ee+le>=0!=!!G&&F.reverse()}return Qe=1,Ee=function F(G,ee){var le,fe=G&&G.type;if(fe==="FeatureCollection")for(le=0;le<G.features.length;le++)F(G.features[le],ee);else if(fe==="GeometryCollection")for(le=0;le<G.geometries.length;le++)F(G.geometries[le],ee);else if(fe==="Feature")F(G.geometry,ee);else if(fe==="Polygon")ne(G.coordinates,ee);else if(fe==="MultiPolygon")for(le=0;le<G.coordinates.length;le++)ne(G.coordinates[le],ee);return G}})(),St=z.cQ(ve);class wt extends z.cS{constructor(O,F){super(new z.cM,0,F,[],[]),this.feature=O,this.type=O.type,this.properties=O.tags?O.tags:{},"id"in O&&(typeof O.id=="string"?this.id=parseInt(O.id,10):typeof O.id!="number"||isNaN(O.id)||(this.id=O.id))}loadGeometry(){const O=[],F=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const G of F){const ee=[];for(const le of G)ee.push(new z.P(le[0],le[1]));O.push(ee)}return O}}class jt extends z.cR{constructor(O,F){super(new z.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=F?F.version:1,this.extent=F?F.extent:4096,this.length=O.length,this.features=O}feature(O){return new wt(this.features[O],this.extent)}}function $t(ne,O){O.writeVarintField(15,ne.version||1),O.writeStringField(1,ne.name||""),O.writeVarintField(5,ne.extent||4096);const F={keys:[],values:[],keycache:{},valuecache:{}};for(let le=0;le<ne.length;le++)F.feature=ne.feature(le),O.writeMessage(2,Fi,F);const G=F.keys;for(const le of G)O.writeStringField(3,le);const ee=F.values;for(const le of ee)O.writeMessage(4,Ui,le)}function Fi(ne,O){if(!ne.feature)return;const F=ne.feature;F.id!==void 0&&O.writeVarintField(1,F.id),O.writeMessage(2,Rt,ne),O.writeVarintField(3,F.type),O.writeMessage(4,wi,F)}function Rt(ne,O){for(const F in ne.feature?.properties){let G=ne.feature.properties[F],ee=ne.keycache[F];if(G===null)continue;ee===void 0&&(ne.keys.push(F),ee=ne.keys.length-1,ne.keycache[F]=ee),O.writeVarint(ee),typeof G!="string"&&typeof G!="boolean"&&typeof G!="number"&&(G=JSON.stringify(G));const le=typeof G+":"+G;let fe=ne.valuecache[le];fe===void 0&&(ne.values.push(G),fe=ne.values.length-1,ne.valuecache[le]=fe),O.writeVarint(fe)}}function vt(ne,O){return(O<<3)+(7&ne)}function Ft(ne){return ne<<1^ne>>31}function wi(ne,O){const F=ne.loadGeometry(),G=ne.type;let ee=0,le=0;for(const fe of F){let Pe=1;G===1&&(Pe=fe.length),O.writeVarint(vt(1,Pe));const Se=G===3?fe.length-1:fe.length;for(let Ae=0;Ae<Se;Ae++){Ae===1&&G!==1&&O.writeVarint(vt(2,Se-1));const Ge=fe[Ae].x-ee,Ve=fe[Ae].y-le;O.writeVarint(Ft(Ge)),O.writeVarint(Ft(Ve)),ee+=Ge,le+=Ve}ne.type===3&&O.writeVarint(vt(7,1))}}function Ui(ne,O){const F=typeof ne;F==="string"?O.writeStringField(1,ne):F==="boolean"?O.writeBooleanField(7,ne):F==="number"&&(ne%1!=0?O.writeDoubleField(3,ne):ne<0?O.writeSVarintField(6,ne):O.writeVarintField(5,ne))}const Ri={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},Yi=Math.fround||(Ci=new Float32Array(1),ne=>(Ci[0]=+ne,Ci[0]));var Ci;class Vt{constructor(O){this.options=Object.assign(Object.create(Ri),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:F,minZoom:G,maxZoom:ee}=this.options;F&&console.time("total time");const le=`prepare ${O.length} points`;F&&console.time(le),this.points=O;const fe=[];for(let Se=0;Se<O.length;Se++){const Ae=O[Se];if(!Ae.geometry)continue;const[Ge,Ve]=Ae.geometry.coordinates,ct=Yi(He(Ge)),_e=Yi(gt(Ve));fe.push(ct,_e,1/0,Se,-1,1),this.options.reduce&&fe.push(0)}let Pe=this.trees[ee+1]=this._createTree(fe);F&&console.timeEnd(le);for(let Se=ee;Se>=G;Se--){const Ae=+Date.now();Pe=this.trees[Se]=this._createTree(this._cluster(Pe,Se)),F&&console.log("z%d: %d clusters in %dms",Se,Pe.numItems,+Date.now()-Ae)}return F&&console.timeEnd("total time"),this}getClusters(O,F){let G=((O[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,O[1]));let le=O[2]===180?180:((O[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)G=-180,le=180;else if(G>le){const Ve=this.getClusters([G,ee,180,fe],F),ct=this.getClusters([-180,ee,le,fe],F);return Ve.concat(ct)}const Pe=this.trees[this._limitZoom(F)],Se=Pe.range(He(G),gt(fe),He(le),gt(ee)),Ae=Pe.data,Ge=[];for(const Ve of Se){const ct=this.stride*Ve;Ge.push(Ae[ct+5]>1?Kt(Ae,ct,this.clusterProps):this.points[Ae[ct+3]])}return Ge}getChildren(O){const F=this._getOriginId(O),G=this._getOriginZoom(O),ee="No cluster with the specified id.",le=this.trees[G];if(!le)throw new Error(ee);const fe=le.data;if(F*this.stride>=fe.length)throw new Error(ee);const Pe=this.options.radius/(this.options.extent*Math.pow(2,G-1)),Se=le.within(fe[F*this.stride],fe[F*this.stride+1],Pe),Ae=[];for(const Ge of Se){const Ve=Ge*this.stride;fe[Ve+4]===O&&Ae.push(fe[Ve+5]>1?Kt(fe,Ve,this.clusterProps):this.points[fe[Ve+3]])}if(Ae.length===0)throw new Error(ee);return Ae}getLeaves(O,F,G){const ee=[];return this._appendLeaves(ee,O,F=F||10,G=G||0,0),ee}getTile(O,F,G){const ee=this.trees[this._limitZoom(O)],le=Math.pow(2,O),{extent:fe,radius:Pe}=this.options,Se=Pe/fe,Ae=(G-Se)/le,Ge=(G+1+Se)/le,Ve={features:[]};return this._addTileFeatures(ee.range((F-Se)/le,Ae,(F+1+Se)/le,Ge),ee.data,F,G,le,Ve),F===0&&this._addTileFeatures(ee.range(1-Se/le,Ae,1,Ge),ee.data,le,G,le,Ve),F===le-1&&this._addTileFeatures(ee.range(0,Ae,Se/le,Ge),ee.data,-1,G,le,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(O){let F=this._getOriginZoom(O)-1;for(;F<=this.options.maxZoom;){const G=this.getChildren(O);if(F++,G.length!==1)break;O=G[0].properties.cluster_id}return F}_appendLeaves(O,F,G,ee,le){const fe=this.getChildren(F);for(const Pe of fe){const Se=Pe.properties;if(Se&&Se.cluster?le+Se.point_count<=ee?le+=Se.point_count:le=this._appendLeaves(O,Se.cluster_id,G,ee,le):le<ee?le++:O.push(Pe),O.length===G)break}return le}_createTree(O){const F=new z.aI(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<O.length;G+=this.stride)F.add(O[G],O[G+1]);return F.finish(),F.data=O,F}_addTileFeatures(O,F,G,ee,le,fe){for(const Pe of O){const Se=Pe*this.stride,Ae=F[Se+5]>1;let Ge,Ve,ct;if(Ae)Ge=qi(F,Se,this.clusterProps),Ve=F[Se],ct=F[Se+1];else{const Ii=this.points[F[Se+3]];Ge=Ii.properties;const[zt,oi]=Ii.geometry.coordinates;Ve=He(zt),ct=gt(oi)}const _e={type:1,geometry:[[Math.round(this.options.extent*(Ve*le-G)),Math.round(this.options.extent*(ct*le-ee))]],tags:Ge};let qt;qt=Ae||this.options.generateId?F[Se+3]:this.points[F[Se+3]].id,qt!==void 0&&(_e.id=qt),fe.features.push(_e)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,F){const{radius:G,extent:ee,reduce:le,minPoints:fe}=this.options,Pe=G/(ee*Math.pow(2,F)),Se=O.data,Ae=[],Ge=this.stride;for(let Ve=0;Ve<Se.length;Ve+=Ge){if(Se[Ve+2]<=F)continue;Se[Ve+2]=F;const ct=Se[Ve],_e=Se[Ve+1],qt=O.within(Se[Ve],Se[Ve+1],Pe),Ii=Se[Ve+5];let zt=Ii;for(const oi of qt){const ki=oi*Ge;Se[ki+2]>F&&(zt+=Se[ki+5])}if(zt>Ii&&zt>=fe){let oi,ki=ct*Ii,mr=_e*Ii,nr=-1;const gi=(Ve/Ge<<5)+(F+1)+this.points.length;for(const ze of qt){const Ke=ze*Ge;if(Se[Ke+2]<=F)continue;Se[Ke+2]=F;const pe=Se[Ke+5];ki+=Se[Ke]*pe,mr+=Se[Ke+1]*pe,Se[Ke+4]=gi,le&&(oi||(oi=this._map(Se,Ve,!0),nr=this.clusterProps.length,this.clusterProps.push(oi)),le(oi,this._map(Se,Ke)))}Se[Ve+4]=gi,Ae.push(ki/zt,mr/zt,1/0,gi,-1,zt),le&&Ae.push(nr)}else{for(let oi=0;oi<Ge;oi++)Ae.push(Se[Ve+oi]);if(zt>1)for(const oi of qt){const ki=oi*Ge;if(!(Se[ki+2]<=F)){Se[ki+2]=F;for(let mr=0;mr<Ge;mr++)Ae.push(Se[ki+mr])}}}}return Ae}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,F,G){if(O[F+5]>1){const fe=this.clusterProps[O[F+6]];return G?Object.assign({},fe):fe}const ee=this.points[O[F+3]].properties,le=this.options.map(ee);return G&&le===ee?Object.assign({},le):le}}function Kt(ne,O,F){return{type:"Feature",id:ne[O+3],properties:qi(ne,O,F),geometry:{type:"Point",coordinates:[(G=ne[O],360*(G-.5)),Ot(ne[O+1])]}};var G}function qi(ne,O,F){const G=ne[O+5],ee=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,le=ne[O+6],fe=le===-1?{}:Object.assign({},F[le]);return Object.assign(fe,{cluster:!0,cluster_id:ne[O+3],point_count:G,point_count_abbreviated:ee})}function He(ne){return ne/360+.5}function gt(ne){const O=Math.sin(ne*Math.PI/180),F=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return F<0?0:F>1?1:F}function Ot(ne){const O=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function At(ne,O,F,G){let ee=G;const le=O+(F-O>>1);let fe,Pe=F-O;const Se=ne[O],Ae=ne[O+1],Ge=ne[F],Ve=ne[F+1];for(let ct=O+3;ct<F;ct+=3){const _e=mi(ne[ct],ne[ct+1],Se,Ae,Ge,Ve);if(_e>ee)fe=ct,ee=_e;else if(_e===ee){const qt=Math.abs(ct-le);qt<Pe&&(fe=ct,Pe=qt)}}ee>G&&(fe-O>3&&At(ne,O,fe,G),ne[fe+2]=ee,F-fe>3&&At(ne,fe,F,G))}function mi(ne,O,F,G,ee,le){let fe=ee-F,Pe=le-G;if(fe!==0||Pe!==0){const Se=((ne-F)*fe+(O-G)*Pe)/(fe*fe+Pe*Pe);Se>1?(F=ee,G=le):Se>0&&(F+=fe*Se,G+=Pe*Se)}return fe=ne-F,Pe=O-G,fe*fe+Pe*Pe}function be(ne,O,F,G){const ee={id:ne??null,type:O,geometry:F,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(O==="Point"||O==="MultiPoint"||O==="LineString")Ye(ee,F);else if(O==="Polygon")Ye(ee,F[0]);else if(O==="MultiLineString")for(const le of F)Ye(ee,le);else if(O==="MultiPolygon")for(const le of F)Ye(ee,le[0]);return ee}function Ye(ne,O){for(let F=0;F<O.length;F+=3)ne.minX=Math.min(ne.minX,O[F]),ne.minY=Math.min(ne.minY,O[F+1]),ne.maxX=Math.max(ne.maxX,O[F]),ne.maxY=Math.max(ne.maxY,O[F+1])}function yt(ne,O,F,G){if(!O.geometry)return;const ee=O.geometry.coordinates;if(ee&&ee.length===0)return;const le=O.geometry.type,fe=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2);let Pe=[],Se=O.id;if(F.promoteId?Se=O.properties[F.promoteId]:F.generateId&&(Se=G||0),le==="Point")kt(ee,Pe);else if(le==="MultiPoint")for(const Ae of ee)kt(Ae,Pe);else if(le==="LineString")Ht(ee,Pe,fe,!1);else if(le==="MultiLineString"){if(F.lineMetrics){for(const Ae of ee)Pe=[],Ht(Ae,Pe,fe,!1),ne.push(be(Se,"LineString",Pe,O.properties));return}Gt(ee,Pe,fe,!1)}else if(le==="Polygon")Gt(ee,Pe,fe,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(const Ae of O.geometry.geometries)yt(ne,{id:Se,geometry:Ae,properties:O.properties},F,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ae of ee){const Ge=[];Gt(Ae,Ge,fe,!0),Pe.push(Ge)}}ne.push(be(Se,le,Pe,O.properties))}function kt(ne,O){O.push(ei(ne[0]),$i(ne[1]),0)}function Ht(ne,O,F,G){let ee,le,fe=0;for(let Se=0;Se<ne.length;Se++){const Ae=ei(ne[Se][0]),Ge=$i(ne[Se][1]);O.push(Ae,Ge,0),Se>0&&(fe+=G?(ee*Ge-Ae*le)/2:Math.sqrt(Math.pow(Ae-ee,2)+Math.pow(Ge-le,2))),ee=Ae,le=Ge}const Pe=O.length-3;O[2]=1,At(O,0,Pe,F),O[Pe+2]=1,O.size=Math.abs(fe),O.start=0,O.end=O.size}function Gt(ne,O,F,G){for(let ee=0;ee<ne.length;ee++){const le=[];Ht(ne[ee],le,F,G),O.push(le)}}function ei(ne){return ne/360+.5}function $i(ne){const O=Math.sin(ne*Math.PI/180),F=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return F<0?0:F>1?1:F}function vi(ne,O,F,G,ee,le,fe,Pe){if(G/=O,le>=(F/=O)&&fe<G)return ne;if(fe<F||le>=G)return null;const Se=[];for(const Ae of ne){const Ge=Ae.geometry;let Ve=Ae.type;const ct=ee===0?Ae.minX:Ae.minY,_e=ee===0?Ae.maxX:Ae.maxY;if(ct>=F&&_e<G){Se.push(Ae);continue}if(_e<F||ct>=G)continue;let qt=[];if(Ve==="Point"||Ve==="MultiPoint")Cn(Ge,qt,F,G,ee);else if(Ve==="LineString")_n(Ge,qt,F,G,ee,!1,Pe.lineMetrics);else if(Ve==="MultiLineString")En(Ge,qt,F,G,ee,!1);else if(Ve==="Polygon")En(Ge,qt,F,G,ee,!0);else if(Ve==="MultiPolygon")for(const Ii of Ge){const zt=[];En(Ii,zt,F,G,ee,!0),zt.length&&qt.push(zt)}if(qt.length){if(Pe.lineMetrics&&Ve==="LineString"){for(const Ii of qt)Se.push(be(Ae.id,Ve,Ii,Ae.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(qt.length===1?(Ve="LineString",qt=qt[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=qt.length===3?"Point":"MultiPoint"),Se.push(be(Ae.id,Ve,qt,Ae.tags))}}return Se.length?Se:null}function Cn(ne,O,F,G,ee){for(let le=0;le<ne.length;le+=3){const fe=ne[le+ee];fe>=F&&fe<=G&&zi(O,ne[le],ne[le+1],ne[le+2])}}function _n(ne,O,F,G,ee,le,fe){let Pe=Tr(ne);const Se=ee===0?Bi:cn;let Ae,Ge,Ve=ne.start;for(let zt=0;zt<ne.length-3;zt+=3){const oi=ne[zt],ki=ne[zt+1],mr=ne[zt+2],nr=ne[zt+3],gi=ne[zt+4],ze=ee===0?oi:ki,Ke=ee===0?nr:gi;let pe=!1;fe&&(Ae=Math.sqrt(Math.pow(oi-nr,2)+Math.pow(ki-gi,2))),ze<F?Ke>F&&(Ge=Se(Pe,oi,ki,nr,gi,F),fe&&(Pe.start=Ve+Ae*Ge)):ze>G?Ke<G&&(Ge=Se(Pe,oi,ki,nr,gi,G),fe&&(Pe.start=Ve+Ae*Ge)):zi(Pe,oi,ki,mr),Ke<F&&ze>=F&&(Ge=Se(Pe,oi,ki,nr,gi,F),pe=!0),Ke>G&&ze<=G&&(Ge=Se(Pe,oi,ki,nr,gi,G),pe=!0),!le&&pe&&(fe&&(Pe.end=Ve+Ae*Ge),O.push(Pe),Pe=Tr(ne)),fe&&(Ve+=Ae)}let ct=ne.length-3;const _e=ne[ct],qt=ne[ct+1],Ii=ee===0?_e:qt;Ii>=F&&Ii<=G&&zi(Pe,_e,qt,ne[ct+2]),ct=Pe.length-3,le&&ct>=3&&(Pe[ct]!==Pe[0]||Pe[ct+1]!==Pe[1])&&zi(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&O.push(Pe)}function Tr(ne){const O=[];return O.size=ne.size,O.start=ne.start,O.end=ne.end,O}function En(ne,O,F,G,ee,le){for(const fe of ne)_n(fe,O,F,G,ee,le,!1)}function zi(ne,O,F,G){ne.push(O,F,G)}function Bi(ne,O,F,G,ee,le){const fe=(le-O)/(G-O);return zi(ne,le,F+(ee-F)*fe,1),fe}function cn(ne,O,F,G,ee,le){const fe=(le-F)/(ee-F);return zi(ne,O+(G-O)*fe,le,1),fe}function Pa(ne,O){const F=[];for(let G=0;G<ne.length;G++){const ee=ne[G],le=ee.type;let fe;if(le==="Point"||le==="MultiPoint"||le==="LineString")fe=Ei(ee.geometry,O);else if(le==="MultiLineString"||le==="Polygon"){fe=[];for(const Pe of ee.geometry)fe.push(Ei(Pe,O))}else if(le==="MultiPolygon"){fe=[];for(const Pe of ee.geometry){const Se=[];for(const Ae of Pe)Se.push(Ei(Ae,O));fe.push(Se)}}F.push(be(ee.id,le,fe,ee.tags))}return F}function Ei(ne,O){const F=[];F.size=ne.size,ne.start!==void 0&&(F.start=ne.start,F.end=ne.end);for(let G=0;G<ne.length;G+=3)F.push(ne[G]+O,ne[G+1],ne[G+2]);return F}function An(ne,O){if(ne.transformed)return ne;const F=1<<ne.z,G=ne.x,ee=ne.y;for(const le of ne.features){const fe=le.geometry,Pe=le.type;if(le.geometry=[],Pe===1)for(let Se=0;Se<fe.length;Se+=2)le.geometry.push(Fn(fe[Se],fe[Se+1],O,F,G,ee));else for(let Se=0;Se<fe.length;Se++){const Ae=[];for(let Ge=0;Ge<fe[Se].length;Ge+=2)Ae.push(Fn(fe[Se][Ge],fe[Se][Ge+1],O,F,G,ee));le.geometry.push(Ae)}}return ne.transformed=!0,ne}function Fn(ne,O,F,G,ee,le){return[Math.round(F*(ne*G-ee)),Math.round(F*(O*G-le))]}function Hr(ne,O,F,G,ee){const le=O===ee.maxZoom?0:ee.tolerance/((1<<O)*ee.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:ne.length,source:null,x:F,y:G,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Pe of ne)Qn(fe,Pe,le,ee);return fe}function Qn(ne,O,F,G){const ee=O.geometry,le=O.type,fe=[];if(ne.minX=Math.min(ne.minX,O.minX),ne.minY=Math.min(ne.minY,O.minY),ne.maxX=Math.max(ne.maxX,O.maxX),ne.maxY=Math.max(ne.maxY,O.maxY),le==="Point"||le==="MultiPoint")for(let Pe=0;Pe<ee.length;Pe+=3)fe.push(ee[Pe],ee[Pe+1]),ne.numPoints++,ne.numSimplified++;else if(le==="LineString")un(fe,ee,ne,F,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(let Pe=0;Pe<ee.length;Pe++)un(fe,ee[Pe],ne,F,le==="Polygon",Pe===0);else if(le==="MultiPolygon")for(let Pe=0;Pe<ee.length;Pe++){const Se=ee[Pe];for(let Ae=0;Ae<Se.length;Ae++)un(fe,Se[Ae],ne,F,!0,Ae===0)}if(fe.length){let Pe=O.tags||null;if(le==="LineString"&&G.lineMetrics){Pe={};for(const Ae in O.tags)Pe[Ae]=O.tags[Ae];Pe.mapbox_clip_start=ee.start/ee.size,Pe.mapbox_clip_end=ee.end/ee.size}const Se={geometry:fe,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Pe};O.id!==null&&(Se.id=O.id),ne.features.push(Se)}}function un(ne,O,F,G,ee,le){const fe=G*G;if(G>0&&O.size<(ee?fe:G))return void(F.numPoints+=O.length/3);const Pe=[];for(let Se=0;Se<O.length;Se+=3)(G===0||O[Se+2]>fe)&&(F.numSimplified++,Pe.push(O[Se],O[Se+1])),F.numPoints++;ee&&(function(Se,Ae){let Ge=0;for(let Ve=0,ct=Se.length,_e=ct-2;Ve<ct;_e=Ve,Ve+=2)Ge+=(Se[Ve]-Se[_e])*(Se[Ve+1]+Se[_e+1]);if(Ge>0===Ae)for(let Ve=0,ct=Se.length;Ve<ct/2;Ve+=2){const _e=Se[Ve],qt=Se[Ve+1];Se[Ve]=Se[ct-2-Ve],Se[Ve+1]=Se[ct-1-Ve],Se[ct-2-Ve]=_e,Se[ct-1-Ve]=qt}})(Pe,le),ne.push(Pe)}const dr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class fa{constructor(O,F){const G=(F=this.options=(function(le,fe){for(const Pe in fe)le[Pe]=fe[Pe];return le})(Object.create(dr),F)).debug;if(G&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");let ee=(function(le,fe){const Pe=[];if(le.type==="FeatureCollection")for(let Se=0;Se<le.features.length;Se++)yt(Pe,le.features[Se],fe,Se);else yt(Pe,le.type==="Feature"?le:{geometry:le},fe);return Pe})(O,F);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=(function(le,fe){const Pe=fe.buffer/fe.extent;let Se=le;const Ae=vi(le,1,-1-Pe,Pe,0,-1,2,fe),Ge=vi(le,1,1-Pe,2+Pe,0,-1,2,fe);return(Ae||Ge)&&(Se=vi(le,1,-Pe,1+Pe,0,-1,2,fe)||[],Ae&&(Se=Pa(Ae,1).concat(Se)),Ge&&(Se=Se.concat(Pa(Ge,-1)))),Se})(ee,F),ee.length&&this.splitTile(ee,0,0,0),G&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(O,F,G,ee,le,fe,Pe){const Se=[O,F,G,ee],Ae=this.options,Ge=Ae.debug;for(;Se.length;){ee=Se.pop(),G=Se.pop(),F=Se.pop(),O=Se.pop();const Ve=1<<F,ct=rn(F,G,ee);let _e=this.tiles[ct];if(!_e&&(Ge>1&&console.time("creation"),_e=this.tiles[ct]=Hr(O,F,G,ee,Ae),this.tileCoords.push({z:F,x:G,y:ee}),Ge)){Ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,G,ee,_e.numFeatures,_e.numPoints,_e.numSimplified),console.timeEnd("creation"));const pe=`z${F}`;this.stats[pe]=(this.stats[pe]||0)+1,this.total++}if(_e.source=O,le==null){if(F===Ae.indexMaxZoom||_e.numPoints<=Ae.indexMaxPoints)continue}else{if(F===Ae.maxZoom||F===le)continue;if(le!=null){const pe=le-F;if(G!==fe>>pe||ee!==Pe>>pe)continue}}if(_e.source=null,O.length===0)continue;Ge>1&&console.time("clipping");const qt=.5*Ae.buffer/Ae.extent,Ii=.5-qt,zt=.5+qt,oi=1+qt;let ki=null,mr=null,nr=null,gi=null,ze=vi(O,Ve,G-qt,G+zt,0,_e.minX,_e.maxX,Ae),Ke=vi(O,Ve,G+Ii,G+oi,0,_e.minX,_e.maxX,Ae);O=null,ze&&(ki=vi(ze,Ve,ee-qt,ee+zt,1,_e.minY,_e.maxY,Ae),mr=vi(ze,Ve,ee+Ii,ee+oi,1,_e.minY,_e.maxY,Ae),ze=null),Ke&&(nr=vi(Ke,Ve,ee-qt,ee+zt,1,_e.minY,_e.maxY,Ae),gi=vi(Ke,Ve,ee+Ii,ee+oi,1,_e.minY,_e.maxY,Ae),Ke=null),Ge>1&&console.timeEnd("clipping"),Se.push(ki||[],F+1,2*G,2*ee),Se.push(mr||[],F+1,2*G,2*ee+1),Se.push(nr||[],F+1,2*G+1,2*ee),Se.push(gi||[],F+1,2*G+1,2*ee+1)}}getTile(O,F,G){O=+O,F=+F,G=+G;const ee=this.options,{extent:le,debug:fe}=ee;if(O<0||O>24)return null;const Pe=1<<O,Se=rn(O,F=F+Pe&Pe-1,G);if(this.tiles[Se])return An(this.tiles[Se],le);fe>1&&console.log("drilling down to z%d-%d-%d",O,F,G);let Ae,Ge=O,Ve=F,ct=G;for(;!Ae&&Ge>0;)Ge--,Ve>>=1,ct>>=1,Ae=this.tiles[rn(Ge,Ve,ct)];return Ae&&Ae.source?(fe>1&&(console.log("found parent tile z%d-%d-%d",Ge,Ve,ct),console.time("drilling down")),this.splitTile(Ae.source,Ge,Ve,ct,O,F,G),fe>1&&console.timeEnd("drilling down"),this.tiles[Se]?An(this.tiles[Se],le):null):null}}function rn(ne,O,F){return 32*((1<<ne)*F+O)+ne}class st extends De{constructor(O,F,G,ee=Pt){super(O,F,G),this._dataUpdateable=new Map,this._createGeoJSONIndex=ee}loadVectorTile(O,F){return z._(this,void 0,void 0,(function*(){const G=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ee=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!ee)return null;const le=new jt(ee.features,{version:2,extent:z.$});let fe=(function(Pe){const Se=new z.cM;return(function(Ae,Ge){for(const Ve in Ae.layers)Ge.writeMessage(3,$t,Ae.layers[Ve])})(Pe,Se),Se.finish()})(le);return fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),{vectorTile:le,rawData:fe.buffer}}))}loadData(O){return z._(this,void 0,void 0,(function*(){var F;(F=this._pendingRequest)===null||F===void 0||F.abort();const G=!!(O&&O.request&&O.request.collectResourceTiming)&&new z.cN(O.request);this._pendingRequest=new AbortController;try{(!this._pendingData||O.request||O.data||O.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(O,this._pendingRequest));const ee=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ee,O),this.loaded={};const le={data:ee};if(G){const fe=G.finish();fe&&(le.resourceTiming={},le.resourceTiming[O.source]=JSON.parse(JSON.stringify(fe)))}return le}catch(ee){if(delete this._pendingRequest,z.cy(ee))return{abandoned:!0};throw ee}}))}getData(){return z._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(O){const F=this.loaded;return F&&F[O.uid]?super.reloadTile(O):this.loadTile(O)}loadAndProcessGeoJSON(O,F){return z._(this,void 0,void 0,(function*(){let G=yield this.loadGeoJSON(O,F);if(delete this._pendingRequest,typeof G!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(St(G,!0),O.filter){const ee=z.cT(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map((fe=>`${fe.key}: ${fe.message}`)).join(", "));G={type:"FeatureCollection",features:G.features.filter((fe=>ee.value.evaluate({zoom:0},fe)))}}return G}))}loadGeoJSON(O,F){return z._(this,void 0,void 0,(function*(){const{promoteId:G}=O;if(O.request){const ee=yield z.j(O.request,F);return this._dataUpdateable=z.cV(ee.data,G)?z.cU(ee.data,G):void 0,ee.data}if(typeof O.data=="string")try{const ee=JSON.parse(O.data);return this._dataUpdateable=z.cV(ee,G)?z.cU(ee,G):void 0,ee}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return z.cW(this._dataUpdateable,O.dataDiff,G),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(O){return z._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}function Pt(ne,O){return O.cluster?new Vt((function({superclusterOptions:F,clusterProperties:G}){if(!G||!F)return F;const ee={},le={},fe={accumulated:null,zoom:0},Pe={properties:null},Se=Object.keys(G);for(const Ae of Se){const[Ge,Ve]=G[Ae],ct=z.cT(Ve),_e=z.cT(typeof Ge=="string"?[Ge,["accumulated"],["get",Ae]]:Ge);ee[Ae]=ct.value,le[Ae]=_e.value}return F.map=Ae=>{Pe.properties=Ae;const Ge={};for(const Ve of Se)Ge[Ve]=ee[Ve].evaluate(fe,Pe);return Ge},F.reduce=(Ae,Ge)=>{Pe.properties=Ge;for(const Ve of Se)fe.accumulated=Ae[Ve],Ae[Ve]=le[Ve].evaluate(fe,Pe)},F})(O)).load(ne.features):(function(F,G){return new fa(F,G)})(ne,O.geojsonVtOptions)}class Et{constructor(O){this.self=O,this.actor=new z.J(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(F,G)=>{if(this.externalWorkerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.externalWorkerSourceTypes[F]=G},this.self.addProtocol=z.cA,this.self.removeProtocol=z.cB,this.self.registerRTLTextPlugin=F=>{z.cX.setMethods(F)},this.actor.registerMessageHandler("LDT",((F,G)=>this._getDEMWorkerSource(F,G.source).loadTile(G))),this.actor.registerMessageHandler("RDT",((F,G)=>z._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(F,G.source).removeTile(G)})))),this.actor.registerMessageHandler("GCEZ",((F,G)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(F,G.type,G.source).getClusterExpansionZoom(G)})))),this.actor.registerMessageHandler("GCC",((F,G)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(F,G.type,G.source).getClusterChildren(G)})))),this.actor.registerMessageHandler("GCL",((F,G)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(F,G.type,G.source).getClusterLeaves(G)})))),this.actor.registerMessageHandler("LD",((F,G)=>this._getWorkerSource(F,G.type,G.source).loadData(G))),this.actor.registerMessageHandler("GD",((F,G)=>this._getWorkerSource(F,G.type,G.source).getData())),this.actor.registerMessageHandler("LT",((F,G)=>this._getWorkerSource(F,G.type,G.source).loadTile(G))),this.actor.registerMessageHandler("RT",((F,G)=>this._getWorkerSource(F,G.type,G.source).reloadTile(G))),this.actor.registerMessageHandler("AT",((F,G)=>this._getWorkerSource(F,G.type,G.source).abortTile(G))),this.actor.registerMessageHandler("RMT",((F,G)=>this._getWorkerSource(F,G.type,G.source).removeTile(G))),this.actor.registerMessageHandler("RS",((F,G)=>z._(this,void 0,void 0,(function*(){if(!this.workerSources[F]||!this.workerSources[F][G.type]||!this.workerSources[F][G.type][G.source])return;const ee=this.workerSources[F][G.type][G.source];delete this.workerSources[F][G.type][G.source],ee.removeSource!==void 0&&ee.removeSource(G)})))),this.actor.registerMessageHandler("RM",(F=>z._(this,void 0,void 0,(function*(){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F],this.globalStates.delete(F)})))),this.actor.registerMessageHandler("SR",((F,G)=>z._(this,void 0,void 0,(function*(){this.referrer=G})))),this.actor.registerMessageHandler("SRPS",((F,G)=>this._syncRTLPluginState(F,G))),this.actor.registerMessageHandler("IS",((F,G)=>z._(this,void 0,void 0,(function*(){this.self.importScripts(G)})))),this.actor.registerMessageHandler("SI",((F,G)=>this._setImages(F,G))),this.actor.registerMessageHandler("UL",((F,G)=>z._(this,void 0,void 0,(function*(){this._getLayerIndex(F).update(G.layers,G.removedIds,this._getGlobalState(F))})))),this.actor.registerMessageHandler("UGS",((F,G)=>z._(this,void 0,void 0,(function*(){const ee=this._getGlobalState(F);for(const le in G)ee[le]=G[le]})))),this.actor.registerMessageHandler("SL",((F,G)=>z._(this,void 0,void 0,(function*(){this._getLayerIndex(F).replace(G,this._getGlobalState(F))}))))}_getGlobalState(O){let F=this.globalStates.get(O);return F||(F={},this.globalStates.set(O,F)),F}_setImages(O,F){return z._(this,void 0,void 0,(function*(){this.availableImages[O]=F;for(const G in this.workerSources[O]){const ee=this.workerSources[O][G];for(const le in ee)ee[le].availableImages=F}}))}_syncRTLPluginState(O,F){return z._(this,void 0,void 0,(function*(){return yield z.cX.syncState(F,this.self.importScripts)}))}_getAvailableImages(O){let F=this.availableImages[O];return F||(F=[]),F}_getLayerIndex(O){let F=this.layerIndexes[O];return F||(F=this.layerIndexes[O]=new u),F}_getWorkerSource(O,F,G){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][F]||(this.workerSources[O][F]={}),!this.workerSources[O][F][G]){const ee={sendAsync:(le,fe)=>(le.targetMapId=O,this.actor.sendAsync(le,fe))};switch(F){case"vector":this.workerSources[O][F][G]=new De(ee,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][F][G]=new st(ee,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][F][G]=new this.externalWorkerSourceTypes[F](ee,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][F][G]}_getDEMWorkerSource(O,F){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][F]||(this.demWorkerSources[O][F]=new we),this.demWorkerSources[O][F]}}return z.i(self)&&(self.worker=new Et(self)),Et})),X("index",["exports","./shared"],(function(z,u){var W="5.10.0";function te(){var p=new u.A(4);return u.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}let xe,De;const we={frame(p,e,a){const l=requestAnimationFrame((g=>{d(),e(g)})),{unsubscribe:d}=u.s(p.signal,"abort",(()=>{d(),cancelAnimationFrame(l),a(u.c())}),!1)},frameAsync(p){return new Promise(((e,a)=>{this.frame(p,e,a)}))},getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,a.drawImage(p,0,0,p.width,p.height),a},resolveURL:p=>(xe||(xe=document.createElement("a")),xe.href=p,xe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(De==null&&(De=matchMedia("(prefers-reduced-motion: reduce)")),De.matches)}},Ee=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(p){this._frozenAt=p}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Qe(){return Ee.getCurrentTime()}class ve{static testProp(e){if(!ve.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in ve.docStyle)return e[a];return e[0]}static create(e,a,l){const d=window.document.createElement(e);return a!==void 0&&(d.className=a),l&&l.appendChild(d),d}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){ve.docStyle&&ve.selectProp&&(ve.userSelect=ve.docStyle[ve.selectProp],ve.docStyle[ve.selectProp]="none")}static enableDrag(){ve.docStyle&&ve.selectProp&&(ve.docStyle[ve.selectProp]=ve.userSelect)}static setTransform(e,a){e.style[ve.transformProp]=a}static addEventListener(e,a,l,d={}){e.addEventListener(a,l,"passive"in d?d:d.capture)}static removeEventListener(e,a,l,d={}){e.removeEventListener(a,l,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ve.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ve.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ve.suppressClickInternal,!0)}),0)}static getScale(e){const a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,l){const d=a.boundingClientRect;return new u.P((l.clientX-d.left)/a.x-e.clientLeft,(l.clientY-d.top)/a.y-e.clientTop)}static mousePos(e,a){const l=ve.getScale(e);return ve.getPoint(e,l,a)}static touchPos(e,a){const l=[],d=ve.getScale(e);for(let g=0;g<a.length;g++)l.push(ve.getPoint(e,d,a[g]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const a=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=a.querySelectorAll("script");for(const d of l)d.remove();return ve.clean(a),a.innerHTML}static isPossiblyDangerous(e,a){const l=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const a=e.children;for(const l of a)ve.removeAttributes(l),ve.clean(l)}static removeAttributes(e){for(const{name:a,value:l}of e.attributes)ve.isPossiblyDangerous(a,l)&&e.removeAttribute(a)}}ve.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ve.selectProp=ve.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ve.transformProp=ve.testProp(["transform","WebkitTransform"]);const St={supported:!1,testSupport:function(p){!$t&&jt&&(Fi?Rt(p):wt=p)}};let wt,jt,$t=!1,Fi=!1;function Rt(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,jt),p.isContextLost())return;St.supported=!0}catch{}p.deleteTexture(e),$t=!0}var vt;typeof document<"u"&&(jt=document.createElement("img"),jt.onload=()=>{wt&&Rt(wt),wt=null,Fi=!0},jt.onerror=()=>{$t=!0,wt=null},jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(p){let e,a,l,d;p.resetRequestQueue=()=>{e=[],a=0,l=0,d={}},p.addThrottleControl=S=>{const E=l++;return d[E]=S,E},p.removeThrottleControl=S=>{delete d[S],_()},p.getImage=(S,E,I=!0)=>new Promise(((L,R)=>{St.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),u.e(S,{type:"image"}),e.push({abortController:E,requestParameters:S,supportImageRefresh:I,state:"queued",onError:$=>{R($)},onSuccess:$=>{L($)}}),_()}));const g=S=>u._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:E,supportImageRefresh:I,onError:L,onSuccess:R,abortController:$}=S,Z=I===!1&&!u.i(self)&&!u.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce(((J,oe)=>J&&oe==="accept"),!0));a++;const K=Z?w(E,$):u.m(E,$);try{const J=yield K;delete S.abortController,S.state="completed",J.data instanceof HTMLImageElement||u.b(J.data)?R(J):J.data&&R({data:yield(Q=J.data,typeof createImageBitmap=="function"?u.f(Q):u.h(Q)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete S.abortController,L(J)}finally{a--,_()}var Q})),_=()=>{const S=(()=>{for(const E of Object.keys(d))if(d[E]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=a;E<S&&e.length>0;E++){const I=e.shift();I.abortController.signal.aborted?E--:g(I)}},w=(S,E)=>new Promise(((I,L)=>{const R=new Image,$=S.url,Z=S.credentials;Z&&Z==="include"?R.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!u.d($))&&(R.crossOrigin="anonymous"),E.signal.addEventListener("abort",(()=>{R.src="",L(u.c())})),R.fetchPriority="high",R.onload=()=>{R.onerror=R.onload=null,I({data:R})},R.onerror=()=>{R.onerror=R.onload=null,E.signal.aborted||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},R.src=$}))})(vt||(vt={})),vt.resetRequestQueue();class Ft{constructor(e){this._transformRequestFn=e??null}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function wi(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const a=[];for(const{id:l,url:d}of p){const g=`${l}${d}`;a.indexOf(g)===-1&&(a.push(g),e.push({id:l,url:d}))}}return e}function Ui(p,e,a){try{const l=new URL(p);return l.pathname+=`${e}${a}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${p}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Ri(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class Yi extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,promiseResolve:l}of this.requestors)l(this._getImagesForIds(a));this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const l=a.spriteData;a.data=new u.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let l=!0;const d=a.data||a.spriteData;return this._validateStretch(a.stretchX,d&&d.width)||(this.fire(new u.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(a.stretchY,d&&d.height)||(this.fire(new u.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(a.content,a)||(this.fire(new u.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,a){if(!e)return!0;let l=0;for(const d of e){if(d[0]<l||d[1]<d[0]||a<d[1])return!1;l=d[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const l=a.spriteData,d=l&&l.width||a.data.width,g=l&&l.height||a.data.height;return!(e[0]<0||d<e[0]||e[1]<0||g<e[1]||e[2]<0||d<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,l=!0){const d=this.getImage(e);if(l&&(d.data.width!==a.data.width||d.data.height!==a.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=d.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((a,l)=>{let d=!0;if(!this.isLoaded())for(const g of e)this.images[g]||(d=!1);this.isLoaded()||d?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})}))}_getImagesForIds(e){const a={};for(const l of e){let d=this.getImage(l);d||(this.fire(new u.l("styleimagemissing",{id:l})),d=this.getImage(l)),d?a[l]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:u.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],l=this.getImage(e);if(!l)return null;if(a&&a.position.version===l.version)return a.position;if(a)a.position.version=l.version;else{const d={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new u.I(d,l);this.patterns[e]={bin:d,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.T(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const g in this.patterns)e.push(this.patterns[g].bin);const{w:a,h:l}=u.p(e),d=this.atlasImage;d.resize({width:a||1,height:l||1});for(const g in this.patterns){const{bin:_}=this.patterns[g],w=_.x+1,S=_.y+1,E=this.getImage(g).data,I=E.width,L=E.height;u.R.copy(E,d,{x:0,y:0},{x:w,y:S},{width:I,height:L}),u.R.copy(E,d,{x:0,y:L-1},{x:w,y:S-1},{width:I,height:1}),u.R.copy(E,d,{x:0,y:0},{x:w,y:S+L},{width:I,height:1}),u.R.copy(E,d,{x:I-1,y:0},{x:w-1,y:S},{width:1,height:L}),u.R.copy(E,d,{x:0,y:0},{x:w+I,y:S},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const l=this.getImage(a);l||u.w(`Image with ID: "${a}" was not found`),Ri(l)&&this.updateImage(a,l)}}}const Ci=1e20;function Vt(p,e,a,l,d,g,_,w,S){for(let E=e;E<e+l;E++)Kt(p,a*g+E,g,d,_,w,S);for(let E=a;E<a+d;E++)Kt(p,E*g+e,1,l,_,w,S)}function Kt(p,e,a,l,d,g,_){g[0]=0,_[0]=-Ci,_[1]=Ci,d[0]=p[e];for(let w=1,S=0,E=0;w<l;w++){d[w]=p[e+w*a];const I=w*w;do{const L=g[S];E=(d[w]-d[L]+I-L*L)/(w-L)/2}while(E<=_[S]&&--S>-1);S++,g[S]=w,_[S]=E,_[S+1]=Ci}for(let w=0,S=0;w<l;w++){for(;_[S+1]<w;)S++;const E=g[S],I=w-E;p[e+w*a]=d[E]+I*I}}class qi{constructor(e,a,l){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={},this.lang=l}setURL(e){this.url=e}getGlyphs(e){return u._(this,void 0,void 0,(function*(){const a=[];for(const g in e)for(const _ of e[g])a.push(this._getAndCacheGlyphsPromise(g,_));const l=yield Promise.all(a),d={};for(const{stack:g,id:_,glyph:w}of l)d[g]||(d[g]={}),d[g][_]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return d}))}_getAndCacheGlyphsPromise(e,a){return u._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=l.glyphs[a];if(d!==void 0)return{stack:e,id:a,glyph:d};if(d=this._tinySDF(l,e,a),d)return l.glyphs[a]=d,{stack:e,id:a,glyph:d};const g=Math.floor(a/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[g])return{stack:e,id:a,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[g]){const w=qi.loadGlyphRange(e,g,this.url,this.requestManager);l.requests[g]=w}const _=yield l.requests[g];for(const w in _)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=_[+w]);return l.ranges[g]=!0,{stack:e,id:a,glyph:_[a]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||u.u["CJK Unified Ideographs"](e)||u.u["Hangul Syllables"](e)||u.u.Hiragana(e)||u.u.Katakana(e)||u.u["CJK Symbols and Punctuation"](e)||u.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,a,l){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(l))return;let g=e.tinySDF;if(!g){let w="400";/bold/i.test(a)?w="900":/medium/i.test(a)?w="500":/light/i.test(a)&&(w="200"),g=e.tinySDF=new qi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:d,fontWeight:w})}const _=g.draw(String.fromCharCode(l));return{id:l,bitmap:new u.q({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}qi.loadGlyphRange=function(p,e,a,l){return u._(this,void 0,void 0,(function*(){const d=256*e,g=d+255,_=l.transformRequest(a.replace("{fontstack}",p).replace("{range}",`${d}-${g}`),"Glyphs"),w=yield u.n(_,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${g}`);const S={};for(const E of u.o(w.data))S[E.id]=E;return S}))},qi.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:a=8,cutoff:l=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:_="normal",lang:w=null}={}){this.buffer=e,this.cutoff=l,this.radius=a,this.lang=w;const S=this.size=p+4*e,E=this._createCanvas(S),I=this.ctx=E.getContext("2d",{willReadFrequently:!0});I.font=`${_} ${g} ${p}px ${d}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:l,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(p),_=Math.ceil(a),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),S=Math.min(this.size-this.buffer,_+Math.ceil(l)),E=w+2*this.buffer,I=S+2*this.buffer,L=Math.max(E*I,0),R=new Uint8ClampedArray(L),$={data:R,width:E,height:I,glyphWidth:w,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(w===0||S===0)return $;const{ctx:Z,buffer:K,gridInner:Q,gridOuter:J}=this;this.lang&&(Z.lang=this.lang),Z.clearRect(K,K,w,S),Z.fillText(p,K,K+_);const oe=Z.getImageData(K,K,w,S);J.fill(Ci,0,L),Q.fill(0,0,L);for(let he=0;he<S;he++)for(let se=0;se<w;se++){const de=oe.data[4*(he*w+se)+3]/255;if(de===0)continue;const ge=(he+K)*E+se+K;if(de===1)J[ge]=0,Q[ge]=Ci;else{const ce=.5-de;J[ge]=ce>0?ce*ce:0,Q[ge]=ce<0?ce*ce:0}}Vt(J,0,0,E,I,E,this.f,this.v,this.z),Vt(Q,K,K,w,S,E,this.f,this.v,this.z);for(let he=0;he<L;he++){const se=Math.sqrt(J[he])-Math.sqrt(Q[he]);R[he]=Math.round(255-255*(se/this.radius+this.cutoff))}return $}};class He{constructor(){this.specification=u.v.light.position}possiblyEvaluate(e,a){return u.B(e.expression.evaluate(a))}interpolate(e,a,l){return{x:u.C.number(e.x,a.x,l),y:u.C.number(e.y,a.y,l),z:u.C.number(e.z,a.z,l)}}}let gt;class Ot extends u.E{constructor(e){super(),gt=gt||new u.r({anchor:new u.D(u.v.light.anchor),position:new He,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.t(gt,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(u.x,e,a))for(const l in e){const d=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),d):this._transitionable.setValue(l,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,l){return(!l||l.validate!==!1)&&u.y(this,e.call(u.z,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const At=new u.r({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class mi extends u.E{constructor(e){super(),this._transitionable=new u.t(At,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.F(0))}setSky(e,a={}){if(!this._validate(u.G,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const d=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),d):this._transitionable.setValue(l,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,l={}){return l?.validate!==!1&&u.y(this,e.call(u.z,u.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class be{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const l=e.join(",")+String(a);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,a)),this.dashEntry[l]}getDashRanges(e,a,l){const d=[];let g=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,w=!0;d.push({left:g,right:_,isDash:w,zeroLength:e[0]===0});let S=e[0];for(let E=1;E<e.length;E++){w=!w;const I=e[E];g=S*l,S+=I,_=S*l,d.push({left:g,right:_,isDash:w,zeroLength:I===0})}return d}addRoundDash(e,a,l){const d=a/2;for(let g=-l;g<=l;g++){const _=this.width*(this.nextRow+l+g);let w=0,S=e[w];for(let E=0;E<this.width;E++){E/S.right>1&&(S=e[++w]);const I=Math.abs(E-S.left),L=Math.abs(E-S.right),R=Math.min(I,L);let $;const Z=g/l*(d+1);if(S.isDash){const K=d-Math.abs(Z);$=Math.sqrt(R*R+K*K)}else $=d-Math.sqrt(R*R+Z*Z);this.data[_+E]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const S=e[w],E=e[w+1];S.zeroLength?e.splice(w,1):E&&E.isDash===S.isDash&&(E.left=S.left,e.splice(w,1))}const a=e[0],l=e[e.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const d=this.width*this.nextRow;let g=0,_=e[g];for(let w=0;w<this.width;w++){w/_.right>1&&(_=e[++g]);const S=Math.abs(w-_.left),E=Math.abs(w-_.right),I=Math.min(S,E);this.data[d+w]=Math.max(0,Math.min(255,(_.isDash?I:-I)+128))}}addDash(e,a){const l=a?7:0,d=2*l+1;if(this.nextRow+d>this.height)return u.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<e.length;w++)g+=e[w];if(g!==0){const w=this.width/g,S=this.getDashRanges(e,this.width,w);a?this.addRoundDash(S,w,l):this.addRegularDash(S)}const _={y:this.nextRow+l,height:2*l,width:g};return this.nextRow+=d,this.dirty=!0,_}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Ye="maplibre_preloaded_worker_pool";class yt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<yt.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ye]}numActive(){return Object.keys(this.active).length}}const kt=Math.floor(we.hardwareConcurrency/2);let Ht,Gt;function ei(){return Ht||(Ht=new yt),Ht}yt.workerCount=u.H(globalThis)?Math.max(Math.min(kt,3),1):1;class $i{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const l=this.workerPool.acquire(a);for(let d=0;d<l.length;d++){const g=new u.J(l[d],a);g.name=`Worker ${d}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){const l=[];for(const d of this.actors)l.push(d.sendAsync({type:e,data:a}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(const l of this.actors)l.registerMessageHandler(e,a)}}function vi(){return Gt||(Gt=new $i(ei(),u.K),Gt.registerMessageHandler("GR",((p,e,a)=>u.m(e,a)))),Gt}function Cn(p,e){const a=u.L();return u.M(a,a,[1,1,0]),u.N(a,a,[.5*p.width,.5*p.height,1]),p.calculatePosMatrix?u.O(a,a,p.calculatePosMatrix(e.toUnwrapped())):a}function _n(p,e,a,l,d,g,_){var w;const S=(function(R,$,Z){if(R)for(const K of R){const Q=$[K];if(Q&&Q.source===Z&&Q.type==="fill-extrusion")return!0}else for(const K in $){const Q=$[K];if(Q.source===Z&&Q.type==="fill-extrusion")return!0}return!1})((w=d?.layers)!==null&&w!==void 0?w:null,e,p.id),E=g.maxPitchScaleFactor(),I=p.tilesIn(l,E,S);I.sort(Tr);const L=[];for(const R of I)L.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,a,p._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,d,g,E,Cn(p.transform,R.tileID),_?($,Z)=>_(R.tileID,$,Z):void 0)});return(function(R,$){for(const Z in R)for(const K of R[Z])En(K,$);return R})((function(R){const $={},Z={};for(const K of R){const Q=K.queryResults,J=K.wrappedTileID,oe=Z[J]=Z[J]||{};for(const he in Q){const se=Q[he],de=oe[he]=oe[he]||{},ge=$[he]=$[he]||[];for(const ce of se)de[ce.featureIndex]||(de[ce.featureIndex]=!0,ge.push(ce))}}return $})(L),p)}function Tr(p,e){const a=p.tileID,l=e.tileID;return a.overscaledZ-l.overscaledZ||a.canonical.y-l.canonical.y||a.wrap-l.wrap||a.canonical.x-l.canonical.x}function En(p,e){const a=p.feature,l=e.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=l}function zi(p,e,a){return u._(this,void 0,void 0,(function*(){let l=p;if(p.url?l=(yield u.j(e.transformRequest(p.url,"Source"),a)).data:yield we.frameAsync(a),!l)return null;const d=u.Q(u.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(d.vectorLayerIds=l.vector_layers.map((g=>g.id))),d}))}class Bi{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof u.S?new u.S(e.lng,e.lat):u.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof u.S?new u.S(e.lng,e.lat):u.S.convert(e),this}extend(e){const a=this._sw,l=this._ne;let d,g;if(e instanceof u.S)d=e,g=e;else{if(!(e instanceof Bi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Bi.convert(e)):this.extend(u.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(u.S.convert(e)):this;if(d=e._sw,g=e._ne,!d||!g)return this}return a||l?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),l.lng=Math.max(g.lng,l.lng),l.lat=Math.max(g.lat,l.lat)):(this._sw=new u.S(d.lng,d.lat),this._ne=new u.S(g.lng,g.lat)),this}getCenter(){return new u.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.S(this.getWest(),this.getNorth())}getSouthEast(){return new u.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:l}=u.S.convert(e);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&d}static convert(e){return e instanceof Bi?e:e&&new Bi(e)}static fromLngLat(e,a=0){const l=360*a/40075017,d=l/Math.cos(Math.PI/180*e.lat);return new Bi(new u.S(e.lng-d,e.lat-l),new u.S(e.lng+d,e.lat+l))}adjustAntiMeridian(){const e=new u.S(this._sw.lng,this._sw.lat),a=new u.S(this._ne.lng,this._ne.lat);return new Bi(e,e.lng>a.lng?new u.S(a.lng+360,a.lat):a)}}class cn{constructor(e,a,l){this.bounds=Bi.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),l=Math.floor(u.V(this.bounds.getWest())*a),d=Math.floor(u.U(this.bounds.getNorth())*a),g=Math.ceil(u.V(this.bounds.getEast())*a),_=Math.ceil(u.U(this.bounds.getSouth())*a);return e.x>=l&&e.x<g&&e.y>=d&&e.y<_}}class Pa extends u.E{constructor(e,a,l,d){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.Q(a,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield zi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(u.e(this,e),e.bounds&&(this.tileBounds=new cn(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new u.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(e){return u._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((g,_)=>{e.reloadPromise={resolve:g,reject:_}}))}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const g=yield e.actor.sendAsync({type:d,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return u._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return u._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Ei extends u.E{constructor(e,a,l,d){super(),this.id=e,this.dispatcher=l,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},a),u.e(this,u.Q(a,["url","scheme","tileSize"]))}load(){return u._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield zi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(u.e(this,a),a.bounds&&(this.tileBounds=new cn(a.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,this.fire(new u.k(a))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return u.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return u._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield vt.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const d=this.map.painter.context,g=d.gl,_=l.data;e.texture=this.map.painter.getTileTexture(_.width),e.texture?e.texture.update(_,{useMipmap:!0}):(e.texture=new u.T(d,_,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return u._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return u._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class An extends Ei{constructor(e,a,l,d){super(e,a,l,d),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return u._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield vt.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const g=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const _=u.b(g)&&u.W()?g:yield this.readImageNow(g),w={type:this.type,uid:e.uid,source:this.id,rawImageData:_,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}}))}readImageNow(e){return u._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&u.X()){const a=e.width+2,l=e.height+2;try{return new u.R({width:a,height:l},yield u.Y(e,-1,-1,a,l))}catch{}}return we.getImageData(e,1)}))}_getNeighboringTiles(e){const a=e.canonical,l=Math.pow(2,a.z),d=(a.x-1+l)%l,g=a.x===0?e.wrap-1:e.wrap,_=(a.x+1+l)%l,w=a.x+1===l?e.wrap+1:e.wrap,S={};return S[new u.Z(e.overscaledZ,g,a.z,d,a.y).key]={backfilled:!1},S[new u.Z(e.overscaledZ,w,a.z,_,a.y).key]={backfilled:!1},a.y>0&&(S[new u.Z(e.overscaledZ,g,a.z,d,a.y-1).key]={backfilled:!1},S[new u.Z(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},S[new u.Z(e.overscaledZ,w,a.z,_,a.y-1).key]={backfilled:!1}),a.y+1<l&&(S[new u.Z(e.overscaledZ,g,a.z,d,a.y+1).key]={backfilled:!1},S[new u.Z(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},S[new u.Z(e.overscaledZ,w,a.z,_,a.y+1).key]={backfilled:!1}),S}unloadTile(e){return u._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Fn extends u.E{constructor(e,a,l,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=l.getActor(),this.setEventedParent(d),this._data=a.data,this._options=u.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:u.$,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.$,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(u.$/this.tileSize)}_getClusterMaxZoom(e){const a=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||u.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${a}"`),a}load(){return u._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=u.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return u._(this,void 0,void 0,(function*(){const e=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((a=>a.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return u._(this,void 0,void 0,(function*(){const e=new Bi,a=yield this.getData();let l;switch(a.type){case"FeatureCollection":l=a.features.map((d=>this.getCoordinatesFromGeometry(d.geometry))).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(a.geometry);break;default:l=this.getCoordinatesFromGeometry(a)}if(l.length==0)return e;for(let d=0;d<l.length-1;d+=2)e.extend([l[d],l[d+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:l}})}_updateWorkerData(){return u._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void u.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:a}=this._pendingWorkerUpdate,l=u.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(l.request=this.map._requestManager.transformRequest(we.resolveURL(e),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):a&&(l.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new u.l("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||d.abandoned)return void this.fire(new u.l("dataabort",{dataType:"source"}));this._data=d.data;let g=null;d.resourceTiming&&d.resourceTiming[this.id]&&(g=d.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&u.e(_,{resourceTiming:g}),this.fire(new u.l("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new u.l("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(d){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new u.l("dataabort",{dataType:"source"}));this.fire(new u.k(d))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return u._(this,void 0,void 0,(function*(){const a=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:a,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,a==="RT")}))}abortTile(e){return u._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return u._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Hr extends u.E{constructor(e,a,l,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=a}load(e){return u._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield vt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new u.k(a))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(u.a1.fromLngLat);var l;return this.tileID=(function(d){const g=u.a2.fromPoints(d),_=g.width(),w=g.height(),S=Math.max(_,w),E=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),I=Math.pow(2,E);return new u.a4(E,Math.floor((g.minX+g.maxX)/2*I),Math.floor((g.minY+g.maxY)/2*I))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((d=>this.tileID.getTilePoint(d)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,a=e.gl;this.texture||(this.texture=new u.T(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return u._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:a,minY:l,maxX:d,maxY:g}=u.a2.fromPoints(e),_={};for(let w=0;w<=u.a3;w++){const S=Math.pow(2,w),E=Math.floor(a*S),I=Math.floor(l*S),L=Math.floor(d*S),R=Math.floor(g*S);_[w]={minTileX:E,minTileY:I,maxTileX:L,maxTileY:R}}return _}}class Qn extends Hr{constructor(e,a,l,d){super(e,a,l,d),this.roundZoom=!0,this.type="video",this.options=a}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield u.a5(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new u.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new u.k(new u.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,a=e.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new u.T(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const d in this.tiles){const g=this.tiles[d];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,l=!0)}l&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class un extends Hr{constructor(e,a,l,d){super(e,a,l,d),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((g=>!Array.isArray(g)||g.length!==2||g.some((_=>typeof _!="number"))))||this.fire(new u.k(new u.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.k(new u.a6(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new u.k(new u.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new u.k(new u.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.k(new u.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return u._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,l=a.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.T(a,this.canvas,l.RGBA,{premultiply:!0});let d=!1;for(const g in this.tiles){const _=this.tiles[g];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,d=!0)}d&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const dr={},fa=p=>{switch(p){case"geojson":return Fn;case"image":return Hr;case"raster":return Ei;case"raster-dem":return An;case"vector":return Pa;case"video":return Qn;case"canvas":return un}return dr[p]},rn="RTLPluginLoaded";class st extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=vi()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return u._(this,arguments,void 0,(function*(a,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=we.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return u._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.l(rn))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Pt=null;function Et(){return Pt||(Pt=new st),Pt}var ne,O;(function(p){p[p.Base=0]="Base",p[p.Parent=1]="Parent"})(ne||(ne={})),(function(p){p[p.Departing=0]="Departing",p[p.Incoming=1]="Incoming"})(O||(O={}));class F{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=u.a7(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:a,fadingParentID:l,fadeEndTime:d}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=a,this.fadingParentID=l,this.fadeEndTime=d}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Qe(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(d,g){const _={};if(!g)return _;for(const w of d){const S=w.layerIds.map((E=>g.getLayer(E))).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((E=>S.filter((I=>I.id===E))[0])));for(const E of S)_[E.id]=w}}return _})(e.buckets,a?.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const g=this.buckets[d];if(g instanceof u.a9){if(this.hasSymbolBuckets=!0,!l)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const g=this.buckets[d];if(g instanceof u.a9&&g.hasRTLText){this.hasRTLText=!0,Et().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const g=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(d).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new u.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const d=this.buckets[l];d.uploadPending()&&d.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new u.T(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new u.T(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,l,d,g,_,w,S,E,I,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:g,scale:_,tileSize:this.tileSize,pixelPosMatrix:I,transform:S,params:w,queryPadding:this.queryPadding*E,getElevation:L},e,a,l):{}}querySourceFeatures(e,a){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const d=l.loadVTLayers(),g=a&&a.sourceLayer?a.sourceLayer:"",_=d._geojsonTileLayer||d[g];if(!_)return;const w=u.aa(a?.filter,a?.globalState),{z:S,x:E,y:I}=this.tileID.canonical,L={z:S,x:E,y:I};for(let R=0;R<_.length;R++){const $=_.feature(R);if(w.needGeometry){const Q=u.ab($,!0);if(!w.filter(new u.F(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!w.filter(new u.F(this.tileID.overscaledZ),$))continue;const Z=l.getId($,g),K=new u.ac($,S,E,I,Z);K.tile=L,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const l=u.ad(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let d=!1;if(this.expirationTime>l)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const g=this.expirationTime-a;g?this.expirationTime=l+Math.max(g,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!a.style.hasLayer(d))continue;const g=this.buckets[d],_=g.layers[0].sourceLayer||"_geojsonTileLayer",w=l[_],S=e[_];if(!w||!S||Object.keys(S).length===0)continue;g.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const E=a&&a.style&&a.style.getLayer(d);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(g)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Qe()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=Qe()+e}setDependencies(e,a){const l={};for(const d of a)l[d]=!0;this.dependencies[e]=l}hasDependency(e,a){for(const l of e){const d=this.dependencies[l];if(d){for(const g of a)if(d[g])return!0}}return!1}}class G{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(const e in this.data)for(const a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,l){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const g={value:a,timeout:void 0};if(l!==void 0&&(g.timeout=setTimeout((()=>{this.remove(e,g)}),l)),this.data[d].push(g),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){const a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;const l=e.wrapped().key,d=a===void 0?0:this.data[l].indexOf(a),g=this.data[l][d];return this.data[l].splice(d,1),g.timeout&&clearTimeout(g.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(g.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){const a=[];for(const l in this.data)for(const d of this.data[l])e(d.value)||a.push(d);for(const l of a)this.remove(l.value.tileID,l)}}class ee{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,l){const d=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},u.e(this.stateChanges[e][d],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const g in this.state[e])g!==d&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const g in this.state[e][d])l[g]||(this.deletedStates[e][d][g]=null)}else for(const g in l)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][g]===null&&delete this.deletedStates[e][d][g]}removeFeatureState(e,a,l){if(this.deletedStates[e]===null)return;const d=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&a!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][l]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(l in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][l]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,a){const l=String(a),d=u.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const g=this.deletedStates[e][a];if(g===null)return{};for(const _ in g)delete d[_]}return d}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const l={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const g={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),u.e(this.state[d][_],this.stateChanges[d][_]),g[_]=this.state[d][_];l[d]=g}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const g={};if(this.deletedStates[d]===null)for(const _ in this.state[d])g[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(this.deletedStates[d][_]===null)this.state[d][_]={};else for(const w of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][w];g[_]=this.state[d][_]}l[d]=l[d]||{},u.e(l[d],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const d in e)e[d].setFeatureState(l,a)}}const le=89.25;function fe(p,e){const a=u.ae(e.lat,-u.af,u.af);return new u.P(u.V(e.lng)*p,u.U(a)*p)}function Pe(p,e){return new u.a1(e.x/p,e.y/p).toLngLat()}function Se(p){return p.cameraToCenterDistance*Math.min(.85*Math.tan(u.ag(90-p.pitch)),Math.tan(u.ag(le-p.pitch)))}function Ae(p,e){const a=p.canonical,l=e/u.ah(a.z),d=a.x+Math.pow(2,a.z)*p.wrap,g=u.ai(new Float64Array(16));return u.M(g,g,[d*l,a.y*l,0]),u.N(g,g,[l/u.$,l/u.$,1]),g}function Ge(p,e,a,l,d){const g=u.a1.fromLngLat(p,e),_=d*u.aj(1,p.lat),w=_*Math.cos(u.ag(a)),S=Math.sqrt(_*_-w*w),E=S*Math.sin(u.ag(-l)),I=S*Math.cos(u.ag(-l));return new u.a1(g.x+E,g.y+I,g.z+w)}function Ve(p,e,a){const l=e.intersectsFrustum(p);if(!a||l===0)return l;const d=e.intersectsPlane(a);return d===0?0:l===2&&d===2?2:1}function ct(p,e,a){let l=0;const d=(a-e)/10;for(let g=0;g<10;g++)l+=d*Math.pow(Math.cos(e+(g+.5)/10*(a-e)),p);return l}function _e(p,e){return function(a,l,d,g,_){const w=2*((p-1)/u.ak(Math.cos(u.ag(le-_))/Math.cos(u.ag(le)))-1),S=Math.acos(d/g),E=2*ct(w-1,0,u.ag(_/2)),I=Math.min(u.ag(le),S+u.ag(_/2)),L=ct(w-1,Math.min(I,S-u.ag(_/2)),I),R=Math.atan(l/d),$=Math.hypot(l,d);let Z=a;return Z+=u.ak(g/$/Math.max(.5,Math.cos(u.ag(_/2)))),Z+=w*u.ak(Math.cos(R))/2,Z-=u.ak(Math.max(1,L/E/e))/2,Z}}const qt=_e(9.314,3);function Ii(p,e){const a=(e.roundZoom?Math.round:Math.floor)(p.zoom+u.ak(p.tileSize/e.tileSize));return Math.max(0,a)}function zt(p,e){const a=p.getCameraFrustum(),l=p.getClippingPlane(),d=p.screenPointToMercatorCoordinate(p.getCameraPoint()),g=u.a1.fromLngLat(p.center,p.elevation);d.z=g.z+Math.cos(p.pitchInRadians)*p.cameraToCenterDistance/p.worldSize;const _=p.getCoveringTilesDetailsProvider(),w=_.allowVariableZoom(p,e),S=Ii(p,e),E=e.minzoom||0,I=e.maxzoom!==void 0?e.maxzoom:p.maxZoom,L=Math.min(Math.max(0,S),I),R=Math.pow(2,L),$=[R*d.x,R*d.y,0],Z=[R*g.x,R*g.y,0],K=Math.hypot(g.x-d.x,g.y-d.y),Q=Math.abs(g.z-d.z),J=Math.hypot(K,Q),oe=de=>({zoom:0,x:0,y:0,wrap:de,fullyVisible:!1}),he=[],se=[];if(p.renderWorldCopies&&_.allowWorldCopies())for(let de=1;de<=3;de++)he.push(oe(-de)),he.push(oe(de));for(he.push(oe(0));he.length>0;){const de=he.pop(),ge=de.x,ce=de.y;let Te=de.fullyVisible;const Oe={x:ge,y:ce,z:de.zoom},Re=_.getTileBoundingVolume(Oe,de.wrap,p.elevation,e);if(!Te){const at=Ve(a,Re,l);if(at===0)continue;Te=at===2}const Le=_.distanceToTile2d(d.x,d.y,Oe,Re);let Be=S;w&&(Be=(e.calculateTileZoom||qt)(p.zoom+u.ak(p.tileSize/e.tileSize),Le,Q,J,p.fov)),Be=(e.roundZoom?Math.round:Math.floor)(Be),Be=Math.max(0,Be);const nt=Math.min(Be,I);if(de.wrap=_.getWrap(g,Oe,de.wrap),de.zoom>=nt){if(de.zoom<E)continue;const at=L-de.zoom,et=$[0]-.5-(ge<<at),bt=$[1]-.5-(ce<<at),Wt=e.reparseOverscaled?Math.max(de.zoom,Be):de.zoom;se.push({tileID:new u.Z(de.zoom===I?Wt:de.zoom,de.wrap,de.zoom,ge,ce),distanceSq:u.al([Z[0]-.5-ge,Z[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(et*et+bt*bt)})}else for(let at=0;at<4;at++)he.push({zoom:de.zoom+1,x:(ge<<1)+at%2,y:(ce<<1)+(at>>1),wrap:de.wrap,fullyVisible:Te})}return se.sort(((de,ge)=>de.distanceSq-ge.distanceSq)).map((de=>de.tileID))}const oi=u.a2.fromPoints([new u.P(0,0),new u.P(u.$,u.$)]);class ki extends u.E{constructor(e,a,l){super(),this.id=e,this.dispatcher=l,this.on("data",(d=>this._dataHandler(d))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((d,g,_,w)=>{const S=new(fa(g.type))(d,g,_,w);if(S.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${S.id}`);return S})(e,a,l,this),this._tiles={},this._cache=new G(0,(d=>this._unloadTile(d))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new ee,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,l){return u._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,l)}catch(d){e.state="errored",d.status!==404?this._source.fire(new u.k(d,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new u.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const l=this._tiles[a];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(mr).map((e=>e.key))}getRenderableIds(e){const a=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&a.push(this._tiles[l]);return e?a.sort(((l,d)=>{const g=l.tileID,_=d.tileID,w=new u.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),S=new u.P(_.canonical.x,_.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-_.overscaledZ||S.y-w.y||S.x-w.x})).map((l=>l.tileID.key)):a.map((l=>l.tileID)).sort(mr).map((l=>l.key))}hasRenderableParent(e){const a=e.overscaledZ-1;if(a>=this._source.minzoom){const l=this._getLoadedTile(e.scaledTo(a));if(l)return this._isIdRenderable(l.tileID.key)}return!1}_isIdRenderable(e,a=!1){var l;return(l=this._tiles[e])===null||l===void 0?void 0:l.isRenderable(a)}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)e?this._reloadTile(a,"expired"):this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(e,a){return u._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=a),yield this._loadTile(l,e,a))}))}_tileLoaded(e,a,l){e.timeAdded=Qe(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new u.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let d=0;d<a.length;d++){const g=a[d];if(e.neighboringTiles&&e.neighboringTiles[g]){const _=this.getTileByID(g);l(e,_),l(_,e)}}function l(d,g){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let _=g.tileID.canonical.x-d.tileID.canonical.x;const w=g.tileID.canonical.y-d.tileID.canonical.y,S=Math.pow(2,d.tileID.canonical.z),E=g.tileID.key;_===0&&w===0||Math.abs(w)>1||(Math.abs(_)>1&&(Math.abs(_+S)===1?_+=S:Math.abs(_-S)===1&&(_-=S)),g.dem&&d.dem&&(d.dem.backfillBorder(g.dem,_,w),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a){const l=Object.values(e),d=this._getLoadedDescendents(l),g={};for(const _ of l){const w=d[_.key];if(!w?.length){g[_.key]=_;continue}const S=_.overscaledZ+ki.maxUnderzooming,E=w.filter((R=>R.tileID.overscaledZ<=S));if(!E.length){g[_.key]=_;continue}const I=Math.min(...E.map((R=>R.tileID.overscaledZ))),L=E.filter((R=>R.tileID.overscaledZ===I)).map((R=>R.tileID));for(const R of L)a[R.key]=R;this._areDescendentsComplete(L,I,_.overscaledZ)||(g[_.key]=_)}return g}_getLoadedDescendents(e){var a;const l={};for(const d in this._tiles){const g=this._tiles[d];if(g.hasData())for(const _ of e)g.tileID.isChildOf(_)&&(l[a=_.key]||(l[a]=[])).push(g)}return l}_areDescendentsComplete(e,a,l){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===a:Math.pow(4,a-l)===e.length}_getLoadedTile(e){const a=this._tiles[e.key];return a?.hasData()?a:null}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(a*l*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(g)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const l={};for(const d in this._tiles){const g=this._tiles[d];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),l[g.tileID.key]=g}this._tiles=l,this._resetTileReloadTimers()}}update(e,a){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((S=>new u.Z(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y))):(l=zt(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((S=>this._source.hasTile(S))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const d=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,d&&this.fire(new u.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const g=Ii(e,this._source),_=this._updateRetainedTiles(l,g),w=nr(this._source.type);w&&this._rasterFadeDuration>0&&!a&&this._updateFadingTiles(l,_),w?this._cleanUpRasterTiles(_):this._cleanUpVectorTiles(_)}_cleanUpRasterTiles(e){for(const a in this._tiles)e[a]||this._removeTile(a)}_cleanUpVectorTiles(e){for(const a in this._tiles){const l=this._tiles[a];e[a]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(a):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(e){const a=[];for(const l of e)if(l.canonical.z>this._source.minzoom){const d=l.scaledTo(l.canonical.z-1);a.push(d);const g=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));a.push(g)}return e.concat(a)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var l;const d={},g={},_=Math.max(a-ki.maxOverzooming,this._source.minzoom);let w={};for(const S of e){const E=this._addTile(S);d[S.key]=S,E.hasData()||(w[S.key]=S)}w=this._retainLoadedChildren(w,d);for(const S in w){const E=w[S];let I=this._tiles[S],L=I?.wasRequested();for(let R=E.overscaledZ-1;R>=_;--R){const $=E.scaledTo(R);if(g[$.key])break;if(g[$.key]=!0,I=this.getTile($),!I&&L&&(I=this._addTile($)),I){const Z=I.hasData();if((Z||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||L)&&(d[$.key]=$),L=I.wasRequested(),Z)break}}}return d}_updateFadingTiles(e,a){const l=Qe(),d=u.am(e);for(const g of e){const _=this._tiles[g.key];_.fadingDirection!==O.Departing&&_.fadeOpacity!==0||_.resetFadeLogic(),this._updateFadingAncestor(_,a,l)||this._updateFadingDescendents(_,a,l)||this._updateFadingEdge(_,d,l)||_.resetFadeLogic()}}_updateFadingAncestor(e,a,l){if(!e.hasData())return!1;const{tileID:d,fadingRole:g,fadingDirection:_,fadingParentID:w}=e;if(g===ne.Base&&_===O.Incoming&&w)return a[w.key]=w,!0;const S=Math.max(d.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let E=d.overscaledZ-1;E>=S;E--){const I=d.scaledTo(E),L=this._getLoadedTile(I);if(L)return e.setCrossFadeLogic({fadingRole:ne.Base,fadingDirection:O.Incoming,fadingParentID:L.tileID,fadeEndTime:l+this._rasterFadeDuration}),L.setCrossFadeLogic({fadingRole:ne.Parent,fadingDirection:O.Departing,fadeEndTime:l+this._rasterFadeDuration}),a[I.key]=I,!0}return!1}_updateFadingDescendents(e,a,l){if(!e.hasData())return!1;const d=e.tileID.children(this._source.maxzoom);let g=this._updateFadingChildren(e,d,a,l);if(g)return!0;for(const _ of d){const w=_.children(this._source.maxzoom);this._updateFadingChildren(e,w,a,l)&&(g=!0)}return g}_updateFadingChildren(e,a,l,d){if(a[0].overscaledZ>=this._source.maxzoom)return!1;let g=!1;for(const _ of a){const w=this._getLoadedTile(_);if(!w)continue;const{fadingRole:S,fadingDirection:E,fadingParentID:I}=w;S===ne.Base&&E===O.Departing&&I||(w.setCrossFadeLogic({fadingRole:ne.Base,fadingDirection:O.Departing,fadingParentID:e.tileID,fadeEndTime:d+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:ne.Parent,fadingDirection:O.Incoming,fadeEndTime:d+this._rasterFadeDuration})),l[_.key]=_,g=!0}return g}_updateFadingEdge(e,a,l){const d=e.tileID;return!!e.selfFading||!e.hasData()&&!!a.has(d)&&(e.setSelfFadeLogic(l+this._rasterFadeDuration),!0)}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(a.resetFadeLogic(),this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null));const l=a;return a||(a=new F(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,l||this._source.fire(new u.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){this._clearTileReloadTimer(e);const l=a.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}_clearTileReloadTimer(e){const a=this._timers[e];a&&(clearTimeout(a),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(const a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&e.some((l=>l.equals(this._tiles[a].tileID.canonical)))&&this._reloadTile(a,"expired")}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,l){const d=[],g=this.transform;if(!g)return d;const _=g.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?g.getCameraQueryGeometry(e):e,S=$=>g.screenPointToMercatorCoordinate($,this.terrain),E=this.transformBbox(e,S,!_),I=this.transformBbox(w,S,!_),L=this.getIds(),R=u.a2.fromPoints(I);for(let $=0;$<L.length;$++){const Z=this._tiles[L[$]];if(Z.holdingForSymbolFade())continue;const K=_?[Z.tileID]:[Z.tileID.unwrapTo(-1),Z.tileID.unwrapTo(0)],Q=Math.pow(2,g.zoom-Z.tileID.overscaledZ),J=a*Z.queryPadding*u.$/Z.tileSize/Q;for(const oe of K){const he=R.map((se=>oe.getTilePoint(new u.a1(se.x,se.y))));if(he.expandBy(J),he.intersects(oi)){const se=E.map((ge=>oe.getTilePoint(ge))),de=I.map((ge=>oe.getTilePoint(ge)));d.push({tile:Z,tileID:_?oe:oe.unwrapTo(0),queryGeometry:se,cameraQueryGeometry:de,scale:Q})}}}return d}transformBbox(e,a,l){let d=e.map(a);if(l){const g=u.a2.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));const _=g.map(a);u.a2.fromPoints(d).covers(_)||(d=d.map((w=>w.x>.5?new u.a1(w.x-1,w.y,w.z):w)))}return d}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(nr(this._source.type)&&this._rasterFadeDuration>0){const e=Qe();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,a,l){this._state.updateState(e=e||"_geojsonTileLayer",a,l)}removeFeatureState(e,a,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,l)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,l){const d=this._tiles[e];d&&d.setDependencies(a,l)}reloadTilesForDependencies(e,a){for(const l in this._tiles)this._tiles[l].hasDependency(e,a)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,a)))}}function mr(p,e){const a=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||l-a||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function nr(p){return p==="raster"||p==="image"||p==="video"}ki.maxOverzooming=10,ki.maxUnderzooming=3;class gi{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=u.ae(e,0,1);let a=1,l=this._distances[a];const d=e*this.paddedLength+this.padding;for(;l<d&&a<this._distances.length;)l=this._distances[++a];const g=a-1,_=this._distances[g],w=l-_,S=w>0?(d-_)/w:0;return this.points[g].mult(1-S).add(this.points[a].mult(S))}}function ze(p,e){let a=!0;return p==="always"||p!=="never"&&e!=="never"||(a=!1),a}class Ke{constructor(e,a,l){const d=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(a/l);for(let _=0;_<this.xCellCount*this.yCellCount;_++)d.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,l,d,g){this._forEachCell(a,l,d,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g)}insertCircle(e,a,l,d){this._forEachCell(a-d,l-d,a+d,l+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(l),this.circles.push(d)}_insertBoxCell(e,a,l,d,g,_){this.boxCells[g].push(_)}_insertCircleCell(e,a,l,d,g,_){this.circleCells[g].push(_)}_query(e,a,l,d,g,_,w){if(l<0||e>this.width||d<0||a>this.height)return[];const S=[];if(e<=0&&a<=0&&this.width<=l&&this.height<=d){if(g)return[{key:null,x1:e,y1:a,x2:l,y2:d}];for(let E=0;E<this.boxKeys.length;E++)S.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const I=this.circles[3*E],L=this.circles[3*E+1],R=this.circles[3*E+2];S.push({key:this.circleKeys[E],x1:I-R,y1:L-R,x2:I+R,y2:L+R})}}else this._forEachCell(e,a,l,d,this._queryCell,S,{hitTest:g,overlapMode:_,seenUids:{box:{},circle:{}}},w);return S}query(e,a,l,d){return this._query(e,a,l,d,!1,null)}hitTest(e,a,l,d,g,_){return this._query(e,a,l,d,!0,g,_).length>0}hitTestCircle(e,a,l,d,g){const _=e-l,w=e+l,S=a-l,E=a+l;if(w<0||_>this.width||E<0||S>this.height)return!1;const I=[];return this._forEachCell(_,S,w,E,this._queryCellCircle,I,{hitTest:!0,overlapMode:d,circle:{x:e,y:a,radius:l},seenUids:{box:{},circle:{}}},g),I.length>0}_queryCell(e,a,l,d,g,_,w,S){const{seenUids:E,hitTest:I,overlapMode:L}=w,R=this.boxCells[g];if(R!==null){const Z=this.bboxes;for(const K of R)if(!E.box[K]){E.box[K]=!0;const Q=4*K,J=this.boxKeys[K];if(e<=Z[Q+2]&&a<=Z[Q+3]&&l>=Z[Q+0]&&d>=Z[Q+1]&&(!S||S(J))&&(!I||!ze(L,J.overlapMode))&&(_.push({key:J,x1:Z[Q],y1:Z[Q+1],x2:Z[Q+2],y2:Z[Q+3]}),I))return!0}}const $=this.circleCells[g];if($!==null){const Z=this.circles;for(const K of $)if(!E.circle[K]){E.circle[K]=!0;const Q=3*K,J=this.circleKeys[K];if(this._circleAndRectCollide(Z[Q],Z[Q+1],Z[Q+2],e,a,l,d)&&(!S||S(J))&&(!I||!ze(L,J.overlapMode))){const oe=Z[Q],he=Z[Q+1],se=Z[Q+2];if(_.push({key:J,x1:oe-se,y1:he-se,x2:oe+se,y2:he+se}),I)return!0}}}return!1}_queryCellCircle(e,a,l,d,g,_,w,S){const{circle:E,seenUids:I,overlapMode:L}=w,R=this.boxCells[g];if(R!==null){const Z=this.bboxes;for(const K of R)if(!I.box[K]){I.box[K]=!0;const Q=4*K,J=this.boxKeys[K];if(this._circleAndRectCollide(E.x,E.y,E.radius,Z[Q+0],Z[Q+1],Z[Q+2],Z[Q+3])&&(!S||S(J))&&!ze(L,J.overlapMode))return _.push(!0),!0}}const $=this.circleCells[g];if($!==null){const Z=this.circles;for(const K of $)if(!I.circle[K]){I.circle[K]=!0;const Q=3*K,J=this.circleKeys[K];if(this._circlesCollide(Z[Q],Z[Q+1],Z[Q+2],E.x,E.y,E.radius)&&(!S||S(J))&&!ze(L,J.overlapMode))return _.push(!0),!0}}}_forEachCell(e,a,l,d,g,_,w,S){const E=this._convertToXCellCoord(e),I=this._convertToYCellCoord(a),L=this._convertToXCellCoord(l),R=this._convertToYCellCoord(d);for(let $=E;$<=L;$++)for(let Z=I;Z<=R;Z++)if(g.call(this,e,a,l,d,this.xCellCount*Z+$,_,w,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,l,d,g,_){const w=d-e,S=g-a,E=l+_;return E*E>w*w+S*S}_circleAndRectCollide(e,a,l,d,g,_,w){const S=(_-d)/2,E=Math.abs(e-(d+S));if(E>S+l)return!1;const I=(w-g)/2,L=Math.abs(a-(g+I));if(L>I+l)return!1;if(E<=S||L<=I)return!0;const R=E-S,$=L-I;return R*R+$*$<=l*l}}function pe(p,e,a){const l=u.L();if(!p){const{vecSouth:L,vecEast:R}=ht(e),$=te();$[0]=R[0],$[1]=R[1],$[2]=L[0],$[3]=L[1],d=$,(I=(_=(g=$)[0])*(E=g[3])-(S=g[2])*(w=g[1]))&&(d[0]=E*(I=1/I),d[1]=-w*I,d[2]=-S*I,d[3]=_*I),l[0]=$[0],l[1]=$[1],l[4]=$[2],l[5]=$[3]}var d,g,_,w,S,E,I;return u.N(l,l,[1/a,1/a,1]),l}function Me(p,e,a,l){if(p){const d=u.L();if(!e){const{vecSouth:g,vecEast:_}=ht(a);d[0]=_[0],d[1]=_[1],d[4]=g[0],d[5]=g[1]}return u.N(d,d,[l,l,1]),d}return a.pixelsToClipSpaceMatrix}function ht(p){const e=Math.cos(p.rollInRadians),a=Math.sin(p.rollInRadians),l=Math.cos(p.pitchInRadians),d=Math.cos(p.bearingInRadians),g=Math.sin(p.bearingInRadians),_=u.ar();_[0]=-d*l*a-g*e,_[1]=-g*l*a+d*e;const w=u.as(_);w<1e-9?u.at(_):u.au(_,_,1/w);const S=u.ar();S[0]=d*l*e-g*a,S[1]=g*l*e+d*a;const E=u.as(S);return E<1e-9?u.at(S):u.au(S,S,1/E),{vecEast:S,vecSouth:_}}function ot(p,e,a,l){let d;l?(d=[p,e,l(p,e),1],u.aw(d,d,a)):(d=[p,e,0,1],xn(d,d,a));const g=d[3];return{point:new u.P(d[0]/g,d[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function ri(p,e){return .5+p/e*.5}function di(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function Ze(p,e,a,l,d,g,_,w,S,E,I,L,R){const $=a?p.textSizeData:p.iconSizeData,Z=u.an($,e.transform.zoom),K=[256/e.width*2+1,256/e.height*2+1],Q=a?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;Q.clear();const J=p.lineVertexArray,oe=a?p.text.placedSymbolArray:p.icon.placedSymbolArray,he=e.transform.width/e.transform.height;let se=!1;for(let de=0;de<oe.length;de++){const ge=oe.get(de);if(ge.hidden||ge.writingMode===u.ao.vertical&&!se){ts(ge.numGlyphs,Q);continue}se=!1;const ce=new u.P(ge.anchorX,ge.anchorY),Te={getElevation:R,pitchedLabelPlaneMatrix:l,lineVertexArray:J,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ce,unwrappedTileID:S,width:E,height:I,translation:L},Oe=Da(ge.anchorX,ge.anchorY,Te);if(!di(Oe.point,K)){ts(ge.numGlyphs,Q);continue}const Re=ri(e.transform.cameraToCenterDistance,Oe.signedDistanceFromCamera),Le=u.ap($,Z,ge),Be=g?Le*e.transform.getPitchedTextCorrection(ge.anchorX,ge.anchorY,S)/Re:Le*Re,nt=xt({projectionContext:Te,pitchedLabelPlaneMatrixInverse:d,symbol:ge,fontSize:Be,flip:!1,keepUpright:_,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:he,rotateToLine:w});se=nt.useVertical,(nt.notEnoughRoom||se||nt.needsFlipping&&xt({projectionContext:Te,pitchedLabelPlaneMatrixInverse:d,symbol:ge,fontSize:Be,flip:!0,keepUpright:_,glyphOffsetArray:p.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:he,rotateToLine:w}).notEnoughRoom)&&ts(ge.numGlyphs,Q)}a?p.text.dynamicLayoutVertexBuffer.updateData(Q):p.icon.dynamicLayoutVertexBuffer.updateData(Q)}function dt(p,e,a,l,d,g,_,w){const S=g.glyphStartIndex+g.numGlyphs,E=g.lineStartIndex,I=g.lineStartIndex+g.lineLength,L=e.getoffsetX(g.glyphStartIndex),R=e.getoffsetX(S-1),$=ma(p*L,a,l,d,g.segment,E,I,w,_);if(!$)return null;const Z=ma(p*R,a,l,d,g.segment,E,I,w,_);return Z?w.projectionCache.anyProjectionOccluded?null:{first:$,last:Z}:null}function Bt(p,e,a,l){return p===u.ao.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*l?{useVertical:!0}:(p===u.ao.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function xt(p){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:a,symbol:l,fontSize:d,flip:g,keepUpright:_,glyphOffsetArray:w,dynamicLayoutVertexArray:S,aspectRatio:E,rotateToLine:I}=p,L=d/24,R=l.lineOffsetX*L,$=l.lineOffsetY*L;let Z;if(l.numGlyphs>1){const K=l.glyphStartIndex+l.numGlyphs,Q=l.lineStartIndex,J=l.lineStartIndex+l.lineLength,oe=dt(L,w,R,$,g,l,I,e);if(!oe)return{notEnoughRoom:!0};const he=gs(oe.first.point.x,oe.first.point.y,e,a),se=gs(oe.last.point.x,oe.last.point.y,e,a);if(_&&!g){const de=Bt(l.writingMode,he,se,E);if(de)return de}Z=[oe.first];for(let de=l.glyphStartIndex+1;de<K-1;de++){const ge=ma(L*w.getoffsetX(de),R,$,g,l.segment,Q,J,e,I);if(!ge)return{notEnoughRoom:!0};Z.push(ge)}Z.push(oe.last)}else{if(_&&!g){const Q=Zt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,J=l.lineStartIndex+l.segment+1,oe=new u.P(e.lineVertexArray.getx(J),e.lineVertexArray.gety(J)),he=Zt(oe.x,oe.y,e),se=he.signedDistanceFromCamera>0?he.point:Si(e.tileAnchorPoint,oe,Q,1,e),de=gs(Q.x,Q.y,e,a),ge=gs(se.x,se.y,e,a),ce=Bt(l.writingMode,de,ge,E);if(ce)return ce}const K=ma(L*w.getoffsetX(l.glyphStartIndex),R,$,g,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,I);if(!K||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[K]}for(const K of Z)u.av(S,K.point,K.angle);return{}}function Si(p,e,a,l,d){const g=p.add(p.sub(e)._unit()),_=Zt(g.x,g.y,d).point,w=a.sub(_);return a.add(w._mult(l/w.mag()))}function Un(p,e,a){const l=e.projectionCache;if(l.projections[p])return l.projections[p];const d=new u.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),g=Zt(d.x,d.y,e);if(g.signedDistanceFromCamera>0)return l.projections[p]=g.point,l.anyProjectionOccluded=l.anyProjectionOccluded||g.isOccluded,g.point;const _=p-a.direction;return Si(a.distanceFromAnchor===0?e.tileAnchorPoint:new u.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),d,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function Zt(p,e,a){const l=p+a.translation[0],d=e+a.translation[1];let g;return a.pitchWithMap?(g=ot(l,d,a.pitchedLabelPlaneMatrix,a.getElevation),g.isOccluded=!1):(g=a.transform.projectTileCoordinates(l,d,a.unwrappedTileID,a.getElevation),g.point.x=(.5*g.point.x+.5)*a.width,g.point.y=(.5*-g.point.y+.5)*a.height),g}function gs(p,e,a,l){if(a.pitchWithMap){const d=[p,e,0,1];return u.aw(d,d,l),a.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],a.unwrappedTileID,a.getElevation).point}return{x:p/a.width*2-1,y:1-e/a.height*2}}function Da(p,e,a){return a.transform.projectTileCoordinates(p,e,a.unwrappedTileID,a.getElevation)}function Ra(p,e,a){return p._unit()._perp()._mult(e*a)}function ys(p,e,a,l,d,g,_,w,S){if(w.projectionCache.offsets[p])return w.projectionCache.offsets[p];const E=a.add(e);if(p+S.direction<l||p+S.direction>=d)return w.projectionCache.offsets[p]=E,E;const I=Un(p+S.direction,w,S),L=Ra(I.sub(a),_,S.direction),R=a.add(L),$=I.add(L);return w.projectionCache.offsets[p]=u.ax(g,E,R,$)||E,w.projectionCache.offsets[p]}function ma(p,e,a,l,d,g,_,w,S){const E=l?p-e:p+e;let I=E>0?1:-1,L=0;l&&(I*=-1,L=Math.PI),I<0&&(L+=Math.PI);let R,$=I>0?g+d:g+d+1;w.projectionCache.cachedAnchorPoint?R=w.projectionCache.cachedAnchorPoint:(R=Zt(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=R);let Z,K,Q=R,J=R,oe=0,he=0;const se=Math.abs(E),de=[];let ge;for(;oe+he<=se;){if($+=I,$<g||$>=_)return null;oe+=he,J=Q,K=Z;const Oe={absOffsetX:se,direction:I,distanceFromAnchor:oe,previousVertex:J};if(Q=Un($,w,Oe),a===0)de.push(J),ge=Q.sub(J);else{let Re;const Le=Q.sub(J);Re=Le.mag()===0?Ra(Un($+I,w,Oe).sub(Q),a,I):Ra(Le,a,I),K||(K=J.add(Re)),Z=ys($,Re,Q,g,_,K,a,w,Oe),de.push(K),ge=Z.sub(K)}he=ge.mag()}const ce=ge._mult((se-oe)/he)._add(K||J),Te=L+Math.atan2(Q.y-J.y,Q.x-J.x);return de.push(ce),{point:ce,angle:S?Te:0,path:de}}const Er=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ts(p,e){for(let a=0;a<p;a++){const l=e.length;e.resize(l+4),e.float32.set(Er,3*l)}}function xn(p,e,a){const l=e[0],d=e[1];return p[0]=a[0]*l+a[4]*d+a[12],p[1]=a[1]*l+a[5]*d+a[13],p[3]=a[3]*l+a[7]*d+a[15],p}const ni=100;class sl{constructor(e,a=new Ke(e.width+200,e.height+200,25),l=new Ke(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ni,this.screenBottomBoundary=e.height+ni,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,l,d,g,_,w,S,E,I,L,R){const $=this.projectAndGetPerspectiveRatio(e.anchorPointX+S[0],e.anchorPointY+S[1],g,I,R),Z=l*$.perspectiveRatio;let K;if(_||w)K=this._projectCollisionBox(e,Z,d,g,_,w,S,$,I,L,R);else{const ge=$.x+(L?L.x*Z:0),ce=$.y+(L?L.y*Z:0);K={allPointsOccluded:!1,box:[ge+e.x1*Z,ce+e.y1*Z,ge+e.x2*Z,ce+e.y2*Z]}}const[Q,J,oe,he]=K.box,se=_?K.allPointsOccluded:$.isOccluded;let de=se;return de||(de=$.perspectiveRatio<this.perspectiveRatioCutoff),de||(de=!this.isInsideGrid(Q,J,oe,he)),de||a!=="always"&&this.grid.hitTest(Q,J,oe,he,a,E)?{box:[Q,J,oe,he],placeable:!1,offscreen:!1,occluded:se}:{box:[Q,J,oe,he],placeable:!0,offscreen:this.isOffscreen(Q,J,oe,he),occluded:se}}placeCollisionCircles(e,a,l,d,g,_,w,S,E,I,L,R,$,Z){const K=[],Q=new u.P(a.anchorX,a.anchorY),J=this.getPerspectiveRatio(Q.x,Q.y,_,Z),oe=(E?g*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,_)/J:g*J)/u.aB,he={getElevation:Z,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Q,unwrappedTileID:_,width:this.transform.width,height:this.transform.height,translation:$},se=dt(oe,d,a.lineOffsetX*oe,a.lineOffsetY*oe,!1,a,!1,he);let de=!1,ge=!1,ce=!0;if(se){const Te=.5*L*J+R,Oe=new u.P(-100,-100),Re=new u.P(this.screenRightBoundary,this.screenBottomBoundary),Le=new gi,Be=se.first,nt=se.last;let at=[];for(let Wt=Be.path.length-1;Wt>=1;Wt--)at.push(Be.path[Wt]);for(let Wt=1;Wt<nt.path.length;Wt++)at.push(nt.path[Wt]);const et=2.5*Te;if(E){const Wt=this.projectPathToScreenSpace(at,he);at=Wt.some((Ai=>Ai.signedDistanceFromCamera<=0))?[]:Wt.map((Ai=>Ai.point))}let bt=[];if(at.length>0){const Wt=at[0].clone(),Ai=at[0].clone();for(let Qi=1;Qi<at.length;Qi++)Wt.x=Math.min(Wt.x,at[Qi].x),Wt.y=Math.min(Wt.y,at[Qi].y),Ai.x=Math.max(Ai.x,at[Qi].x),Ai.y=Math.max(Ai.y,at[Qi].y);bt=Wt.x>=Oe.x&&Ai.x<=Re.x&&Wt.y>=Oe.y&&Ai.y<=Re.y?[at]:Ai.x<Oe.x||Wt.x>Re.x||Ai.y<Oe.y||Wt.y>Re.y?[]:u.ay([at],Oe.x,Oe.y,Re.x,Re.y)}for(const Wt of bt){Le.reset(Wt,.25*Te);let Ai=0;Ai=Le.length<=.5*Te?1:Math.ceil(Le.paddedLength/et)+1;for(let Qi=0;Qi<Ai;Qi++){const tr=Qi/Math.max(Ai-1,1),ci=Le.lerp(tr),ir=ci.x+ni,Ur=ci.y+ni;K.push(ir,Ur,Te,0);const _r=ir-Te,Kr=Ur-Te,kr=ir+Te,zr=Ur+Te;if(ce=ce&&this.isOffscreen(_r,Kr,kr,zr),ge=ge||this.isInsideGrid(_r,Kr,kr,zr),e!=="always"&&this.grid.hitTestCircle(ir,Ur,Te,e,I)&&(de=!0,!S))return{circles:[],offscreen:!1,collisionDetected:de}}}}return{circles:!S&&de||!ge||J<this.perspectiveRatioCutoff?[]:K,offscreen:ce,collisionDetected:de}}projectPathToScreenSpace(e,a){const l=(function(d,g){const _=u.L();return u.aq(_,g.pitchedLabelPlaneMatrix),d.map((w=>{const S=ot(w.x,w.y,_,g.getElevation),E=g.transform.projectTileCoordinates(S.point.x,S.point.y,g.unwrappedTileID,g.getElevation);return E.point.x=(.5*E.point.x+.5)*g.width,E.point.y=(.5*-E.point.y+.5)*g.height,E}))})(e,a);return(function(d){let g=0,_=0,w=0,S=0;for(let E=0;E<d.length;E++)d[E].isOccluded?(w=E+1,S=0):(S++,S>_&&(_=S,g=w));return d.slice(g,g+_)})(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],l=new u.a2;for(const L of e){const R=new u.P(L.x+ni,L.y+ni);l.extend(R),a.push(R)}const{minX:d,minY:g,maxX:_,maxY:w}=l,S=this.grid.query(d,g,_,w).concat(this.ignoredGrid.query(d,g,_,w)),E={},I={};for(const L of S){const R=L.key;if(E[R.bucketInstanceId]===void 0&&(E[R.bucketInstanceId]={}),E[R.bucketInstanceId][R.featureIndex])continue;const $=[new u.P(L.x1,L.y1),new u.P(L.x2,L.y1),new u.P(L.x2,L.y2),new u.P(L.x1,L.y2)];u.az(a,$)&&(E[R.bucketInstanceId][R.featureIndex]=!0,I[R.bucketInstanceId]===void 0&&(I[R.bucketInstanceId]=[]),I[R.bucketInstanceId].push(R.featureIndex))}return I}insertCollisionBox(e,a,l,d,g,_){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:_,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,l,d,g,_){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:g,collisionGroupID:_,overlapMode:a};for(let E=0;E<e.length;E+=4)w.insertCircle(S,e[E],e[E+1],e[E+2])}projectAndGetPerspectiveRatio(e,a,l,d,g){if(g){let _;d?(_=[e,a,d(e,a),1],u.aw(_,_,g)):(_=[e,a,0,1],xn(_,_,g));const w=_[3];return{x:(_[0]/w+1)/2*this.transform.width+ni,y:(-_[1]/w+1)/2*this.transform.height+ni,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const _=this.transform.projectTileCoordinates(e,a,l,d);return{x:(_.point.x+1)/2*this.transform.width+ni,y:(1-_.point.y)/2*this.transform.height+ni,perspectiveRatio:.5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5,isOccluded:_.isOccluded,signedDistanceFromCamera:_.signedDistanceFromCamera}}}getPerspectiveRatio(e,a,l,d){const g=this.transform.projectTileCoordinates(e,a,l,d);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,a,l,d){return l<ni||e>=this.screenRightBoundary||d<ni||a>this.screenBottomBoundary}isInsideGrid(e,a,l,d){return l>=0&&e<this.gridRightBoundary&&d>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=u.ai([]);return u.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,l,d,g,_,w,S,E,I,L){let R=1,$=0,Z=0,K=1;const Q=e.anchorPointX+w[0],J=e.anchorPointY+w[1];if(_&&!g){const at=this.projectAndGetPerspectiveRatio(Q+1,J,d,E,L),et=at.x-S.x,bt=Math.atan((at.y-S.y)/et)+(et<0?Math.PI:0),Wt=Math.sin(bt),Ai=Math.cos(bt);R=Ai,$=Wt,Z=-Wt,K=Ai}else if(!_&&g){const at=ht(this.transform);R=at.vecEast[0],$=at.vecEast[1],Z=at.vecSouth[0],K=at.vecSouth[1]}let oe=S.x,he=S.y,se=a;g&&(oe=Q,he=J,se=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),se*=this.transform.getPitchedTextCorrection(Q,J,d),I||(se*=u.ae(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),I&&(oe+=R*I.x*se+Z*I.y*se,he+=$*I.x*se+K*I.y*se);const de=e.x1*se,ge=e.x2*se,ce=(de+ge)/2,Te=e.y1*se,Oe=e.y2*se,Re=(Te+Oe)/2,Le=[{offsetX:de,offsetY:Te},{offsetX:ce,offsetY:Te},{offsetX:ge,offsetY:Te},{offsetX:ge,offsetY:Re},{offsetX:ge,offsetY:Oe},{offsetX:ce,offsetY:Oe},{offsetX:de,offsetY:Oe},{offsetX:de,offsetY:Re}];let Be=[];for(const{offsetX:at,offsetY:et}of Le)Be.push(new u.P(oe+R*at+Z*et,he+$*at+K*et));let nt=!1;if(g){const at=Be.map((et=>this.projectAndGetPerspectiveRatio(et.x,et.y,d,E,L)));nt=at.some((et=>!et.isOccluded)),Be=at.map((et=>new u.P(et.x,et.y)))}else nt=!0;return{box:u.aA(Be),allPointsOccluded:!nt}}}class ol{constructor(e,a,l,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):d&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class $s{constructor(e,a,l,d,g){this.text=new ol(e?e.text:null,a,l,g),this.icon=new ol(e?e.icon:null,a,d,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _s{constructor(e,a,l){this.text=e,this.icon=a,this.skipFade=l}}class Vs{constructor(e,a,l,d,g){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=l,this.bucketIndex=d,this.tileID=g}}class Gl{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:l=>l.collisionGroupID===a}}return this.collisionGroups[e]}}function ll(p,e,a,l,d){const{horizontalAlign:g,verticalAlign:_}=u.aH(p);return new u.P(-(g-.5)*e+l[0]*d,-(_-.5)*a+l[1]*d)}class is{constructor(e,a,l,d,g){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new sl(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Gl(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const a=this.terrain;return a?(l,d)=>a.getElevation(e,l,d):null}getBucketParts(e,a,l,d){const g=l.getBucket(a),_=l.latestFeatureIndex;if(!g||!_||a.id!==g.layerIds[0])return;const w=l.collisionBoxArray,S=g.layers[0].layout,E=g.layers[0].paint,I=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),L=l.tileSize/u.$,R=l.tileID.toUnwrapped(),$=S.get("text-rotation-alignment")==="map",Z=u.aC(l,1,this.transform.zoom),K=u.aD(this.collisionIndex.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),Q=u.aD(this.collisionIndex.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),J=pe($,this.transform,Z);this.retainedQueryData[g.bucketInstanceId]=new Vs(g.bucketInstanceId,_,g.sourceLayerIndex,g.index,l.tileID);const oe={bucket:g,layout:S,translationText:K,translationIcon:Q,unwrappedTileID:R,pitchedLabelPlaneMatrix:J,scale:I,textPixelRatio:L,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:u.an(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(d)for(const he of g.sortKeyRanges){const{sortKey:se,symbolInstanceStart:de,symbolInstanceEnd:ge}=he;e.push({sortKey:se,symbolInstanceStart:de,symbolInstanceEnd:ge,parameters:oe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(e,a,l,d,g,_,w,S,E,I,L,R,$,Z,K,Q,J,oe,he,se){const de=u.aE[e.textAnchor],ge=[e.textOffset0,e.textOffset1],ce=ll(de,l,d,ge,g),Te=this.collisionIndex.placeCollisionBox(a,R,S,E,I,w,_,Q,L.predicate,he,ce,se);if((!oe||this.collisionIndex.placeCollisionBox(oe,R,S,E,I,w,_,J,L.predicate,he,ce,se).placeable)&&Te.placeable){let Oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Oe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:ge,width:l,height:d,anchor:de,textBoxScale:g,prevAnchor:Oe},this.markUsedJustification(Z,de,$,K),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,K,$),this.placedOrientations[$.crossTileID]=K),{shift:ce,placedGlyphBoxes:Te}}}placeLayerBucketPart(e,a,l){const{bucket:d,layout:g,translationText:_,translationIcon:w,unwrappedTileID:S,pitchedLabelPlaneMatrix:E,textPixelRatio:I,holdingForFade:L,collisionBoxArray:R,partiallyEvaluatedTextSize:$,collisionGroup:Z}=e.parameters,K=g.get("text-optional"),Q=g.get("icon-optional"),J=u.aF(g,"text-overlap","text-allow-overlap"),oe=J==="always",he=u.aF(g,"icon-overlap","icon-allow-overlap"),se=he==="always",de=g.get("text-rotation-alignment")==="map",ge=g.get("text-pitch-alignment")==="map",ce=g.get("icon-text-fit")!=="none",Te=g.get("symbol-z-order")==="viewport-y",Oe=oe&&(se||!d.hasIconData()||Q),Re=se&&(oe||!d.hasTextData()||K);!d.collisionArrays&&R&&d.deserializeCollisionBoxes(R);const Le=this.retainedQueryData[d.bucketInstanceId].tileID,Be=this._getTerrainElevationFunc(Le),nt=this.transform.getFastPathSimpleProjectionMatrix(Le),at=(et,bt,Wt)=>{var Ai,Qi;if(a[et.crossTileID])return;if(L)return void(this.placements[et.crossTileID]=new _s(!1,!1,!1));let tr=!1,ci=!1,ir=!0,Ur=null,_r={box:null,placeable:!1,offscreen:null,occluded:!1},Kr={placeable:!1},kr=null,zr=null,$r=null,zs=0,Is=0,Ps=0;bt.textFeatureIndex?zs=bt.textFeatureIndex:et.useRuntimeCollisionCircles&&(zs=et.featureIndex),bt.verticalTextFeatureIndex&&(Is=bt.verticalTextFeatureIndex);const Ds=bt.textBox;if(Ds){const Sn=jr=>{let ln=u.ao.horizontal;if(d.allowVerticalPlacement&&!jr&&this.prevPlacement){const qn=this.prevPlacement.placedOrientations[et.crossTileID];qn&&(this.placedOrientations[et.crossTileID]=qn,ln=qn,this.markUsedOrientation(d,ln,et))}return ln},fn=(jr,ln)=>{if(d.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&bt.verticalTextBox){for(const qn of d.writingModes)if(qn===u.ao.vertical?(_r=ln(),Kr=_r):_r=jr(),_r&&_r.placeable)break}else _r=jr()},Ta=et.textAnchorOffsetStartIndex,Wo=et.textAnchorOffsetEndIndex;if(Wo===Ta){const jr=(ln,qn)=>{const Cr=this.collisionIndex.placeCollisionBox(ln,J,I,Le,S,ge,de,_,Z.predicate,Be,void 0,nt);return Cr&&Cr.placeable&&(this.markUsedOrientation(d,qn,et),this.placedOrientations[et.crossTileID]=qn),Cr};fn((()=>jr(Ds,u.ao.horizontal)),(()=>{const ln=bt.verticalTextBox;return d.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&ln?jr(ln,u.ao.vertical):{box:null,offscreen:null}})),Sn(_r&&_r.placeable)}else{let jr=u.aE[(Qi=(Ai=this.prevPlacement)===null||Ai===void 0?void 0:Ai.variableOffsets[et.crossTileID])===null||Qi===void 0?void 0:Qi.anchor];const ln=(Cr,Wa,Ya)=>{const Hn=Cr.x2-Cr.x1,Rs=Cr.y2-Cr.y1,ih=et.textBoxScale,zl=ce&&he==="never"?Wa:null;let Ls=null,ps=J==="never"?1:2,rh="never";jr&&ps++;for(let _c=0;_c<ps;_c++){for(let Yo=Ta;Yo<Wo;Yo++){const fu=d.textAnchorOffsets.get(Yo);if(jr&&fu.textAnchor!==jr)continue;const fs=this.attemptAnchorPlacement(fu,Cr,Hn,Rs,ih,de,ge,I,Le,S,Z,rh,et,d,Ya,_,w,zl,Be);if(fs&&(Ls=fs.placedGlyphBoxes,Ls&&Ls.placeable))return tr=!0,Ur=fs.shift,Ls}jr?jr=null:rh=J}return l&&!Ls&&(Ls={box:this.collisionIndex.placeCollisionBox(Ds,"always",I,Le,S,ge,de,_,Z.predicate,Be,void 0,nt).box,offscreen:!1,placeable:!1,occluded:!1}),Ls};fn((()=>ln(Ds,bt.iconBox,u.ao.horizontal)),(()=>{const Cr=bt.verticalTextBox;return d.allowVerticalPlacement&&(!_r||!_r.placeable)&&et.numVerticalGlyphVertices>0&&Cr?ln(Cr,bt.verticalIconBox,u.ao.vertical):{box:null,occluded:!0,offscreen:null}})),_r&&(tr=_r.placeable,ir=_r.offscreen);const qn=Sn(_r&&_r.placeable);if(!tr&&this.prevPlacement){const Cr=this.prevPlacement.variableOffsets[et.crossTileID];Cr&&(this.variableOffsets[et.crossTileID]=Cr,this.markUsedJustification(d,Cr.anchor,et,qn))}}}if(kr=_r,tr=kr&&kr.placeable,ir=kr&&kr.offscreen,et.useRuntimeCollisionCircles&&et.centerJustifiedTextSymbolIndex>=0){const Sn=d.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex),fn=u.ap(d.textSizeData,$,Sn),Ta=g.get("text-padding");zr=this.collisionIndex.placeCollisionCircles(J,Sn,d.lineVertexArray,d.glyphOffsetArray,fn,S,E,l,ge,Z.predicate,et.collisionCircleDiameter,Ta,_,Be),zr.circles.length&&zr.collisionDetected&&!l&&u.w("Collisions detected, but collision boxes are not shown"),tr=oe||zr.circles.length>0&&!zr.collisionDetected,ir=ir&&zr.offscreen}if(bt.iconFeatureIndex&&(Ps=bt.iconFeatureIndex),bt.iconBox){const Sn=fn=>this.collisionIndex.placeCollisionBox(fn,he,I,Le,S,ge,de,w,Z.predicate,Be,ce&&Ur?Ur:void 0,nt);Kr&&Kr.placeable&&bt.verticalIconBox?($r=Sn(bt.verticalIconBox),ci=$r.placeable):($r=Sn(bt.iconBox),ci=$r.placeable),ir=ir&&$r.offscreen}const po=K||et.numHorizontalGlyphVertices===0&&et.numVerticalGlyphVertices===0,yc=Q||et.numIconVertices===0;po||yc?yc?po||(ci=ci&&tr):tr=ci&&tr:ci=tr=ci&&tr;const ds=ci&&$r.placeable;if(tr&&kr.placeable&&this.collisionIndex.insertCollisionBox(kr.box,J,g.get("text-ignore-placement"),d.bucketInstanceId,Kr&&Kr.placeable&&Is?Is:zs,Z.ID),ds&&this.collisionIndex.insertCollisionBox($r.box,he,g.get("icon-ignore-placement"),d.bucketInstanceId,Ps,Z.ID),zr&&tr&&this.collisionIndex.insertCollisionCircles(zr.circles,J,g.get("text-ignore-placement"),d.bucketInstanceId,zs,Z.ID),l&&this.storeCollisionData(d.bucketInstanceId,Wt,bt,kr,$r,zr),et.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[et.crossTileID]=new _s((tr||Oe)&&!kr?.occluded,(ci||Re)&&!$r?.occluded,ir||d.justReloaded),a[et.crossTileID]=!0};if(Te){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const et=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let bt=et.length-1;bt>=0;--bt){const Wt=et[bt];at(d.symbolInstances.get(Wt),d.collisionArrays[Wt],Wt)}}else for(let et=e.symbolInstanceStart;et<e.symbolInstanceEnd;et++)at(d.symbolInstances.get(et),d.collisionArrays[et],et);d.justReloaded=!1}storeCollisionData(e,a,l,d,g,_){if(l.textBox||l.iconBox){let w,S;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(a)?S=w.get(a):(S={text:null,icon:null},w.set(a,S)),l.textBox&&(S.text=d.box),l.iconBox&&(S.icon=g.box)}if(_){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let S=0;S<_.circles.length;S+=4)w.push(_.circles[S+0]-ni),w.push(_.circles[S+1]-ni),w.push(_.circles[S+2]),w.push(_.collisionDetected?1:0)}}markUsedJustification(e,a,l,d){let g;g=d===u.ao.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[u.aG(a)];const _=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of _)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:l.crossTileID)}markUsedOrientation(e,a,l){const d=a===u.ao.horizontal||a===u.ao.horizontalOnly?a:0,g=a===u.ao.vertical?a:0,_=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of _)e.text.placedSymbolArray.get(w).placedOrientation=d;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let l=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const d=a?a.symbolFadeChange(e):1,g=a?a.opacities:{},_=a?a.variableOffsets:{},w=a?a.placedOrientations:{};for(const S in this.placements){const E=this.placements[S],I=g[S];I?(this.opacities[S]=new $s(I,d,E.text,E.icon),l=l||E.text!==I.text.placed||E.icon!==I.icon.placed):(this.opacities[S]=new $s(null,d,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const S in g){const E=g[S];if(!this.opacities[S]){const I=new $s(E,d,!1,!1);I.isHidden()||(this.opacities[S]=I,l=l||E.text.placed||E.icon.placed)}}for(const S in _)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=_[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const l={};for(const d of a){const g=d.getBucket(e);g&&d.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,d.tileID,l,d.collisionBoxArray)}}updateBucketOpacities(e,a,l,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const g=e.layers[0],_=g.layout,w=new $s(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),E=_.get("icon-allow-overlap"),I=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=_.get("text-rotation-alignment")==="map",R=_.get("text-pitch-alignment")==="map",$=_.get("icon-text-fit")!=="none",Z=new $s(null,0,S&&(E||!e.hasIconData()||_.get("icon-optional")),E&&(S||!e.hasTextData()||_.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const K=(J,oe,he)=>{for(let se=0;se<oe/4;se++)J.opacityVertexArray.emplaceBack(he);J.hasVisibleVertices=J.hasVisibleVertices||he!==To},Q=this.collisionBoxArrays.get(e.bucketInstanceId);for(let J=0;J<e.symbolInstances.length;J++){const oe=e.symbolInstances.get(J),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:se,crossTileID:de}=oe;let ge=this.opacities[de];l[de]?ge=w:ge||(ge=Z,this.opacities[de]=ge),l[de]=!0;const ce=oe.numIconVertices>0,Te=this.placedOrientations[oe.crossTileID],Oe=Te===u.ao.vertical,Re=Te===u.ao.horizontal||Te===u.ao.horizontalOnly;if(he>0||se>0){const Be=cl(ge.text);K(e.text,he,Oe?To:Be),K(e.text,se,Re?To:Be);const nt=ge.text.isHidden();[oe.rightJustifiedTextSymbolIndex,oe.centerJustifiedTextSymbolIndex,oe.leftJustifiedTextSymbolIndex].forEach((bt=>{bt>=0&&(e.text.placedSymbolArray.get(bt).hidden=nt||Oe?1:0)})),oe.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(oe.verticalPlacedTextSymbolIndex).hidden=nt||Re?1:0);const at=this.variableOffsets[oe.crossTileID];at&&this.markUsedJustification(e,at.anchor,oe,Te);const et=this.placedOrientations[oe.crossTileID];et&&(this.markUsedJustification(e,"left",oe,et),this.markUsedOrientation(e,et,oe))}if(ce){const Be=cl(ge.icon),nt=!($&&oe.verticalPlacedIconSymbolIndex&&Oe);oe.placedIconSymbolIndex>=0&&(K(e.icon,oe.numIconVertices,nt?Be:To),e.icon.placedSymbolArray.get(oe.placedIconSymbolIndex).hidden=ge.icon.isHidden()),oe.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,oe.numVerticalIconVertices,nt?To:Be),e.icon.placedSymbolArray.get(oe.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}const Le=Q&&Q.has(J)?Q.get(J):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Be=e.collisionArrays[J];if(Be){let nt=new u.P(0,0);if(Be.textBox||Be.verticalTextBox){let at=!0;if(I){const et=this.variableOffsets[de];et?(nt=ll(et.anchor,et.width,et.height,et.textOffset,et.textBoxScale),L&&nt._rotate(R?-this.transform.bearingInRadians:this.transform.bearingInRadians)):at=!1}if(Be.textBox||Be.verticalTextBox){let et;Be.textBox&&(et=Oe),Be.verticalTextBox&&(et=Re),nn(e.textCollisionBox.collisionVertexArray,ge.text.placed,!at||et,Le.text,nt.x,nt.y)}}if(Be.iconBox||Be.verticalIconBox){const at=!!(!Re&&Be.verticalIconBox);let et;Be.iconBox&&(et=at),Be.verticalIconBox&&(et=!at),nn(e.iconCollisionBox.collisionVertexArray,ge.icon.placed,et,Le.icon,$?nt.x:0,$?nt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const l=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function nn(p,e,a,l,d,g){l&&l.length!==0||(l=[0,0,0,0]);const _=l[0]-ni,w=l[1]-ni,S=l[2]-ni,E=l[3]-ni;p.emplaceBack(e?1:0,a?1:0,d||0,g||0,_,w),p.emplaceBack(e?1:0,a?1:0,d||0,g||0,S,w),p.emplaceBack(e?1:0,a?1:0,d||0,g||0,S,E),p.emplaceBack(e?1:0,a?1:0,d||0,g||0,_,E)}const Du=Math.pow(2,25),Od=Math.pow(2,24),Ru=Math.pow(2,17),Rh=Math.pow(2,16),Zl=Math.pow(2,9),Lh=Math.pow(2,8),$n=Math.pow(2,1);function cl(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,a=Math.floor(127*p.opacity);return a*Du+e*Od+a*Ru+e*Rh+a*Zl+e*Lh+a*$n+e}const To=0;class ql{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,l,d,g){const _=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(_,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort(((w,S)=>w.sortKey-S.sortKey)));this._currentPartIndex<_.length;)if(a.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,g())return!0;return!1}}class Gs{constructor(e,a,l,d,g,_,w,S){this.placement=new is(e,a,_,w,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,a,l){const d=Qe(),g=()=>!this._forceFullPlacement&&Qe()-d>2;for(;this._currentPlacementIndex>=0;){const _=a[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=w)&&(!_.maxzoom||_.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new ql(_)),this._inProgressLayer.continuePlacement(l[_.source],this.placement,this._showCollisionBoxes,_,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ul=512/u.$/2;class hl{constructor(e,a,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const d=new Map;for(let g=0;g<a.length;g++){const _=a.get(g),w=_.key,S=d.get(w);S?S.push(_):d.set(w,[_])}for(const[g,_]of d){const w={positions:_.map((S=>({x:Math.floor(S.anchorX*ul),y:Math.floor(S.anchorY*ul)}))),crossTileIDs:_.map((S=>S.crossTileID))};if(w.positions.length>128){const S=new u.aI(w.positions.length,16,Uint16Array);for(const{x:E,y:I}of w.positions)S.add(E,I);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[g]=w}}getScaledCoordinates(e,a){const{x:l,y:d,z:g}=this.tileID.canonical,{x:_,y:w,z:S}=a.canonical,E=ul/Math.pow(2,S-g),I=(w*u.$+e.anchorY)*E,L=d*u.$*ul;return{x:Math.floor((_*u.$+e.anchorX)*E-l*u.$*ul),y:Math.floor(I-L)}}findMatches(e,a,l){const d=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<e.length;g++){const _=e.get(g);if(_.crossTileID)continue;const w=this._symbolsByKey[_.key];if(!w)continue;const S=this.getScaledCoordinates(_,a);if(w.index){const E=w.index.range(S.x-d,S.y-d,S.x+d,S.y+d).sort();for(const I of E){const L=w.crossTileIDs[I];if(!l[L]){l[L]=!0,_.crossTileID=L;break}}}else if(w.positions)for(let E=0;E<w.positions.length;E++){const I=w.positions[E],L=w.crossTileIDs[E];if(Math.abs(I.x-S.x)<=d&&Math.abs(I.y-S.y)<=d&&!l[L]){l[L]=!0,_.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class xs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class jh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const l in this.indexes){const d=this.indexes[l],g={};for(const _ in d){const w=d[_];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),g[w.tileID.key]=w}this.indexes[l]=g}this.lng=e}addBucket(e,a,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const g in this.indexes){const _=this.indexes[g];if(Number(g)>e.overscaledZ)for(const w in _){const S=_[w];S.tileID.isChildOf(e)&&S.findMatches(a.symbolInstances,e,d)}else{const w=_[e.scaledTo(Number(g)).key];w&&w.findMatches(a.symbolInstances,e,d)}}for(let g=0;g<a.symbolInstances.length;g++){const _=a.symbolInstances.get(g);_.crossTileID||(_.crossTileID=l.generate(),d[_.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new hl(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const l of a.getCrossTileIDsLists())for(const d of l)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let a=!1;for(const l in this.indexes){const d=this.indexes[l];for(const g in d)e[d[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,d[g]),delete d[g],a=!0)}return a}}class Zs{constructor(){this.layerIndexes={},this.crossTileIDs=new xs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,l){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new jh);let g=!1;const _={};d.handleWrapJump(l);for(const w of a){const S=w.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(w.tileID,S,this.crossTileIDs)&&(g=!0),_[S.bucketInstanceId]=!0)}return d.removeStaleBuckets(_)&&(g=!0),g}pruneUnusedLayers(e){const a={};e.forEach((l=>{a[l]=!0}));for(const l in this.layerIndexes)a[l]||delete this.layerIndexes[l]}}var Bc="void main() {fragColor=vec4(1.0);}";const ga={prelude:ui(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ui("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ui("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ui(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ui(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ui(Bc,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ui(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ui("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ui("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ui(Bc,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ui(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ui(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ui(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ui(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ui(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ui(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ui(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ui(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ui("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ui("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ui("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ui("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ui(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ui("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ui(p,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),d=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=g?g.concat(d):d,w={};return{fragmentSource:p=p.replace(a,((S,E,I,L,R)=>(w[R]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
in ${I} ${L} ${R};
#else
uniform ${I} ${L} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${I} ${L} ${R} = u_${R};
#endif
`))),vertexSource:e=e.replace(a,((S,E,I,L,R)=>{const $=L==="float"?"vec2":"vec4",Z=R.match(/color/)?"color":$;return w[R]?E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${I} ${$} a_${R};
out ${I} ${L} ${R};
#else
uniform ${I} ${L} u_${R};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${I} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${Z}(a_${R}, u_${R}_t);
#else
    ${I} ${L} ${R} = u_${R};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${I} ${$} a_${R};
#else
uniform ${I} ${L} u_${R};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${I} ${L} ${R} = a_${R};
#else
    ${I} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${I} ${L} ${R} = unpack_mix_${Z}(a_${R}, u_${R}_t);
#else
    ${I} ${L} ${R} = u_${R};
#endif
`})),staticAttributes:l,staticUniforms:_}}class La{constructor(e,a,l){this.vertexBuffer=e,this.indexBuffer=a,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ti=u.aJ([{name:"a_pos",type:"Int16",components:2}]);const ya="#define PROJECTION_MERCATOR",Nc="mercator";class Mo{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Nc}get shaderDefine(){return ya}get shaderPreludeCode(){return ga.projectionMercator}get vertexShaderPreludeCode(){return ga.projectionMercator.vertexSource}get subdivisionGranularity(){return u.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,a,l,d,g){if(this._cachedMesh)return this._cachedMesh;const _=new u.aL;_.emplaceBack(0,0),_.emplaceBack(u.$,0),_.emplaceBack(0,u.$),_.emplaceBack(u.$,u.$);const w=e.createVertexBuffer(_,ti.members),S=u.aM.simpleSegment(0,0,4,2),E=new u.aN;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3);const I=e.createIndexBuffer(E);return this._cachedMesh=new La(w,I,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ar{constructor(e=0,a=0,l=0,d=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(l)||l<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=l,this.right=d}interpolate(e,a,l){return a.top!=null&&e.top!=null&&(this.top=u.C.number(e.top,a.top,l)),a.bottom!=null&&e.bottom!=null&&(this.bottom=u.C.number(e.bottom,a.bottom,l)),a.left!=null&&e.left!=null&&(this.left=u.C.number(e.left,a.left,l)),a.right!=null&&e.right!=null&&(this.right=u.C.number(e.right,a.right,l)),this}getCenter(e,a){const l=u.ae((this.left+e-this.right)/2,0,e),d=u.ae((this.top+a-this.bottom)/2,0,a);return new u.P(l,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ar(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Mr(p,e){if(!p.renderWorldCopies||p.lngRange)return;const a=e.lng-p.center.lng;e.lng+=a>180?-360:a<-180?360:0}function hn(p){return Math.max(0,Math.floor(p))}class Rr{constructor(e,a){var l;this._callbacks=e,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrain=(l=a?.constrain)!==null&&l!==void 0?l:this._callbacks.constrain,this.setMaxBounds(),this._width=0,this._height=0,this._center=new u.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=hn(this._zoom),this._scale=u.ah(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ar,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,a,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=hn(this._zoom),this._scale=u.ah(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ar(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrain(){return this._constrain}setConstrain(e){e||(e=this._callbacks.constrain),this._constrain=e,this.constrainInternal(),this._calcMatrices()}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const a=u.aO(e,-180,180)*Math.PI/180;var l,d,g,_,w,S,E,I,L;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=te(),l=this._rotationMatrix,g=-this._bearingInRadians,_=(d=this._rotationMatrix)[0],w=d[1],S=d[2],E=d[3],I=Math.sin(g),L=Math.cos(g),l[0]=_*L+S*I,l[1]=w*L+E*I,l[2]=_*-I+S*L,l[3]=w*-I+E*L)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const a=u.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const a=e/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return u.aP(this._fovInRadians)}setFov(e){e=u.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=u.ag(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const a=this.constrain(this._center,e).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=u.ah(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,a){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,l){this._unmodified=!1,this._edgeInsets.interpolate(e,a,l),this.constrainInternal(),this._calcMatrices()}resize(e,a,l=!0){this._width=e,this._height=a,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Bi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-u.af,u.af])}getCameraQueryGeometry(e,a){if(a.length===1)return[a[0],e];{const{minX:l,minY:d,maxX:g,maxY:_}=u.a2.fromPoints(a).extend(e);return[new u.P(l,d),new u.P(g,d),new u.P(g,_),new u.P(l,_),new u.P(l,d)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:a,zoom:l}=this.constrain(this.center,this.zoom);this.setCenter(a),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=u.ai(new Float64Array(16));u.N(e,e,[this._width/2,-this._height/2,1]),u.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=u.ai(new Float64Array(16)),u.N(e,e,[1,-1,1]),u.M(e,e,[-1,-1,0]),u.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,a,l,d){const g=l!==void 0?l:this.bearing,_=d=d!==void 0?d:this.pitch,w=u.a1.fromLngLat(e,a),S=-Math.cos(u.ag(_)),E=Math.sin(u.ag(_)),I=E*Math.sin(u.ag(g)),L=-E*Math.cos(u.ag(g));let R=this.elevation;const $=a-R;let Z;S*$>=0||Math.abs(S)<.1?(Z=1e4,R=a+Z*S):Z=-$/S;let K,Q,J=u.aQ(1,w.y),oe=0;do{if(oe+=1,oe>10)break;Q=Z/J,K=new u.a1(w.x+I*Q,w.y+L*Q),J=1/K.meterInMercatorCoordinateUnits()}while(Math.abs(Z-Q*J)>1e-12);return{center:K.toLngLat(),elevation:R,zoom:u.ak(this.height/2/Math.tan(this.fovInRadians/2)/Q/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const a=u.aj(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/a,d=u.a1.fromLngLat(this.center,this.elevation),g=Ge(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const _=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),u.aQ(g.z,d.y),this.bearing,this.pitch);this._elevation=_.elevation,this._center=_.center,this.setZoom(_.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=u.aj(1,this.center.lat)*this.worldSize;return Ge(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const a=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/a,e.canonical.y/a,1/a/u.$,1/a/u.$]}}class ar{constructor(e,a){this.min=e,this.max=a,this.center=u.aR([],u.aS([],this.min,this.max),.5)}quadrant(e){const a=[e%2==0,e<2],l=u.aT(this.min),d=u.aT(this.max);for(let g=0;g<a.length;g++)l[g]=a[g]?this.min[g]:this.center[g],d[g]=a[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new ar(l,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let a=!0;for(let l=0;l<e.planes.length;l++){const d=this.intersectsPlane(e.planes[l]);if(d===0)return 0;d===1&&(a=!1)}return a?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let a=e[3],l=e[3];for(let d=0;d<3;d++)e[d]>0?(a+=e[d]*this.min[d],l+=e[d]*this.max[d]):(l+=e[d]*this.min[d],a+=e[d]*this.max[d]);return a>=0?2:l<0?0:1}}class Hl{distanceToTile2d(e,a,l,d){const g=d.distanceX([e,a]),_=d.distanceY([e,a]);return Math.hypot(g,_)}getWrap(e,a,l){return l}getTileBoundingVolume(e,a,l,d){var g,_;let w=0,S=0;if(d?.terrain){const I=new u.Z(e.z,a,e.z,e.x,e.y),L=d.terrain.getMinMaxElevation(I);w=(g=L.minElevation)!==null&&g!==void 0?g:Math.min(0,l),S=(_=L.maxElevation)!==null&&_!==void 0?_:Math.max(0,l)}const E=1<<e.z;return new ar([a+e.x/E,e.y/E,w],[a+(e.x+1)/E,(e.y+1)/E,S])}allowVariableZoom(e,a){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=u.ae(78.5-l/2,0,60);return!!a.terrain||e.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class gr{constructor(e,a,l){this.points=e,this.planes=a,this.aabb=l}static fromInvProjectionMatrix(e,a=1,l=0,d,g){const _=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((R=>(function($,Z,K,Q){const J=u.aw([],$,Z),oe=1/J[3]/K*Q;return u.aY(J,J,[oe,oe,1/J[3],oe])})(R,e,a,w)));d&&(function(R,$,Z,K){const Q=K?4:0,J=K?0:4;let oe=0;const he=[],se=[];for(let ce=0;ce<4;ce++){const Te=u.aU([],R[ce+J],R[ce+Q]),Oe=u.aZ(Te);u.aR(Te,Te,1/Oe),he.push(Oe),se.push(Te)}for(let ce=0;ce<4;ce++){const Te=u.a_(R[ce+Q],se[ce],Z);oe=Te!==null&&Te>=0?Math.max(oe,Te):Math.max(oe,he[ce])}const de=(function(ce,Te){const Oe=u.aU([],ce[Te[0]],ce[Te[1]]),Re=u.aU([],ce[Te[2]],ce[Te[1]]),Le=[0,0,0,0];return u.aV(Le,u.aW([],Oe,Re)),Le[3]=-u.aX(Le,ce[Te[0]]),Le})(R,$),ge=(function(ce,Te){const Oe=u.a$(ce),Re=u.b0([],ce,1/Oe),Le=u.aU([],Te,u.aR([],Re,u.aX(Te,Re))),Be=u.a$(Le);if(Be>0){const nt=Math.sqrt(1-Re[3]*Re[3]),at=u.aR([],Re,-Re[3]),et=u.aS([],at,u.aR([],Le,nt/Be));return u.b1(Te,et)}return null})(Z,de);if(ge!==null){const ce=ge/u.aX(se[0],de);oe=Math.min(oe,ce)}for(let ce=0;ce<4;ce++){const Te=Math.min(oe,he[ce]);R[ce+J]=[R[ce+Q][0]+se[ce][0]*Te,R[ce+Q][1]+se[ce][1]*Te,R[ce+Q][2]+se[ce][2]*Te,1]}})(S,_[0],d,g);const E=_.map((R=>{const $=u.aU([],S[R[0]],S[R[1]]),Z=u.aU([],S[R[2]],S[R[1]]),K=u.aV([],u.aW([],$,Z)),Q=-u.aX(K,S[R[1]]);return K.concat(Q)})),I=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],L=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const R of S)for(let $=0;$<3;$++)I[$]=Math.min(I[$],R[$]),L[$]=Math.max(L[$],R[$]);return new gr(S,E,new ar(I,L))}}class Xr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,l){return this._helper.interpolatePadding(e,a,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,l=!0){this._helper.resize(e,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,a){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,l)=>{l=u.ae(+l,this.minZoom,this.maxZoom);const d={center:new u.S(a.lng,a.lat),zoom:l};let g=this._helper._lngRange;if(!this._helper._renderWorldCopies&&g===null){const se=179.9999999999;g=[-se,se]}const _=this.tileSize*u.ah(d.zoom);let w=0,S=_,E=0,I=_,L=0,R=0;const{x:$,y:Z}=this.size;if(this._helper._latRange){const se=this._helper._latRange;w=u.U(se[1])*_,S=u.U(se[0])*_,S-w<Z&&(L=Z/(S-w))}g&&(E=u.aO(u.V(g[0])*_,0,_),I=u.aO(u.V(g[1])*_,0,_),I<E&&(I+=_),I-E<$&&(R=$/(I-E)));const{x:K,y:Q}=fe(_,a);let J,oe;const he=Math.max(R||0,L||0);if(he){const se=new u.P(R?(I+E)/2:K,L?(S+w)/2:Q);return d.center=Pe(_,se).wrap(),d.zoom+=u.ak(he),d}if(this._helper._latRange){const se=Z/2;Q-se<w&&(oe=w+se),Q+se>S&&(oe=S-se)}if(g){const se=(E+I)/2;let de=K;this._helper._renderWorldCopies&&(de=u.aO(K,se-_/2,se+_/2));const ge=$/2;de-ge<E&&(J=E+ge),de+ge>I&&(J=I-ge)}if(J!==void 0||oe!==void 0){const se=new u.P(J??K,oe??Q);d.center=Pe(_,se).wrap()}return d},this._helper=new Rr({calcMatrices:()=>{this._calcMatrices()},constrain:(a,l)=>this.defaultConstrain(a,l)},e),this._coveringTilesDetailsProvider=new Hl}clone(){const e=new Xr;return e.apply(this),e}apply(e,a,l){this._helper.apply(e,a,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const a=[new u.b2(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new u.P(0,0)),d=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,this._helper._height)),_=this.screenPointToMercatorCoordinate(new u.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,d.x,g.x,_.x)),S=Math.floor(Math.max(l.x,d.x,g.x,_.x)),E=1;for(let I=w-E;I<=S+E;I++)I!==0&&a.push(new u.b2(I,e))}return a}getCameraFrustum(){return gr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const a=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,a){const l=u.aj(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(a,l),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),_=u.a1.fromLngLat(e),w=new u.a1(_.x-(d.x-g.x),_.y-(d.y-g.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,a){return a?this.coordinatePoint(u.a1.fromLngLat(e),a.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(u.a1.fromLngLat(e))}screenPointToLocation(e,a){var l;return(l=this.screenPointToMercatorCoordinate(e,a))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,a){if(a){const l=a.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,a){const l=a||0,d=[e.x,e.y,0,1],g=[e.x,e.y,1,1];u.aw(d,d,this._pixelMatrixInverse),u.aw(g,g,this._pixelMatrixInverse);const _=d[3],w=g[3],S=d[1]/_,E=g[1]/w,I=d[2]/_,L=g[2]/w,R=I===L?0:(l-I)/(L-I);return new u.a1(u.C.number(d[0]/_,g[0]/w,R)/this.worldSize,u.C.number(S,E,R)/this.worldSize,l)}coordinatePoint(e,a=0,l=this._pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,a,1];return u.aw(d,d,l),new u.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Se(this));return new Bi().extend(this.screenPointToLocation(new u.P(0,e))).extend(this.screenPointToLocation(new u.P(this._helper._width,e))).extend(this.screenPointToLocation(new u.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new u.P(0,this._helper._height)))}isPointOnMapSurface(e,a){return a?a.pointCoordinate(e)!=null:e.y>this.height/2-Se(this)}calculatePosMatrix(e,a=!1,l){var d;const g=(d=e.key)!==null&&d!==void 0?d:u.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),_=a?this._alignedPosMatrixCache:this._posMatrixCache;if(_.has(g)){const E=_.get(g);return l?E.f32:E.f64}const w=Ae(e,this.worldSize);u.O(w,a?this._alignedProjMatrix:this._viewProjMatrix,w);const S={f64:w,f32:new Float32Array(w)};return _.set(g,S),l?S.f32:S.f64}calculateFogMatrix(e){const a=e.key,l=this._fogMatrixCacheF32;if(l.has(a))return l.get(a);const d=Ae(e,this.worldSize);return u.O(d,this._fogMatrix,d),l.set(a,new Float32Array(d)),l.get(a)}calculateCenterFromCameraLngLatAlt(e,a,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,l,d)}_calculateNearFarZIfNeeded(e,a,l){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-d*this._helper._pixelPerMeter/Math.cos(a),_=d<0?g:e,w=Math.PI/2+this.pitchInRadians,S=u.ag(this.fov)*(Math.abs(Math.cos(u.ag(this.roll)))*this.height+Math.abs(Math.sin(u.ag(this.roll)))*this.width)/this.height*(.5+l.y/this.height),E=Math.sin(S)*_/Math.sin(u.ae(Math.PI-w-S,.01,Math.PI-.01)),I=Se(this),L=Math.atan(I/this._helper.cameraToCenterDistance),R=u.ag(.75),$=L>R?2*L*(.5+l.y/(2*I)):R,Z=Math.sin($)*_/Math.sin(u.ae(Math.PI-w-$,.01,Math.PI-.01)),K=Math.min(E,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*K+_),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,a=fe(this.worldSize,this.center),l=a.x,d=a.y;this._helper._pixelPerMeter=u.aj(1,this.center.lat)*this.worldSize;const g=u.ag(Math.min(this.pitch,le)),_=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g));let w;this._calculateNearFarZIfNeeded(_,g,e),w=new Float64Array(16),u.b4(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),u.aq(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=u.b5(w),u.N(w,w,[1,-1,1]),u.M(w,w,[0,0,-this._helper.cameraToCenterDistance]),u.b6(w,w,-this.rollInRadians),u.b7(w,w,this.pitchInRadians),u.b6(w,w,-this.bearingInRadians),u.M(w,w,[-l,-d,0]),this._mercatorMatrix=u.N([],w,[this.worldSize,this.worldSize,this.worldSize]),u.N(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=u.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),u.M(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=u.aq([],w);const S=[0,0,-1,1];u.aw(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),u.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,_,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,u.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),u.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),u.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),u.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),u.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),u.M(this._fogMatrix,this._fogMatrix,[-l,-d,0]),u.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),u.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=u.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const E=this._helper._width%2/2,I=this._helper._height%2/2,L=Math.cos(this.bearingInRadians),R=Math.sin(-this.bearingInRadians),$=l-Math.round(l)+L*E+R*I,Z=d-Math.round(d)+L*I+R*E,K=new Float64Array(w);if(u.M(K,K,[$>.5?$-1:$,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=K,w=u.aq(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new u.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return u.aw(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=u.aj(1,this.center.lat)*this.worldSize;return Ge(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,a){const l=u.a1.fromLngLat(e),d=[l.x*this.worldSize,l.y*this.worldSize,a,1];return u.aw(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){const{overscaledTileID:a,aligned:l,applyTerrainMatrix:d}=e,g=this._helper.getMercatorTileCoordinates(a),_=a?this.calculatePosMatrix(a,l,!0):null;let w;return w=a&&a.terrainRttPosMatrix32f&&d?a.terrainRttPosMatrix32f:_||u.b8(),{mainMatrix:w,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,a,l){return 1}transformLightDirection(e){return u.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,a,l,d){const g=this.calculatePosMatrix(l);let _;d?(_=[e,a,d(e,a),1],u.aw(_,_,g)):(_=[e,a,0,1],xn(_,_,g));const w=_[3];return{point:new u.P(_[0]/w,_[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(const a of e)this.calculatePosMatrix(a)}getMatrixForModel(e,a){const l=u.a1.fromLngLat(e,a),d=l.meterInMercatorCoordinateUnits(),g=u.b9();return u.M(g,g,[l.x,l.y,l.z]),u.b6(g,g,Math.PI),u.b7(g,g,Math.PI/2),u.N(g,g,[-d,d,d]),g}getProjectionDataForCustomLayer(e=!0){const a=new u.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:e}),d=Ae(a,this.worldSize);u.O(d,this._viewProjMatrix,d),l.tileMercatorCoords=[0,0,1,1];const g=[u.$,u.$,this.worldSize/this._helper.pixelsPerMeter],_=u.ba();return u.N(_,d,g),l.fallbackMatrix=_,l.mainMatrix=_,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function an(){u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function rs(p){if(p.useSlerp)if(p.k<1){const e=u.bb(p.startEulerAngles.roll,p.startEulerAngles.pitch,p.startEulerAngles.bearing),a=u.bb(p.endEulerAngles.roll,p.endEulerAngles.pitch,p.endEulerAngles.bearing),l=new Float64Array(4);u.bc(l,e,a,p.k);const d=u.bd(l);p.tr.setRoll(d.roll),p.tr.setPitch(d.pitch),p.tr.setBearing(d.bearing)}else p.tr.setRoll(p.endEulerAngles.roll),p.tr.setPitch(p.endEulerAngles.pitch),p.tr.setBearing(p.endEulerAngles.bearing);else p.tr.setRoll(u.C.number(p.startEulerAngles.roll,p.endEulerAngles.roll,p.k)),p.tr.setPitch(u.C.number(p.startEulerAngles.pitch,p.endEulerAngles.pitch,p.k)),p.tr.setBearing(u.C.number(p.startEulerAngles.bearing,p.endEulerAngles.bearing,p.k))}function qs(p,e,a,l,d){const g=d.padding,_=fe(d.worldSize,a.getNorthWest()),w=fe(d.worldSize,a.getNorthEast()),S=fe(d.worldSize,a.getSouthEast()),E=fe(d.worldSize,a.getSouthWest()),I=u.ag(-l),L=_.rotate(I),R=w.rotate(I),$=S.rotate(I),Z=E.rotate(I),K=new u.P(Math.max(L.x,R.x,Z.x,$.x),Math.max(L.y,R.y,Z.y,$.y)),Q=new u.P(Math.min(L.x,R.x,Z.x,$.x),Math.min(L.y,R.y,Z.y,$.y)),J=K.sub(Q),oe=(d.width-(g.left+g.right+e.left+e.right))/J.x,he=(d.height-(g.top+g.bottom+e.top+e.bottom))/J.y;if(he<0||oe<0)return void an();const se=Math.min(u.ak(d.scale*Math.min(oe,he)),p.maxZoom),de=u.P.convert(p.offset),ge=new u.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(u.ag(l)),ce=de.add(ge).mult(d.scale/u.ah(se));return{center:Pe(d.worldSize,_.add(S).div(2).sub(ce)),zoom:se,bearing:l}}class sr{get useGlobeControls(){return!1}handlePanInertia(e,a){const l=e.mag(),d=Math.abs(Se(a));return{easingOffset:e.mult(Math.min(.75*d/l,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(e,a){e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta),e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta)}handleMapControlsPan(e,a,l){e.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,a,l,d,g){return qs(e,a,l,d,g)}handleJumpToCenterZoom(e,a){e.zoom!==(a.zoom!==void 0?+a.zoom:e.zoom)&&e.setZoom(+a.zoom),a.center!==void 0&&e.setCenter(u.S.convert(a.center))}handleEaseTo(e,a){const l=e.zoom,d=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},_={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},w=a.zoom!==void 0,S=!e.isPaddingEqual(a.padding);let E=!1;const I=w?+a.zoom:e.zoom;let L=e.centerPoint.add(a.offsetAsPoint);const R=e.screenPointToLocation(L),{center:$,zoom:Z}=e.constrain(u.S.convert(a.center||R),I??l);Mr(e,$);const K=fe(e.worldSize,R),Q=fe(e.worldSize,$).sub(K),J=u.ah(Z-l);return E=Z!==l,{easeFunc:oe=>{if(E&&e.setZoom(u.C.number(l,Z,oe)),u.be(g,_)||rs({startEulerAngles:g,endEulerAngles:_,tr:e,k:oe,useSlerp:g.roll!=_.roll}),S&&(e.interpolatePadding(d,a.padding,oe),L=e.centerPoint.add(a.offsetAsPoint)),a.around)e.setLocationAtPoint(a.around,a.aroundPoint);else{const he=u.ah(e.zoom-l),se=Z>l?Math.min(2,J):Math.max(.5,J),de=Math.pow(se,1-oe),ge=Pe(e.worldSize,K.add(Q.mult(oe*de)).mult(he));e.setLocationAtPoint(e.renderWorldCopies?ge.wrap():ge,L)}},isZooming:E,elevationCenter:$}}handleFlyTo(e,a){const l=a.zoom!==void 0,d=e.zoom,g=e.constrain(u.S.convert(a.center||a.locationAtOffset),l?+a.zoom:d),_=g.center,w=g.zoom;Mr(e,_);const S=fe(e.worldSize,a.locationAtOffset),E=fe(e.worldSize,_).sub(S),I=E.mag(),L=u.ah(w-d);let R;if(a.minZoom!==void 0){const $=Math.min(+a.minZoom,d,w),Z=e.constrain(_,$).zoom;R=u.ah(Z-d)}return{easeFunc:($,Z,K,Q)=>{e.setZoom($===1?w:d+u.ak(Z));const J=$===1?_:Pe(e.worldSize,S.add(E.mult(K)).mult(Z));e.setLocationAtPoint(e.renderWorldCopies?J.wrap():J,Q)},scaleOfZoom:L,targetCenter:_,scaleOfMinZoom:R,pixelPathLength:I}}}class Hi{constructor(e,a,l){this.blendFunction=e,this.blendColor=a,this.mask=l}}Hi.Replace=[1,0],Hi.disabled=new Hi(Hi.Replace,u.bf.transparent,[!1,!1,!1,!1]),Hi.unblended=new Hi(Hi.Replace,u.bf.transparent,[!0,!0,!0,!0]),Hi.alphaBlended=new Hi([1,771],u.bf.transparent,[!0,!0,!0,!0]);const _a=2305;class pi{constructor(e,a,l){this.enable=e,this.mode=a,this.frontFace=l}}pi.disabled=new pi(!1,1029,_a),pi.backCCW=new pi(!0,1029,_a),pi.frontCCW=new pi(!0,1028,_a);class Xt{constructor(e,a,l){this.func=e,this.mask=a,this.range=l}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const dn=7680;class ai{constructor(e,a,l,d,g,_){this.test=e,this.ref=a,this.mask=l,this.fail=d,this.depthFail=g,this.pass=_}}ai.disabled=new ai({func:519,mask:0},0,0,dn,dn,dn);const dl=new WeakMap;function Vn(p){var e;if(dl.has(p))return dl.get(p);{const a=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return dl.set(p,a),a}}class pl{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const a=e.context,l=a.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const d=new u.aL;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const g=new u.aN;g.emplaceBack(0,1,2),this._fullscreenTriangle=new La(a.createVertexBuffer(d,ti.members),a.createIndexBuffer(g),u.aM.simpleSegment(0,0,d.length,g.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(l.TEXTURE1);const _=l.createTexture();l.bindTexture(l.TEXTURE_2D,_),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(_),Vn(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,a){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,a=e.gl;e.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,a){const l=this._cachedRenderContext.context,d=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:u.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,d.TRIANGLES,Xt.disabled,ai.disabled,Hi.unblended,pi.disabled,((g,_)=>({u_input:g,u_output_expected:_}))(e,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Vn(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const g=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Vn(e)){const a=e.clientWaitSync(this._readbackQueue.sync,0,0);if(a===e.WAIT_FAILED)return u.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=pl._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let a=0;return a+=e[0]/256,a+=e[1]/65536,a+=e[2]/16777216,e[3]<127&&(a=-a),a/128}}const vs=u.$/128;function ko(p,e){const a=p.granularity!==void 0?Math.max(p.granularity,1):1,l=a+(p.generateBorders?2:0),d=a+(p.extendToNorthPole||p.generateBorders?1:0)+(p.extendToSouthPole||p.generateBorders?1:0),g=l+1,_=d+1,w=p.generateBorders?-1:0,S=p.generateBorders||p.extendToNorthPole?-1:0,E=a+(p.generateBorders?1:0),I=a+(p.generateBorders||p.extendToSouthPole?1:0),L=g*_,R=l*d*6,$=g*_>65536;if($&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=$||e==="32bit",K=new Int16Array(2*L);let Q=0;for(let he=S;he<=I;he++)for(let se=w;se<=E;se++){let de=se/a*u.$;se===-1&&(de=-vs),se===a+1&&(de=u.$+vs);let ge=he/a*u.$;he===-1&&(ge=p.extendToNorthPole?u.bh:-vs),he===a+1&&(ge=p.extendToSouthPole?u.bi:u.$+vs),K[Q++]=de,K[Q++]=ge}const J=Z?new Uint32Array(R):new Uint16Array(R);let oe=0;for(let he=0;he<d;he++)for(let se=0;se<l;se++){const de=se+1+he*g,ge=se+(he+1)*g,ce=se+1+(he+1)*g;J[oe++]=se+he*g,J[oe++]=ge,J[oe++]=de,J[oe++]=de,J[oe++]=ge,J[oe++]=ce}return{vertices:K.buffer.slice(0),indices:J.buffer.slice(0),uses32bitIndices:Z}}const bs=new u.aK({fill:new u.bj(128,2),line:new u.bj(512,0),tile:new u.bj(128,32),stencil:new u.bj(128,1),circle:3});class Co{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ga.projectionGlobe}get vertexShaderPreludeCode(){return ga.projectionMercator.vertexSource}get subdivisionGranularity(){return bs}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new pl(e));const a=u.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(a,l),g=Qe();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=g);const _=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=u.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,u.bl(_))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,a,l,d,g){const _=(g==="stencil"?bs.stencil:bs.tile).getGranularityForZoomLevel(a.z);return this._getMesh(e,{granularity:_,generateBorders:l,extendToNorthPole:a.y===0&&d,extendToSouthPole:a.y===(1<<a.z)-1&&d})}_getMesh(e,a){const l=this._getMeshKey(a);if(l in this._tileMeshCache)return this._tileMeshCache[l];const d=(function(g,_){const w=ko(_,"16bit"),S=u.aL.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),E=u.aN.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new La(g.createVertexBuffer(S,ti.members),g.createIndexBuffer(E),u.aM.simpleSegment(0,0,S.length,E.length))})(e,a);return this._tileMeshCache[l]=d,d}recalculate(e){}hasTransition(){const e=Qe();let a=!1;return a=a||(e-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Xl=new u.r({type:new u.D(u.v.projection.type)});class Fc extends u.E{constructor(e){super(),this._transitionable=new u.t(Xl,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.F(0)),this._mercatorProjection=new Mo,this._verticalPerspectiveProjection=new Co}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof u.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,a,l,d,g){return this.currentProjection.getMeshFromTileID(e,a,l,d,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Uc(p){const e=Hs(p.worldSize,p.center.lat);return 2*Math.PI*e}function ja(p,e,a,l,d){const g=1/(1<<d),_=e/u.$*g+l*g,w=u.bo((p/u.$*g+a*g)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-_*Math.PI*2))-.5*Math.PI,E=Math.cos(S),I=new Float64Array(3);return I[0]=Math.sin(w)*E,I[1]=Math.sin(S),I[2]=Math.cos(w)*E,I}function Lr(p){return(function(e,a){const l=Math.cos(a),d=new Float64Array(3);return d[0]=Math.sin(e)*l,d[1]=Math.sin(a),d[2]=Math.cos(e)*l,d})(p.lng*Math.PI/180,p.lat*Math.PI/180)}function Hs(p,e){return p/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Oh(p){const e=Math.asin(p[1])/Math.PI*180,a=Math.sqrt(p[0]*p[0]+p[2]*p[2]);if(a>1e-6){const l=p[0]/a,d=Math.acos(p[2]/a),g=(l>0?d:-d)/Math.PI*180;return new u.S(u.aO(g,-180,180),e)}return new u.S(0,e)}function fl(p){return Math.cos(p*Math.PI/180)}function Wr(p,e){const a=fl(p),l=fl(e);return u.ak(l/a)}function Bh(p,e){const a=p.rotate(e.bearingInRadians),l=e.zoom+Wr(e.center.lat,0),d=u.bk(1/fl(e.center.lat),1/fl(Math.min(Math.abs(e.center.lat),60)),u.bn(l,7,3,0,1)),g=360/Uc({worldSize:e.worldSize,center:{lat:e.center.lat}});return new u.S(e.center.lng-a.x*g*d,u.ae(e.center.lat+a.y*g,-u.af,u.af))}function $c(p){const e=.5*p,a=Math.sin(e),l=Math.cos(e);return Math.log(a+l)-Math.log(l-a)}function zn(p,e,a,l){const d=p.lat+a*l;if(Math.abs(a)>1){const g=(Math.sign(p.lat+a)!==Math.sign(p.lat)?-Math.abs(p.lat):Math.abs(p.lat))*Math.PI/180,_=Math.abs(p.lat+a)*Math.PI/180,w=$c(g+l*(_-g)),S=$c(g),E=$c(_);return new u.S(p.lng+e*((w-S)/(E-S)),d)}return new u.S(p.lng+e*l,d)}class Lu{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,a,l,d){const g=`${e.z}_${e.x}_${e.y}_${d?.terrain?"t":""}`,_=this._cache.get(g);if(_)return _;const w=this._cachePrevious.get(g);if(w)return this._cache.set(g,w),w;const S=this._boundingVolumeFactory(e,a,l,d);return this._cache.set(g,S),this._hadAnyChanges=!0,S}}class In{constructor(e,a,l,d){this.min=l,this.max=d,this.points=e,this.planes=a}static fromAabb(e,a){const l=[];for(let d=0;d<8;d++)l.push([1&~d?e[0]:a[0],(d>>1&1)==1?a[1]:e[1],(d>>2&1)==1?a[2]:e[2]]);return new In(l,[[-1,0,0,a[0]],[1,0,0,-e[0]],[0,-1,0,a[1]],[0,1,0,-e[1]],[0,0,-1,a[2]],[0,0,1,-e[2]]],e,a)}static fromCenterSizeAngles(e,a,l){const d=u.br([],l[0],l[1],l[2]),g=u.bs([],[a[0],0,0],d),_=u.bs([],[0,a[1],0],d),w=u.bs([],[0,0,a[2]],d),S=[...e],E=[...e];for(let L=0;L<8;L++)for(let R=0;R<3;R++){const $=e[R]+g[R]*(1&~L?-1:1)+_[R]*((L>>1&1)==1?1:-1)+w[R]*((L>>2&1)==1?1:-1);S[R]=Math.min(S[R],$),E[R]=Math.max(E[R],$)}const I=[];for(let L=0;L<8;L++){const R=[...e];u.aS(R,R,u.aR([],g,1&~L?-1:1)),u.aS(R,R,u.aR([],_,(L>>1&1)==1?1:-1)),u.aS(R,R,u.aR([],w,(L>>2&1)==1?1:-1)),I.push(R)}return new In(I,[[...g,-u.aX(g,I[0])],[..._,-u.aX(_,I[0])],[...w,-u.aX(w,I[0])],[-g[0],-g[1],-g[2],-u.aX(g,I[7])],[-_[0],-_[1],-_[2],-u.aX(_,I[7])],[-w[0],-w[1],-w[2],-u.aX(w,I[7])]],S,E)}intersectsFrustum(e){let a=!0;const l=this.points.length,d=this.planes.length,g=e.planes.length,_=e.points.length;for(let w=0;w<g;w++){const S=e.planes[w];let E=0;for(let I=0;I<l;I++){const L=this.points[I];S[0]*L[0]+S[1]*L[1]+S[2]*L[2]+S[3]>=0&&E++}if(E===0)return 0;E<l&&(a=!1)}if(a)return 2;for(let w=0;w<d;w++){const S=this.planes[w];let E=0;for(let I=0;I<_;I++){const L=e.points[I];S[0]*L[0]+S[1]*L[1]+S[2]*L[2]+S[3]>=0&&E++}if(E===0)return 0}return 1}intersectsPlane(e){const a=this.points.length;let l=0;for(let d=0;d<a;d++){const g=this.points[d];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&l++}return l===a?2:l===0?0:1}}function Eo(p,e,a){const l=p-e;return l<0?-l:Math.max(0,l-a)}function ml(p,e,a,l,d){const g=p-a;let _;return _=g<0?Math.min(-g,1+g-d):g>1?Math.min(Math.max(g-d,0),1-g):0,Math.max(_,Eo(e,l,d))}class Nh{constructor(){this._boundingVolumeCache=new Lu(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,a,l,d){const g=1<<l.z,_=1/g,w=l.x/g,S=l.y/g;let E=2;return E=Math.min(E,ml(e,a,w,S,_)),E=Math.min(E,ml(e,a,w+.5,-S-_,_)),E=Math.min(E,ml(e,a,w+.5,2-S-_,_)),E}getWrap(e,a,l){const d=1<<a.z,g=1/d,_=a.x/d,w=Eo(e.x,_,g),S=Eo(e.x,_-1,g),E=Eo(e.x,_+1,g),I=Math.min(w,S,E);return I===E?1:I===S?-1:0}allowVariableZoom(e,a){return Ii(e,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,a,l,d){return this._boundingVolumeCache.getTileBoundingVolume(e,a,l,d)}_computeTileBoundingVolume(e,a,l,d){var g,_;let w=0,S=0;if(d?.terrain){const E=new u.Z(e.z,a,e.z,e.x,e.y),I=d.terrain.getMinMaxElevation(E);w=(g=I.minElevation)!==null&&g!==void 0?g:Math.min(0,l),S=(_=I.maxElevation)!==null&&_!==void 0?_:Math.max(0,l)}if(w/=u.bu,S/=u.bu,w+=1,S+=1,e.z<=0)return In.fromAabb([-S,-S,-S],[S,S,S]);if(e.z===1)return In.fromAabb([e.x===0?-S:0,e.y===0?0:-S,-S],[e.x===0?0:S,e.y===0?S:0,S]);{const E=[ja(0,0,e.x,e.y,e.z),ja(u.$,0,e.x,e.y,e.z),ja(u.$,u.$,e.x,e.y,e.z),ja(0,u.$,e.x,e.y,e.z)],I=[];for(const Le of E)I.push(u.aR([],Le,S));if(S!==w)for(const Le of E)I.push(u.aR([],Le,w));e.y===0&&I.push([0,1,0]),e.y===(1<<e.z)-1&&I.push([0,-1,0]);const L=[1,1,1],R=[-1,-1,-1];for(const Le of I)for(let Be=0;Be<3;Be++)L[Be]=Math.min(L[Be],Le[Be]),R[Be]=Math.max(R[Be],Le[Be]);const $=ja(u.$/2,u.$/2,e.x,e.y,e.z),Z=u.aW([],[0,1,0],$);u.aV(Z,Z);const K=u.aW([],$,Z);u.aV(K,K);const Q=u.aW([],E[2],E[1]);u.aV(Q,Q);const J=u.aW([],E[0],E[3]);u.aV(J,J),I.push(u.aR([],$,S)),e.y>=(1<<e.z)/2&&I.push(u.aR([],ja(u.$/2,0,e.x,e.y,e.z),S)),e.y<(1<<e.z)/2&&I.push(u.aR([],ja(u.$/2,u.$,e.x,e.y,e.z),S));const oe=Ao($,I),he=Ao(K,I),se=[-$[0],-$[1],-$[2],oe.max],de=[$[0],$[1],$[2],-oe.min],ge=[-K[0],-K[1],-K[2],he.max],ce=[K[0],K[1],K[2],-he.min],Te=[...Q,0],Oe=[...J,0],Re=[];return e.y===0?Re.push(u.bt(Oe,Te,se),u.bt(Oe,Te,de)):Re.push(u.bt(ge,Te,se),u.bt(ge,Te,de),u.bt(ge,Oe,se),u.bt(ge,Oe,de)),e.y===(1<<e.z)-1?Re.push(u.bt(Oe,Te,se),u.bt(Oe,Te,de)):Re.push(u.bt(ce,Te,se),u.bt(ce,Te,de),u.bt(ce,Oe,se),u.bt(ce,Oe,de)),new In(Re,[se,de,ge,ce,Te,Oe],L,R)}}}function Ao(p,e){let a=1/0,l=-1/0;for(const d of e){const g=u.aX(p,d);a=Math.min(a,g),l=Math.max(l,g)}return{min:a,max:l}}class Vc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,l){return this._helper.interpolatePadding(e,a,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a){this._helper.resize(e,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=u.bv(),this._projectionMatrix=u.b9(),this._globeViewProjMatrix32f=u.b8(),this._globeViewProjMatrixNoCorrection=u.b9(),this._globeViewProjMatrixNoCorrectionInverted=u.b9(),this._globeProjMatrixInverted=u.b9(),this._cameraPosition=u.bp(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,l)=>{const d=u.ae(a.lat,-u.af,u.af),g=u.ae(+l,this.minZoom+Wr(0,d),this.maxZoom);return{center:new u.S(a.lng,d),zoom:g}},this._helper=new Rr({calcMatrices:()=>{this._calcMatrices()},constrain:(a,l)=>this.defaultConstrain(a,l)},e),this._coveringTilesDetailsProvider=new Nh}clone(){const e=new Vc;return e.apply(this),e}apply(e,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=u.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:a,applyGlobeMatrix:l}=e,d=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const a=this.pitchInRadians,l=this.cameraToCenterDistance/e,d=Math.sin(a)*l,g=Math.cos(a)*l+1,_=1/Math.sqrt(d*d+g*g)*1;let w=-d,S=g;const E=Math.sqrt(w*w+S*S);w/=E,S/=E;const I=[0,w,S];u.bw(I,I,[0,0,0],-this.bearingInRadians),u.bx(I,I,[0,0,0],-1*this.center.lat*Math.PI/180),u.by(I,I,[0,0,0],this.center.lng*Math.PI/180);const L=1/u.aZ(I);return u.aR(I,I,L),[...I,-_*L]}isLocationOccluded(e){return!this.isSurfacePointVisible(Lr(e))}transformLightDirection(e){const a=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,d=Math.cos(l),g=[Math.sin(a)*d,Math.sin(l),Math.cos(a)*d],_=[g[2],0,-g[0]],w=[0,0,0];u.aW(w,_,g),u.aV(_,_),u.aV(w,w);const S=[0,0,0];return u.aV(S,[_[0]*e[0]+w[0]*e[1]+g[0]*e[2],_[1]*e[0]+w[1]*e[1]+g[1]*e[2],_[2]*e[0]+w[2]*e[1]+g[2]*e[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,a,l){const d=(function(w,S,E){const I=1/(1<<E.z);return new u.a1(w/u.$*I+E.x*I,S/u.$*I+E.y*I)})(e,a,l.canonical),g=(_=d.y,[u.bo(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-_*Math.PI*2))-.5*Math.PI]);var _;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,a,l,d){const g=l.canonical,_=ja(e,a,g.x,g.y,g.z),w=1+(d?d(e,a):0)/u.bu,S=[_[0]*w,_[1]*w,_[2]*w,1];u.aw(S,S,this._globeViewProjMatrixNoCorrection);const E=this._cachedClippingPlane,I=E[0]*_[0]+E[1]*_[1]+E[2]*_[2]+E[3]<0;return{point:new u.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:I}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Hs(this.worldSize,this.center.lat),a=u.ba(),l=u.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),u.b4(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;a[8]=2*-d.x/this._helper._width,a[9]=2*d.y/this._helper._height,this._projectionMatrix=u.b5(a),this._globeProjMatrixInverted=u.ba(),u.aq(this._globeProjMatrixInverted,a),u.M(a,a,[0,0,-this.cameraToCenterDistance]),u.b6(a,a,this.rollInRadians),u.b7(a,a,-this.pitchInRadians),u.b6(a,a,this.bearingInRadians),u.M(a,a,[0,0,-e]);const g=u.bp();g[0]=e,g[1]=e,g[2]=e,u.b7(l,a,this.center.lat*Math.PI/180),u.bz(l,l,-this.center.lng*Math.PI/180),u.N(l,l,g),this._globeViewProjMatrixNoCorrection=l,u.b7(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),u.bz(a,a,-this.center.lng*Math.PI/180),u.N(a,a,g),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=u.ba(),u.aq(this._globeViewProjMatrixNoCorrectionInverted,l);const _=u.bp();this._cameraPosition=u.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,u.bw(this._cameraPosition,this._cameraPosition,_,-this.rollInRadians),u.bx(this._cameraPosition,this._cameraPosition,_,this.pitchInRadians),u.bw(this._cameraPosition,this._cameraPosition,_,-this.bearingInRadians),u.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),u.bx(this._cameraPosition,this._cameraPosition,_,-this.center.lat*Math.PI/180),u.by(this._cameraPosition,this._cameraPosition,_,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const w=u.b5(this._globeViewProjMatrixNoCorrectionInverted);u.N(w,w,[1,1,-1]),this._cachedFrustum=gr.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){u.w("calculateFogMatrix is not supported on globe projection.");const a=u.ba();return u.ai(a),a}getVisibleUnwrappedCoordinates(e){return[new u.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&u.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Lr(e);u.aR(l,l,1+a/u.bu);const d=u.bv();return u.aw(d,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){const e=.5*this.width,a=.5*this.height,l=[new u.P(0,0),new u.P(e,0),new u.P(this.width,0),new u.P(this.width,a),new u.P(this.width,this.height),new u.P(e,this.height),new u.P(0,this.height),new u.P(0,a)],d=[];for(const L of l)d.push(this.unprojectScreenPoint(L));let g=0,_=0,w=0,S=0;const E=this.center;for(const L of d){const R=u.bA(E.lng,L.lng),$=u.bA(E.lat,L.lat);R<_&&(_=R),R>g&&(g=R),$<S&&(S=$),$>w&&(w=$)}const I=[E.lng+_,E.lat+S,E.lng+g,E.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(I[3]=90,I[0]=-180,I[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(I[1]=-90,I[0]=-180,I[2]=180),new Bi(I)}calculateCenterFromCameraLngLatAlt(e,a,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,l,d)}setLocationAtPoint(e,a){const l=Lr(this.unprojectScreenPoint(a)),d=Lr(e),g=u.bp();u.bB(g);const _=u.bp();u.by(_,l,g,-this.center.lng*Math.PI/180),u.bx(_,_,g,this.center.lat*Math.PI/180);const w=d[0]*d[0]+d[2]*d[2],S=_[0]*_[0];if(w<S)return;const E=Math.sqrt(w-S),I=-E,L=u.bC(d[0],d[2],_[0],E),R=u.bC(d[0],d[2],_[0],I),$=u.bp();u.by($,d,g,-L);const Z=u.bC($[1],$[2],_[1],_[2]),K=u.bp();u.by(K,d,g,-R);const Q=u.bC(K[1],K[2],_[1],_[2]),J=.5*Math.PI,oe=Z>=-J&&Z<=J,he=Q>=-J&&Q<=J;let se,de;if(oe&&he){const Oe=this.center.lng*Math.PI/180,Re=this.center.lat*Math.PI/180;u.bD(L,Oe)+u.bD(Z,Re)<u.bD(R,Oe)+u.bD(Q,Re)?(se=L,de=Z):(se=R,de=Q)}else if(oe)se=L,de=Z;else{if(!he)return;se=R,de=Q}const ge=se/Math.PI*180,ce=de/Math.PI*180,Te=this.center.lat;this.setCenter(new u.S(ge,u.ae(ce,-90,90))),this.setZoom(this.zoom+Wr(Te,this.center.lat))}locationToScreenPoint(e,a){const l=Lr(e);if(a){const d=a.getElevationForLngLatZoom(e,this._helper._tileZoom);u.aR(l,l,1+d/u.bu)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const a=u.bv();return u.aw(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new u.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,a){if(a){const l=a.pointCoordinate(e);if(l)return l}return u.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,a){var l;return(l=this.screenPointToMercatorCoordinate(e,a))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,a){const l=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,d)}getRayDirectionFromPixel(e){const a=u.bv();a[0]=e.x/this.width*2-1,a[1]=-1*(e.y/this.height*2-1),a[2]=1,a[3]=1,u.aw(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const l=u.bp();l[0]=a[0]-this._cameraPosition[0],l[1]=a[1]-this._cameraPosition[1],l[2]=a[2]-this._cameraPosition[2];const d=u.bp();return u.aV(d,l),d}isSurfacePointVisible(e){const a=this._cachedClippingPlane;return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const a=u.bv();return u.aw(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(e,a){const l=u.aX(e,a),d=u.bp(),g=u.bp();u.aR(g,a,l),u.aU(d,e,g);const _=1-u.aX(d,d);if(_<0)return null;const w=u.aX(e,e)-1,S=-l+(l<0?1:-1)*Math.sqrt(_),E=w/S,I=S;return{tMin:Math.min(E,I),tMax:Math.max(E,I)}}unprojectScreenPoint(e){const a=this._cameraPosition,l=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(a,l);if(d){const I=u.bp();u.aS(I,a,[l[0]*d.tMin,l[1]*d.tMin,l[2]*d.tMin]);const L=u.bp();return u.aV(L,I),Oh(L)}const g=this._cachedClippingPlane,_=g[0]*l[0]+g[1]*l[1]+g[2]*l[2],w=-u.b1(g,a)/_,S=u.bp();if(w>0)u.aS(S,a,[l[0]*w,l[1]*w,l[2]*w]);else{const I=u.bp();u.aS(I,a,[2*l[0],2*l[1],2*l[2]]);const L=u.b1(this._cachedClippingPlane,I);u.aU(S,I,[this._cachedClippingPlane[0]*L,this._cachedClippingPlane[1]*L,this._cachedClippingPlane[2]*L])}const E=(function(I){const L=u.bp();return L[0]=I[0]*-I[3],L[1]=I[1]*-I[3],L[2]=I[2]*-I[3],{center:L,radius:Math.sqrt(1-I[3]*I[3])}})(g);return Oh((function(I,L,R){const $=u.bp();u.aU($,R,I);const Z=u.bp();return u.bq(Z,I,$,L/u.a$($)),Z})(E.center,E.radius,S))}getMatrixForModel(e,a){const l=u.S.convert(e),d=1/u.bu,g=u.b9();return u.bz(g,g,l.lng/180*Math.PI),u.b7(g,g,-l.lat/180*Math.PI),u.M(g,g,[0,0,1+a/u.bu]),u.b7(g,g,.5*Math.PI),u.N(g,g,[d,d,d]),g}getProjectionDataForCustomLayer(e=!0){const a=this.getProjectionData({overscaledTileID:new u.Z(0,0,0,0,0),applyGlobeMatrix:e});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(e){}}class Wl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,l){return this._helper.interpolatePadding(e,a,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,l=!0){this._helper.resize(e,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,a){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,l)=>this.currentTransform.defaultConstrain(a,l),this._helper=new Rr({calcMatrices:()=>{this._calcMatrices()},constrain:(a,l)=>this.defaultConstrain(a,l)},e),this._globeness=1,this._mercatorTransform=new Xr,this._verticalPerspectiveTransform=new Vc}clone(){const e=new Wl;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const a=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:a.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return u.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return u.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,a,l){const d=this._mercatorTransform.getPitchedTextCorrection(e,a,l),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,a,l);return u.bk(d,g,this._globeness)}projectTileCoordinates(e,a,l,d){return this.currentTransform.projectTileCoordinates(e,a,l,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){return this.currentTransform.lngLatToCameraDepth(e,a)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,a,l,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,l,d)}setLocationAtPoint(e,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,a){return this.currentTransform.locationToScreenPoint(e,a)}screenPointToMercatorCoordinate(e,a){return this.currentTransform.screenPointToMercatorCoordinate(e,a)}screenPointToLocation(e,a){return this.currentTransform.screenPointToLocation(e,a)}isPointOnMapSurface(e,a){return this.currentTransform.isPointOnMapSurface(e,a)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,a){return this.currentTransform.getMatrixForModel(e,a)}getProjectionDataForCustomLayer(e=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return a;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=a.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Oa{get useGlobeControls(){return!0}handlePanInertia(e,a){const l=Bh(e,a);return Math.abs(l.lng-a.center.lng)>180&&(l.lng=a.center.lng+179.5*Math.sign(l.lng-a.center.lng)),{easingCenter:l,easingOffset:new u.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,a){const l=e.around,d=a.screenPointToLocation(l);e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta);const g=a.zoom;e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta);const _=a.zoom-g;if(_===0)return;const w=u.bA(a.center.lng,d.lng),S=w/(Math.abs(w/180)+1),E=u.bA(a.center.lat,d.lat),I=a.getRayDirectionFromPixel(l),L=a.cameraPosition,R=-1*u.aX(L,I),$=u.bp();u.aS($,L,[I[0]*R,I[1]*R,I[2]*R]);const Z=u.aZ($)-1,K=Math.exp(.5*-Math.max(Z-.3,0)),Q=Hs(a.worldSize,a.center.lat)/Math.min(a.width,a.height),J=u.bn(Q,.9,.5,1,.25),oe=(1-u.ah(-_))*Math.min(K,J),he=a.center.lat,se=a.zoom,de=new u.S(a.center.lng+S*oe,u.ae(a.center.lat+E*oe,-u.af,u.af));a.setLocationAtPoint(d,l);const ge=a.center,ce=u.bn(Math.abs(w),45,85,0,1),Te=u.bn(Q,.75,.35,0,1),Oe=Math.pow(Math.max(ce,Te),.25),Re=u.bA(ge.lng,de.lng),Le=u.bA(ge.lat,de.lat);a.setCenter(new u.S(ge.lng+Re*Oe,ge.lat+Le*Oe).wrap()),a.setZoom(se+Wr(he,a.center.lat))}handleMapControlsPan(e,a,l){if(!e.panDelta)return;const d=a.center.lat,g=a.zoom;a.setCenter(Bh(e.panDelta,a).wrap()),a.setZoom(g+Wr(d,a.center.lat))}cameraForBoxAndBearing(e,a,l,d,g){const _=qs(e,a,l,d,g),w=a.left/g.width*2-1,S=(g.width-a.right)/g.width*2-1,E=a.top/g.height*-2+1,I=(g.height-a.bottom)/g.height*-2+1,L=u.bA(l.getWest(),l.getEast())<0,R=L?l.getEast():l.getWest(),$=L?l.getWest():l.getEast(),Z=Math.max(l.getNorth(),l.getSouth()),K=Math.min(l.getNorth(),l.getSouth()),Q=R+.5*u.bA(R,$),J=Z+.5*u.bA(Z,K),oe=g.clone();oe.setCenter(_.center),oe.setBearing(_.bearing),oe.setPitch(0),oe.setRoll(0),oe.setZoom(_.zoom);const he=oe.modelViewProjectionMatrix,se=[Lr(l.getNorthWest()),Lr(l.getNorthEast()),Lr(l.getSouthWest()),Lr(l.getSouthEast()),Lr(new u.S($,J)),Lr(new u.S(R,J)),Lr(new u.S(Q,Z)),Lr(new u.S(Q,K))],de=Lr(_.center);let ge=Number.POSITIVE_INFINITY;for(const ce of se)w<0&&(ge=Oa.getLesserNonNegativeNonNull(ge,Oa.solveVectorScale(ce,de,he,"x",w))),S>0&&(ge=Oa.getLesserNonNegativeNonNull(ge,Oa.solveVectorScale(ce,de,he,"x",S))),E>0&&(ge=Oa.getLesserNonNegativeNonNull(ge,Oa.solveVectorScale(ce,de,he,"y",E))),I<0&&(ge=Oa.getLesserNonNegativeNonNull(ge,Oa.solveVectorScale(ce,de,he,"y",I)));if(Number.isFinite(ge)&&ge!==0)return _.zoom=oe.zoom+u.ak(ge),_;an()}handleJumpToCenterZoom(e,a){const l=e.center.lat,d=e.constrain(a.center?u.S.convert(a.center):e.center,e.zoom).center;e.setCenter(d.wrap());const g=a.zoom!==void 0?+a.zoom:e.zoom+Wr(l,d.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,a){const l=e.zoom,d=e.center,g=e.padding,_={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},S=a.zoom!==void 0,E=!e.isPaddingEqual(a.padding);let I=!1;const L=a.center?u.S.convert(a.center):d,R=e.constrain(L,l).center;Mr(e,R);const $=e.clone();$.setCenter(R),$.setZoom(S?+a.zoom:l+Wr(d.lat,L.lat)),$.setBearing(a.bearing);const Z=new u.P(u.ae(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),u.ae(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));$.setLocationAtPoint(R,Z);const K=(a.offset&&a.offsetAsPoint.mag())>0?$.center:R,Q=S?+a.zoom:l+Wr(d.lat,K.lat),J=l+Wr(d.lat,0),oe=Q+Wr(K.lat,0),he=u.bA(d.lng,K.lng),se=u.bA(d.lat,K.lat),de=u.ah(oe-J);return I=Q!==l,{easeFunc:ge=>{if(u.be(_,w)||rs({startEulerAngles:_,endEulerAngles:w,tr:e,k:ge,useSlerp:_.roll!=w.roll}),E&&e.interpolatePadding(g,a.padding,ge),a.around)u.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(a.around,a.aroundPoint);else{const ce=oe>J?Math.min(2,de):Math.max(.5,de),Te=Math.pow(ce,1-ge),Oe=zn(d,he,se,ge*Te);e.setCenter(Oe.wrap())}if(I){const ce=u.C.number(J,oe,ge)+Wr(0,e.center.lat);e.setZoom(ce)}},isZooming:I,elevationCenter:K}}handleFlyTo(e,a){const l=a.zoom!==void 0,d=e.center,g=e.zoom,_=e.padding,w=!e.isPaddingEqual(a.padding),S=e.constrain(u.S.convert(a.center||a.locationAtOffset),g).center,E=l?+a.zoom:e.zoom+Wr(e.center.lat,S.lat),I=e.clone();I.setCenter(S),I.setZoom(E),I.setBearing(a.bearing);const L=new u.P(u.ae(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),u.ae(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));I.setLocationAtPoint(S,L);const R=I.center;Mr(e,R);const $=(function(se,de,ge){const ce=Lr(de),Te=Lr(ge),Oe=u.aX(ce,Te),Re=Math.acos(Oe),Le=Uc(se);return Re/(2*Math.PI)*Le})(e,d,R),Z=g+Wr(d.lat,0),K=E+Wr(R.lat,0),Q=u.ah(K-Z);let J;if(typeof a.minZoom=="number"){const se=+a.minZoom+Wr(R.lat,0),de=Math.min(se,Z,K)+Wr(0,R.lat),ge=e.constrain(R,de).zoom+Wr(R.lat,0);J=u.ah(ge-Z)}const oe=u.bA(d.lng,R.lng),he=u.bA(d.lat,R.lat);return{easeFunc:(se,de,ge,ce)=>{const Te=zn(d,oe,he,ge);w&&e.interpolatePadding(_,a.padding,se);const Oe=se===1?R:Te;e.setCenter(Oe.wrap());const Re=Z+u.ak(de);e.setZoom(se===1?E:Re+Wr(0,Oe.lat))},scaleOfZoom:Q,targetCenter:R,scaleOfMinZoom:J,pixelPathLength:$}}static solveVectorScale(e,a,l,d,g){const _=d==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],S=e[0]*_[0]+e[1]*_[1]+e[2]*_[2],E=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],I=a[0]*_[0]+a[1]*_[1]+a[2]*_[2],L=a[0]*w[0]+a[1]*w[1]+a[2]*w[2];return I+g*E===S+g*L||w[3]*(S-I)+_[3]*(L-E)+S*L==I*E?null:(I+_[3]-g*L-g*w[3])/(I-S-g*L+g*E)}static getLesserNonNegativeNonNull(e,a){return a!==null&&a>=0&&a<e?a:e}}class Fh{constructor(e){this._globe=e,this._mercatorCameraHelper=new sr,this._verticalPerspectiveCameraHelper=new Oa}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,a){return this.currentHelper.handlePanInertia(e,a)}handleMapControlsRollPitchBearingZoom(e,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,a)}handleMapControlsPan(e,a,l){this.currentHelper.handleMapControlsPan(e,a,l)}cameraForBoxAndBearing(e,a,l,d,g){return this.currentHelper.cameraForBoxAndBearing(e,a,l,d,g)}handleJumpToCenterZoom(e,a){this.currentHelper.handleJumpToCenterZoom(e,a)}handleEaseTo(e,a){return this.currentHelper.handleEaseTo(e,a)}handleFlyTo(e,a){return this.currentHelper.handleFlyTo(e,a)}}const Gc=(p,e)=>u.y(p,e&&e.filter((a=>a.identifier!=="source.canvas"))),Bd=u.bE();class gl extends u.E{constructor(e,a={}){var l,d;super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const w=this.sourceCaches[_].getSource().type;w!=="vector"&&w!=="geojson"||this.sourceCaches[_].reload()}},this.map=e,this.dispatcher=new $i(ei(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((_,w)=>this.getGlyphs(_,w))),this.dispatcher.registerMessageHandler("GI",((_,w)=>this.getImages(_,w))),this.dispatcher.registerMessageHandler("GDA",((_,w)=>this.getDashes(_,w))),this.imageManager=new Yi,this.imageManager.setEventedParent(this);const g=((l=e._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((d=document.documentElement)===null||d===void 0?void 0:d.lang)||void 0;this.glyphManager=new qi(e._requestManager,a.localIdeographFontFamily,g),this.lineAtlas=new be(256,512),this.crossTileSymbolIndex=new Zs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",u.bG()),Et().on(rn,this._rtlPluginLoaded),this.on("data",(_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const w=this.sourceCaches[_.sourceId];if(!w)return;const S=w.getSource();if(S&&S.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===S.id&&this._validateLayer(I)}}))}setGlobalStateProperty(e,a){var l,d,g;this._checkLoaded();const _=a===null?(g=(d=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||d===void 0?void 0:d.default)!==null&&g!==void 0?g:null:a;if(u.bH(_,this._globalState[e]))return this;this._globalState[e]=_,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const a=[];for(const l in e)!u.bH(this._globalState[l],e[l].default)&&(a.push(l),this._globalState[l]=e[l].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(e){if(e.length===0)return;const a=new Set,l={};for(const d of e){l[d]=this._globalState[d];for(const g in this._layers){const _=this._layers[g],w=_.getLayoutAffectingGlobalStateRefs(),S=_.getPaintAffectingGlobalStateRefs();if(w.has(d)&&a.add(_.source),S.has(d))for(const{name:E,value:I}of S.get(d))this._updatePaintProperty(_,E,I)}}this.dispatcher.broadcast("UGS",l);for(const d in this.sourceCaches)a.has(d)&&(this._reloadSource(d),this._changed=!0)}loadURL(e,a={},l){this.fire(new u.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const g=this._loadStyleRequest;u.j(d,this._loadStyleRequest).then((_=>{this._loadStyleRequest=null,this._load(_.data,a,l)})).catch((_=>{this._loadStyleRequest=null,_&&!g.signal.aborted&&this.fire(new u.k(_))}))}loadJSON(e,a={},l){this.fire(new u.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,we.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,l)})).catch((()=>{}))}loadEmpty(){this.fire(new u.l("dataloading",{dataType:"style"})),this._load(Bd,{validate:!1})}_load(e,a,l){var d,g;let _=a.transformStyle?a.transformStyle(l,e):e;if(!a.validate||!Gc(this,u.z(_))){_=Object.assign({},_),this._loaded=!0,this.stylesheet=_;for(const w in _.sources)this.addSource(w,_.sources[w],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new Ot(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new mi(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new u.l("data",{dataType:"style"})),this.fire(new u.l("style.load"))}}_createLayers(){var e,a,l;const d=u.bI(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",d),this._order=d.map((g=>g.id)),this._layers={},this._serializedLayers=null;for(const g of d){const _=u.bJ(g,this._globalState);if(_.setEventedParent(this,{layer:{id:g.id}}),this._layers[g.id]=_,u.bK(_)&&this.sourceCaches[_.source]){const w=(l=(a=g.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&l!==void 0?l:_.paint.get("raster-fade-duration");this.sourceCaches[_.source].setRasterFadeDuration(w)}}}_loadSprite(e,a=!1,l=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,_,w,S){return u._(this,void 0,void 0,(function*(){const E=wi(g),I=w>1?"@2x":"",L={},R={};for(const{id:$,url:Z}of E){const K=_.transformRequest(Ui(Z,I,".json"),"SpriteJSON");L[$]=u.j(K,S);const Q=_.transformRequest(Ui(Z,I,".png"),"SpriteImage");R[$]=vt.getImage(Q,S)}return yield Promise.all([...Object.values(L),...Object.values(R)]),(function($,Z){return u._(this,void 0,void 0,(function*(){const K={};for(const Q in $){K[Q]={};const J=we.getImageCanvasContext((yield Z[Q]).data),oe=(yield $[Q]).data;for(const he in oe){const{width:se,height:de,x:ge,y:ce,sdf:Te,pixelRatio:Oe,stretchX:Re,stretchY:Le,content:Be,textFitWidth:nt,textFitHeight:at}=oe[he];K[Q][he]={data:null,pixelRatio:Oe,sdf:Te,stretchX:Re,stretchY:Le,content:Be,textFitWidth:nt,textFitHeight:at,spriteData:{width:se,height:de,x:ge,y:ce,context:J}}}}return K}))})(L,R)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((g=>{if(this._spriteRequest=null,g)for(const _ in g){this._spritesImagesIds[_]=[];const w=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter((S=>!(S in g))):[];for(const S of w)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in g[_]){const E=_==="default"?S:`${_}:${S}`;this._spritesImagesIds[_].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,g[_][S],!1):this.imageManager.addImage(E,g[_][S]),a&&(this._changedImages[E]=!0)}}})).catch((g=>{this._spriteRequest=null,d=g,this.fire(new u.k(d))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"})),l&&l(d)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}_validateLayer(e){const a=this.sourceCaches[e.source];if(!a)return;const l=e.sourceLayer;if(!l)return;const d=a.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(l)===-1)&&this.fire(new u.k(new Error(`Source layer "${l}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?u.bL(l):l);const d=[];for(const g of e)if(l[g]){const _=a?u.bL(l[g]):l[g];d.push(_)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const l of a){const d=this._layers[l];d.type!=="custom"&&(e[l]=d.serialize())}return e}hasTransitions(){var e,a,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(a){const d=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(d.length||g.length)&&this._updateWorkerLayers(d,g);for(const _ in this._updatedSources){const w=this._updatedSources[_];if(w==="reload")this._reloadSource(_);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const d in this.sourceCaches){const g=this.sourceCaches[d];l[d]=g.used,g.used=!1}for(const d of this._order){const g=this._layers[d];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const d in l){const g=this.sourceCaches[d];!!l[d]!=!!g.used&&g.fire(new u.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,a&&this.fire(new u.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var l;this._checkLoaded();const d=this.serialize();if(e=a.transformStyle?a.transformStyle(d,e):e,((l=a.validate)===null||l===void 0||l)&&Gc(this,u.z(e)))return!1;(e=u.bL(e)).layers=u.bI(e.layers);const g=u.bM(d,e),_=this._getOperationsToPerform(g);if(_.unimplemented.length>0)throw new Error(`Unimplemented: ${_.unimplemented.join(", ")}.`);if(_.operations.length===0)return!1;for(const w of _.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const a=[],l=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":a.push((()=>{}));break;default:l.push(d.command)}return{operations:a,unimplemented:l}}addImage(e,a){if(this.getImage(e))return this.fire(new u.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new u.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(u.z.source,`sources.${e}`,a,null,l))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const d=this.sourceCaches[e]=new ki(e,a,this.dispatcher);d.style=this,d.setEventedParent(this,(()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e}))),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new u.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new u.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,l={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new u.k(new Error(`Layer "${d}" already exists on this map.`)));let g;if(e.type==="custom"){if(Gc(this,u.bN(e)))return;g=u.bJ(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=u.bL(e),e=u.e(e,{source:d})),this._validate(u.z.layer,`layers.${d}`,e,{arrayIndex:-1},l))return;g=u.bJ(e,this._globalState),this._validateLayer(g),g.setEventedParent(this,{layer:{id:d}})}const _=a?this._order.indexOf(a):this._order.length;if(a&&_===-1)this.fire(new u.k(new Error(`Cannot add layer "${d}" before non-existing layer "${a}".`)));else{if(this._order.splice(_,0,d),this._layerOrderChanged=!0,this._layers[d]=g,this._removedLayers[d]&&g.source&&g.type!=="custom"){const w=this._removedLayers[d];delete this._removedLayers[d],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new u.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const l=this._order.indexOf(e);this._order.splice(l,1);const d=a?this._order.indexOf(a):this._order.length;a&&d===-1?this.fire(new u.k(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new u.k(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,l){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===a&&d.maxzoom===l||(a!=null&&(d.minzoom=a),l!=null&&(d.maxzoom=l),this._updateLayer(d)):this.fire(new u.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,l={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!u.bH(d.filter,a))return a==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(u.z.filter,`layers.${d.id}.filter`,a,null,l)||(d.setFilter(u.bL(a)),this._updateLayer(d)))}else this.fire(new u.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return u.bL(this.getLayer(e).filter)}setLayoutProperty(e,a,l,d={}){this._checkLoaded();const g=this.getLayer(e);g?u.bH(g.getLayoutProperty(a),l)||(g.setLayoutProperty(a,l,d),this._updateLayer(g)):this.fire(new u.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const l=this.getLayer(e);if(l)return l.getLayoutProperty(a);this.fire(new u.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,l,d={}){this._checkLoaded();const g=this.getLayer(e);g?u.bH(g.getPaintProperty(a),l)||this._updatePaintProperty(g,a,l,d):this.fire(new u.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,a,l,d={}){e.setPaintProperty(a,l,d)&&this._updateLayer(e),u.bK(e)&&a==="raster-fade-duration"&&this.sourceCaches[e.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const l=e.source,d=e.sourceLayer,g=this.sourceCaches[l];if(g===void 0)return void this.fire(new u.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=g.getSource().type;_==="geojson"&&d?this.fire(new u.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||d?(e.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(d,e.id,a)):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const l=e.source,d=this.sourceCaches[l];if(d===void 0)return void this.fire(new u.k(new Error(`The source '${l}' does not exist in the map's style.`)));const g=d.getSource().type,_=g==="vector"?e.sourceLayer:void 0;g!=="vector"||_?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new u.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(_,e.id,a):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,l=e.sourceLayer,d=this.sourceCaches[a];if(d!==void 0)return d.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(l,e.id)):void this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=u.bO(this.sourceCaches,(g=>g.serialize())),a=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,d=this.stylesheet;return u.bP({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:a,terrain:l},(g=>g!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=_=>this._layers[_].type==="fill-extrusion",l={},d=[];for(let _=this._order.length-1;_>=0;_--){const w=this._order[_];if(a(w)){l[w]=_;for(const S of e){const E=S[w];if(E)for(const I of E)d.push(I)}}}d.sort(((_,w)=>w.intersectionZ-_.intersectionZ));const g=[];for(let _=this._order.length-1;_>=0;_--){const w=this._order[_];if(a(w))for(let S=d.length-1;S>=0;S--){const E=d[S].feature;if(l[E.layer.id]<_)break;g.push(E),d.pop()}else for(const S of e){const E=S[w];if(E)for(const I of E)g.push(I.feature)}}return g}queryRenderedFeatures(e,a,l){a&&a.filter&&this._validate(u.z.filter,"queryRenderedFeatures.filter",a.filter,null,a);const d={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new u.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const E of a.layers){const I=this._layers[E];if(!I)return this.fire(new u.k(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];d[I.source]=!0}}const g=[];a.availableImages=this._availableImages;const _=this._serializedAllLayers(),w=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,S=Object.assign(Object.assign({},a),{layers:w,globalState:this._globalState});for(const E in this.sourceCaches)a.layers&&!d[E]||g.push(_n(this.sourceCaches[E],this._layers,_,e,S,l,this.map.terrain?(I,L,R)=>this.map.terrain.getElevation(I,L,R):void 0));return this.placement&&g.push((function(E,I,L,R,$,Z,K){const Q={},J=Z.queryRenderedSymbols(R),oe=[];for(const he of Object.keys(J).map(Number))oe.push(K[he]);oe.sort(Tr);for(const he of oe){const se=he.featureIndex.lookupSymbolFeatures(J[he.bucketInstanceId],I,he.bucketIndex,he.sourceLayerIndex,{filterSpec:$.filter,globalState:$.globalState},$.layers,$.availableImages,E);for(const de in se){const ge=Q[de]=Q[de]||[],ce=se[de];ce.sort(((Te,Oe)=>{const Re=he.featureSortOrder;if(Re){const Le=Re.indexOf(Te.featureIndex);return Re.indexOf(Oe.featureIndex)-Le}return Oe.featureIndex-Te.featureIndex}));for(const Te of ce)ge.push(Te)}}return(function(he,se,de){for(const ge in he)for(const ce of he[ge])En(ce,de[se[ge].source]);return he})(Q,E,L)})(this._layers,_,this.sourceCaches,e,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,a){a?.filter&&this._validate(u.z.filter,"querySourceFeatures.filter",a.filter,null,a);const l=this.sourceCaches[e];return l?(function(d,g){const _=d.getRenderableIds().map((E=>d.getTileByID(E))),w=[],S={};for(let E=0;E<_.length;E++){const I=_[E],L=I.tileID.canonical.key;S[L]||(S[L]=!0,I.querySourceFeatures(w,g))}return w})(l,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const l=this.light.getLight();let d=!1;for(const _ in e)if(!u.bH(e[_],l[_])){d=!0;break}if(!d)return;const g={now:Qe(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){this._checkLoaded();const l=this.getSky();let d=!1;if(!e&&!l)return;if(e&&!l)d=!0;else if(!e&&l)d=!0;else for(const _ in e)if(!u.bH(e[_],l[_])){d=!0;break}if(!d)return;const g={now:Qe(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(g)}_setProjectionInternal(e){const a=(function(l,d){const g={constrain:d};if(Array.isArray(l)){const _=new Fc({type:l});return{projection:_,transform:new Wl(g),cameraHelper:new Fh(_)}}switch(l){case"mercator":return{projection:new Mo,transform:new Xr(g),cameraHelper:new sr};case"globe":{const _=new Fc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:_,transform:new Wl(g),cameraHelper:new Fh(_)}}case"vertical-perspective":return{projection:new Co,transform:new Vc(g),cameraHelper:new Oa};default:return u.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Mo,transform:new Xr(g),cameraHelper:new sr}}})(e,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,a,l,d,g={}){return(!g||g.validate!==!1)&&Gc(this,e.call(u.z,u.e({key:a,style:this.serialize(),value:l,styleSpec:u.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Et().off(rn,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const l=this.sourceCaches[a];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,l,d,g=!1){let _=!1,w=!1;const S={};for(const E of this._order){const I=this._layers[E];if(I.type!=="symbol")continue;if(!S[I.source]){const R=this.sourceCaches[I.source];S[I.source]=R.getRenderableIds(!0).map(($=>R.getTileByID($))).sort((($,Z)=>Z.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(Z.tileID)?-1:1)))}const L=this.crossTileSymbolIndex.addLayer(I,S[I.source],e.center.lng);_=_||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Qe(),e.zoom))&&(this.pauseablePlacement=new Gs(e,this.map.terrain,this._order,g,a,l,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Qe()),w=!0),_&&this.pauseablePlacement.placement.setStale()),w||_)for(const E of this._order){const I=this._layers[E];I.type==="symbol"&&this.placement.updateLayerOpacities(I,S[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Qe())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a){return u._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[a.source];return d&&d.setDependencies(a.tileID.key,a.type,a.icons),l}))}getGlyphs(e,a){return u._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(a.stacks),d=this.sourceCaches[a.source];return d&&d.setDependencies(a.tileID.key,a.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(u.z.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,a){return u._(this,void 0,void 0,(function*(){const l={};for(const[d,g]of Object.entries(a.dashes))l[d]=this.lineAtlas.getDash(g.dasharray,g.round);return l}))}addSprite(e,a,l={},d){this._checkLoaded();const g=[{id:e,url:a}],_=[...wi(this.stylesheet.sprite),...g];this._validate(u.z.sprite,"sprite",_,null,l)||(this.stylesheet.sprite=_,this._loadSprite(g,!0,d))}removeSprite(e){this._checkLoaded();const a=wi(this.stylesheet.sprite);if(a.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;a.splice(a.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}else this.fire(new u.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return wi(this.stylesheet.sprite)}setSprite(e,a={},l){this._checkLoaded(),e&&this._validate(u.z.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var ju=u.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Zc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,l,d,g,_,w,S,E){this.context=e;let I=this.boundPaintVertexBuffers.length!==d.length;for(let L=0;!I&&L<d.length;L++)this.boundPaintVertexBuffers[L]!==d[L]&&(I=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==l||I||this.boundIndexBuffer!==g||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==E?this.freshBind(a,l,d,g,_,w,S,E):(e.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),S&&S.bind(),E&&E.bind())}freshBind(e,a,l,d,g,_,w,S){const E=e.numAttributes,I=this.context,L=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=d,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,a.enableAttributes(L,e);for(const R of l)R.enableAttributes(L,e);_&&_.enableAttributes(L,e),w&&w.enableAttributes(L,e),S&&S.enableAttributes(L,e),a.bind(),a.setVertexAttribPointers(L,e,g);for(const R of l)R.bind(),R.setVertexAttribPointers(L,e,g);_&&(_.bind(),_.setVertexAttribPointers(L,e,g)),d&&d.bind(),w&&(w.bind(),w.setVertexAttribPointers(L,e,g)),S&&(S.bind(),S.setVertexAttribPointers(L,e,g)),I.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ou=(p,e,a,l,d)=>({u_texture:0,u_ele_delta:p,u_fog_matrix:e,u_fog_color:a?a.properties.get("fog-color"):u.bf.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):u.bf.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),Bu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Pn(p){const e=[];for(let a=0;a<p.length;a++){if(p[a]===null)continue;const l=p[a].split(" ");e.push(l.pop())}return e}class Yl{constructor(e,a,l,d,g,_,w,S,E=[]){const I=e.gl;this.program=I.createProgram();const L=Pn(a.staticAttributes),R=l?l.getBinderAttributes():[],$=L.concat(R),Z=ga.prelude.staticUniforms?Pn(ga.prelude.staticUniforms):[],K=w.staticUniforms?Pn(w.staticUniforms):[],Q=a.staticUniforms?Pn(a.staticUniforms):[],J=l?l.getBinderUniforms():[],oe=Z.concat(K).concat(Q).concat(J),he=[];for(const Re of oe)he.indexOf(Re)<0&&he.push(Re);const se=l?l.defines():[];Vn(I)&&se.unshift("#version 300 es"),g&&se.push("#define OVERDRAW_INSPECTOR;"),_&&se.push("#define TERRAIN3D;"),S&&se.push(S),E&&se.push(...E);let de=se.concat(ga.prelude.fragmentSource,w.fragmentSource,a.fragmentSource).join(`
`),ge=se.concat(ga.prelude.vertexSource,w.vertexSource,a.vertexSource).join(`
`);Vn(I)||(de=(function(Re){return Re.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(de),ge=(function(Re){return Re.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ge));const ce=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(ce,de),I.compileShader(ce),!I.getShaderParameter(ce,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(ce)}`);I.attachShader(this.program,ce);const Te=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(Te,ge),I.compileShader(Te),!I.getShaderParameter(Te,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(Te)}`);I.attachShader(this.program,Te),this.attributes={};const Oe={};this.numAttributes=$.length;for(let Re=0;Re<this.numAttributes;Re++)$[Re]&&(I.bindAttribLocation(this.program,Re,$[Re]),this.attributes[$[Re]]=Re);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(Te),I.deleteShader(ce);for(let Re=0;Re<he.length;Re++){const Le=he[Re];if(Le&&!Oe[Le]){const Be=I.getUniformLocation(this.program,Le);Be&&(Oe[Le]=Be)}}this.fixedUniforms=d(e,Oe),this.terrainUniforms=((Re,Le)=>({u_depth:new u.bQ(Re,Le.u_depth),u_terrain:new u.bQ(Re,Le.u_terrain),u_terrain_dim:new u.bg(Re,Le.u_terrain_dim),u_terrain_matrix:new u.bS(Re,Le.u_terrain_matrix),u_terrain_unpack:new u.bT(Re,Le.u_terrain_unpack),u_terrain_exaggeration:new u.bg(Re,Le.u_terrain_exaggeration)}))(e,Oe),this.projectionUniforms=((Re,Le)=>({u_projection_matrix:new u.bS(Re,Le.u_projection_matrix),u_projection_tile_mercator_coords:new u.bT(Re,Le.u_projection_tile_mercator_coords),u_projection_clipping_plane:new u.bT(Re,Le.u_projection_clipping_plane),u_projection_transition:new u.bg(Re,Le.u_projection_transition),u_projection_fallback_matrix:new u.bS(Re,Le.u_projection_fallback_matrix)}))(e,Oe),this.binderUniforms=l?l.getUniforms(e,Oe):[]}draw(e,a,l,d,g,_,w,S,E,I,L,R,$,Z,K,Q,J,oe,he){const se=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(d),e.setColorMode(g),e.setCullFace(_),S){e.activeTexture.set(se.TEXTURE2),se.bindTexture(se.TEXTURE_2D,S.depthTexture),e.activeTexture.set(se.TEXTURE3),se.bindTexture(se.TEXTURE_2D,S.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(S[ge])}if(E)for(const ge in E)this.projectionUniforms[Bu[ge]].set(E[ge]);if(w)for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(w[ge]);Q&&Q.setUniforms(e,this.binderUniforms,Z,{zoom:K});let de=0;switch(a){case se.LINES:de=2;break;case se.TRIANGLES:de=3;break;case se.LINE_STRIP:de=1}for(const ge of $.get()){const ce=ge.vaos||(ge.vaos={});(ce[I]||(ce[I]=new Zc)).bind(e,this,L,Q?Q.getPaintVertexBuffers():[],R,ge.vertexOffset,J,oe,he),se.drawElements(a,ge.primitiveLength*de,se.UNSIGNED_SHORT,ge.primitiveOffset*de*2)}}}function qc(p,e,a){const l=1/u.aC(a,1,e.transform.tileZoom),d=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,e.transform.tileZoom)/d,_=g*(a.tileID.canonical.x+a.tileID.wrap*d),w=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[_>>16,w>>16],u_pixel_coord_lower:[65535&_,65535&w]}}const zo=(p,e,a,l)=>{const d=p.style.light,g=d.properties.get("position"),_=[g.x,g.y,g.z],w=u.bW();d.properties.get("anchor")==="viewport"&&u.bX(w,p.transform.bearingInRadians),u.bY(_,_,w);const S=p.transform.transformLightDirection(_),E=d.properties.get("color");return{u_lightpos:_,u_lightpos_globe:S,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+e,u_opacity:a,u_fill_translate:l}},yl=(p,e,a,l,d,g,_)=>u.e(zo(p,e,a,l),qc(g,p,_),{u_height_factor:-Math.pow(2,d.overscaledZ)/_.tileSize/8}),Nu=(p,e,a,l)=>u.e(qc(e,p,a),{u_fill_translate:l}),Kl=(p,e)=>({u_world:p,u_fill_translate:e}),Uh=(p,e,a,l,d)=>u.e(Nu(p,e,a,d),{u_world:l}),Ba=(p,e,a,l,d)=>{const g=p.transform;let _,w,S=0;if(a.paint.get("circle-pitch-alignment")==="map"){const E=u.aC(e,1,g.zoom);_=!0,w=[E,E],S=E/(u.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else _=!1,w=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+_,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:S,u_translate:l}},Nd=p=>({u_pixel_extrude_scale:[1/p.width,1/p.height]}),$h=p=>({u_viewport_size:[p.width,p.height]}),Vh=(p,e=1)=>({u_color:p,u_overlay:0,u_overlay_scale:e}),Hc=(p,e,a,l)=>{const d=u.aC(p,1,e)/(u.$*Math.pow(2,p.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:u.aC(p,1,e),u_intensity:a,u_globe_extrude_scale:d}},Ql=(p,e,a,l)=>{const d=u.L();u.bZ(d,0,p.width,p.height,0,0,1);const g=p.context.gl;return{u_matrix:d,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:a,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},_l=(p,e,a)=>{const l=a.paint.get("hillshade-accent-color");let d;switch(a.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const g=a.getIlluminationProperties();for(let _=0;_<g.directionRadians.length;_++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[_]+=p.transform.bearingInRadians);return{u_image:0,u_latrange:Gh(0,e.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:l,u_method:d,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},xl=(p,e)=>{const a=e.stride,l=u.L();return u.bZ(l,0,u.$,-u.$,0,0,1),u.M(l,l,[0,-u.$,0]),{u_matrix:l,u_image:1,u_dimension:[a,a],u_zoom:p.overscaledZ,u_unpack:e.getUnpackVector()}};function Gh(p,e){const a=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new u.a1(0,l/a).toLngLat().lat,new u.a1(0,(l+1)/a).toLngLat().lat]}const Jl=(p,e,a=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:p.paint.get("color-relief-opacity")}),Na=(p,e,a,l)=>{const d=p.transform;return{u_translation:Uu(p,e,a),u_ratio:l/u.aC(e,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Fu=(p,e,a,l,d)=>u.e(Na(p,e,a,l),{u_image:0,u_image_height:d}),Xc=(p,e,a,l,d)=>{const g=p.transform,_=Po(e,g);return{u_translation:Uu(p,e,a),u_texsize:e.imageAtlasTexture.size,u_ratio:l/u.aC(e,1,g.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[_,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Io=(p,e,a,l,d)=>{const g=Po(e,p.transform);return u.e(Na(p,e,a,l),{u_tileratio:g,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image:0,u_mix:d.t,u_lineatlas_width:p.lineAtlas.width,u_lineatlas_height:p.lineAtlas.height})},Zh=(p,e,a,l,d,g)=>{const _=Po(e,p.transform);return u.e(Na(p,e,a,l),{u_image:0,u_image_height:g,u_tileratio:_,u_crossfade_from:d.fromScale,u_crossfade_to:d.toScale,u_image_dash:1,u_mix:d.t,u_lineatlas_width:p.lineAtlas.width,u_lineatlas_height:p.lineAtlas.height})};function Po(p,e){return 1/u.aC(p,1,e.tileZoom)}function Uu(p,e,a){return u.aD(p.transform,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Fd=(p,e,a,l,d)=>{return{u_tl_parent:p,u_scale_parent:e,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(_=l.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(g=l.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:qh(l.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var g,_};function qh(p){p*=Math.PI/180;const e=Math.sin(p),a=Math.cos(p);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const $u=(p,e,a,l,d,g,_,w,S,E,I,L,R)=>{const $=_.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:$.width/$.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+I,u_pitch_with_map:+l,u_is_along_line:d,u_is_variable_anchor:g,u_texsize:L,u_texture:0,u_translation:E,u_pitched_scale:R}},Vu=(p,e,a,l,d,g,_,w,S,E,I,L,R,$)=>{const Z=_.transform;return u.e($u(p,e,a,l,d,g,_,w,S,E,I,L,$),{u_gamma_scale:l?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:1})},Gu=(p,e,a,l,d,g,_,w,S,E,I,L,R)=>u.e(Vu(p,e,a,l,d,g,_,w,S,E,!0,I,0,R),{u_texsize_icon:L,u_texture_icon:1}),Gn=(p,e)=>({u_opacity:p,u_color:e}),Xs=(p,e,a,l,d)=>u.e((function(g,_,w,S){const E=w.imageManager.getPattern(g.from.toString()),I=w.imageManager.getPattern(g.to.toString()),{width:L,height:R}=w.imageManager.getPixelSize(),$=Math.pow(2,S.tileID.overscaledZ),Z=S.tileSize*Math.pow(2,w.transform.tileZoom)/$,K=Z*(S.tileID.canonical.x+S.tileID.wrap*$),Q=Z*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:E.tl,u_pattern_br_a:E.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[L,R],u_mix:_.t,u_pattern_size_a:E.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/u.aC(S,1,w.transform.tileZoom),u_pixel_coord_upper:[K>>16,Q>>16],u_pixel_coord_lower:[65535&K,65535&Q]}})(a,d,e,l),{u_opacity:p}),Fa=(p,e)=>{},Wc={fillExtrusion:(p,e)=>({u_lightpos:new u.bU(p,e.u_lightpos),u_lightpos_globe:new u.bU(p,e.u_lightpos_globe),u_lightintensity:new u.bg(p,e.u_lightintensity),u_lightcolor:new u.bU(p,e.u_lightcolor),u_vertical_gradient:new u.bg(p,e.u_vertical_gradient),u_opacity:new u.bg(p,e.u_opacity),u_fill_translate:new u.bV(p,e.u_fill_translate)}),fillExtrusionPattern:(p,e)=>({u_lightpos:new u.bU(p,e.u_lightpos),u_lightpos_globe:new u.bU(p,e.u_lightpos_globe),u_lightintensity:new u.bg(p,e.u_lightintensity),u_lightcolor:new u.bU(p,e.u_lightcolor),u_vertical_gradient:new u.bg(p,e.u_vertical_gradient),u_height_factor:new u.bg(p,e.u_height_factor),u_opacity:new u.bg(p,e.u_opacity),u_fill_translate:new u.bV(p,e.u_fill_translate),u_image:new u.bQ(p,e.u_image),u_texsize:new u.bV(p,e.u_texsize),u_pixel_coord_upper:new u.bV(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bV(p,e.u_pixel_coord_lower),u_scale:new u.bU(p,e.u_scale),u_fade:new u.bg(p,e.u_fade)}),fill:(p,e)=>({u_fill_translate:new u.bV(p,e.u_fill_translate)}),fillPattern:(p,e)=>({u_image:new u.bQ(p,e.u_image),u_texsize:new u.bV(p,e.u_texsize),u_pixel_coord_upper:new u.bV(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bV(p,e.u_pixel_coord_lower),u_scale:new u.bU(p,e.u_scale),u_fade:new u.bg(p,e.u_fade),u_fill_translate:new u.bV(p,e.u_fill_translate)}),fillOutline:(p,e)=>({u_world:new u.bV(p,e.u_world),u_fill_translate:new u.bV(p,e.u_fill_translate)}),fillOutlinePattern:(p,e)=>({u_world:new u.bV(p,e.u_world),u_image:new u.bQ(p,e.u_image),u_texsize:new u.bV(p,e.u_texsize),u_pixel_coord_upper:new u.bV(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bV(p,e.u_pixel_coord_lower),u_scale:new u.bU(p,e.u_scale),u_fade:new u.bg(p,e.u_fade),u_fill_translate:new u.bV(p,e.u_fill_translate)}),circle:(p,e)=>({u_camera_to_center_distance:new u.bg(p,e.u_camera_to_center_distance),u_scale_with_map:new u.bQ(p,e.u_scale_with_map),u_pitch_with_map:new u.bQ(p,e.u_pitch_with_map),u_extrude_scale:new u.bV(p,e.u_extrude_scale),u_device_pixel_ratio:new u.bg(p,e.u_device_pixel_ratio),u_globe_extrude_scale:new u.bg(p,e.u_globe_extrude_scale),u_translate:new u.bV(p,e.u_translate)}),collisionBox:(p,e)=>({u_pixel_extrude_scale:new u.bV(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_viewport_size:new u.bV(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new u.bR(p,e.u_color),u_overlay:new u.bQ(p,e.u_overlay),u_overlay_scale:new u.bg(p,e.u_overlay_scale)}),depth:Fa,clippingMask:Fa,heatmap:(p,e)=>({u_extrude_scale:new u.bg(p,e.u_extrude_scale),u_intensity:new u.bg(p,e.u_intensity),u_globe_extrude_scale:new u.bg(p,e.u_globe_extrude_scale)}),heatmapTexture:(p,e)=>({u_matrix:new u.bS(p,e.u_matrix),u_world:new u.bV(p,e.u_world),u_image:new u.bQ(p,e.u_image),u_color_ramp:new u.bQ(p,e.u_color_ramp),u_opacity:new u.bg(p,e.u_opacity)}),hillshade:(p,e)=>({u_image:new u.bQ(p,e.u_image),u_latrange:new u.bV(p,e.u_latrange),u_exaggeration:new u.bg(p,e.u_exaggeration),u_altitudes:new u.b$(p,e.u_altitudes),u_azimuths:new u.b$(p,e.u_azimuths),u_accent:new u.bR(p,e.u_accent),u_method:new u.bQ(p,e.u_method),u_shadows:new u.b_(p,e.u_shadows),u_highlights:new u.b_(p,e.u_highlights)}),hillshadePrepare:(p,e)=>({u_matrix:new u.bS(p,e.u_matrix),u_image:new u.bQ(p,e.u_image),u_dimension:new u.bV(p,e.u_dimension),u_zoom:new u.bg(p,e.u_zoom),u_unpack:new u.bT(p,e.u_unpack)}),colorRelief:(p,e)=>({u_image:new u.bQ(p,e.u_image),u_unpack:new u.bT(p,e.u_unpack),u_dimension:new u.bV(p,e.u_dimension),u_elevation_stops:new u.bQ(p,e.u_elevation_stops),u_color_stops:new u.bQ(p,e.u_color_stops),u_color_ramp_size:new u.bQ(p,e.u_color_ramp_size),u_opacity:new u.bg(p,e.u_opacity)}),line:(p,e)=>({u_translation:new u.bV(p,e.u_translation),u_ratio:new u.bg(p,e.u_ratio),u_device_pixel_ratio:new u.bg(p,e.u_device_pixel_ratio),u_units_to_pixels:new u.bV(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_translation:new u.bV(p,e.u_translation),u_ratio:new u.bg(p,e.u_ratio),u_device_pixel_ratio:new u.bg(p,e.u_device_pixel_ratio),u_units_to_pixels:new u.bV(p,e.u_units_to_pixels),u_image:new u.bQ(p,e.u_image),u_image_height:new u.bg(p,e.u_image_height)}),linePattern:(p,e)=>({u_translation:new u.bV(p,e.u_translation),u_texsize:new u.bV(p,e.u_texsize),u_ratio:new u.bg(p,e.u_ratio),u_device_pixel_ratio:new u.bg(p,e.u_device_pixel_ratio),u_image:new u.bQ(p,e.u_image),u_units_to_pixels:new u.bV(p,e.u_units_to_pixels),u_scale:new u.bU(p,e.u_scale),u_fade:new u.bg(p,e.u_fade)}),lineSDF:(p,e)=>({u_translation:new u.bV(p,e.u_translation),u_ratio:new u.bg(p,e.u_ratio),u_device_pixel_ratio:new u.bg(p,e.u_device_pixel_ratio),u_units_to_pixels:new u.bV(p,e.u_units_to_pixels),u_image:new u.bQ(p,e.u_image),u_mix:new u.bg(p,e.u_mix),u_tileratio:new u.bg(p,e.u_tileratio),u_crossfade_from:new u.bg(p,e.u_crossfade_from),u_crossfade_to:new u.bg(p,e.u_crossfade_to),u_lineatlas_width:new u.bg(p,e.u_lineatlas_width),u_lineatlas_height:new u.bg(p,e.u_lineatlas_height)}),lineGradientSDF:(p,e)=>({u_translation:new u.bV(p,e.u_translation),u_ratio:new u.bg(p,e.u_ratio),u_device_pixel_ratio:new u.bg(p,e.u_device_pixel_ratio),u_units_to_pixels:new u.bV(p,e.u_units_to_pixels),u_image:new u.bQ(p,e.u_image),u_image_height:new u.bg(p,e.u_image_height),u_tileratio:new u.bg(p,e.u_tileratio),u_crossfade_from:new u.bg(p,e.u_crossfade_from),u_crossfade_to:new u.bg(p,e.u_crossfade_to),u_image_dash:new u.bQ(p,e.u_image_dash),u_mix:new u.bg(p,e.u_mix),u_lineatlas_width:new u.bg(p,e.u_lineatlas_width),u_lineatlas_height:new u.bg(p,e.u_lineatlas_height)}),raster:(p,e)=>({u_tl_parent:new u.bV(p,e.u_tl_parent),u_scale_parent:new u.bg(p,e.u_scale_parent),u_buffer_scale:new u.bg(p,e.u_buffer_scale),u_fade_t:new u.bg(p,e.u_fade_t),u_opacity:new u.bg(p,e.u_opacity),u_image0:new u.bQ(p,e.u_image0),u_image1:new u.bQ(p,e.u_image1),u_brightness_low:new u.bg(p,e.u_brightness_low),u_brightness_high:new u.bg(p,e.u_brightness_high),u_saturation_factor:new u.bg(p,e.u_saturation_factor),u_contrast_factor:new u.bg(p,e.u_contrast_factor),u_spin_weights:new u.bU(p,e.u_spin_weights),u_coords_top:new u.bT(p,e.u_coords_top),u_coords_bottom:new u.bT(p,e.u_coords_bottom)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new u.bQ(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bQ(p,e.u_is_size_feature_constant),u_size_t:new u.bg(p,e.u_size_t),u_size:new u.bg(p,e.u_size),u_camera_to_center_distance:new u.bg(p,e.u_camera_to_center_distance),u_pitch:new u.bg(p,e.u_pitch),u_rotate_symbol:new u.bQ(p,e.u_rotate_symbol),u_aspect_ratio:new u.bg(p,e.u_aspect_ratio),u_fade_change:new u.bg(p,e.u_fade_change),u_label_plane_matrix:new u.bS(p,e.u_label_plane_matrix),u_coord_matrix:new u.bS(p,e.u_coord_matrix),u_is_text:new u.bQ(p,e.u_is_text),u_pitch_with_map:new u.bQ(p,e.u_pitch_with_map),u_is_along_line:new u.bQ(p,e.u_is_along_line),u_is_variable_anchor:new u.bQ(p,e.u_is_variable_anchor),u_texsize:new u.bV(p,e.u_texsize),u_texture:new u.bQ(p,e.u_texture),u_translation:new u.bV(p,e.u_translation),u_pitched_scale:new u.bg(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new u.bQ(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bQ(p,e.u_is_size_feature_constant),u_size_t:new u.bg(p,e.u_size_t),u_size:new u.bg(p,e.u_size),u_camera_to_center_distance:new u.bg(p,e.u_camera_to_center_distance),u_pitch:new u.bg(p,e.u_pitch),u_rotate_symbol:new u.bQ(p,e.u_rotate_symbol),u_aspect_ratio:new u.bg(p,e.u_aspect_ratio),u_fade_change:new u.bg(p,e.u_fade_change),u_label_plane_matrix:new u.bS(p,e.u_label_plane_matrix),u_coord_matrix:new u.bS(p,e.u_coord_matrix),u_is_text:new u.bQ(p,e.u_is_text),u_pitch_with_map:new u.bQ(p,e.u_pitch_with_map),u_is_along_line:new u.bQ(p,e.u_is_along_line),u_is_variable_anchor:new u.bQ(p,e.u_is_variable_anchor),u_texsize:new u.bV(p,e.u_texsize),u_texture:new u.bQ(p,e.u_texture),u_gamma_scale:new u.bg(p,e.u_gamma_scale),u_device_pixel_ratio:new u.bg(p,e.u_device_pixel_ratio),u_is_halo:new u.bQ(p,e.u_is_halo),u_translation:new u.bV(p,e.u_translation),u_pitched_scale:new u.bg(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new u.bQ(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bQ(p,e.u_is_size_feature_constant),u_size_t:new u.bg(p,e.u_size_t),u_size:new u.bg(p,e.u_size),u_camera_to_center_distance:new u.bg(p,e.u_camera_to_center_distance),u_pitch:new u.bg(p,e.u_pitch),u_rotate_symbol:new u.bQ(p,e.u_rotate_symbol),u_aspect_ratio:new u.bg(p,e.u_aspect_ratio),u_fade_change:new u.bg(p,e.u_fade_change),u_label_plane_matrix:new u.bS(p,e.u_label_plane_matrix),u_coord_matrix:new u.bS(p,e.u_coord_matrix),u_is_text:new u.bQ(p,e.u_is_text),u_pitch_with_map:new u.bQ(p,e.u_pitch_with_map),u_is_along_line:new u.bQ(p,e.u_is_along_line),u_is_variable_anchor:new u.bQ(p,e.u_is_variable_anchor),u_texsize:new u.bV(p,e.u_texsize),u_texsize_icon:new u.bV(p,e.u_texsize_icon),u_texture:new u.bQ(p,e.u_texture),u_texture_icon:new u.bQ(p,e.u_texture_icon),u_gamma_scale:new u.bg(p,e.u_gamma_scale),u_device_pixel_ratio:new u.bg(p,e.u_device_pixel_ratio),u_is_halo:new u.bQ(p,e.u_is_halo),u_translation:new u.bV(p,e.u_translation),u_pitched_scale:new u.bg(p,e.u_pitched_scale)}),background:(p,e)=>({u_opacity:new u.bg(p,e.u_opacity),u_color:new u.bR(p,e.u_color)}),backgroundPattern:(p,e)=>({u_opacity:new u.bg(p,e.u_opacity),u_image:new u.bQ(p,e.u_image),u_pattern_tl_a:new u.bV(p,e.u_pattern_tl_a),u_pattern_br_a:new u.bV(p,e.u_pattern_br_a),u_pattern_tl_b:new u.bV(p,e.u_pattern_tl_b),u_pattern_br_b:new u.bV(p,e.u_pattern_br_b),u_texsize:new u.bV(p,e.u_texsize),u_mix:new u.bg(p,e.u_mix),u_pattern_size_a:new u.bV(p,e.u_pattern_size_a),u_pattern_size_b:new u.bV(p,e.u_pattern_size_b),u_scale_a:new u.bg(p,e.u_scale_a),u_scale_b:new u.bg(p,e.u_scale_b),u_pixel_coord_upper:new u.bV(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.bV(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new u.bg(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_texture:new u.bQ(p,e.u_texture),u_ele_delta:new u.bg(p,e.u_ele_delta),u_fog_matrix:new u.bS(p,e.u_fog_matrix),u_fog_color:new u.bR(p,e.u_fog_color),u_fog_ground_blend:new u.bg(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.bg(p,e.u_fog_ground_blend_opacity),u_horizon_color:new u.bR(p,e.u_horizon_color),u_horizon_fog_blend:new u.bg(p,e.u_horizon_fog_blend),u_is_globe_mode:new u.bg(p,e.u_is_globe_mode)}),terrainDepth:(p,e)=>({u_ele_delta:new u.bg(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_texture:new u.bQ(p,e.u_texture),u_terrain_coords_id:new u.bg(p,e.u_terrain_coords_id),u_ele_delta:new u.bg(p,e.u_ele_delta)}),projectionErrorMeasurement:(p,e)=>({u_input:new u.bg(p,e.u_input),u_output_expected:new u.bg(p,e.u_output_expected)}),atmosphere:(p,e)=>({u_sun_pos:new u.bU(p,e.u_sun_pos),u_atmosphere_blend:new u.bg(p,e.u_atmosphere_blend),u_globe_position:new u.bU(p,e.u_globe_position),u_globe_radius:new u.bg(p,e.u_globe_radius),u_inv_proj_matrix:new u.bS(p,e.u_inv_proj_matrix)}),sky:(p,e)=>({u_sky_color:new u.bR(p,e.u_sky_color),u_horizon_color:new u.bR(p,e.u_horizon_color),u_horizon:new u.bV(p,e.u_horizon),u_horizon_normal:new u.bV(p,e.u_horizon_normal),u_sky_horizon_blend:new u.bg(p,e.u_sky_horizon_blend),u_sky_blend:new u.bg(p,e.u_sky_blend)})};class Yc{constructor(e,a,l){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Kc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qc{constructor(e,a,l,d){this.length=a.length,this.attributes=l,this.itemSize=a.bytesPerElement,this.dynamicDraw=d,this.context=e;const g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let l=0;l<this.attributes.length;l++){const d=a.attributes[this.attributes[l].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,a,l){for(let d=0;d<this.attributes.length;d++){const g=this.attributes[d],_=a.attributes[g.name];_!==void 0&&e.vertexAttribPointer(_,g.components,e[Kc[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Li{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xa extends Li{getDefault(){return u.bf.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ec extends Li{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class tc extends Li{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Zu extends Li{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Hh extends Li{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Do extends Li{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ro extends Li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class qu extends Li{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Hu extends Li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class ns extends Li{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ic extends Li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class rc extends Li{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Jc extends Li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class Lo extends Li{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class nc extends Li{getDefault(){return u.bf.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class vl extends Li{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Jn extends Li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class Xu extends Li{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class eu extends Li{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ea extends Li{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class as extends Li{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Dn extends Li{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ws extends Li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class jo extends Li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Oo extends Li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ac extends Li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ws extends Li{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class va extends Li{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const l=this.gl;Vn(l)?l.bindVertexArray(e):(a=l.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Wu extends Li{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class bl extends Li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class li extends Li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class wl extends Li{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class ta extends wl{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class tu extends wl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ia extends wl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Yu="Framebuffer is not complete";class iu{constructor(e,a,l,d,g){this.context=e,this.width=a,this.height=l;const _=e.gl,w=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new ta(e,w),d)this.depthAttachment=g?new ia(e,w):new tu(e,w);else if(g)throw new Error("Stencil cannot be set without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error(Yu)}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Ys{constructor(e){var a,l;if(this.gl=e,this.clearColor=new xa(this),this.clearDepth=new ec(this),this.clearStencil=new tc(this),this.colorMask=new Zu(this),this.depthMask=new Hh(this),this.stencilMask=new Do(this),this.stencilFunc=new Ro(this),this.stencilOp=new qu(this),this.stencilTest=new Hu(this),this.depthRange=new ns(this),this.depthTest=new ic(this),this.depthFunc=new rc(this),this.blend=new Jc(this),this.blendFunc=new Lo(this),this.blendColor=new nc(this),this.blendEquation=new vl(this),this.cullFace=new Jn(this),this.cullFaceSide=new Xu(this),this.frontFace=new eu(this),this.program=new ea(this),this.activeTexture=new as(this),this.viewport=new Dn(this),this.bindFramebuffer=new ws(this),this.bindRenderbuffer=new jo(this),this.bindTexture=new Oo(this),this.bindVertexBuffer=new ac(this),this.bindElementBuffer=new Ws(this),this.bindVertexArray=new va(this),this.pixelStoreUnpack=new Wu(this),this.pixelStoreUnpackPremultiplyAlpha=new bl(this),this.pixelStoreUnpackFlipY=new li(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Vn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:d?.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:d?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new Yc(this,e,a)}createVertexBuffer(e,a,l){return new Qc(this,e,a,l)}createRenderbuffer(e,a,l){const d=this.gl,g=d.createRenderbuffer();return this.bindRenderbuffer.set(g),d.renderbufferStorage(d.RENDERBUFFER,e,a,l),this.bindRenderbuffer.set(null),g}createFramebuffer(e,a,l,d){return new iu(this,e,a,l,d)}clear({color:e,depth:a,stencil:l}){const d=this.gl;let g=0;e&&(g|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),l!==void 0&&(g|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),d.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){u.bH(e.blendFunction,Hi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Vn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return Vn(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Sl;function sc(p,e,a,l,d){const g=p.context,_=p.transform,w=g.gl,S=p.useProgram("collisionBox"),E=[];let I=0,L=0;for(let J=0;J<l.length;J++){const oe=l[J],he=e.getTile(oe).getBucket(a);if(!he)continue;const se=d?he.textCollisionBox:he.iconCollisionBox,de=he.collisionCircleArray;de.length>0&&(E.push({circleArray:de,circleOffset:L,coord:oe}),I+=de.length/4,L=I),se&&S.draw(g,w.LINES,Xt.disabled,ai.disabled,p.colorModeForRenderPass(),pi.disabled,Nd(p.transform),p.style.map.terrain&&p.style.map.terrain.getTerrainData(oe),_.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,null,p.transform.zoom,null,null,se.collisionVertexBuffer)}if(!d||!E.length)return;const R=p.useProgram("collisionCircle"),$=new u.c0;$.resize(4*I),$._trim();let Z=0;for(const J of E)for(let oe=0;oe<J.circleArray.length/4;oe++){const he=4*oe,se=J.circleArray[he+0],de=J.circleArray[he+1],ge=J.circleArray[he+2],ce=J.circleArray[he+3];$.emplace(Z++,se,de,ge,ce,0),$.emplace(Z++,se,de,ge,ce,1),$.emplace(Z++,se,de,ge,ce,2),$.emplace(Z++,se,de,ge,ce,3)}(!Sl||Sl.length<2*I)&&(Sl=(function(J){const oe=2*J,he=new u.c2;he.resize(oe),he._trim();for(let se=0;se<oe;se++){const de=6*se;he.uint16[de+0]=4*se+0,he.uint16[de+1]=4*se+1,he.uint16[de+2]=4*se+2,he.uint16[de+3]=4*se+2,he.uint16[de+4]=4*se+3,he.uint16[de+5]=4*se+0}return he})(I));const K=g.createIndexBuffer(Sl,!0),Q=g.createVertexBuffer($,u.c1.members,!0);for(const J of E){const oe=$h(p.transform);R.draw(g,w.TRIANGLES,Xt.disabled,ai.disabled,p.colorModeForRenderPass(),pi.disabled,oe,p.style.map.terrain&&p.style.map.terrain.getTerrainData(J.coord),null,a.id,Q,K,u.aM.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,p.transform.zoom,null,null,null)}Q.destroy(),K.destroy()}const Tl=u.ai(new Float32Array(16));function oc(p,e,a,l,d,g){const{horizontalAlign:_,verticalAlign:w}=u.aH(p);return new u.P((-(_-.5)*e/d+l[0])*g,(-(w-.5)*a/d+l[1])*g)}function Rn(p,e,a,l,d,g){const _=e.tileAnchorPoint.add(new u.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(g);a||(w=w.rotate(-d));const S=_.add(w);return ot(S.x,S.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(a){const w=Zt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return p.add(l.rotate(S))}return p.add(l)}function Ks(p,e,a,l,d,g,_,w,S,E,I,L){const R=p.text.placedSymbolArray,$=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,K={};$.clear();for(let Q=0;Q<R.length;Q++){const J=R.get(Q),oe=J.hidden||!J.crossTileID||p.allowVerticalPlacement&&!J.placedOrientation?null:l[J.crossTileID];if(oe){const he=new u.P(J.anchorX,J.anchorY),se={getElevation:L,width:d.width,height:d.height,pitchedLabelPlaneMatrix:g,pitchWithMap:a,transform:d,tileAnchorPoint:he,translation:E,unwrappedTileID:I},de=a?Da(he.x,he.y,se):Zt(he.x,he.y,se),ge=ri(d.cameraToCenterDistance,de.signedDistanceFromCamera);let ce=u.ap(p.textSizeData,w,J)*ge/u.aB;a&&(ce*=p.tilePixelRatio/_);const{width:Te,height:Oe,anchor:Re,textOffset:Le,textBoxScale:Be}=oe,nt=oc(Re,Te,Oe,Le,Be,ce),at=d.getPitchedTextCorrection(he.x+E[0],he.y+E[1],I),et=Rn(de.point,se,e,nt,-d.bearingInRadians,at),bt=p.allowVerticalPlacement&&J.placedOrientation===u.ao.vertical?Math.PI/2:0;for(let Wt=0;Wt<J.numGlyphs;Wt++)u.av($,et,bt);S&&J.associatedIconIndex>=0&&(K[J.associatedIconIndex]={shiftedAnchor:et,angle:bt})}else ts(J.numGlyphs,$)}if(S){Z.clear();const Q=p.icon.placedSymbolArray;for(let J=0;J<Q.length;J++){const oe=Q.get(J);if(oe.hidden)ts(oe.numGlyphs,Z);else{const he=K[J];if(he)for(let se=0;se<oe.numGlyphs;se++)u.av(Z,he.shiftedAnchor,he.angle);else ts(oe.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData($)}function Bo(p,e,a){return a.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Qs(p,e,a,l,d,g,_,w,S,E,I,L,R){const $=p.context,Z=$.gl,K=p.transform,Q=w==="map",J=S==="map",oe=w!=="viewport"&&a.layout.get("symbol-placement")!=="point",he=Q&&!J&&!oe,se=!a.layout.get("symbol-sort-key").isConstant();let de=!1;const ge=p.getDepthModeForSublayer(0,Xt.ReadOnly),ce=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Te=[],Oe=K.getCircleRadiusCorrection();for(const Re of l){const Le=e.getTile(Re),Be=Le.getBucket(a);if(!Be)continue;const nt=d?Be.text:Be.icon;if(!nt||!nt.segments.get().length||!nt.hasVisibleVertices)continue;const at=nt.programConfigurations.get(a.id),et=d||Be.sdfIcons,bt=d?Be.textSizeData:Be.iconSizeData,Wt=J||K.pitch!==0,Ai=p.useProgram(Bo(et,d,Be),at),Qi=u.an(bt,K.zoom),tr=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Re);let ci,ir,Ur,_r,Kr=[0,0],kr=null;if(d)ir=Le.glyphAtlasTexture,Ur=Z.LINEAR,ci=Le.glyphAtlasTexture.size,Be.iconsInText&&(Kr=Le.imageAtlasTexture.size,kr=Le.imageAtlasTexture,_r=Wt||p.options.rotating||p.options.zooming||bt.kind==="composite"||bt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const jr=a.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;ir=Le.imageAtlasTexture,Ur=et||p.options.rotating||p.options.zooming||jr||Wt?Z.LINEAR:Z.NEAREST,ci=Le.imageAtlasTexture.size}const zr=u.aC(Le,1,p.transform.zoom),$r=pe(Q,p.transform,zr),zs=u.L();u.aq(zs,$r);const Is=Me(J,Q,p.transform,zr),Ps=u.aD(K,Le,g,_),Ds=K.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),po=ce&&Be.hasTextData(),yc=a.layout.get("icon-text-fit")!=="none"&&po&&Be.hasIconData();if(oe){const jr=p.style.map.terrain?(qn,Cr)=>p.style.map.terrain.getElevation(Re,qn,Cr):null,ln=a.layout.get("text-rotation-alignment")==="map";Ze(Be,p,d,$r,zs,J,E,ln,Re.toUnwrapped(),K.width,K.height,Ps,jr)}const ds=d&&ce||yc,Sn=oe||ds?Tl:J?$r:p.transform.clipSpaceToPixelsMatrix,fn=et&&a.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ta;Ta=et?Be.iconsInText?Gu(bt.kind,Qi,he,J,oe,ds,p,Sn,Is,Ps,ci,Kr,Oe):Vu(bt.kind,Qi,he,J,oe,ds,p,Sn,Is,Ps,d,ci,0,Oe):$u(bt.kind,Qi,he,J,oe,ds,p,Sn,Is,Ps,d,ci,Oe);const Wo={program:Ai,buffers:nt,uniformValues:Ta,projectionData:Ds,atlasTexture:ir,atlasTextureIcon:kr,atlasInterpolation:Ur,atlasInterpolationIcon:_r,isSDF:et,hasHalo:fn};if(se&&Be.canOverlap){de=!0;const jr=nt.segments.get();for(const ln of jr)Te.push({segments:new u.aM([ln]),sortKey:ln.sortKey,state:Wo,terrainData:tr})}else Te.push({segments:nt.segments,sortKey:0,state:Wo,terrainData:tr})}de&&Te.sort(((Re,Le)=>Re.sortKey-Le.sortKey));for(const Re of Te){const Le=Re.state;if($.activeTexture.set(Z.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,Z.CLAMP_TO_EDGE),Le.atlasTextureIcon&&($.activeTexture.set(Z.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Le.isSDF){const Be=Le.uniformValues;Le.hasHalo&&(Be.u_is_halo=1,Ss(Le.buffers,Re.segments,a,p,Le.program,ge,I,L,Be,Le.projectionData,Re.terrainData)),Be.u_is_halo=0}Ss(Le.buffers,Re.segments,a,p,Le.program,ge,I,L,Le.uniformValues,Le.projectionData,Re.terrainData)}}function Ss(p,e,a,l,d,g,_,w,S,E,I){const L=l.context;d.draw(L,L.gl.TRIANGLES,g,_,w,pi.backCCW,S,I,E,a.id,p.layoutVertexBuffer,p.indexBuffer,e,a.paint,l.transform.zoom,p.programConfigurations.get(a.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Ln(p,e,a,l,d){const g=p.context,_=g.gl,w=ai.disabled,S=new Hi([_.ONE,_.ONE],u.bf.transparent,[!0,!0,!0,!0]),E=e.getBucket(a);if(!E)return;const I=l.key;let L=a.heatmapFbos.get(I);L||(L=Ua(g,e.tileSize,e.tileSize),a.heatmapFbos.set(I,L)),g.bindFramebuffer.set(L.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:u.bf.transparent});const R=E.programConfigurations.get(a.id),$=p.useProgram("heatmap",R,!d),Z=p.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),K=p.style.map.terrain.getTerrainData(l);$.draw(g,_.TRIANGLES,Xt.disabled,w,S,pi.disabled,Hc(e,p.transform.zoom,a.paint.get("heatmap-intensity"),1),K,Z,a.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,a.paint,p.transform.zoom,R)}function pn(p,e,a,l,d){const g=p.context,_=g.gl,w=p.transform;g.setColorMode(p.colorModeForRenderPass());const S=$a(g,e),E=a.key,I=e.heatmapFbos.get(E);if(!I)return;g.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,I.colorAttachment.get()),g.activeTexture.set(_.TEXTURE1),S.bind(_.LINEAR,_.CLAMP_TO_EDGE);const L=w.getProjectionData({overscaledTileID:a,applyTerrainMatrix:d,applyGlobeMatrix:!l});p.useProgram("heatmapTexture").draw(g,_.TRIANGLES,Xt.disabled,ai.disabled,p.colorModeForRenderPass(),pi.disabled,Ql(p,e,0,1),null,L,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,w.zoom),I.destroy(),e.heatmapFbos.delete(E)}function Ua(p,e,a){var l,d;const g=p.gl,_=g.createTexture();g.bindTexture(g.TEXTURE_2D,_),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);const w=(l=p.HALF_FLOAT)!==null&&l!==void 0?l:g.UNSIGNED_BYTE,S=(d=p.RGBA16F)!==null&&d!==void 0?d:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,S,e,a,0,g.RGBA,w,null);const E=p.createFramebuffer(e,a,!1,!1);return E.colorAttachment.set(_),E}function $a(p,e){return e.colorRampTexture||(e.colorRampTexture=new u.T(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function jn(p,e,a,l,d,g,_,w){let S=256;if(d.stepInterpolant){const E=e.getSource().maxzoom,I=_.canonical.z===E?Math.ceil(1<<p.transform.maxZoom-_.canonical.z):1;S=u.ae(u.c4(g.maxLineLength/u.$*1024*I),256,a.maxTextureSize)}return w.gradient=u.c5({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:w.gradient||void 0,clips:g.lineClipsArray}),w.texture?w.texture.update(w.gradient):w.texture=new u.T(a,w.gradient,l.RGBA),w.version=d.gradientVersion,w.texture}function Ts(p,e,a,l,d){p.activeTexture.set(e.TEXTURE0),a.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),l.updatePaintBuffers(d)}function Ku(p,e,a,l,d,g){(d||p.lineAtlas.dirty)&&(e.activeTexture.set(a.TEXTURE0),p.lineAtlas.bind(e)),l.updatePaintBuffers(g)}function Ml(p,e,a,l,d,g,_){const w=g.gradients[d.id];let S=w.texture;d.gradientVersion!==w.version&&(S=jn(p,e,a,l,d,g,_,w)),a.activeTexture.set(l.TEXTURE0),S.bind(d.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function lc(p,e,a,l,d,g,_,w,S){const E=g.gradients[d.id];let I=E.texture;d.gradientVersion!==E.version&&(I=jn(p,e,a,l,d,g,_,E)),a.activeTexture.set(l.TEXTURE0),I.bind(d.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),p.lineAtlas.bind(a),w.updatePaintBuffers(S)}function ru(p,e,a,l,d){if(!a||!l||!l.imageAtlas)return;const g=l.imageAtlas.patternPositions;let _=g[a.to.toString()],w=g[a.from.toString()];if(!_&&w&&(_=w),!w&&_&&(w=_),!_||!w){const S=d.getPaintProperty(e);_=g[S],w=g[S]}_&&w&&p.setConstantPatternPositions(_,w)}function Yr(p,e,a,l,d,g,_,w){const S=p.context.gl,E="fill-pattern",I=a.paint.get(E),L=I&&I.constantOr(1),R=a.getCrossfadeParameters();let $,Z,K,Q,J;const oe=p.transform,he=a.paint.get("fill-translate"),se=a.paint.get("fill-translate-anchor");_?(Z=L&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=S.LINES):(Z=L?"fillPattern":"fill",$=S.TRIANGLES);const de=I.constantOr(null);for(const ge of l){const ce=e.getTile(ge);if(L&&!ce.patternsLoaded())continue;const Te=ce.getBucket(a);if(!Te)continue;const Oe=Te.programConfigurations.get(a.id),Re=p.useProgram(Z,Oe),Le=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ge);L&&(p.context.activeTexture.set(S.TEXTURE0),ce.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Oe.updatePaintBuffers(R)),ru(Oe,E,de,ce,a);const Be=oe.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),nt=u.aD(oe,ce,he,se);if(_){Q=Te.indexBuffer2,J=Te.segments2;const et=[S.drawingBufferWidth,S.drawingBufferHeight];K=Z==="fillOutlinePattern"&&L?Uh(p,R,ce,et,nt):Kl(et,nt)}else Q=Te.indexBuffer,J=Te.segments,K=L?Nu(p,R,ce,nt):{u_fill_translate:nt};const at=p.stencilModeForClipping(ge);Re.draw(p.context,$,d,at,g,pi.backCCW,K,Le,Be,a.id,Te.layoutVertexBuffer,Q,J,a.paint,p.transform.zoom,Oe)}}function Xi(p,e,a,l,d,g,_,w){const S=p.context,E=S.gl,I="fill-extrusion-pattern",L=a.paint.get(I),R=L.constantOr(1),$=a.getCrossfadeParameters(),Z=a.paint.get("fill-extrusion-opacity"),K=L.constantOr(null),Q=p.transform;for(const J of l){const oe=e.getTile(J),he=oe.getBucket(a);if(!he)continue;const se=p.style.map.terrain&&p.style.map.terrain.getTerrainData(J),de=he.programConfigurations.get(a.id),ge=p.useProgram(R?"fillExtrusionPattern":"fillExtrusion",de);R&&(p.context.activeTexture.set(E.TEXTURE0),oe.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),de.updatePaintBuffers($));const ce=Q.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!w,applyTerrainMatrix:!0});ru(de,I,K,oe,a);const Te=u.aD(Q,oe,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Oe=a.paint.get("fill-extrusion-vertical-gradient"),Re=R?yl(p,Oe,Z,Te,J,$,oe):zo(p,Oe,Z,Te);ge.draw(S,S.gl.TRIANGLES,d,g,_,pi.backCCW,Re,se,ce,a.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,a.paint,p.transform.zoom,de,p.style.map.terrain&&he.centroidVertexBuffer)}}function bi(p,e,a,l,d,g,_,w,S){var E;const I=p.style.projection,L=p.context,R=p.transform,$=L.gl,Z=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],K=p.useProgram("hillshade",null,!1,Z),Q=!p.options.moving;for(const J of l){const oe=e.getTile(J),he=oe.fbo;if(!he)continue;const se=I.getMeshFromTileID(L,J.canonical,w,!0,"raster"),de=(E=p.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(J);L.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,he.colorAttachment.get());const ge=R.getProjectionData({overscaledTileID:J,aligned:Q,applyGlobeMatrix:!S,applyTerrainMatrix:!0});K.draw(L,$.TRIANGLES,g,d[J.overscaledZ],_,pi.backCCW,_l(p,oe,a),de,ge,a.id,se.vertexBuffer,se.indexBuffer,se.segments)}}function ss(p,e,a,l,d,g,_,w,S){var E;const I=p.style.projection,L=p.context,R=p.transform,$=L.gl,Z=p.useProgram("colorRelief"),K=!p.options.moving;let Q=!0,J=0;for(const oe of l){const he=e.getTile(oe),se=he.dem;if(Q){const Re=$.getParameter($.MAX_TEXTURE_SIZE),{elevationTexture:Le,colorTexture:Be}=a.getColorRampTextures(L,Re,se.getUnpackVector());L.activeTexture.set($.TEXTURE1),Le.bind($.NEAREST,$.CLAMP_TO_EDGE),L.activeTexture.set($.TEXTURE4),Be.bind($.LINEAR,$.CLAMP_TO_EDGE),Q=!1,J=Le.size[0]}if(!se||!se.data)continue;const de=se.stride,ge=se.getPixels();if(L.activeTexture.set($.TEXTURE0),L.pixelStoreUnpackPremultiplyAlpha.set(!1),he.demTexture=he.demTexture||p.getTileTexture(de),he.demTexture){const Re=he.demTexture;Re.update(ge,{premultiply:!1}),Re.bind($.LINEAR,$.CLAMP_TO_EDGE)}else he.demTexture=new u.T(L,ge,$.RGBA,{premultiply:!1}),he.demTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const ce=I.getMeshFromTileID(L,oe.canonical,w,!0,"raster"),Te=(E=p.style.map.terrain)===null||E===void 0?void 0:E.getTerrainData(oe),Oe=R.getProjectionData({overscaledTileID:oe,aligned:K,applyGlobeMatrix:!S,applyTerrainMatrix:!0});Z.draw(L,$.TRIANGLES,g,d[oe.overscaledZ],_,pi.backCCW,Jl(a,he.dem,J),Te,Oe,a.id,ce.vertexBuffer,ce.indexBuffer,ce.segments)}}const On=[new u.P(0,0),new u.P(u.$,0),new u.P(u.$,u.$),new u.P(0,u.$)];function or(p,e,a,l,d,g,_,w,S=!1,E=!1){const I=l[l.length-1].overscaledZ,L=p.context,R=L.gl,$=p.useProgram("raster"),Z=p.transform,K=p.style.projection,Q=p.colorModeForRenderPass(),J=!p.options.moving,oe=a.paint.get("raster-opacity"),he=a.paint.get("raster-resampling"),se=a.paint.get("raster-fade-duration"),de=!!p.style.map.terrain;for(const ge of l){const ce=p.getDepthModeForSublayer(ge.overscaledZ-I,oe===1?Xt.ReadWrite:Xt.ReadOnly,R.LESS),Te=e.getTile(ge),Oe=he==="nearest"?R.NEAREST:R.LINEAR;L.activeTexture.set(R.TEXTURE0),Te.texture.bind(Oe,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),L.activeTexture.set(R.TEXTURE1);const{parentTile:Re,parentScaleBy:Le,parentTopLeft:Be,fadeValues:nt}=Zn(Te,e,se,de);Te.fadeOpacity=nt.tileOpacity,Re?(Re.fadeOpacity=nt.parentTileOpacity,Re.texture.bind(Oe,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST)):Te.texture.bind(Oe,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),Te.texture.useMipmap&&L.extTextureFilterAnisotropic&&p.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const at=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ge),et=Z.getProjectionData({overscaledTileID:ge,aligned:J,applyGlobeMatrix:!E,applyTerrainMatrix:!0}),bt=Fd(Be,Le,nt.fadeMix,a,w),Wt=K.getMeshFromTileID(L,ge.canonical,g,_,"raster");$.draw(L,R.TRIANGLES,ce,d?d[ge.overscaledZ]:ai.disabled,Q,S?pi.frontCCW:pi.backCCW,bt,at,et,a.id,Wt.vertexBuffer,Wt.indexBuffer,Wt.segments)}}function Zn(p,e,a,l){const d={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||l)return d;if(p.fadingParentID){const g=e._getLoadedTile(p.fadingParentID);if(!g)return d;const _=Math.pow(2,g.tileID.overscaledZ-p.tileID.overscaledZ),w=[p.tileID.canonical.x*_%1,p.tileID.canonical.y*_%1],S=(function(E,I,L){const R=Qe(),$=(R-I.timeAdded)/L,Z=E.fadingDirection===O.Incoming,K=u.ae((R-E.timeAdded)/L,0,1),Q=u.ae(1-$,0,1),J=Z?K:Q;return{tileOpacity:J,parentTileOpacity:Z?Q:K,fadeMix:{opacity:1,mix:1-J}}})(p,g,a);return{parentTile:g,parentScaleBy:_,parentTopLeft:w,fadeValues:S}}if(p.selfFading){const g=(function(_,w){const S=(Qe()-_.timeAdded)/w,E=u.ae(S,0,1);return{tileOpacity:E,fadeMix:{opacity:E,mix:0}}})(p,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:g}}return d}const ra=new u.bf(1,0,0,1),nu=new u.bf(0,1,0,1),Ms=new u.bf(0,0,1,1),Js=new u.bf(1,0,1,1),eo=new u.bf(0,1,1,1);function to(p,e,a,l){ba(p,0,e+a/2,p.transform.width,a,l)}function io(p,e,a,l){ba(p,e-a/2,0,a,p.transform.height,l)}function ba(p,e,a,l,d,g){const _=p.context,w=_.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*p.pixelRatio,a*p.pixelRatio,l*p.pixelRatio,d*p.pixelRatio),_.clear({color:g}),w.disable(w.SCISSOR_TEST)}function os(p,e,a){const l=p.context,d=l.gl,g=p.useProgram("debug"),_=Xt.disabled,w=ai.disabled,S=p.colorModeForRenderPass(),E="$debug",I=p.style.map.terrain&&p.style.map.terrain.getTerrainData(a);l.activeTexture.set(d.TEXTURE0);const L=e.getTileByID(a.key).latestRawTileData,R=Math.floor((L&&L.byteLength||0)/1024),$=e.getTile(a).tileSize,Z=512/Math.min($,512)*(a.overscaledZ/p.transform.zoom)*.5;let K=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(K+=` => ${a.overscaledZ}`),(function(J,oe){J.initDebugOverlayCanvas();const he=J.debugOverlayCanvas,se=J.context.gl,de=J.debugOverlayCanvas.getContext("2d");de.clearRect(0,0,he.width,he.height),de.shadowColor="white",de.shadowBlur=2,de.lineWidth=1.5,de.strokeStyle="white",de.textBaseline="top",de.font="bold 36px Open Sans, sans-serif",de.fillText(oe,5,5),de.strokeText(oe,5,5),J.debugOverlayTexture.update(he),J.debugOverlayTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE)})(p,`${K} ${R}kB`);const Q=p.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(l,d.TRIANGLES,_,w,Hi.alphaBlended,pi.disabled,Vh(u.bf.transparent,Z),null,Q,E,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),g.draw(l,d.LINE_STRIP,_,w,S,pi.disabled,Vh(u.bf.red),I,Q,E,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function ls(p,e,a,l){const{isRenderingGlobe:d}=l,g=p.context,_=g.gl,w=p.transform,S=p.colorModeForRenderPass(),E=p.getDepthModeFor3D(),I=p.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,p.width,p.height]);for(const L of a){const R=e.getTerrainMesh(L.tileID),$=p.renderToTexture.getTexture(L),Z=e.getTerrainData(L.tileID);g.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,$.texture);const K=e.getMeshFrameDelta(w.zoom),Q=w.calculateFogMatrix(L.tileID.toUnwrapped()),J=Ou(K,Q,p.style.sky,w.pitch,d),oe=w.getProjectionData({overscaledTileID:L.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});I.draw(g,_.TRIANGLES,E,ai.disabled,S,pi.backCCW,J,Z,oe,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}function Va(p,e){if(!e.mesh){const a=new u.aL;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const l=new u.aN;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new La(p.createVertexBuffer(a,ti.members),p.createIndexBuffer(l),u.aM.simpleSegment(0,0,a.length,l.length))}return e.mesh}class au{constructor(e,a){this.context=new Ys(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.ai(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ki.maxUnderzooming+ki.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zs}resize(e,a,l){if(this.width=Math.floor(e*l),this.height=Math.floor(a*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,a=new u.aL;a.emplaceBack(0,0),a.emplaceBack(u.$,0),a.emplaceBack(0,u.$),a.emplaceBack(u.$,u.$),this.tileExtentBuffer=e.createVertexBuffer(a,ti.members),this.tileExtentSegments=u.aM.simpleSegment(0,0,4,2);const l=new u.aL;l.emplaceBack(0,0),l.emplaceBack(u.$,0),l.emplaceBack(0,u.$),l.emplaceBack(u.$,u.$),this.debugBuffer=e.createVertexBuffer(l,ti.members),this.debugSegments=u.aM.simpleSegment(0,0,4,5);const d=new u.c7;d.emplaceBack(0,0,0,0),d.emplaceBack(u.$,0,u.$,0),d.emplaceBack(0,u.$,0,u.$),d.emplaceBack(u.$,u.$,u.$,u.$),this.rasterBoundsBuffer=e.createVertexBuffer(d,ju.members),this.rasterBoundsSegments=u.aM.simpleSegment(0,0,4,2);const g=new u.aL;g.emplaceBack(0,0),g.emplaceBack(u.$,0),g.emplaceBack(0,u.$),g.emplaceBack(u.$,u.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,ti.members),this.rasterBoundsSegmentsPosOnly=u.aM.simpleSegment(0,0,4,5);const _=new u.aL;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(_,ti.members),this.viewportSegments=u.aM.simpleSegment(0,0,4,2);const w=new u.c8;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const S=new u.aN;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const E=this.context.gl;this.stencilClearMode=new ai({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.tileExtentMesh=new La(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=u.L();u.bZ(l,0,this.width,this.height,0,0,1),u.N(l,l,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const d={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,a.TRIANGLES,Xt.disabled,this.stencilClearMode,Hi.disabled,pi.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source,this.nextStencilID+a.length>256&&this.clearStencil();const d=this.context;d.setColorMode(Hi.disabled),d.setDepthMode(Xt.disabled);const g={};for(const _ of a)g[_.key]=this.nextStencilID++;this._renderTileMasks(g,a,l,!0),this._renderTileMasks(g,a,l,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,a,l,d){const g=this.context,_=g.gl,w=this.style.projection,S=this.transform,E=this.useProgram("clippingMask");for(const I of a){const L=e[I.key],R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),$=w.getMeshFromTileID(this.context,I.canonical,d,!0,"stencil"),Z=S.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!l,applyTerrainMatrix:!0});E.draw(g,_.TRIANGLES,Xt.disabled,new ai({func:_.ALWAYS,mask:0},L,255,_.KEEP,_.KEEP,_.REPLACE),Hi.disabled,l?pi.disabled:pi.backCCW,null,R,Z,"$clipping",$.vertexBuffer,$.indexBuffer,$.segments)}}_renderTilesDepthBuffer(){const e=this.context,a=e.gl,l=this.style.projection,d=this.transform,g=this.useProgram("depth"),_=this.getDepthModeFor3D(),w=zt(d,{tileSize:d.tileSize});for(const S of w){const E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),I=l.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),L=d.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,a.TRIANGLES,_,ai.disabled,Hi.disabled,pi.backCCW,null,E,L,"$clipping",I.vertexBuffer,I.indexBuffer,I.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new ai({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new ai({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const a=this.context.gl,l=e.sort(((_,w)=>w.overscaledZ-_.overscaledZ)),d=l[l.length-1].overscaledZ,g=l[0].overscaledZ-d+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const _={};for(let w=0;w<g;w++)_[w+d]=new ai({func:a.GEQUAL,mask:255},w+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[_,l]}return[{[d]:ai.disabled},l]}stencilConfigForOverlapTwoPass(e){const a=this.context.gl,l=e.sort(((_,w)=>w.overscaledZ-_.overscaledZ)),d=l[l.length-1].overscaledZ,g=l[0].overscaledZ-d+1;if(this.clearStencil(),g>1){const _={},w={};for(let S=0;S<g;S++)_[S+d]=new ai({func:a.GREATER,mask:255},g+1+S,255,a.KEEP,a.KEEP,a.REPLACE),w[S+d]=new ai({func:a.GREATER,mask:255},1+S,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*g+1,[_,w,l]}return this.nextStencilID=3,[{[d]:new ai({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[d]:new ai({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Hi([e.CONSTANT_COLOR,e.ONE],new u.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Hi.unblended:Hi.alphaBlended}getDepthModeForSublayer(e,a,l){if(!this.opaquePassEnabledForLayer())return Xt.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Xt(l||this.context.gl.LEQUAL,a,[d,d])}getDepthModeFor3D(){return new Xt(this.context.gl.LEQUAL,Xt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){var l,d;this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Qe()),this.imageManager.beginFrame();const g=this.style._order,_=this.style.sourceCaches,w={},S={},E={},I={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const R in _){const $=_[R];$.used&&$.prepare(this.context),w[R]=$.getVisibleCoordinates(!1),S[R]=w[R].slice().reverse(),E[R]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<g.length;R++)if(this.style._layers[g[R]].is3D()){this.opaquePassCutoff=R;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const R of g){const $=this.style._layers[R];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const Z=S[$.source];($.type==="custom"||Z.length)&&this.renderLayer(this,_[$.source],$,Z,I)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:R=>this.useProgram(R)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?u.bf.black:u.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(R,$){const Z=R.context,K=Z.gl,Q=((ge,ce,Te)=>{const Oe=Math.cos(ce.rollInRadians),Re=Math.sin(ce.rollInRadians),Le=Se(ce),Be=ce.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ge.properties.get("sky-color"),u_horizon_color:ge.properties.get("horizon-color"),u_horizon:[(ce.width/2-Le*Re)*Te,(ce.height/2+Le*Oe)*Te],u_horizon_normal:[-Re,Oe],u_sky_horizon_blend:ge.properties.get("sky-horizon-blend")*ce.height/2*Te,u_sky_blend:Be}})($,R.style.map.transform,R.pixelRatio),J=new Xt(K.LEQUAL,Xt.ReadWrite,[0,1]),oe=ai.disabled,he=R.colorModeForRenderPass(),se=R.useProgram("sky"),de=Va(Z,$);se.draw(Z,K.TRIANGLES,J,oe,he,pi.disabled,Q,null,void 0,"sky",de.vertexBuffer,de.indexBuffer,de.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[g[this.currentLayer]],$=_[R.source],Z=w[R.source];this._renderTileClippingMasks(R,Z,!1),this.renderLayer(this,$,R,Z,I)}this.renderPass="translucent";let L=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const R=this.style._layers[g[this.currentLayer]],$=_[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R,I))continue;this.opaquePassEnabledForLayer()||L||(L=!0,I.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(R.type==="symbol"?E:S)[R.source];this._renderTileClippingMasks(R,w[R.source],!!this.renderToTexture),this.renderLayer(this,$,R,Z,I)}if(I.isRenderingGlobe&&(function(R,$,Z){const K=R.context,Q=K.gl,J=R.useProgram("atmosphere"),oe=new Xt(Q.LEQUAL,Xt.ReadOnly,[0,1]),he=R.transform,se=(function(Be,nt){const at=Be.properties.get("position"),et=[-at.x,-at.y,-at.z],bt=u.ai(new Float64Array(16));return Be.properties.get("anchor")==="map"&&(u.b6(bt,bt,nt.rollInRadians),u.b7(bt,bt,-nt.pitchInRadians),u.b6(bt,bt,nt.bearingInRadians),u.b7(bt,bt,nt.center.lat*Math.PI/180),u.bz(bt,bt,-nt.center.lng*Math.PI/180)),u.c6(et,et,bt),et})(Z,R.transform),de=he.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ge=$.properties.get("atmosphere-blend")*de.projectionTransition;if(ge===0)return;const ce=Hs(he.worldSize,he.center.lat),Te=he.inverseProjectionMatrix,Oe=new Float64Array(4);Oe[3]=1,u.aw(Oe,Oe,he.modelViewProjectionMatrix),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1,u.aw(Oe,Oe,Te),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1;const Re=((Be,nt,at,et,bt)=>({u_sun_pos:Be,u_atmosphere_blend:nt,u_globe_position:at,u_globe_radius:et,u_inv_proj_matrix:bt}))(se,ge,[Oe[0],Oe[1],Oe[2]],ce,Te),Le=Va(K,$);J.draw(K,Q.TRIANGLES,oe,ai.disabled,Hi.alphaBlended,pi.disabled,Re,null,null,"atmosphere",Le.vertexBuffer,Le.indexBuffer,Le.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const R=(function($,Z){let K=null;const Q=Object.values($._layers).flatMap((se=>se.source&&!se.isHidden(Z)?[$.sourceCaches[se.source]]:[])),J=Q.filter((se=>se.getSource().type==="vector")),oe=Q.filter((se=>se.getSource().type!=="vector")),he=se=>{(!K||K.getSource().maxzoom<se.getSource().maxzoom)&&(K=se)};return J.forEach((se=>he(se))),K||oe.forEach((se=>he(se))),K})(this.style,this.transform.zoom);R&&(function($,Z,K){for(let Q=0;Q<K.length;Q++)os($,Z,K[Q])})(this,R,R.getVisibleCoordinates())}this.options.showPadding&&(function(R){const $=R.transform.padding;to(R,R.transform.height-($.top||0),3,ra),to(R,$.bottom||0,3,nu),io(R,$.left||0,3,Ms),io(R,R.transform.width-($.right||0),3,Js);const Z=R.transform.centerPoint;(function(K,Q,J,oe){ba(K,Q-1,J-10,2,20,oe),ba(K,Q-10,J-1,20,2,oe)})(R,Z.x,R.transform.height-Z.y,eo)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!u.c9(a,l):!u.ca(a,l)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(u.cb(a,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,_){const w=g.context,S=w.gl,E=g.transform,I=Hi.unblended,L=new Xt(S.LEQUAL,Xt.ReadWrite,[0,1]),R=_.sourceCache.getRenderableTiles(),$=g.useProgram("terrainDepth");w.bindFramebuffer.set(_.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:u.bf.transparent,depth:1});for(const Z of R){const K=_.getTerrainMesh(Z.tileID),Q=_.getTerrainData(Z.tileID),J=E.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),oe={u_ele_delta:_.getMeshFrameDelta(E.zoom)};$.draw(w,S.TRIANGLES,L,ai.disabled,I,pi.backCCW,oe,Q,J,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,_){const w=g.context,S=w.gl,E=g.transform,I=Hi.unblended,L=new Xt(S.LEQUAL,Xt.ReadWrite,[0,1]),R=_.getCoordsTexture(),$=_.sourceCache.getRenderableTiles(),Z=g.useProgram("terrainCoords");w.bindFramebuffer.set(_.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:u.bf.transparent,depth:1}),_.coordsIndex=[];for(const K of $){const Q=_.getTerrainMesh(K.tileID),J=_.getTerrainData(K.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,R.texture);const oe={u_terrain_coords_id:(255-_.coordsIndex.length)/255,u_texture:0,u_ele_delta:_.getMeshFrameDelta(E.zoom)},he=E.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(w,S.TRIANGLES,L,ai.disabled,I,pi.backCCW,oe,J,he,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),_.coordsIndex.push(K.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,a,l,d,g){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(d||[]).length)&&(this.id=l.id,u.cc(l)?(function(_,w,S,E,I,L){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:R}=L,$=ai.disabled,Z=_.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(K,Q,J,oe,he,se,de,ge,ce){const Te=Q.transform,Oe=Q.style.map.terrain,Re=he==="map",Le=se==="map";for(const Be of K){const nt=oe.getTile(Be),at=nt.getBucket(J);if(!at||!at.text||!at.text.segments.get().length)continue;const et=u.an(at.textSizeData,Te.zoom),bt=u.aC(nt,1,Q.transform.zoom),Wt=pe(Re,Q.transform,bt),Ai=J.layout.get("icon-text-fit")!=="none"&&at.hasIconData();if(et){const Qi=Math.pow(2,Te.zoom-nt.tileID.overscaledZ),tr=Oe?(ci,ir)=>Oe.getElevation(Be,ci,ir):null;Ks(at,Re,Le,ce,Te,Wt,Qi,et,Ai,u.aD(Te,nt,de,ge),Be.toUnwrapped(),tr)}}})(E,_,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),I),S.paint.get("icon-opacity").constantOr(1)!==0&&Qs(_,w,S,E,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),$,Z,R),S.paint.get("text-opacity").constantOr(1)!==0&&Qs(_,w,S,E,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),$,Z,R),w.map.showCollisionBoxes&&(sc(_,w,S,E,!0),sc(_,w,S,E,!1))})(e,a,l,d,this.style.placement.variableOffsets,g):u.cd(l)?(function(_,w,S,E,I){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:L}=I,R=S.paint.get("circle-opacity"),$=S.paint.get("circle-stroke-width"),Z=S.paint.get("circle-stroke-opacity"),K=!S.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&($.constantOr(1)===0||Z.constantOr(1)===0))return;const Q=_.context,J=Q.gl,oe=_.transform,he=_.getDepthModeForSublayer(0,Xt.ReadOnly),se=ai.disabled,de=_.colorModeForRenderPass(),ge=[],ce=oe.getCircleRadiusCorrection();for(let Te=0;Te<E.length;Te++){const Oe=E[Te],Re=w.getTile(Oe),Le=Re.getBucket(S);if(!Le)continue;const Be=S.paint.get("circle-translate"),nt=S.paint.get("circle-translate-anchor"),at=u.aD(oe,Re,Be,nt),et=Le.programConfigurations.get(S.id),bt=_.useProgram("circle",et),Wt=Le.layoutVertexBuffer,Ai=Le.indexBuffer,Qi=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Oe),tr={programConfiguration:et,program:bt,layoutVertexBuffer:Wt,indexBuffer:Ai,uniformValues:Ba(_,Re,S,at,ce),terrainData:Qi,projectionData:oe.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!L,applyTerrainMatrix:!0})};if(K){const ci=Le.segments.get();for(const ir of ci)ge.push({segments:new u.aM([ir]),sortKey:ir.sortKey,state:tr})}else ge.push({segments:Le.segments,sortKey:0,state:tr})}K&&ge.sort(((Te,Oe)=>Te.sortKey-Oe.sortKey));for(const Te of ge){const{programConfiguration:Oe,program:Re,layoutVertexBuffer:Le,indexBuffer:Be,uniformValues:nt,terrainData:at,projectionData:et}=Te.state;Re.draw(Q,J.TRIANGLES,he,se,de,pi.backCCW,nt,at,et,S.id,Le,Be,Te.segments,S.paint,_.transform.zoom,Oe)}})(e,a,l,d,g):u.ce(l)?(function(_,w,S,E,I){if(S.paint.get("heatmap-opacity")===0)return;const L=_.context,{isRenderingToTexture:R,isRenderingGlobe:$}=I;if(_.style.map.terrain){for(const Z of E){const K=w.getTile(Z);w.hasRenderableParent(Z)||(_.renderPass==="offscreen"?Ln(_,K,S,Z,$):_.renderPass==="translucent"&&pn(_,S,Z,R,$))}L.viewport.set([0,0,_.width,_.height])}else _.renderPass==="offscreen"?(function(Z,K,Q,J){const oe=Z.context,he=oe.gl,se=Z.transform,de=ai.disabled,ge=new Hi([he.ONE,he.ONE],u.bf.transparent,[!0,!0,!0,!0]);(function(ce,Te,Oe){const Re=ce.gl;ce.activeTexture.set(Re.TEXTURE1),ce.viewport.set([0,0,Te.width/4,Te.height/4]);let Le=Oe.heatmapFbos.get(u.c3);Le?(Re.bindTexture(Re.TEXTURE_2D,Le.colorAttachment.get()),ce.bindFramebuffer.set(Le.framebuffer)):(Le=Ua(ce,Te.width/4,Te.height/4),Oe.heatmapFbos.set(u.c3,Le))})(oe,Z,Q),oe.clear({color:u.bf.transparent});for(let ce=0;ce<J.length;ce++){const Te=J[ce];if(K.hasRenderableParent(Te))continue;const Oe=K.getTile(Te),Re=Oe.getBucket(Q);if(!Re)continue;const Le=Re.programConfigurations.get(Q.id),Be=Z.useProgram("heatmap",Le),nt=se.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),at=se.getCircleRadiusCorrection();Be.draw(oe,he.TRIANGLES,Xt.disabled,de,ge,pi.backCCW,Hc(Oe,se.zoom,Q.paint.get("heatmap-intensity"),at),null,nt,Q.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,Q.paint,se.zoom,Le)}oe.viewport.set([0,0,Z.width,Z.height])})(_,w,S,E):_.renderPass==="translucent"&&(function(Z,K){const Q=Z.context,J=Q.gl;Q.setColorMode(Z.colorModeForRenderPass());const oe=K.heatmapFbos.get(u.c3);oe&&(Q.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,oe.colorAttachment.get()),Q.activeTexture.set(J.TEXTURE1),$a(Q,K).bind(J.LINEAR,J.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(Q,J.TRIANGLES,Xt.disabled,ai.disabled,Z.colorModeForRenderPass(),pi.disabled,Ql(Z,K,0,1),null,null,K.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,K.paint,Z.transform.zoom))})(_,S)})(e,a,l,d,g):u.cf(l)?(function(_,w,S,E,I){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:L}=I,R=S.paint.get("line-opacity"),$=S.paint.get("line-width");if(R.constantOr(1)===0||$.constantOr(1)===0)return;const Z=_.getDepthModeForSublayer(0,Xt.ReadOnly),K=_.colorModeForRenderPass(),Q=S.paint.get("line-dasharray"),J=Q.constantOr(1),oe=S.paint.get("line-pattern"),he=oe.constantOr(1),se=S.paint.get("line-gradient"),de=S.getCrossfadeParameters();let ge;ge=he?"linePattern":J&&se?"lineGradientSDF":J?"lineSDF":se?"lineGradient":"line";const ce=_.context,Te=ce.gl,Oe=_.transform;let Re=!0;for(const Le of E){const Be=w.getTile(Le);if(he&&!Be.patternsLoaded())continue;const nt=Be.getBucket(S);if(!nt)continue;const at=nt.programConfigurations.get(S.id),et=_.context.program.get(),bt=_.useProgram(ge,at),Wt=Re||bt.program!==et,Ai=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Le),Qi=oe.constantOr(null),tr=Q&&Q.constantOr(null);if(Qi&&Be.imageAtlas){const Kr=Be.imageAtlas,kr=Kr.patternPositions[Qi.to.toString()],zr=Kr.patternPositions[Qi.from.toString()];kr&&zr&&at.setConstantPatternPositions(kr,zr)}else if(tr){const Kr=S.layout.get("line-cap")==="round",kr=_.lineAtlas.getDash(tr.to,Kr),zr=_.lineAtlas.getDash(tr.from,Kr);at.setConstantDashPositions(kr,zr)}const ci=Oe.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),ir=Oe.getPixelScale();let Ur;he?(Ur=Xc(_,Be,S,ir,de),Ts(ce,Te,Be,at,de)):J&&se?(Ur=Zh(_,Be,S,ir,de,nt.lineClipsArray.length),lc(_,w,ce,Te,S,nt,Le,at,de)):J?(Ur=Io(_,Be,S,ir,de),Ku(_,ce,Te,at,Wt,de)):se?(Ur=Fu(_,Be,S,ir,nt.lineClipsArray.length),Ml(_,w,ce,Te,S,nt,Le)):Ur=Na(_,Be,S,ir);const _r=_.stencilModeForClipping(Le);bt.draw(ce,Te.TRIANGLES,Z,_r,K,pi.disabled,Ur,Ai,ci,S.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,S.paint,_.transform.zoom,at,nt.layoutVertexBuffer2),Re=!1}})(e,a,l,d,g):u.cg(l)?(function(_,w,S,E,I){const L=S.paint.get("fill-color"),R=S.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const{isRenderingToTexture:$}=I,Z=_.colorModeForRenderPass(),K=S.paint.get("fill-pattern"),Q=_.opaquePassEnabledForLayer()&&!K.constantOr(1)&&L.constantOr(u.bf.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===Q){const J=_.getDepthModeForSublayer(1,_.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly);Yr(_,w,S,E,J,Z,!1,$)}if(_.renderPass==="translucent"&&S.paint.get("fill-antialias")){const J=_.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly);Yr(_,w,S,E,J,Z,!0,$)}})(e,a,l,d,g):u.ch(l)?(function(_,w,S,E,I){const L=S.paint.get("fill-extrusion-opacity");if(L===0)return;const{isRenderingToTexture:R}=I;if(_.renderPass==="translucent"){const $=new Xt(_.context.gl.LEQUAL,Xt.ReadWrite,_.depthRangeFor3D);if(L!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))Xi(_,w,S,E,$,ai.disabled,Hi.disabled,R),Xi(_,w,S,E,$,_.stencilModeFor3D(),_.colorModeForRenderPass(),R);else{const Z=_.colorModeForRenderPass();Xi(_,w,S,E,$,ai.disabled,Z,R)}}})(e,a,l,d,g):u.ci(l)?(function(_,w,S,E,I){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const{isRenderingToTexture:L}=I,R=_.context,$=_.style.projection.useSubdivision,Z=_.getDepthModeForSublayer(0,Xt.ReadOnly),K=_.colorModeForRenderPass();if(_.renderPass==="offscreen")(function(Q,J,oe,he,se,de,ge){const ce=Q.context,Te=ce.gl;for(const Oe of oe){const Re=J.getTile(Oe),Le=Re.dem;if(!Le||!Le.data||!Re.needsHillshadePrepare)continue;const Be=Le.dim,nt=Le.stride,at=Le.getPixels();if(ce.activeTexture.set(Te.TEXTURE1),ce.pixelStoreUnpackPremultiplyAlpha.set(!1),Re.demTexture=Re.demTexture||Q.getTileTexture(nt),Re.demTexture){const bt=Re.demTexture;bt.update(at,{premultiply:!1}),bt.bind(Te.NEAREST,Te.CLAMP_TO_EDGE)}else Re.demTexture=new u.T(ce,at,Te.RGBA,{premultiply:!1}),Re.demTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);ce.activeTexture.set(Te.TEXTURE0);let et=Re.fbo;if(!et){const bt=new u.T(ce,{width:Be,height:Be,data:null},Te.RGBA);bt.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),et=Re.fbo=ce.createFramebuffer(Be,Be,!0,!1),et.colorAttachment.set(bt.texture)}ce.bindFramebuffer.set(et.framebuffer),ce.viewport.set([0,0,Be,Be]),Q.useProgram("hillshadePrepare").draw(ce,Te.TRIANGLES,se,de,ge,pi.disabled,xl(Re.tileID,Le),null,null,he.id,Q.rasterBoundsBuffer,Q.quadTriangleIndexBuffer,Q.rasterBoundsSegments),Re.needsHillshadePrepare=!1}})(_,w,E,S,Z,ai.disabled,K),R.viewport.set([0,0,_.width,_.height]);else if(_.renderPass==="translucent")if($){const[Q,J,oe]=_.stencilConfigForOverlapTwoPass(E);bi(_,w,S,oe,Q,Z,K,!1,L),bi(_,w,S,oe,J,Z,K,!0,L)}else{const[Q,J]=_.getStencilConfigForOverlapAndUpdateStencilID(E);bi(_,w,S,J,Q,Z,K,!1,L)}})(e,a,l,d,g):u.cj(l)?(function(_,w,S,E,I){if(_.renderPass!=="translucent"||!E.length)return;const{isRenderingToTexture:L}=I,R=_.style.projection.useSubdivision,$=_.getDepthModeForSublayer(0,Xt.ReadOnly),Z=_.colorModeForRenderPass();if(R){const[K,Q,J]=_.stencilConfigForOverlapTwoPass(E);ss(_,w,S,J,K,$,Z,!1,L),ss(_,w,S,J,Q,$,Z,!0,L)}else{const[K,Q]=_.getStencilConfigForOverlapAndUpdateStencilID(E);ss(_,w,S,Q,K,$,Z,!1,L)}})(e,a,l,d,g):u.bK(l)?(function(_,w,S,E,I){if(_.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!E.length)return;const{isRenderingToTexture:L}=I,R=w.getSource(),$=_.style.projection.useSubdivision;if(R instanceof Hr)or(_,w,S,E,null,!1,!1,R.tileCoords,R.flippedWindingOrder,L);else if($){const[Z,K,Q]=_.stencilConfigForOverlapTwoPass(E);or(_,w,S,Q,Z,!1,!0,On,!1,L),or(_,w,S,Q,K,!0,!0,On,!1,L)}else{const[Z,K]=_.getStencilConfigForOverlapAndUpdateStencilID(E);or(_,w,S,K,Z,!1,!0,On,!1,L)}})(e,a,l,d,g):u.ck(l)?(function(_,w,S,E,I){const L=S.paint.get("background-color"),R=S.paint.get("background-opacity");if(R===0)return;const{isRenderingToTexture:$}=I,Z=_.context,K=Z.gl,Q=_.style.projection,J=_.transform,oe=J.tileSize,he=S.paint.get("background-pattern");if(_.isPatternMissing(he))return;const se=!he&&L.a===1&&R===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==se)return;const de=ai.disabled,ge=_.getDepthModeForSublayer(0,se==="opaque"?Xt.ReadWrite:Xt.ReadOnly),ce=_.colorModeForRenderPass(),Te=_.useProgram(he?"backgroundPattern":"background"),Oe=E||zt(J,{tileSize:oe,terrain:_.style.map.terrain});he&&(Z.activeTexture.set(K.TEXTURE0),_.imageManager.bind(_.context));const Re=S.getCrossfadeParameters();for(const Le of Oe){const Be=J.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),nt=he?Xs(R,_,he,{tileID:Le,tileSize:oe},Re):Gn(R,L),at=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Le),et=Q.getMeshFromTileID(Z,Le.canonical,!1,!0,"raster");Te.draw(Z,K.TRIANGLES,ge,de,ce,pi.backCCW,nt,at,Be,S.id,et.vertexBuffer,et.indexBuffer,et.segments)}})(e,0,l,d,g):u.cl(l)&&(function(_,w,S,E){const{isRenderingGlobe:I}=E,L=_.context,R=S.implementation,$=_.style.projection,Z=_.transform,K=Z.getProjectionDataForCustomLayer(I),Q={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:$.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${$.shaderPreludeCode.vertexSource}`,define:$.shaderDefine},defaultProjectionData:K},J=R.renderingMode?R.renderingMode:"2d";if(_.renderPass==="offscreen"){const oe=R.prerender;oe&&(_.setCustomLayerDefaults(),L.setColorMode(_.colorModeForRenderPass()),oe.call(R,L.gl,Q),L.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),L.setColorMode(_.colorModeForRenderPass()),L.setStencilMode(ai.disabled);const oe=J==="3d"?_.getDepthModeFor3D():_.getDepthModeForSublayer(0,Xt.ReadOnly);L.setDepthMode(oe),R.render(L.gl,Q),L.setDirty(),_.setBaseState(),L.bindFramebuffer.set(null)}})(e,0,l,g))}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!a||!l}useProgram(e,a,l=!1,d=[]){this.cache=this.cache||{};const g=!!this.style.map.terrain,_=this.style.projection,w=l?ga.projectionMercator:_.shaderPreludeCode,S=l?ya:_.shaderDefine,E=e+(a?a.cacheKey:"")+`/${l?Nc:_.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[E]||(this.cache[E]=new Yl(this.context,ga[e],a,Wc[e],this._showOverdrawInspector,g,w,S,d)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}function cc(p,e){let a,l=!1,d=null,g=null;const _=()=>{d=null,l&&(p.apply(g,a),d=setTimeout(_,e),l=!1)};return(...w)=>(l=!0,g=this,a=w,d||_(),d)}class na{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let l;return a.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(l=d)})),(l&&l[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:l,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const l=a.join("/");let d=l;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${l}`);let g=window.location.hash.replace(d,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let _=window.location.href.replace(/(#.+)?$/,g);_=_.replace("&&","&"),window.history.replaceState(window.history.state,null,_)},this._updateHash=cc(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const a=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,d=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,d),_=Math.round(a.lng*g)/g,w=Math.round(a.lat*g)/g,S=this._map.getBearing(),E=this._map.getPitch();let I="";if(I+=e?`/${_}/${w}/${l}`:`${l}/${w}/${_}`,(S||E)&&(I+="/"+Math.round(10*S)/10),E&&(I+=`/${Math.round(E)}`),this._hashName){const L=this._hashName;let R=!1;const $=window.location.hash.slice(1).split("&").map((Z=>{const K=Z.split("=")[0];return K===L?(R=!0,`${K}=${I}`):Z})).filter((Z=>Z));return R||$.push(`${L}=${I}`),`#${$.join("&")}`}return`#${I}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new u.S(+e[2],+e[1])}catch{return!1}const a=+e[0],l=+(e[3]||0),d=+(e[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&l>=-180&&l<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const ks={linearity:.3,easing:u.cm(0,0,.3,1)},ro=u.e({deceleration:2500,maxSpeed:1400},ks),sn=u.e({deceleration:20,maxSpeed:1400},ks),uc=u.e({deceleration:1e3,maxSpeed:360},ks),Qu=u.e({deceleration:1e3,maxSpeed:90},ks),Xh=u.e({deceleration:1e3,maxSpeed:360},ks);class Wh{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Qe(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=Qe();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,a.roll+=g.rollDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(a.pan.mag()){const g=lr(a.pan.mag(),l,u.e({},ro,e||{})),_=a.pan.mult(g.amount/a.pan.mag()),w=this._map.cameraHelper.handlePanInertia(_,this._map.transform);d.center=w.easingCenter,d.offset=w.easingOffset,kl(d,g)}if(a.zoom){const g=lr(a.zoom,l,sn);d.zoom=this._map.transform.zoom+g.amount,kl(d,g)}if(a.bearing){const g=lr(a.bearing,l,uc);d.bearing=this._map.transform.bearing+u.ae(g.amount,-179,179),kl(d,g)}if(a.pitch){const g=lr(a.pitch,l,Qu);d.pitch=this._map.transform.pitch+g.amount,kl(d,g)}if(a.roll){const g=lr(a.roll,l,Xh);d.roll=this._map.transform.roll+u.ae(g.amount,-179,179),kl(d,g)}if(d.zoom||d.bearing){const g=a.pinchAround===void 0?a.around:a.pinchAround;d.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),u.e(d,{noMoveStart:!0})}}function kl(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function lr(p,e,a){const{maxSpeed:l,linearity:d,deceleration:g}=a,_=u.ae(p*d/(e/1e3),-l,l),w=Math.abs(_)/(g*d);return{easing:a.easing,duration:1e3*w,amount:_*(w/2)}}class vn extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,l,d={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const g=ve.mousePos(a.getCanvas(),l),_=a.unproject(g);super(e,u.e({point:g,lngLat:_,originalEvent:l},d)),this._defaultPrevented=!1,this.target=a}}class Fr extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,l){const d=e==="touchend"?l.changedTouches:l.touches,g=ve.touchPos(a.getCanvasContainer(),d),_=g.map((S=>a.unproject(S))),w=g.reduce(((S,E,I,L)=>S.add(E.div(L.length))),new u.P(0,0));super(e,{points:g,point:w,lngLats:_,lngLat:a.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class bn extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class su{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new bn(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new vn(e.type,this._map,e))}mouseup(e){this._map.fire(new vn(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new vn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new vn(e.type,this._map,e))}mouseover(e){this._map.fire(new vn(e.type,this._map,e))}mouseout(e){this._map.fire(new vn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Fr(e.type,this._map,e))}touchmove(e){this._map.fire(new Fr(e.type,this._map,e))}touchend(e){this._map.fire(new Fr(e.type,this._map,e))}touchcancel(e){this._map.fire(new Fr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new vn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new vn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(u.P.convert(e),this._map.terrain)}}class Yh{constructor(e,a){this._map=e,this._tr=new Bn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(ve.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const l=a;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=l,this._box||(this._box=ve.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const g=Math.min(d.x,l.x),_=Math.max(d.x,l.x),w=Math.min(d.y,l.y),S=Math.max(d.y,l.y);ve.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=_-g+"px",this._box.style.height=S-w+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const l=this._startPos,d=a;if(this.reset(),ve.suppressClick(),l.x!==d.x||l.y!==d.y)return this._map.fire(new u.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(l,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ve.remove(this._box),this._box=null),ve.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new u.l(e,{originalEvent:a}))}}function ou(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const a={};for(let l=0;l<p.length;l++)a[p[l].identifier]=e[l];return a}class Ud{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(d){const g=new u.P(0,0);for(const _ of d)g._add(_);return g.div(d.length)})(a),this.touches=ou(l,a)))}touchmove(e,a,l){if(this.aborted||!this.centroid)return;const d=ou(l,a);for(const g in this.touches){const _=d[g];(!_||_.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,a,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class lu{constructor(e){this.singleTap=new Ud(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,l){this.singleTap.touchstart(e,a,l)}touchmove(e,a,l){this.singleTap.touchmove(e,a,l)}touchend(e,a,l){const d=this.singleTap.touchend(e,a,l);if(d){const g=e.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(d)<30;if(g&&_||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class no{constructor(e){this._tr=new Bn(e),this._zoomIn=new lu({numTouches:1,numTaps:2}),this._zoomOut=new lu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,l){this._zoomIn.touchstart(e,a,l),this._zoomOut.touchstart(e,a,l)}touchmove(e,a,l){this._zoomIn.touchmove(e,a,l),this._zoomOut.touchmove(e,a,l)}touchend(e,a,l){const d=this._zoomIn.touchend(e,a,l),g=this._zoomOut.touchend(e,a,l),_=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(d)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ga{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=Array.isArray(a)?a[0]:a;return!this._moved&&d.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(l,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&ve.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const wa=0,_t=2,No={[wa]:1,[_t]:2};class Cs{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=ve.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(a,l){const d=No[l];return a.buttons===void 0||(a.buttons&d)!==d})(e,this._eventButton)}isValidEndEvent(e){return ve.mouseButton(e)===this._eventButton}}class hc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class ao{constructor(e=new Cs({checkCorrectEvent:()=>!0}),a=new hc){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(e,a,l){return e instanceof MouseEvent?a(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Es=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}};class cu{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,l){return this._calculateTransform(e,a,l)}touchmove(e,a,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,a,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,l){this._calculateTransform(e,a,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,l){l.length>0&&(this._active=!0);const d=ou(l,a),g=new u.P(0,0),_=new u.P(0,0);let w=0;for(const E in d){const I=d[E],L=this._touches[E];L&&(g._add(I),_._add(I.sub(L)),w++,d[E]=I)}if(this._touches=d,this._shouldBePrevented(w)||!_.mag())return;const S=_.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class si{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,l){if(!this._firstTwoTouches)return;e.preventDefault();const[d,g]=this._firstTwoTouches,_=Sa(l,a,d),w=Sa(l,a,g);if(!_||!w)return;const S=this._aroundCenter?null:_.add(w).div(2);return this._move([_,w],S,e)}touchend(e,a,l){if(!this._firstTwoTouches)return;const[d,g]=this._firstTwoTouches,_=Sa(l,a,d),w=Sa(l,a,g);_&&w||(this._active&&ve.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Sa(p,e,a){for(let l=0;l<p.length;l++)if(p[l].identifier===a)return e[l]}function Ju(p,e){return Math.log(p/e)/Math.LN2}class dc extends si{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ju(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ju(this._distance,l),pinchAround:a}}}function Fo(p,e){return 180*p.angleWith(e)/Math.PI}class Cl extends si{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,l){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Fo(this._vector,d),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,l=Fo(e,this._startVector);return Math.abs(l)<a}}function Uo(p){return Math.abs(p.y)>Math.abs(p.x)}class so extends si{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,l){super.touchstart(e,a,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Uo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,g,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,l){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,g=a.mag()>=2;if(!d&&!g)return;if(!d||!g)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const _=e.y>0==a.y>0;return Uo(e)&&Uo(a)&&_}}const pc={panStep:100,bearingStep:15,pitchStep:10};class eh{constructor(e){this._tr=new Bn(e);const a=pc;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,l=0,d=0,g=0,_=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),_=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(l=0,d=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:oo,zoom:a?Math.round(S.zoom)+a*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+d*this._pitchStep,offset:[-g*this._panStep,-_*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function oo(p){return p*(2-p)}const th=4.000244140625,lo=1/450;class Za{constructor(e,a){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Bn(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=lo}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=Qe(),d=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,a!==0&&a%th==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ve.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(u.S.convert(l.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>th?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&S!==0&&(S=1/S);const E=typeof this._targetZoom!="number"?e.scale:u.ah(this._targetZoom);this._targetZoom=e.constrain(e.getCameraLngLat(),u.ak(E*S)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,d=this._easing;let g,_=!1;if(this._type==="wheel"&&l&&d){const w=Qe()-this._lastWheelEventTime,S=Math.min((w+5)/200,1),E=d(S);g=u.C.number(l,a,E),S<1?this._frameId||(this._frameId=!0):_=!0}else g=a,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!_,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=u.co;if(this._prevEase){const l=this._prevEase,d=(Qe()-l.start)/l.duration,g=l.easing(d+.01)-l.easing(d),_=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-_*_);a=u.cm(_,w,.25,1)}return this._prevEase={start:Qe(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Vi{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class co{constructor(e){this._tr=new Bn(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qa{constructor(){this._tap=new lu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,l){if(!this._swipePoint)if(this._tapTime){const d=a[0],g=e.timeStamp-this._tapTime<500,_=this._tapPoint.dist(d)<30;g&&_?l.length>0&&(this._swipePoint=d,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,a,l)}touchmove(e,a,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const d=a[0],g=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,a,l)}touchend(e,a,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const d=this._tap.touchend(e,a,l);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uo{constructor(e,a,l){this._el=e,this._mousePan=a,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fc{constructor(e,a,l,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=a,this._mousePitch=l,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class mc{constructor(e,a,l,d){this._el=e,this._touchZoom=a,this._touchRotate=l,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $o{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=ve.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=a,this._container.appendChild(d);const g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=l,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ve.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new u.l("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ho=p=>p.zoom||p.drag||p.roll||p.pitch||p.rotate;class Ha extends u.l{}function Vo(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta||p.rollDelta}class Mt{constructor(e,a){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,g)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=d.type==="renderFrame"?void 0:d,w={needsRenderFrame:!1},S={},E={};for(const{handlerName:R,handler:$,allowed:Z}of this._handlers){if(!$.isEnabled())continue;let K;if(this._blockedByActive(E,Z,R))$.reset();else if($[g||d.type]){if(u.cp(d,g||d.type)){const Q=ve.mousePos(this._map.getCanvas(),d);K=$[g||d.type](d,Q)}else if(u.cq(d,g||d.type)){const Q=this._getMapTouches(d.touches),J=ve.touchPos(this._map.getCanvas(),Q);K=$[g||d.type](d,J,Q)}else u.cr(g||d.type)||(K=$[g||d.type](d));this.mergeHandlerResult(w,S,K,R,_),K&&K.needsRenderFrame&&this._triggerRenderFrame()}(K||$.isActive())&&(E[R]=$)}const I={};for(const R in this._previousActiveHandlers)E[R]||(I[R]=_);this._previousActiveHandlers=E,(Object.keys(I).length||Vo(w))&&(this._changes.push([w,S,I]),this._triggerRenderFrame()),(Object.keys(E).length||Vo(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=w;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wh(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,g,_]of this._listeners)ve.addEventListener(d,g,d===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[e,a,l]of this._listeners)ve.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const a=this._map,l=a.getCanvasContainer();this._add("mapEvent",new su(a,e));const d=a.boxZoom=new Yh(a,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const g=a.cooperativeGestures=new $o(a,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();const _=new no(a),w=new co(a);a.doubleClickZoom=new Vi(w,_),this._add("tapZoom",_),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const S=new qa;this._add("tapDragZoom",S);const E=a.touchPitch=new so(a);this._add("touchPitch",E),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const I=()=>a.project(a.getCenter()),L=(function({enable:se,clickTolerance:de,aroundCenter:ge=!0,minPixelCenterThreshold:ce=100,rotateDegreesPerPixelMoved:Te=.8},Oe){const Re=new Cs({checkCorrectEvent:Le=>ve.mouseButton(Le)===0&&Le.ctrlKey||ve.mouseButton(Le)===2&&!Le.ctrlKey});return new Ga({clickTolerance:de,move:(Le,Be)=>{const nt=Oe();if(ge&&Math.abs(nt.y-Le.y)>ce)return{bearingDelta:u.cn(new u.P(Le.x,Be.y),Be,nt)};let at=(Be.x-Le.x)*Te;return ge&&Be.y<nt.y&&(at=-at),{bearingDelta:at}},moveStateManager:Re,enable:se,assignEvents:Es})})(e,I),R=(function({enable:se,clickTolerance:de,pitchDegreesPerPixelMoved:ge=-.5}){const ce=new Cs({checkCorrectEvent:Te=>ve.mouseButton(Te)===0&&Te.ctrlKey||ve.mouseButton(Te)===2});return new Ga({clickTolerance:de,move:(Te,Oe)=>({pitchDelta:(Oe.y-Te.y)*ge}),moveStateManager:ce,enable:se,assignEvents:Es})})(e),$=(function({enable:se,clickTolerance:de,rollDegreesPerPixelMoved:ge=.3},ce){const Te=new Cs({checkCorrectEvent:Oe=>ve.mouseButton(Oe)===2&&Oe.ctrlKey});return new Ga({clickTolerance:de,move:(Oe,Re)=>{const Le=ce();let Be=(Re.x-Oe.x)*ge;return Re.y<Le.y&&(Be=-Be),{rollDelta:Be}},moveStateManager:Te,enable:se,assignEvents:Es})})(e,I);a.dragRotate=new fc(e,L,R,$),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate","mouseRoll"]),this._add("mouseRoll",$,["mousePitch"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const Z=(function({enable:se,clickTolerance:de}){const ge=new Cs({checkCorrectEvent:ce=>ve.mouseButton(ce)===0&&!ce.ctrlKey});return new Ga({clickTolerance:de,move:(ce,Te)=>({around:Te,panDelta:Te.sub(ce)}),activateOnStart:!0,moveStateManager:ge,enable:se,assignEvents:Es})})(e),K=new cu(e,a);a.dragPan=new uo(l,Z,K),this._add("mousePan",Z),this._add("touchPan",K,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const Q=new Cl,J=new dc;a.touchZoomRotate=new mc(l,J,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new wn(a));const oe=a.scrollZoom=new Za(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",oe,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const he=a.keyboard=new eh(a);this._add("keyboard",he),e.interactive&&e.keyboard&&a.keyboard.enable()}_add(e,a,l){this._handlers.push({handlerName:e,handler:a,allowed:l}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ho(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,l){for(const d in e)if(d!==l&&(!a||a.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const l of e)this._el.contains(l.target)&&a.push(l);return a}mergeHandlerResult(e,a,l,d,g){if(!l)return;u.e(e,l);const _={handlerName:d,originalEvent:l.originalEvent||g};l.zoomDelta!==void 0&&(a.zoom=_),l.panDelta!==void 0&&(a.drag=_),l.rollDelta!==void 0&&(a.roll=_),l.pitchDelta!==void 0&&(a.pitch=_),l.bearingDelta!==void 0&&(a.rotate=_)}_applyChanges(){const e={},a={},l={};for(const[d,g,_]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new u.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),u.e(a,g),u.e(l,_);this._updateMapTransform(e,a,l),this._changes=[]}_updateMapTransform(e,a,l){const d=this._map,g=d._getTransformForUpdate(),_=d.terrain;if(!(Vo(e)||_&&this._terrainMovement))return this._fireEvents(a,l,!0);d._stop(!0);let{panDelta:w,zoomDelta:S,bearingDelta:E,pitchDelta:I,rollDelta:L,around:R,pinchAround:$}=e;$!==void 0&&(R=$),R=R||d.transform.centerPoint,_&&!g.isPointOnMapSurface(R)&&(R=g.centerPoint);const Z={panDelta:w,zoomDelta:S,rollDelta:L,pitchDelta:I,bearingDelta:E,around:R};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(R)&&(R=g.centerPoint);const K=R.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(w?R.sub(w):R);this._handleMapControls({terrain:_,tr:g,deltasForHelper:Z,preZoomAroundLoc:K,combinedEventsInProgress:a,panDelta:w}),d._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,l,!0)}_handleMapControls({terrain:e,tr:a,deltasForHelper:l,preZoomAroundLoc:d,combinedEventsInProgress:g,panDelta:_}){const w=this._map.cameraHelper;if(w.handleMapControlsRollPitchBearingZoom(l,a),e)return w.useGlobeControls?(this._terrainMovement||!g.drag&&!g.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void w.handleMapControlsPan(l,a,d)):this._terrainMovement||!g.drag&&!g.zoom?void(g.drag&&this._terrainMovement&&_?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(_))):w.handleMapControlsPan(l,a,d)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void w.handleMapControlsPan(l,a,d));w.handleMapControlsPan(l,a,d)}_fireEvents(e,a,l){const d=ho(this._eventsInProgress),g=ho(e),_={};for(const L in e){const{originalEvent:R}=e[L];this._eventsInProgress[L]||(_[`${L}start`]=R),this._eventsInProgress[L]=e[L]}!d&&g&&this._fireEvent("movestart",g.originalEvent);for(const L in _)this._fireEvent(L,_[L]);g&&this._fireEvent("move",g.originalEvent);for(const L in e){const{originalEvent:R}=e[L];this._fireEvent(L,R)}const w={};let S;for(const L in this._eventsInProgress){const{handlerName:R,originalEvent:$}=this._eventsInProgress[L];this._handlersById[R].isActive()||(delete this._eventsInProgress[L],S=a[R]||$,w[`${L}end`]=S)}for(const L in w)this._fireEvent(L,w[L]);const E=ho(this._eventsInProgress),I=(d||g)&&!E;if(I&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const L=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&L.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(L)}if(l&&I){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!L||!L.essential&&we.prefersReducedMotion?(this._map.fire(new u.l("moveend",{originalEvent:S})),R(this._map.getBearing())&&this._map.resetNorth()):(R(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new u.l(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Ha("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Nt extends u.E{constructor(e,a,l){super(),this._renderFrameCallback=()=>{const d=Math.min((Qe()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,a){e.apply(this.transform),this.transform=e,this.cameraHelper=a}getCenter(){return new u.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,a){return this.jumpTo({elevation:e},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,a,l){return e=u.P.convert(e).mult(-1),this.panTo(this.transform.center,u.e({offset:e},a),l)}panTo(e,a,l){return this.easeTo(u.e({center:e},a),l)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,l){return this.easeTo(u.e({zoom:e},a),l)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,a){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new u.l("movestart",a)).fire(new u.l("move",a)).fire(new u.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,l){return this.easeTo(u.e({bearing:e},a),l)}resetNorth(e,a){return this.rotateTo(0,u.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(u.e({bearing:0,pitch:0,roll:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}getRoll(){return this.transform.roll}setRoll(e,a){return this.jumpTo({roll:e},a),this}cameraForBounds(e,a){e=Bi.convert(e).adjustAntiMeridian();const l=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,a)}_cameraForBoxAndBearing(e,a,l,d){const g={top:0,bottom:0,right:0,left:0};if(typeof(d=u.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const E=d.padding;d.padding={top:E,bottom:E,right:E,left:E}}const _=u.e(g,d.padding);d.padding=_;const w=this.transform,S=new Bi(e,a);return this.cameraHelper.cameraForBoxAndBearing(d,_,S,l,w)}fitBounds(e,a,l){return this._fitInternal(this.cameraForBounds(e,a),a,l)}fitScreenCoordinates(e,a,l,d,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(u.P.convert(e)),this.transform.screenPointToLocation(u.P.convert(a)),l,d),d,g)}_fitInternal(e,a,l){return e?(delete(a=u.e(e,a)).padding,a.linear?this.easeTo(a,l):this.flyTo(a,l)):this}jumpTo(e,a){this.stop();const l=this._getTransformForUpdate();let d=!1,g=!1,_=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const S=l.zoom!==w;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(d=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(g=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(_=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new u.l("movestart",a)).fire(new u.l("move",a)),S&&this.fire(new u.l("zoomstart",a)).fire(new u.l("zoom",a)).fire(new u.l("zoomend",a)),d&&this.fire(new u.l("rotatestart",a)).fire(new u.l("rotate",a)).fire(new u.l("rotateend",a)),g&&this.fire(new u.l("pitchstart",a)).fire(new u.l("pitch",a)).fire(new u.l("pitchend",a)),_&&this.fire(new u.l("rollstart",a)).fire(new u.l("roll",a)).fire(new u.l("rollend",a)),this.fire(new u.l("moveend",a))}calculateCameraOptionsFromTo(e,a,l,d=0){const g=u.a1.fromLngLat(e,a),_=u.a1.fromLngLat(l,d),w=_.x-g.x,S=_.y-g.y,E=_.z-g.z,I=Math.hypot(w,S,E);if(I===0)throw new Error("Can't calculate camera options with same From and To");const L=Math.hypot(w,S),R=u.ak(this.transform.cameraToCenterDistance/I/this.transform.tileSize),$=180*Math.atan2(w,-S)/Math.PI;let Z=180*Math.acos(L/I)/Math.PI;return Z=E<0?90-Z:90+Z,{center:_.toLngLat(),elevation:d,zoom:R,pitch:Z,bearing:$}}calculateCameraOptionsFromCameraLngLatAltRotation(e,a,l,d,g){const _=this.transform.calculateCenterFromCameraLngLatAlt(e,a,l,d);return{center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:l,pitch:d,roll:g}}easeTo(e,a){this._stop(!1,e.easeId),((e=u.e({offset:[0,0],duration:500,easing:u.co},e)).animate===!1||!e.essential&&we.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),d=this.getBearing(),g=l.pitch,_=l.roll,w="bearing"in e?this._normalizeBearing(e.bearing,d):d,S="pitch"in e?+e.pitch:g,E="roll"in e?this._normalizeBearing(e.roll,_):_,I="padding"in e?e.padding:l.padding,L=u.P.convert(e.offset);let R,$;e.around&&(R=u.S.convert(e.around),$=l.locationToScreenPoint(R));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},K=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:S,roll:E,padding:I,around:R,aroundPoint:$,offsetAsPoint:L,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==w,this._pitching=this._pitching||S!==g,this._rolling=this._rolling||E!==_,this._padding=!l.isPaddingEqual(I),this._zooming=this._zooming||K.isZooming,this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,Z),this.terrain&&this._prepareElevation(K.elevationCenter),this._ease((Q=>{K.easeFunc(Q),this.terrain&&!e.freezeElevation&&this._updateElevation(Q),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(Q=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,Q)}),e),this}_prepareEase(e,a,l={}){this._moving=!0,a||l.moving||this.fire(new u.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new u.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new u.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new u.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new u.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(a-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.setElevation(u.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const a=e.getCameraLngLat(),l=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(a,e.zoom):0;if(l<d){const g=this.calculateCameraOptionsFromTo(a,d,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){const a=[];if(a.push((d=>this._elevateCameraIfInsideTerrain(d))),this.transformCameraUpdate&&a.push((d=>this.transformCameraUpdate(d))),!a.length)return;const l=e.clone();for(const d of a){const g=l.clone(),{center:_,zoom:w,roll:S,pitch:E,bearing:I,elevation:L}=d(g);_&&g.setCenter(_),L!==void 0&&g.setElevation(L),w!==void 0&&g.setZoom(w),S!==void 0&&g.setRoll(S),E!==void 0&&g.setPitch(E),I!==void 0&&g.setBearing(I),l.apply(g)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new u.l("move",e)),this._zooming&&this.fire(new u.l("zoom",e)),this._rotating&&this.fire(new u.l("rotate",e)),this._pitching&&this.fire(new u.l("pitch",e)),this._rolling&&this.fire(new u.l("roll",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const l=this._zooming,d=this._rotating,g=this._pitching,_=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new u.l("zoomend",e)),d&&this.fire(new u.l("rotateend",e)),g&&this.fire(new u.l("pitchend",e)),_&&this.fire(new u.l("rollend",e)),this.fire(new u.l("moveend",e))}flyTo(e,a){if(!e.essential&&we.prefersReducedMotion){const Be=u.Q(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Be,a)}this.stop(),e=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.co},e);const l=this._getTransformForUpdate(),d=l.bearing,g=l.pitch,_=l.roll,w=l.padding,S="bearing"in e?this._normalizeBearing(e.bearing,d):d,E="pitch"in e?+e.pitch:g,I="roll"in e?this._normalizeBearing(e.roll,_):_,L="padding"in e?e.padding:l.padding,R=u.P.convert(e.offset);let $=l.centerPoint.add(R);const Z=l.screenPointToLocation($),K=this.cameraHelper.handleFlyTo(l,{bearing:S,pitch:E,roll:I,padding:L,locationAtOffset:Z,offsetAsPoint:R,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let Q=e.curve;const J=Math.max(l.width,l.height),oe=J/K.scaleOfZoom,he=K.pixelPathLength;typeof K.scaleOfMinZoom=="number"&&(Q=Math.sqrt(J/K.scaleOfMinZoom/he*2));const se=Q*Q;function de(Be){const nt=(oe*oe-J*J+(Be?-1:1)*se*se*he*he)/(2*(Be?oe:J)*se*he);return Math.log(Math.sqrt(nt*nt+1)-nt)}function ge(Be){return(Math.exp(Be)-Math.exp(-Be))/2}function ce(Be){return(Math.exp(Be)+Math.exp(-Be))/2}const Te=de(!1);let Oe=function(Be){return ce(Te)/ce(Te+Q*Be)},Re=function(Be){return J*((ce(Te)*(ge(nt=Te+Q*Be)/ce(nt))-ge(Te))/se)/he;var nt},Le=(de(!0)-Te)/Q;if(Math.abs(he)<2e-6||!isFinite(Le)){if(Math.abs(J-oe)<1e-6)return this.easeTo(e,a);const Be=oe<J?-1:1;Le=Math.abs(Math.log(oe/J))/Q,Re=()=>0,Oe=nt=>Math.exp(Be*Q*nt)}return e.duration="duration"in e?+e.duration:1e3*Le/("screenSpeed"in e?+e.screenSpeed/Q:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==S,this._pitching=E!==g,this._rolling=I!==_,this._padding=!l.isPaddingEqual(L),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(K.targetCenter),this._ease((Be=>{const nt=Be*Le,at=1/Oe(nt),et=Re(nt);this._rotating&&l.setBearing(u.C.number(d,S,Be)),this._pitching&&l.setPitch(u.C.number(g,E,Be)),this._rolling&&l.setRoll(u.C.number(_,I,Be)),this._padding&&(l.interpolatePadding(w,L,Be),$=l.centerPoint.add(R)),K.easeFunc(Be,at,et,$),this.terrain&&!e.freezeElevation&&this._updateElevation(Be),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,a)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,a,l){l.animate===!1||l.duration===0?(e(1),a()):(this._easeStart=Qe(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=u.aO(e,-180,180);const l=Math.abs(e-a);return Math.abs(e-360-a)<l&&(e-=360),Math.abs(e+360-a)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(u.S.convert(e),this.transform.tileZoom):null}}const Go={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class gc{constructor(e=Go){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=ve.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ve.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ve.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ve.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const l=this._map._getUIString(`AttributionControl.${a}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((d=>typeof d!="string"?"":d))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const a=this._map.style.sourceCaches;for(const d in a){const g=a[d];if(g.used||g.usedForTerrain){const _=g.getSource();_.attribution&&e.indexOf(_.attribution)<0&&e.push(_.attribution)}}e=e.filter((d=>String(d).trim())),e.sort(((d,g)=>d.length-g.length)),e=e.filter(((d,g)=>{for(let _=g+1;_<e.length;_++)if(e[_].indexOf(d)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=ve.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Zo{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const l=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ve.create("div","maplibregl-ctrl");const a=ve.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ve.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class cr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,l=a?this._queue.concat(a):this._queue;for(const d of l)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const l of a)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var aa=u.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class on extends u.E{constructor(e){super(),this._lastTilesetChange=Qe(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];const l={};for(const d of zt(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),u.bZ(d.terrainRttPosMatrix32f,0,u.$,u.$,0,0,1),this._tiles[d.key]=new F(d,this.tileSize),this._lastTilesetChange=Qe());for(const d in this._tiles)l[d]||delete this._tiles[d]}freeRtt(e){for(const a in this._tiles){const l=this._tiles[a];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,a){return a?this._getTerrainCoordsForTileRanges(e,a):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const a={};for(const l of this._renderableTilesKeys){const d=this._tiles[l].tileID,g=e.clone(),_=u.ba();if(d.canonical.equals(e.canonical))u.bZ(_,0,u.$,u.$,0,0,1);else if(d.canonical.isChildOf(e.canonical)){const w=d.canonical.z-e.canonical.z,S=d.canonical.x-(d.canonical.x>>w<<w),E=d.canonical.y-(d.canonical.y>>w<<w),I=u.$>>w;u.bZ(_,0,I,I,0,0,1),u.M(_,_,[-S*I,-E*I,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{const w=e.canonical.z-d.canonical.z,S=e.canonical.x-(e.canonical.x>>w<<w),E=e.canonical.y-(e.canonical.y>>w<<w),I=u.$>>w;u.bZ(_,0,u.$,u.$,0,0,1),u.M(_,_,[S*I,E*I,0]),u.N(_,_,[1/2**w,1/2**w,0])}}g.terrainRttPosMatrix32f=new Float32Array(_),a[l]=g}return a}_getTerrainCoordsForTileRanges(e,a){const l={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID;if(!this._isWithinTileRanges(g,a))continue;const _=e.clone(),w=u.ba();if(g.canonical.z===e.canonical.z){const S=e.canonical.x-g.canonical.x,E=e.canonical.y-g.canonical.y;u.bZ(w,0,u.$,u.$,0,0,1),u.M(w,w,[S*u.$,E*u.$,0])}else if(g.canonical.z>e.canonical.z){const S=g.canonical.z-e.canonical.z,E=g.canonical.x-(g.canonical.x>>S<<S),I=g.canonical.y-(g.canonical.y>>S<<S),L=e.canonical.x-(g.canonical.x>>S),R=e.canonical.y-(g.canonical.y>>S),$=u.$>>S;u.bZ(w,0,$,$,0,0,1),u.M(w,w,[-E*$+L*u.$,-I*$+R*u.$,0])}else{const S=e.canonical.z-g.canonical.z,E=e.canonical.x-(e.canonical.x>>S<<S),I=e.canonical.y-(e.canonical.y>>S<<S),L=(e.canonical.x>>S)-g.canonical.x,R=(e.canonical.y>>S)-g.canonical.y,$=u.$<<S;u.bZ(w,0,$,$,0,0,1),u.M(w,w,[E*u.$+L*$,I*u.$+R*$,0])}_.terrainRttPosMatrix32f=new Float32Array(w),l[d]=_}return l}getSourceTile(e,a){const l=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>l.maxzoom&&(d=l.maxzoom),d<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&a)for(;d>=l.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(d--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,a){return a[e.canonical.z]&&e.canonical.x>=a[e.canonical.z].minTileX&&e.canonical.x<=a[e.canonical.z].maxTileX&&e.canonical.y>=a[e.canonical.z].minTileY&&e.canonical.y<=a[e.canonical.z].maxTileY}}class uu{constructor(e,a,l){this._meshCache={},this.painter=e,this.sourceCache=new on(a),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,l,d=u.$){var g;if(!(a>=0&&a<d&&l>=0&&l<d))return 0;const _=this.getTerrainData(e),w=(g=_.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;const S=u.cs([],[a/d*u.$,l/d*u.$],_.u_terrain_matrix),E=[S[0]*w.dim,S[1]*w.dim],I=Math.floor(E[0]),L=Math.floor(E[1]),R=E[0]-I,$=E[1]-L;return w.get(I,L)*(1-R)*(1-$)+w.get(I+1,L)*R*(1-$)+w.get(I,L+1)*(1-R)*$+w.get(I+1,L+1)*R*$}getElevationForLngLatZoom(e,a){if(!u.ct(a,e.wrap()))return 0;const{tileID:l,mercatorX:d,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(l,d%u.$,g%u.$,u.$)}getElevation(e,a,l,d=u.$){return this.getDEMElevation(e,a,l,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,g=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new u.T(d,g,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new u.T(d,new u.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.ai([])}const a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const d=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new u.T(d,a.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),a.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const l=a&&a+a.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const d=this.sourceCache.sourceCache._source.maxzoom;let g=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?g=e.canonical.z-d:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=e.canonical.x-(e.canonical.x>>g<<g),w=e.canonical.y-(e.canonical.y>>g<<g),S=u.cu(new Float64Array(16),[1/(u.$<<g),1/(u.$<<g),0]);u.M(S,S,[_*u.$,w*u.$,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,l=a.width/devicePixelRatio,d=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new u.T(a.context,{width:l,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new u.T(a.context,{width:l,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(l,d,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,l,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,_=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,_+=4)a[_+0]=255&w,a[_+1]=255&g,a[_+2]=w>>8<<4|g>>8,a[_+3]=0;const l=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),d=new u.T(e,l,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),l=this.painter.context,d=l.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),_=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(g,w-_-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null);const S=a[0]+(a[2]>>4<<8),E=a[1]+((15&a[2])<<8),I=this.coordsIndex[255-a[3]],L=I&&this.sourceCache.getTileByID(I);if(!L)return null;const R=this._coordsTextureSize,$=(1<<L.tileID.canonical.z)*R;return new u.a1((L.tileID.canonical.x*R+S)/$+L.tileID.wrap,(L.tileID.canonical.y*R+E)/$,this.getElevation(L.tileID,S,E,R))}depthAtPoint(e){const a=new Uint8Array(4),l=this.painter.context,d=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(e){var a;const l=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,d=l&&e.canonical.y===0,g=l&&e.canonical.y===(1<<e.canonical.z)-1,_=`m_${d?"n":""}_${g?"s":""}`;if(this._meshCache[_])return this._meshCache[_];const w=this.painter.context,S=new u.cv,E=new u.aN,I=this.meshSize,L=u.$/I,R=I*I;for(let ce=0;ce<=I;ce++)for(let Te=0;Te<=I;Te++)S.emplaceBack(Te*L,ce*L,0);for(let ce=0;ce<R;ce+=I+1)for(let Te=0;Te<I;Te++)E.emplaceBack(Te+ce,I+Te+ce+1,I+Te+ce+2),E.emplaceBack(Te+ce,I+Te+ce+2,Te+ce+1);const $=S.length,Z=$+(I+1),K=(I+1)*I,Q=d?u.bh:0,J=d?0:1,oe=g?u.bi:u.$,he=g?0:1;for(let ce=0;ce<=I;ce++)S.emplaceBack(ce*L,Q,J);for(let ce=0;ce<=I;ce++)S.emplaceBack(ce*L,oe,he);for(let ce=0;ce<I;ce++)E.emplaceBack(K+ce,Z+ce,Z+ce+1),E.emplaceBack(K+ce,Z+ce+1,K+ce+1),E.emplaceBack(0+ce,$+ce+1,$+ce),E.emplaceBack(0+ce,0+ce+1,$+ce+1);const se=S.length,de=se+2*(I+1);for(const ce of[0,1])for(let Te=0;Te<=I;Te++)for(const Oe of[0,1])S.emplaceBack(ce*u.$,Te*L,Oe);for(let ce=0;ce<2*I;ce+=2)E.emplaceBack(se+ce,se+ce+1,se+ce+3),E.emplaceBack(se+ce,se+ce+3,se+ce+2),E.emplaceBack(de+ce,de+ce+3,de+ce+1),E.emplaceBack(de+ce,de+ce+2,de+ce+3);const ge=new La(w.createVertexBuffer(S,aa.members),w.createIndexBuffer(E),u.aM.simpleSegment(0,0,S.length,E.length));return this._meshCache[_]=ge,ge}getMeshFrameDelta(e){return 2*Math.PI*u.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,a){var l;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(l=this.getMinMaxElevation(d).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return a&&a.dem&&(l.minElevation=a.dem.min*this.exaggeration,l.maxElevation=a.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,a){const l=u.a1.fromLngLat(e.wrap()),d=(1<<a)*u.$,g=l.x*d,_=l.y*d,w=Math.floor(g/u.$),S=Math.floor(_/u.$);return{tileID:new u.Z(a,0,a,w,S),mercatorX:g,mercatorY:_}}}class Kh{constructor(e,a,l){this._context=e,this._size=a,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new u.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(l.texture),{id:e,fbo:a,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>e.id!==a)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const sa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class oa{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new Kh(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(a))),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const d=e.sourceCaches[l].getVisibleCoordinates(),g=e.sourceCaches[l].getSource(),_=g instanceof Hr?g.terrainTileRanges:null;for(const w of d){const S=this.terrain.sourceCache.getTerrainCoords(w,_);for(const E in S)this._coordsAscending[l][E]||(this._coordsAscending[l][E]=[]),this._coordsAscending[l][E].push(S[E])}}this._coordsAscendingStr={};for(const l of e._order){const d=e._layers[l],g=d.source;if(sa[d.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(const _ in this._coordsAscending[g])this._coordsAscendingStr[g][_]=this._coordsAscending[g][_].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const d in this._coordsAscendingStr){const g=this._coordsAscendingStr[d][l.tileID.key];g&&g!==l.rttCoords[d]&&(l.rtt=[])}}renderLayer(e,a){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),d=e.type,g=this.painter,_=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(sa[d]&&(this._prevType&&sa[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!_))return!0;if(sa[this._prevType]||sa[d]&&_){this._prevType=d;const w=this._stacks.length-1,S=this._stacks[w]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(ls(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[w]){const L=this.pool.getObjectForId(E.rtt[w].id);if(L.stamp===E.rtt[w].stamp){this.pool.useObject(L);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),E.rtt[w]={id:I.id,stamp:I.stamp},g.context.bindFramebuffer.set(I.fbo.framebuffer),g.context.clear({color:u.bf.transparent,stencil:0}),g.currentStencilSource=void 0;for(let L=0;L<S.length;L++){const R=g.style._layers[S[L]],$=R.source?this._coordsAscending[R.source][E.tileID.key]:[E.tileID];g.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),g._renderTileClippingMasks(R,$,!0),g.renderLayer(g,g.style.sourceCaches[R.source],R,$,l),R.source&&(E.rttCoords[R.source]=this._coordsAscendingStr[R.source][E.tileID.key])}}return ls(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),sa[d]}return!1}}const yr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ur=W,Gi={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Go,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},hi={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ni{constructor(e,a,l=!1){this.mousedown=g=>{this.startMove(g,ve.mousePos(this.element,g)),ve.addEventListener(window,"mousemove",this.mousemove),ve.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,ve.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ve.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),ve.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=ve.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const d=new ao;this._rotatePitchHandler=new Ga({clickTolerance:3,move:(g,_)=>{const w=a.getBoundingClientRect(),S=new u.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:u.cn(new u.P(g.x,_.y),_,S),pitchDelta:l?-.5*(_.y-g.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,ve.addEventListener(a,"mousedown",this.mousedown),ve.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),ve.addEventListener(a,"touchcancel",this.reset)}startMove(e,a){this._rotatePitchHandler.dragStart(e,a),ve.disableDrag()}move(e,a){const l=this.map,{bearingDelta:d,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,a)||{};d&&l.setBearing(l.getBearing()+d),g&&l.setPitch(l.getPitch()+g)}off(){const e=this.element;ve.removeEventListener(e,"mousedown",this.mousedown),ve.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ve.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.removeEventListener(window,"touchend",this.touchend),ve.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ve.enableDrag(),ve.removeEventListener(window,"mousemove",this.mousemove),ve.removeEventListener(window,"mouseup",this.mouseup),ve.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.removeEventListener(window,"touchend",this.touchend)}}let Ki;function qo(p,e,a,l=!1){if(l||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return p?.wrap();const d=new u.S(p.lng,p.lat);if(p=new u.S(p.lng,p.lat),e){const g=new u.S(p.lng-360,p.lat),_=new u.S(p.lng+360,p.lat),w=a.locationToScreenPoint(p).distSqr(e);a.locationToScreenPoint(g).distSqr(e)<w?p=g:a.locationToScreenPoint(_).distSqr(e)<w&&(p=_)}for(;Math.abs(p.lng-a.center.lng)>180;){const g=a.locationToScreenPoint(p);if(g.x>=0&&g.y>=0&&g.x<=a.width&&g.y<=a.height)break;p.lng>a.center.lng?p.lng-=360:p.lng+=360}return p.lng!==d.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(p))?p:d}const cs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function us(p,e,a){const l=p.classList;for(const d in cs)l.remove(`maplibregl-${a}-anchor-${d}`);l.add(`maplibregl-${a}-anchor-${e}`)}class hs extends u.E{constructor(e){if(super(),this._onKeyPress=a=>{const l=a.code,d=a.charCode||a.keyCode;l!=="Space"&&l!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=a=>{const l=a.originalEvent.target,d=this._element;this._popup&&(l===d||d.contains(l))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=qo(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),ve.setTransform(this._element,`${cs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${d}`),we.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.l("dragstart"))),this.fire(new u.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=u.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ve.create("div");const a=ve.createNS("http://www.w3.org/2000/svg","svg"),l=41,d=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${l}px`),a.setAttributeNS(null,"width",`${d}px`),a.setAttributeNS(null,"viewBox",`0 0 ${d} ${l}`);const g=ve.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const _=ve.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const w=ve.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of S){const oe=ve.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",J.rx),oe.setAttributeNS(null,"ry",J.ry),w.appendChild(oe)}const E=ve.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const I=ve.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(I);const L=ve.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");const R=ve.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(R);const $=ve.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const Z=ve.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=ve.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const Q=ve.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),Z.appendChild(K),Z.appendChild(Q),_.appendChild(w),_.appendChild(E),_.appendChild(L),_.appendChild($),_.appendChild(Z),a.appendChild(_),a.setAttributeNS(null,"height",l*this._scale+"px"),a.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(a),this._offset=u.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),us(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ve.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=u.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,l;const d=(a=this._map)===null||a===void 0?void 0:a.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!d||g){const $=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==$&&(this._element.style.opacity=$))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const _=this._map,w=_.terrain.depthAtPoint(this._pos),S=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,S)-w<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/_.transform.pixelsPerMeter,I=Math.sin(_.getPitch()*Math.PI/180)*E,L=_.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),R=_.transform.lngLatToCameraDepth(this._lngLat,S+I)-L>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=u.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return(this._opacity===void 0||e===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Ho={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Xa=0,Xo=!1;const vr={maxWidth:100,unit:"metric"};function El(p,e,a){const l=a&&a.maxWidth||100,d=p._container.clientHeight/2,g=p._container.clientWidth/2,_=p.unproject([g-l/2,d]),w=p.unproject([g+l/2,d]),S=Math.round(p.project(w).x-p.project(_).x),E=Math.min(l,S,p._container.clientWidth),I=_.distanceTo(w);if(a&&a.unit==="imperial"){const L=3.2808*I;L>5280?As(e,E,L/5280,p._getUIString("ScaleControl.Miles")):As(e,E,L,p._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?As(e,E,I/1852,p._getUIString("ScaleControl.NauticalMiles")):I>=1e3?As(e,E,I/1e3,p._getUIString("ScaleControl.Kilometers")):As(e,E,I,p._getUIString("ScaleControl.Meters"))}function As(p,e,a,l){const d=(function(g){const _=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/_;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){const E=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*E)/E})(w),_*w})(a);p.style.width=e*(d/a)+"px",p.innerHTML=`${d}&nbsp;${l}`}const hu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},du=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pu(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,p),"top-left":new u.P(e,e),"top-right":new u.P(-e,e),bottom:new u.P(0,-p),"bottom-left":new u.P(e,-e),"bottom-right":new u.P(-e,-e),left:new u.P(p,0),right:new u.P(-p,0)}}if(p instanceof u.P||Array.isArray(p)){const e=u.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:u.P.convert(p.center||[0,0]),top:u.P.convert(p.top||[0,0]),"top-left":u.P.convert(p["top-left"]||[0,0]),"top-right":u.P.convert(p["top-right"]||[0,0]),bottom:u.P.convert(p.bottom||[0,0]),"bottom-left":u.P.convert(p["bottom-left"]||[0,0]),"bottom-right":u.P.convert(p["bottom-right"]||[0,0]),left:u.P.convert(p.left||[0,0]),right:u.P.convert(p.right||[0,0])}}return pu(new u.P(0,0))}const Al=W;z.AJAXError=u.cz,z.Event=u.l,z.Evented=u.E,z.LngLat=u.S,z.MercatorCoordinate=u.a1,z.Point=u.P,z.addProtocol=u.cA,z.config=u.a,z.removeProtocol=u.cB,z.AttributionControl=gc,z.BoxZoomHandler=Yh,z.CanvasSource=un,z.CooperativeGesturesHandler=$o,z.DoubleClickZoomHandler=Vi,z.DragPanHandler=uo,z.DragRotateHandler=fc,z.EdgeInsets=Ar,z.FullscreenControl=class extends u.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ve.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=ve.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ve.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},z.GeoJSONSource=Fn,z.GeolocateControl=class extends u.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new u.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new u.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,d=this._map.getBearing(),g=u.e({bearing:d},this.options.fitBoundsOptions),_=Bi.fromLngLat(a,l);this._map.fitBounds(_,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new u.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Xo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=ve.create("button","maplibregl-ctrl-geolocate",this._container),ve.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ve.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new hs({element:this._dotElement}),this._circleElement=ve.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const l=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.l("trackuserlocationend")),this.fire(new u.l("userlocationlostfocus")))}))}},this.options=u.e({},Ho,p)}onAdd(p){return this._map=p,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return u._(this,arguments,void 0,(function*(e=!1){if(Ki!==void 0&&!e)return Ki;if(window.navigator.permissions===void 0)return Ki=!!window.navigator.geolocation,Ki;try{Ki=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ki=!!window.navigator.geolocation}return Ki}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ve.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Xa=0,Xo=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),a=p.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const p=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&p))return;const e=this._map.project(p),a=this._map.unproject([e.x+100,e.y]),l=p.distanceTo(a)/100,d=2*this._accuracy/l;this._circleElement.style.width=`${d.toFixed(2)}px`,this._circleElement.style.height=`${d.toFixed(2)}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Xa--,Xo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.l("trackuserlocationstart")),this.fire(new u.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Xa++,Xa>1?(p={maximumAge:6e5,timeout:0},Xo=!0):(p=this.options.positionOptions,Xo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},z.GlobeControl=class{constructor(){this._toggleProjection=()=>{var p;const e=(p=this._map.getProjection())===null||p===void 0?void 0:p.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var p;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((p=this._map.getProjection())===null||p===void 0?void 0:p.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(p){return this._map=p,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ve.create("button","maplibregl-ctrl-globe",this._container),ve.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ve.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},z.Hash=na,z.ImageSource=Hr,z.KeyboardHandler=eh,z.LngLatBounds=Bi,z.LogoControl=Zo,z.Map=class extends Nt{constructor(p){var e,a;u.cw.mark(u.cx.create);const l=Object.assign(Object.assign(Object.assign({},Gi),p),{canvasContextAttributes:Object.assign(Object.assign({},Gi.canvasContextAttributes),p.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new Xr,g=new sr;if(l.minZoom!==void 0&&d.setMinZoom(l.minZoom),l.maxZoom!==void 0&&d.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&d.setMinPitch(l.minPitch),l.maxPitch!==void 0&&d.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&d.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&d.setConstrain(l.transformConstrain),super(d,g,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new cr,this._controls=[],this._mapId=u.a7(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},yr),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=vt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ft(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const S=cc((E=>{this._trackResize&&!this._removed&&(this.resize(E),this.redraw())}),50);this._resizeObserver=new ResizeObserver((E=>{w?S(E):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Mt(this,l),this._hash=l.hash&&new na(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,u.e({},l.fitBoundsOptions,{duration:0}))));const _=typeof l.style=="string"||((a=(e=l.style)===null||e===void 0?void 0:e.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,_),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new gc(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Zo,l.logoPosition),this.on("style.load",(()=>{if(_||this._resizeTransform(),this.transform.unmodified){const w=u.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new u.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new u.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new u.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(p,e){return this.style.setGlobalStateProperty(p,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new u.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(a,l.firstChild):l.appendChild(a),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new u.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}coveringTiles(p){return zt(this.transform,p)}calculateCameraOptionsFromTo(p,e,a,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,a,l)}resize(p,e=!0){const[a,l]=this._containerDimensions(),d=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,d),this.painter.resize(a,l,d),this.painter.overLimit()){const _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];const w=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,w),this.painter.resize(a,l,w)}this._resizeTransform(e);const g=!this._moving;return g&&(this.stop(),this.fire(new u.l("movestart",p)).fire(new u.l("move",p))),this.fire(new u.l("resize",p)),g&&this.fire(new u.l("moveend",p)),this}_resizeTransform(p=!0){var e;const[a,l]=this._containerDimensions();this.transform.resize(a,l,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,l,p)}_getClampedPixelRatio(p,e){const{0:a,1:l}=this._maxCanvasSize,d=this.getPixelRatio(),g=p*d,_=e*d;return Math.min(g>a?a/g:1,_>l?l/_:1)*d}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(Bi.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.setMinZoom(p),this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.setMaxZoom(p),this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.setMinPitch(p),this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(p>=this.transform.minPitch)return this.transform.setMaxPitch(p),this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.setRenderWorldCopies(p),this._update()}setTransformConstrain(p){return this.transform.setConstrain(p),this._update()}project(p){return this.transform.locationToScreenPoint(u.S.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.screenPointToLocation(u.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,a){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layers:e,listener:a,delegates:{mousemove:g=>{const _=e.filter((S=>this.getLayer(S))),w=_.length!==0?this.queryRenderedFeatures(g.point,{layers:_}):[];w.length?l||(l=!0,a.call(this,new vn(p,this,g.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layers:e,listener:a,delegates:{mousemove:_=>{const w=e.filter((S=>this.getLayer(S)));(w.length!==0?this.queryRenderedFeatures(_.point,{layers:w}):[]).length?l=!0:l&&(l=!1,a.call(this,new vn(p,this,_.originalEvent)))},mouseout:_=>{l&&(l=!1,a.call(this,new vn(p,this,_.originalEvent)))}}}}{const l=d=>{const g=e.filter((w=>this.getLayer(w))),_=g.length!==0?this.queryRenderedFeatures(d.point,{layers:g}):[];_.length&&(d.features=_,a.call(this,d),delete d.features)};return{layers:e,listener:a,delegates:{[p]:l}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,a){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const l=this._delegatedListeners[p];for(let d=0;d<l.length;d++){const g=l[d];if(g.listener===a&&g.layers.length===e.length&&g.layers.every((_=>e.includes(_)))){for(const _ in g.delegates)this.off(_,g.delegates[_]);return void l.splice(d,1)}}}on(p,e,a){if(a===void 0)return super.on(p,e);const l=typeof e=="string"?[e]:e,d=this._createDelegatedListener(p,l,a);this._saveDelegatedListener(p,d);for(const g in d.delegates)this.on(g,d.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(p,l,a)}}}once(p,e,a){if(a===void 0)return super.once(p,e);const l=typeof e=="string"?[e]:e,d=this._createDelegatedListener(p,l,a);for(const g in d.delegates){const _=d.delegates[g];d.delegates[g]=(...w)=>{this._removeDelegatedListener(p,l,a),_(...w)}}this._saveDelegatedListener(p,d);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(p,e,a){return a===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let a;const l=p instanceof u.P||Array.isArray(p),d=l?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:p)||{},d instanceof u.P||typeof d[0]=="number")a=[u.P.convert(d)];else{const g=u.P.convert(d[0]),_=u.P.convert(d[1]);a=[g,new u.P(_.x,g.y),_,new u.P(g.x,_.y),g]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){var a,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(p,e)));const d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new gl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,d):this.style.loadJSON(p,e,d),this):((l=(a=this.style)===null||a===void 0?void 0:a.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new gl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const a=this._requestManager.transformRequest(p,"Style");u.j(a,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new u.k(l))}))}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(a){u.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new u.k(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const a in this.style._layers){const l=this.style._layers[a];l.type==="hillshade"&&l.source===p.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===p.source&&u.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new uu(this.painter,e,p),this.painter.renderToTexture=new oa(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var l;a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==p.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=a.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new u.l("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const a=p[e]._tiles;for(const l in a){const d=a[l];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}setSourceTileLodParams(p,e,a){if(a){const l=this.getSource(a);if(!l)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);l.calculateTileZoom=_e(Math.max(1,p),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=_e(Math.max(1,p),Math.max(1,e));return this._update(!0),this}refreshTiles(p,e){const a=this.style.sourceCaches[p];if(!a)throw new Error(`There is no source cache with ID "${p}", cannot refresh tile`);e===void 0?a.reload(!0):a.refreshTiles(e.map((l=>new u.a4(l.z,l.x,l.y))))}addImage(p,e,a={}){const{pixelRatio:l=1,sdf:d=!1,stretchX:g,stretchY:_,content:w,textFitWidth:S,textFitHeight:E}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||u.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:L,data:R}=e,$=e;return this.style.addImage(p,{data:new u.R({width:I,height:L},new Uint8Array(R)),pixelRatio:l,stretchX:g,stretchY:_,content:w,textFitWidth:S,textFitHeight:E,sdf:d,version:0,userImage:$}),$.onAdd&&$.onAdd(this,p),this}}{const{width:I,height:L,data:R}=we.getImageData(e);this.style.addImage(p,{data:new u.R({width:I,height:L},R),pixelRatio:l,stretchX:g,stretchY:_,content:w,textFitWidth:S,textFitHeight:E,sdf:d,version:0})}}updateImage(p,e){const a=this.style.getImage(p);if(!a)return this.fire(new u.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||u.b(e)?we.getImageData(e):e,{width:d,height:g,data:_}=l;if(d===void 0||g===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==a.data.width||g!==a.data.height)return this.fire(new u.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||u.b(e));return a.data.replace(_,w),this.style.updateImage(p,a),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new u.k(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return vt.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,a){return this.style.setLayerZoomRange(p,e,a),this._update(!0)}setFilter(p,e,a={}){return this.style.setFilter(p,e,a),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,a,l={}){return this.style.setPaintProperty(p,e,a,l),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,a,l={}){return this.style.setLayoutProperty(p,e,a,l),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,a,(l=>{l||this._update(!0)})),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,(a=>{a||this._update(!0)})),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(p,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=ve.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=ve.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),l=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],l);const d=this._controlContainer=ve.create("div","maplibregl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((_=>{g[_]=ve.create("div",`maplibregl-ctrl-${_} `,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,a){this._canvas.width=Math.floor(a*p),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:p},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,p):this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p),!a){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new au(a,this.transform),St.testSupport(a)}migrateProjection(p,e){super.migrateProjection(p,e),this.painter.transform=p,this.fire(new u.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){var e,a,l,d,g;const _=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,R=Qe();this.style.zoomHistory.update(L,R);const $=new u.F(L,{now:R,fadeDuration:_,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Z=$.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(S=!0,this._crossFadingFactor=Z),this.style.update($)}const E=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||E)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,E),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,showPadding:this.showPadding}),this.fire(new u.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.cw.mark(u.cx.load),this.fire(new u.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const I=this._sourcesDirty||this._styleDirty||this._placementDirty;return I||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.l("idle")),!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,u.cw.mark(u.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),vt.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ve.remove(this._canvasContainer),ve.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),u.cw.clearMetrics(),this._removed=!0,this.fire(new u.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,we.frame(this._frameRequest,(p=>{u.cw.frame(p),this._frameRequest=null;try{this._render(p)}catch(e){if(!u.cy(e)&&!(function(a){return a.message===Yu})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return ur}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(p){return this._lazyInitEmptyStyle(),this.style.setProjection(p),this._update(!0)}},z.MapMouseEvent=vn,z.MapTouchEvent=Fr,z.MapWheelEvent=bn,z.Marker=hs,z.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,a)=>{const l=this._map._getUIString(`NavigationControl.${a}`);e.title=l,e.setAttribute("aria-label",l)},this.options=u.e({},hi,p),this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),ve.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),ve.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=ve.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ni(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ve.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const a=ve.create("button",p,this._container);return a.type="button",a.addEventListener("click",e),a}},z.Popup=class extends u.E{constructor(p){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ve.remove(this._content),this._container&&(ve.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ve.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ve.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=qo(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const d=pu(this.options.offset);if(!l){const _=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=a.y+d.bottom.y<w?["top"]:a.y>this._map.transform.height-w?["bottom"]:[],a.x<_/2?S.push("left"):a.x>this._map.transform.width-_/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}let g=a.add(d[l]);this.options.subpixelPositioning||(g=g.round()),ve.setTransform(this._container,`${cs[l]} translate(${g.x}px,${g.y}px)`),us(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(hu),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=u.S.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),a=document.createElement("body");let l;for(a.innerHTML=p;l=a.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ve.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=ve.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(du);p&&p.focus()}},z.RasterDEMTileSource=An,z.RasterTileSource=Ei,z.ScaleControl=class{constructor(p){this._onMove=()=>{El(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,El(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},vr),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ve.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},z.ScrollZoomHandler=Za,z.Style=gl,z.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ve.create("button","maplibregl-ctrl-terrain",this._container),ve.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ve.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},z.TwoFingersTouchPitchHandler=so,z.TwoFingersTouchRotateHandler=Cl,z.TwoFingersTouchZoomHandler=dc,z.TwoFingersTouchZoomRotateHandler=mc,z.VectorTileSource=Pa,z.VideoSource=Qn,z.addSourceType=(p,e)=>u._(void 0,void 0,void 0,(function*(){if(fa(p))throw new Error(`A source type called "${p}" already exists.`);((a,l)=>{dr[a]=l})(p,e)})),z.clearPrewarmedResources=function(){const p=Ht;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Ye),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},z.createTileMesh=ko,z.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},z.getRTLTextPluginStatus=function(){return Et().getRTLTextPluginStatus()},z.getVersion=function(){return Al},z.getWorkerCount=function(){return yt.workerCount},z.getWorkerUrl=function(){return u.a.WORKER_URL},z.importScriptInWorkers=function(p){return vi().broadcast("IS",p)},z.isTimeFrozen=function(){return Ee.isFrozen()},z.prewarm=function(){ei().acquire(Ye)},z.restoreNow=function(){Ee.restoreNow()},z.setMaxParallelImageRequests=function(p){u.a.MAX_PARALLEL_IMAGE_REQUESTS=p},z.setNow=function(p){Ee.setNow(p)},z.setRTLTextPlugin=function(p,e){return Et().setRTLTextPlugin(p,e)},z.setWorkerCount=function(p){yt.workerCount=p},z.setWorkerUrl=function(p){u.a.WORKER_URL=p}}));var ie=N;return ie}))})(zf)),zf.exports}var Hm=qm();const Ph=km(Hm);function Em(re,C){const A=re.lat*Math.PI/180,X=C.lat*Math.PI/180,ie=(C.lat-re.lat)*Math.PI/180,z=(C.lng-re.lng)*Math.PI/180,u=Math.sin(ie/2)*Math.sin(ie/2)+Math.cos(A)*Math.cos(X)*Math.sin(z/2)*Math.sin(z/2);return 6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}function Xm(re){if(re.length<2)return{totalDistance:0,segments:[]};const C=[];let N=0;for(let A=0;A<re.length-1;A++){const X=Em(re[A],re[A+1]);C.push(X),N+=X}return{totalDistance:N,segments:C}}function Wm(re){return re<1e3?`${Math.round(re)} m`:re<1e4?`${(re/1e3).toFixed(2)} km`:`${(re/1e3).toFixed(1)} km`}function Ym(){return`dist_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}class Km{static API_BASE_URL="https://ws.geonorge.no/hoydedata/v1";static COORDINATE_SYSTEM="EPSG:4326";static MAX_POINTS_PER_REQUEST=50;static async getElevation(C,N){try{const A=new URLSearchParams({koordsys:this.COORDINATE_SYSTEM,nord:C.toString(),ost:N.toString(),geojson:"false"}),X=await fetch(`${this.API_BASE_URL}/punkt?${A.toString()}`,{headers:{"User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)",Accept:"application/json"}});if(!X.ok)return console.warn(`⚠️ Elevation API request failed: ${X.status}`),null;const ie=await X.json();if(ie.punkter&&ie.punkter.length>0){const z=ie.punkter[0];return z.datafeil?(console.warn(`⚠️ Elevation data error: ${z.datafeil}`),null):z.hoyde}return null}catch(A){return console.error("❌ Failed to get elevation:",A),null}}static async getElevations(C){if(C.length===0)return[];try{const N=this.chunkArray(C,this.MAX_POINTS_PER_REQUEST),A=[];for(const X of N){const ie=await this.fetchElevationBatch(X);A.push(...ie)}return A}catch(N){return console.error("❌ Failed to get batch elevations:",N),C.map(()=>null)}}static async generateElevationProfile(C,N=50){if(console.log(`📈 Generating elevation profile for ${C.length} coordinates, resolution: ${N}`),!C||C.length<2)return console.warn("⚠️ Invalid coordinates for elevation profile"),[];try{const A=this.sampleTrailPoints(C,N);console.log(`📊 Sampled ${A.length} points from ${C.length} coordinates`);const X=A.map(W=>({lat:W[1],lng:W[0]})),ie=await this.getElevations(X),z=[];let u=0;for(let W=0;W<A.length;W++){const[te,xe]=A[W],De=ie[W];if(W>0){const[we,Ee]=A[W-1];u+=this.haversineDistance(Ee,we,xe,te)}De!==null&&z.push({distance:u,elevation:De,lat:xe,lng:te})}return console.log(`✅ Generated elevation profile with ${z.length} valid points`),z}catch(A){return console.error("❌ Failed to generate elevation profile:",A),[]}}static async getDataSources(){try{const C=await fetch(`${this.API_BASE_URL}/datakilder`,{headers:{"User-Agent":"Tråkke Norwegian Outdoor App",Accept:"application/json"}});if(!C.ok)throw new Error(`Failed to get data sources: ${C.status}`);return await C.json()}catch(C){return console.error("❌ Failed to get elevation data sources:",C),[]}}static async fetchElevationBatch(C){const N=C.map(z=>`${z.lat},${z.lng}`).join(" "),A=new URLSearchParams({koordsys:this.COORDINATE_SYSTEM,punkter:N,geojson:"false"}),X=await fetch(`${this.API_BASE_URL}/punkt?${A.toString()}`,{headers:{"User-Agent":"Tråkke Norwegian Outdoor App",Accept:"application/json"}});if(!X.ok)return console.warn(`⚠️ Batch elevation API request failed: ${X.status}`),C.map(()=>null);const ie=await X.json();return ie.punkter?ie.punkter.map(z=>z.datafeil?(console.warn(`⚠️ Elevation data error for point: ${z.datafeil}`),null):z.hoyde):C.map(()=>null)}static sampleTrailPoints(C,N){if(C.length<=N)return C;const A=Math.max(1,Math.floor(C.length/N)),X=[];X.push(C[0]);for(let u=A;u<C.length;u+=A)X.push(C[u]);const ie=C[C.length-1],z=X[X.length-1];return(ie[0]!==z[0]||ie[1]!==z[1])&&X.push(ie),X}static haversineDistance(C,N,A,X){const z=(A-C)*Math.PI/180,u=(X-N)*Math.PI/180,W=Math.sin(z/2)*Math.sin(z/2)+Math.cos(C*Math.PI/180)*Math.cos(A*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(W),Math.sqrt(1-W)))}static chunkArray(C,N){const A=[];for(let X=0;X<C.length;X+=N)A.push(C.slice(X,X+N));return A}}class Np{static WMS_BASE_URL="https://wms.geonorge.no/skwms1/wms.friluftsruter2";static WMS_VERSION="1.3.0";static WMS_LAYERS={hiking:"Fotrute",cycling:"Sykkelrute",skiing:"Skiloype",other:"AnnenRute"};static async checkServiceAvailability(){try{const C=`${this.WMS_BASE_URL}?service=WMS&version=${this.WMS_VERSION}&request=GetCapabilities`;return(await fetch(C,{method:"HEAD"})).ok}catch(C){return console.error("WMS service unavailable:",C),!1}}static getWMSTileURL(C){const N=this.WMS_LAYERS[C];return`${this.WMS_BASE_URL}?service=WMS&version=${this.WMS_VERSION}&request=GetMap&layers=${N}&styles=&format=image/png&transparent=true&CRS=EPSG:3857&width=256&height=256&bbox={bbox-epsg-3857}`}static getWMSLayerSources(){const C={};return Object.entries(this.WMS_LAYERS).forEach(([N,A])=>{C[`turrutebasen-${N}`]={type:"raster",tiles:[this.getWMSTileURL(N)],tileSize:256,attribution:"© Kartverket"}}),C}static async fetchTrailsInBounds(C,N){return console.log("Trail data served via WMS layers"),[]}static async getTrailById(C){return console.log("Trail detail lookup not supported in WMS mode"),null}static async searchTrails(C){return console.log("Trail search uses WMS layers"),{trails:[],totalCount:0,searchTime:0,bounds:C.bounds}}static async getElevationProfile(C,N=50){try{const A=C.geometry.coordinates;return!A||A.length<2?[]:await Km.generateElevationProfile(A,N)}catch(A){return console.error("Failed to generate elevation profile:",A),[]}}static async planRoute(C,N,A){return console.log("Route planning from",C,"to",N),null}}const xm={hiking:{color:"#e74c3c",width:3,opacity:.8,glowColor:"#e74c3c40"},skiing:{color:"#3498db",width:3,opacity:.8,dashArray:[5,5],glowColor:"#3498db40"},cycling:{color:"#27ae60",width:3,opacity:.8,glowColor:"#27ae6040"},mixed:{color:"#9b59b6",width:3,opacity:.8,glowColor:"#9b59b640"},other:{color:"#95a5a6",width:2,opacity:.7,glowColor:"#95a5a640"}};class Qm{static convertFromTurrutebasen(C){const N=C.properties;return{id:C.id,geometry:C.geometry,properties:{name:N.turrutenavn||`Trail ${C.id}`,description:N.beskrivelse,difficulty:this.mapDifficulty(N.vanskelighetgrad),type:this.mapTrailType(N.rutetype),distance:N.rutelengde||0,surface:this.mapSurface(N.underlaget),municipality:N.kommune||"",county:N.fylke||"",maintainer:N.vedlikeholder,markings:N.merkesystem?[N.merkesystem]:void 0,season:N.sesong?N.sesong.split(",").map(A=>A.trim()):void 0},metadata:{source:"turrutebasen",sourceId:C.id,lastUpdated:new Date().toISOString(),dataQuality:.8,verified:!0}}}static mapDifficulty(C){if(!C)return"medium";const N=C.toLowerCase();return N.includes("lett")||N.includes("enkel")?"easy":N.includes("middels")||N.includes("moderat")?"medium":N.includes("krevende")||N.includes("vanskelig")?"hard":N.includes("ekspert")||N.includes("meget")?"expert":"medium"}static mapTrailType(C){if(!C)return"other";const N=C.toLowerCase();return N.includes("fot")||N.includes("gå")||N.includes("vandre")?"hiking":N.includes("ski")||N.includes("løype")?"skiing":N.includes("sykkel")||N.includes("sykling")?"cycling":N.includes("blandet")||N.includes("multi")?"mixed":"other"}static mapSurface(C){if(!C)return"dirt";const N=C.toLowerCase();return N.includes("asfalt")||N.includes("betong")?"paved":N.includes("grus")||N.includes("singel")?"gravel":N.includes("stein")||N.includes("berg")?"stone":N.includes("tre")||N.includes("planke")?"boardwalk":N.includes("snø")||N.includes("is")?"snow":N.includes("blandet")||N.includes("varierende")?"mixed":"dirt"}static calculateDistance(C){if(!C.coordinates||C.coordinates.length<2)return 0;let N=0;for(let A=1;A<C.coordinates.length;A++){const[X,ie]=C.coordinates[A-1],[z,u]=C.coordinates[A];N+=this.haversineDistance(ie,X,u,z)}return N}static haversineDistance(C,N,A,X){const z=(A-C)*Math.PI/180,u=(X-N)*Math.PI/180,W=Math.sin(z/2)*Math.sin(z/2)+Math.cos(C*Math.PI/180)*Math.cos(A*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(W),Math.sqrt(1-W)))}static getTrailBounds(C){const N=C.geometry.coordinates;if(!N||N.length===0)return{north:0,south:0,east:0,west:0};let A=-90,X=90,ie=-180,z=180;return N.forEach(([u,W])=>{A=Math.max(A,W),X=Math.min(X,W),ie=Math.max(ie,u),z=Math.min(z,u)}),{north:A,south:X,east:ie,west:z}}static intersectsBounds(C,N){const A=this.getTrailBounds(C);return!(A.west>N.east||A.east<N.west||A.north<N.south||A.south>N.north)}}const If=[{type:"forest_pre_1940",name:"Skog etablert før 1940",description:"Skog som har stått kontinuerlig siden 1940 – kan være plantet eller tynnet, men ikke flatehogd",wmsLayerName:"skog_etablert_foer_1940_ikke_flatehogd",icon:"forest",color:"#2d5016"},{type:"forest_probability",name:"Urørt skog (sannsynlighet)",description:"Hvor sannsynlig det er at skogen er urørt siden 1965 – mindre menneskelig påvirkning",wmsLayerName:"naturskogssannsynlighet",icon:"park",color:"#4a7c59"},{type:"forest_proximity",name:"Villmarkspreg (gradering)",description:"Gradering av hvor urørt og villmarksaktig skogen er",wmsLayerName:"naturskogsnaerhet",icon:"eco",color:"#5d8a32"}];class Pf{static WMS_BASE_URL="https://image001.miljodirektoratet.no/arcgis/services/naturskog/naturskog_v1/MapServer/WMSServer";static getWMSLayerSources(){const C={};return If.forEach(N=>{const A=`${this.WMS_BASE_URL}?service=WMS&version=1.3.0&request=GetMap&format=image/png&transparent=true&layers=${N.wmsLayerName}&crs=EPSG:3857&styles=&width=256&height=256&bbox={bbox-epsg-3857}`;C[`naturskog-${N.type}`]={type:"raster",tiles:[A],tileSize:256}}),C}static getMapLayers(){return If.map(C=>({id:`naturskog-${C.type}`,type:"raster",source:`naturskog-${C.type}`,layout:{visibility:"none"},paint:{"raster-opacity":.8}}))}static getLayerByType(C){return If.find(N=>N.type===C)}static async validateService(){try{return(await fetch(`${this.WMS_BASE_URL}?SERVICE=WMS&REQUEST=GetCapabilities`,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok}catch(C){return console.warn("⚠️ Naturskog WMS service not available:",C),!1}}}const Am=Xe.forwardRef((re,C)=>{const{pois:N,categoryState:A,categoryTree:X,onCategoryToggle:ie,onExpandToggle:z,searchResult:u,userLocation:W,onViewportChange:te,onBearingChange:xe,onCoordinatesChange:De,onCoordinatesCopied:we,sidebarCollapsed:Ee=!0,mapType:Qe="topo",distanceMeasurements:ve=[],onDistanceMeasurementUpdate:St,isDistanceMeasuring:wt=!1,onDistanceMeasuringChange:jt,activeTrailTypes:$t=[],onTrailSelect:Fi,onTrailHighlight:Rt}=re,vt=Xe.useRef(null),Ft=Xe.useRef(null),wi=Xe.useRef(te),Ui=Xe.useRef(xe),[Ri,Yi]=Xe.useState(!1),[Ci,Vt]=Xe.useState(!1),[Kt,qi]=Xe.useState(null),[He,gt]=Xe.useState(13),Ot=Xe.useRef(null),At=Xe.useRef(null),mi=Xe.useRef(null),[be,Ye]=Xe.useState([]),[yt,kt]=Xe.useState(!1),[Ht,Gt]=Xe.useState(null),[ei,$i]=Xe.useState(null),[vi,Cn]=Xe.useState([]),_n=Xe.useRef([]),Tr=Xe.useRef([]),En=Xe.useRef(wt),zi=()=>{jt&&jt(!wt),wt?(Pa(),Bi()):Cn([])},Bi=()=>{_n.current.forEach(st=>st.remove()),_n.current=[],Tr.current.forEach(st=>st.remove()),Tr.current=[]},cn=()=>{_n.current.forEach(st=>st.remove()),_n.current=[],Tr.current.forEach(st=>st.remove()),Tr.current=[],Cn([]),jt&&jt(!1),St&&St([])},Pa=()=>{if(vi.length>=2){const{totalDistance:st,segments:Pt}=Xm(vi),Et={id:Ym(),points:[...vi],totalDistance:st,segments:Pt,created:new Date};St&&St([...ve,Et])}Cn([])},Ei=st=>{if(!vt.current){console.warn("⚠️ Cannot add distance point: map not initialized");return}Cn(Pt=>{const Et=[...Pt,st],ne=document.createElement("div");ne.className="distance-marker",ne.style.cssText=`
        width: 16px !important;
        height: 16px !important;
        background-color: #ff4444 !important;
        background: #ff4444 !important;
        border: 3px solid white !important;
        border-radius: 50% !important;
        cursor: pointer !important;
        box-shadow: 0 2px 6px rgba(0,0,0,0.4) !important;
        z-index: 1000 !important;
      `;const O=new Ph.Marker({element:ne,anchor:"center"}).setLngLat([st.lng,st.lat]).addTo(vt.current);if(_n.current.push(O),Et.length>=2){const F=Et[Et.length-2];An(F,st,Et.length-1)}return Et})},An=(st,Pt,Et)=>{if(!vt.current)return;const ne=vt.current,O=Em(st,Pt),F=document.createElement("div");F.className="distance-line-container",F.style.position="absolute",F.style.pointerEvents="none",F.style.zIndex="1000",F.style.top="0",F.style.left="0",F.style.width="100%",F.style.height="100%",F.style.overflow="visible";const G=document.createElement("div");G.className="distance-line";const ee=document.createElement("div");ee.className="distance-label",ee.style.position="absolute",ee.style.background="rgba(255, 255, 255, 0.95)",ee.style.border="2px solid #ff4444",ee.style.borderRadius="6px",ee.style.padding="6px 10px",ee.style.fontSize="13px",ee.style.fontWeight="bold",ee.style.color="#ff4444",ee.style.whiteSpace="nowrap",ee.style.zIndex="1001",ee.style.pointerEvents="none",ee.style.boxShadow="0 2px 8px rgba(0,0,0,0.3)",ee.style.fontFamily="system-ui, -apple-system, sans-serif",ee.textContent=Wm(O),F.appendChild(G),F.appendChild(ee);const le=()=>{const Pe=ne.project([st.lng,st.lat]),Se=ne.project([Pt.lng,Pt.lat]),Ae=Se.x-Pe.x,Ge=Se.y-Pe.y,Ve=Math.sqrt(Ae*Ae+Ge*Ge),ct=Math.atan2(Ge,Ae)*180/Math.PI;G.style.position="absolute",G.style.left=`${Pe.x}px`,G.style.top=`${Pe.y}px`,G.style.width=`${Ve}px`,G.style.height="3px",G.style.backgroundColor="#ff4444",G.style.transformOrigin="0 50%",G.style.transform=`rotate(${ct}deg)`,G.style.zIndex="1000";const _e=Pe.x+Ae/2,qt=Pe.y+Ge/2-20;ee.style.left=`${_e}px`,ee.style.top=`${qt}px`};le(),ne.on("move",le),ne.on("zoom",le),ne.getContainer().appendChild(F),Tr.current.push(F)};Xe.useImperativeHandle(C,()=>({resetBearing:()=>{vt.current&&vt.current.easeTo({bearing:0,duration:500})},getMap:()=>vt.current,toggleDistanceMeasurement:zi,clearDistanceMeasurements:cn})),Xe.useEffect(()=>{wi.current=te},[te]),Xe.useEffect(()=>{Ui.current=xe},[xe]),Xe.useEffect(()=>{En.current=wt,console.log(`📏 Distance measuring mode: ${wt}`)},[wt]);const Fn=st=>(console.log(`🗺️ Creating map style for type: ${st}`),st==="topo"?{version:8,sources:{"kartverket-topo":{type:"raster",tiles:["https://cache.kartverket.no/v1/wmts/1.0.0/topo/default/webmercator/{z}/{y}/{x}.png"],tileSize:256,attribution:"© Kartverket"}},layers:[{id:"kartverket-topo-layer",type:"raster",source:"kartverket-topo"}]}:{version:8,sources:{"esri-satellite":{type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}","https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,minzoom:0,maxzoom:19,scheme:"xyz",attribution:"© Esri"}},layers:[{id:"esri-satellite-layer",type:"raster",source:"esri-satellite",paint:{"raster-fade-duration":100}}]});Xe.useEffect(()=>{if(!Ft.current||vt.current)return;console.log(`🗺️ [DEBUG] Initializing MapLibre with ${Qe} map type...`),console.log("🗺️ [DEBUG] Container ref exists:",!!Ft.current),console.log("🗺️ [DEBUG] Container dimensions:",Ft.current?.offsetWidth,"x",Ft.current?.offsetHeight);const st=O=>{console.log(`🗺️ Initializing MapLibre with center: [${O}] and style:`,Fn(Qe));try{const G=new Ph.Map({container:Ft.current,style:Fn(Qe),center:O,zoom:7,pitch:60,minZoom:3,maxZoom:18,attributionControl:!1,maxBounds:[[4,57.5],[31.5,71.5]]});return G.scrollZoom.enable(),G.scrollZoom.setZoomRate(1/100),G.scrollZoom.setWheelZoomRate(1/450),G.boxZoom.enable(),G.dragRotate.enable(),G.dragPan.enable(),G.doubleClickZoom.enable(),G.touchZoomRotate.enable(),console.log("🗺️ [DEBUG] Map object created successfully:",G),Vt(!0),qi(null),vt.current=G,ne(G),console.log("🗺️ Map initialized and event handlers attached"),G}catch(F){return console.error("❌ [ERROR] Failed to create MapLibre map:",F),qi(F instanceof Error?F.message:"Unknown map creation error"),null}};let Pt=!1;const Et=(O,F)=>{if(Pt){console.log(`🔄 [${F}] Layers already initialized, skipping...`);return}console.log(`🔄 [${F}] Starting layer initialization...`),Pt=!0,console.log(`⚡ [${F}] Using lazy layer initialization for better performance`);try{const G=Pf.getWMSLayerSources(),ee=Pf.getMapLayers();console.log(`🌲 [${F}] Naturskog layers ready for lazy loading:`,ee.map(fe=>fe.id));const le=Np.getWMSLayerSources();console.log(`🥾 [${F}] Turrutebasen sources ready for lazy loading:`,Object.keys(le))}catch(G){console.error(`❌ [${F}] Error preparing lazy layer data:`,G)}},ne=O=>{O.on("load",()=>{console.log(`✅ MapLibre loaded with ${Qe} map tiles`),Yi(!0);const Ae=O.getCenter();De?.({lat:Ae.lat,lng:Ae.lng}),setTimeout(()=>{if(wi.current){const Ge=O.getBounds();wi.current({north:Ge.getNorth(),south:Ge.getSouth(),east:Ge.getEast(),west:Ge.getWest(),zoom:O.getZoom()})}},100),Et(O,"MAP_LOAD")}),O.on("error",Ae=>{console.error("❌ [MAP ERROR] MapLibre error:",Ae)}),O.on("styledata",()=>{console.log(`🎨 [DEBUG] Style data loaded for ${Qe}`)}),O.on("style.load",()=>{console.log(`🎨 [DEBUG] Style fully loaded for ${Qe}`),Et(O,"STYLE_LOAD")});const F=()=>{if(wi.current){const Ae=O.getBounds();wi.current({north:Ae.getNorth(),south:Ae.getSouth(),east:Ae.getEast(),west:Ae.getWest(),zoom:O.getZoom()})}};O.on("moveend",F),O.on("zoomend",F);const G=()=>{Ui.current&&Ui.current(O.getBearing())};O.on("rotate",G),O.on("rotateend",G),O.on("error",Ae=>{console.error("❌ Map error:",Ae)}),O.on("sourceerror",Ae=>{console.error(`❌ Source error: ${Ae.sourceId}`,Ae)}),O.on("zoomend",()=>{const Ae=O.getZoom();gt(Ae),document.querySelectorAll(".custom-poi-popup").forEach(Ve=>Ve.remove())}),setTimeout(()=>{Ui.current&&Ui.current(O.getBearing())},100),O.on("mousemove",Ae=>{De?.({lat:Ae.lngLat.lat,lng:Ae.lngLat.lng})});let ee=null,le=null,fe=null;const Pe=1200,Se=25;O.on("touchstart",Ae=>{if(Ae.lngLat&&Ae.originalEvent.touches.length===1){const Ge=Ae.originalEvent.touches[0];fe={x:Ge.clientX,y:Ge.clientY},le={lat:Ae.lngLat.lat,lng:Ae.lngLat.lng},ee=setTimeout(async()=>{if(le){const Ve=`${le.lat.toFixed(5)}°N, ${le.lng.toFixed(5)}°E`;navigator.vibrate&&navigator.vibrate(50);try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(Ve);else{const ct=document.createElement("textarea");ct.value=Ve,ct.style.position="fixed",ct.style.top="0",ct.style.left="0",ct.style.width="2em",ct.style.height="2em",ct.style.padding="0",ct.style.border="none",ct.style.outline="none",ct.style.boxShadow="none",ct.style.background="transparent",ct.setAttribute("readonly",""),document.body.appendChild(ct),ct.contentEditable="true",ct.readOnly=!1;const _e=document.createRange();_e.selectNodeContents(ct);const qt=window.getSelection();qt&&(qt.removeAllRanges(),qt.addRange(_e)),ct.setSelectionRange(0,999999),document.execCommand("copy"),document.body.removeChild(ct)}console.log(`📋 Copied coordinates with long press: ${Ve}`),we?.(!0)}catch(ct){console.error("Failed to copy coordinates:",ct),we?.(!0)}}},Pe)}}),O.on("touchend",()=>{ee&&(clearTimeout(ee),ee=null),le=null,fe=null}),O.on("touchmove",Ae=>{if(Ae.lngLat&&De?.({lat:Ae.lngLat.lat,lng:Ae.lngLat.lng}),ee&&fe&&Ae.originalEvent.touches.length===1){const Ge=Ae.originalEvent.touches[0];Math.sqrt(Math.pow(Ge.clientX-fe.x,2)+Math.pow(Ge.clientY-fe.y,2))>Se&&(clearTimeout(ee),ee=null,le=null,fe=null)}}),O.on("contextmenu",async Ae=>{Ae.preventDefault();const{lat:Ge,lng:Ve}=Ae.lngLat,ct=`${Ge.toFixed(5)}°N, ${Ve.toFixed(5)}°E`;try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(ct);else{const _e=document.createElement("textarea");_e.value=ct,_e.style.position="fixed",_e.style.top="0",_e.style.left="0",_e.style.width="2em",_e.style.height="2em",_e.style.padding="0",_e.style.border="none",_e.style.outline="none",_e.style.boxShadow="none",_e.style.background="transparent",_e.setAttribute("readonly",""),document.body.appendChild(_e),_e.contentEditable="true",_e.readOnly=!1;const qt=document.createRange();qt.selectNodeContents(_e);const Ii=window.getSelection();Ii&&(Ii.removeAllRanges(),Ii.addRange(qt)),_e.setSelectionRange(0,999999),document.execCommand("copy"),document.body.removeChild(_e)}console.log(`📋 Copied coordinates: ${ct}`),we?.(!0)}catch(_e){console.error("Failed to copy coordinates:",_e),we?.(!0)}}),O.on("click",Ae=>{if(En.current){const{lat:Ge,lng:Ve}=Ae.lngLat;console.log(`📏 Adding distance measurement point at [${Ge.toFixed(5)}, ${Ve.toFixed(5)}]`),Ae.preventDefault(),Ei({lat:Ge,lng:Ve})}})};if(navigator.geolocation)console.log("🌍 Attempting to get user location..."),navigator.geolocation.getCurrentPosition(O=>{const F=[O.coords.longitude,O.coords.latitude];console.log("📍 Using user location"),st(F)},O=>{console.log(`❌ Geolocation failed: ${O.message}, using Hardangervidda fallback`),st([7.47408,60.13022])},{enableHighAccuracy:!1,timeout:1500,maximumAge:3e5});else{console.log("📍 No geolocation support, using Hardangervidda as default");const F=st([7.47408,60.13022]);console.log("🗺️ [DEBUG] Map from initializeWithLocation (no geolocation):",!!F),F?ne(F):console.error("❌ [ERROR] Map initialization failed with Hardangervidda center")}return()=>{vt.current&&(vt.current.remove(),vt.current=null),document.querySelectorAll(".custom-poi-overlay").forEach(F=>F.remove())}},[]),Xe.useEffect(()=>{if(!vt.current||!Ri)return;const st=vt.current;console.log(`🗺️ Map type switching effect triggered: ${Qe}`);const Pt=st.getCenter(),Et=st.getZoom(),ne=st.getBearing(),O=st.getPitch();console.log(`📍 Current position before switch: center=[${Pt.lng.toFixed(4)}, ${Pt.lat.toFixed(4)}], zoom=${Et.toFixed(2)}`);const F=Fn(Qe);st.setStyle(F),st.once("styledata",()=>{console.log(`🎨 Style loaded for ${Qe}, restoring position...`);const G=Qe==="topo"?18:17;st.setMaxZoom(G);const ee=Et>G?G:Et;st.jumpTo({center:Pt,zoom:ee,bearing:ne,pitch:O}),console.log(`✅ Map type switched to ${Qe}, position restored to [${Pt.lng.toFixed(4)}, ${Pt.lat.toFixed(4)}], zoom=${ee.toFixed(2)}`),setTimeout(()=>{if(wi.current){const le=st.getBounds();wi.current({north:le.getNorth(),south:le.getSouth(),east:le.getEast(),west:le.getWest(),zoom:st.getZoom()})}},100)})},[Qe,Ri]),Xe.useEffect(()=>{if(!vt.current||!Ri)return;const st=vt.current;document.querySelectorAll(".custom-poi-overlay").forEach(Et=>Et.remove()),N.forEach((Et,ne)=>{const O=document.createElement("div");O.className="custom-poi-overlay",O.style.cssText=`
        position: absolute;
        z-index: 10;
        pointer-events: auto;
        transform: translate(-50%, -50%);
      `;const F=document.createElement("div");F.className="custom-poi-marker",F.style.cssText=`
        width: 20px;
        height: 20px;
        background: ${Et.color};
        background-color: ${Et.color};
        border-radius: 50%;
        border: 2px solid white;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        display: block;
        transition: all 0.2s ease;
      `,O.appendChild(F);const G=()=>{const le=st.project([Et.lng,Et.lat]);O.style.left=le.x+"px",O.style.top=le.y+"px"};G(),st.on("move",G),st.on("zoom",G),st.getContainer().appendChild(O),console.log("✅ Marker overlay added to map with color:",Et.color),F.addEventListener("mouseenter",()=>{F.style.transform="scale(1.15)",F.style.boxShadow="0 4px 12px rgba(0,0,0,0.2)",F.style.zIndex="15"}),F.addEventListener("mouseleave",()=>{F.style.transform="scale(1.0)",F.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",F.style.zIndex="10"});const ee=le=>`
          <div style="background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                      max-width: ${window.innerWidth<768?"85vw":"320px"}; min-width: 280px;
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                      position: relative;">
            <button onclick="this.closest('.maplibregl-popup').remove()" style="
              position: absolute; top: 8px; right: 8px; width: 28px; height: 28px; border: none;
              background: rgba(0,0,0,0.1); border-radius: 6px; cursor: pointer; display: flex;
              align-items: center; justify-content: center; font-size: 16px; color: #666; z-index: 1;">×</button>
            <div style="padding: 14px 44px 14px 14px;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <div style="width: 20px; height: 20px; border-radius: 50%; background: ${le.color??"#7c3aed"}; flex-shrink: 0;"></div>
                <h3 style="margin: 0; font-size: 15px; font-weight: 600; color: #1F2937;">${le.name}</h3>
              </div>
              <div style="font-size: 13px; color: #4B5563; line-height: 1.4;">${le.description}</div>
            </div>
          </div>
        `;F.addEventListener("click",le=>{if(En.current)return;le.preventDefault(),le.stopPropagation(),document.querySelectorAll(".maplibregl-popup").forEach(Pe=>Pe.remove());const fe=ee(Et);new Ph.Popup({closeButton:!1,closeOnClick:!1,offset:[0,-15]}).setLngLat([Et.lng,Et.lat]).setHTML(fe).addTo(st)})})},[Ri,N]);const Hr=Xe.useCallback((st,Pt)=>{console.log(`🥾 Trail clicked: ${st.properties.name}`),Gt(st),Fi&&Fi(st),new Ph.Popup().setLngLat(Pt).setHTML(`
        <div style="padding: 12px; min-width: 200px;">
          <h3 style="margin: 0 0 8px 0; color: #3e4533; font-size: 16px;">${st.properties.name}</h3>
          <div style="display: flex; flex-direction: column; gap: 4px; font-size: 12px; color: #666;">
            <div><strong>Type:</strong> ${st.properties.type}</div>
            <div><strong>Difficulty:</strong> ${st.properties.difficulty}</div>
            <div><strong>Distance:</strong> ${(st.properties.distance/1e3).toFixed(1)} km</div>
            <div><strong>Municipality:</strong> ${st.properties.municipality}</div>
            ${st.properties.surface?`<div><strong>Surface:</strong> ${st.properties.surface}</div>`:""}
            ${st.properties.maintainer?`<div><strong>Maintainer:</strong> ${st.properties.maintainer}</div>`:""}
          </div>
          ${st.properties.description?`
            <div style="margin-top: 8px; font-size: 12px; color: #555;">
              ${st.properties.description}
            </div>
          `:""}
        </div>
      `).addTo(vt.current);const Et=Qm.getTrailBounds(st);Et&&vt.current.fitBounds([[Et.west,Et.south],[Et.east,Et.north]],{padding:50})},[Fi]),Qn=Xe.useCallback(()=>{if(!vt.current)return;const st=vt.current;Object.keys(xm).forEach(Pt=>{const Et=`trails-${Pt}`;st.on("click",Et,ne=>{if(!ne.features||ne.features.length===0)return;const F=ne.features[0].properties?.id;if(F){const G=be.find(ee=>ee.id===F);G&&Hr(G,ne.lngLat)}}),st.on("mouseenter",Et,ne=>{if(st.getCanvas().style.cursor="pointer",Rt&&ne.features?.[0]){const O=ne.features[0].properties?.id;if(O){const F=be.find(G=>G.id===O);F&&Rt(F)}}}),st.on("mouseleave",Et,()=>{st.getCanvas().style.cursor="",Rt&&Rt(null)})})},[Rt,Hr,be]),un=Xe.useCallback(st=>{if(!vt.current)return;const Pt=vt.current;console.log("🔄 Adding WMS trail layers from Turrutebasen");const Et=Np.getWMSLayerSources();st.forEach(ne=>{const O=`trails-${ne}-wms`,F=`turrutebasen-${ne}`;if(Et[F])try{Pt.getSource(F)||Pt.addSource(F,Et[F]),Pt.getLayer(O)||Pt.addLayer({id:O,type:"raster",source:F,paint:{"raster-opacity":.8}}),console.log(`✅ Added WMS trail layer: ${O}`)}catch(G){console.error(`❌ Failed to add WMS trail layer for ${ne}:`,G)}else console.warn(`⚠️ No WMS source available for trail type: ${ne}`)})},[]),dr=Xe.useCallback((st,Pt)=>{if(!vt.current)return;const Et=vt.current,ne=`trails-${st}-wms`;try{Et.getLayer(ne)&&(Et.setLayoutProperty(ne,"visibility",Pt?"visible":"none"),console.log(`🔄 ${Pt?"Showing":"Hiding"} WMS trail layer: ${ne}`))}catch(O){console.error(`❌ Failed to toggle WMS trail layer ${ne}:`,O)}},[]),fa=Xe.useCallback(st=>{if(!vt.current||st.length===0)return;const Pt=vt.current,Et={type:"FeatureCollection",features:st.map(ne=>({type:"Feature",id:ne.id,geometry:ne.geometry,properties:{id:ne.id,name:ne.properties.name,type:ne.properties.type,difficulty:ne.properties.difficulty,distance:ne.properties.distance,municipality:ne.properties.municipality,surface:ne.properties.surface,maintainer:ne.properties.maintainer}}))};Pt.addSource("trails-data",{type:"geojson",data:Et,lineMetrics:!0}),Object.entries(xm).forEach(([ne,O])=>{Pt.addLayer({id:`trails-${ne}-glow`,type:"line",source:"trails-data",filter:["==",["get","type"],ne],paint:{"line-color":O.glowColor??O.color+"40","line-width":O.width+2,"line-blur":2,"line-opacity":.6}});const F={"line-color":O.color,"line-width":O.width,"line-opacity":O.opacity};O.dashArray&&(F["line-dasharray"]=O.dashArray),Pt.addLayer({id:`trails-${ne}`,type:"line",source:"trails-data",filter:["==",["get","type"],ne],paint:F}),console.log(`✅ Added vector trail layer: trails-${ne}`)}),Qn()},[Qn]),rn=Xe.useCallback(async st=>{if(!vt.current)return;const Et=vt.current.getBounds(),ne={north:Et.getNorth(),south:Et.getSouth(),east:Et.getEast(),west:Et.getWest()};if(!(ei&&Math.abs(ne.north-ei.north)<.01&&Math.abs(ne.south-ei.south)<.01&&Math.abs(ne.east-ei.east)<.01&&Math.abs(ne.west-ei.west)<.01)){kt(!0),$i(ne);try{console.log("🥾 Loading trails from Turrutebasen for types:",st),console.log("📍 Bounds:",ne);const F=(await Np.fetchTrailsInBounds(ne,{maxFeatures:200})).filter(G=>{const ee=G.properties.type==="mixed"?"other":G.properties.type;return st.includes(ee)});console.log(`✅ Loaded ${F.length} trails from Turrutebasen`),Ye(F),fa(F)}catch(O){console.error("❌ Failed to load trails:",O),console.log("🔄 Falling back to WMS trail overlay"),un(st)}finally{kt(!1)}}},[fa,un,ei]);return Xe.useEffect(()=>{if(!vt.current||!Ri)return;const st=vt.current,Pt=$t.map(O=>O==="mixed"?"other":O);["trails-hiking","trails-skiing","trails-cycling","trails-other","trails-hiking-glow","trails-skiing-glow","trails-cycling-glow","trails-other-glow"].forEach(O=>{st.getLayer(O)&&st.removeLayer(O)}),["trails-data"].forEach(O=>{st.getSource(O)&&st.removeSource(O)}),Pt.length>0?(console.log("🥾 Adding WMS trail layers for active types:",Pt),un(Pt),["hiking","skiing","cycling","other"].forEach(F=>{const G=Pt.includes(F);dr(F,G)})):(console.log("🚫 No trail categories active - hiding all trail layers"),["hiking","skiing","cycling","other"].forEach(F=>{dr(F,!1)}),Ye([]))},[Ri,A,$t,un,dr]),Xe.useEffect(()=>{if(!vt.current||!Ri)return;let st;const Pt=()=>{clearTimeout(st),st=setTimeout(()=>{const Et=$t.map(ne=>ne==="mixed"?"other":ne);Et.length>0&&rn(Et)},1e3)};return vt.current.on("moveend",Pt),()=>{vt.current&&vt.current.off("moveend",Pt),clearTimeout(st)}},[Ri,$t,ei,rn]),Xe.useEffect(()=>{if(!vt.current)return;const st=vt.current;if(At.current&&(console.log("🧹 Removing previous search marker"),At.current.remove(),At.current=null),!u){console.log("🔍 No search result, cleanup completed");return}console.log(`🔍 Centering map on search result: ${u.displayName}`),console.log("🔍 Creating search marker at coordinates:",u.lat,u.lng);const Pt=document.createElement("div");Pt.className="search-marker",Pt.style.cssText=`
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #ff0000 !important;
      border: 4px solid #ffffff !important;
      box-shadow: 0 4px 16px rgba(255, 0, 0, 0.8) !important;
      position: absolute !important;
      z-index: 9999 !important;
      transform: translate(-50%, -50%) !important;
      pointer-events: auto !important;
    `,Pt.innerHTML='<div style="width: 100%; height: 100%; background: red; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">S</div>';const Et=new Ph.Marker(Pt).setLngLat([u.lng,u.lat]).addTo(st);At.current=Et,console.log("✅ Search marker added to map successfully"),st.flyTo({center:[u.lng,u.lat],zoom:15,duration:1e3});const ne=setTimeout(()=>{At.current&&(console.log("⏱️ Auto-removing search marker after 3 seconds"),At.current.remove(),At.current=null)},3e3);return()=>{clearTimeout(ne)}},[u]),Xe.useEffect(()=>{if(!vt.current)return;if(!W){console.log("📍 User location cleared - removing markers"),Ot.current&&(Ot.current.remove(),Ot.current=null),mi.current&&(mi.current.remove(),mi.current=null);return}const st=vt.current;console.log(`📍 Centering map on user location: ${W.lat}, ${W.lng}`),console.log("📍 Creating position marker at coordinates:",W.lat,W.lng),Ot.current&&Ot.current.remove();const Pt=document.createElement("div");Pt.className="user-location-marker",Pt.style.cssText=`
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3e4533, #0891b2);
      border: 3px solid white;
      box-shadow: 0 4px 16px rgba(62, 69, 51, 0.4), 0 2px 8px rgba(0,0,0,0.1);
      animation: locationPulse 2s infinite;
      position: relative;
    `;const Et=document.createElement("div");Et.style.cssText=`
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: white;
    `,Pt.appendChild(Et);const ne=new Ph.Marker(Pt).setLngLat([W.lng,W.lat]).addTo(st);Ot.current=ne,mi.current&&mi.current.remove();const O=document.createElement("div");O.className="position-marker",O.style.cssText=`
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: #0000ff !important;
      border: 4px solid #ffffff !important;
      box-shadow: 0 4px 16px rgba(0, 0, 255, 0.8) !important;
      position: absolute !important;
      z-index: 9999 !important;
      transform: translate(-50%, -50%) !important;
      pointer-events: auto !important;
    `,O.innerHTML='<div style="width: 100%; height: 100%; background: blue; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px;">P</div>';const F=new Ph.Marker(O).setLngLat([W.lng,W.lat]).addTo(st);mi.current=F,console.log("✅ Position marker added to map successfully"),st.flyTo({center:[W.lng,W.lat],zoom:14,duration:1500})},[W]),D.jsxs("div",{className:"map-container",style:{position:"relative",width:"100%",height:"100%"},children:[D.jsx("div",{ref:Ft,style:{width:"100%",height:"100%",background:"#f0f0f0"}}),Kt&&D.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(255, 0, 0, 0.9)",color:"white",padding:"20px",borderRadius:"8px",fontFamily:"monospace",fontSize:"14px",zIndex:1e3,maxWidth:"80%",textAlign:"center"},children:["❌ Map initialization failed:",D.jsx("br",{}),Kt]}),!Ci&&!Kt&&D.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.7)",color:"white",padding:"20px",borderRadius:"8px",fontSize:"16px",zIndex:1e3},children:"🗺️ Initializing map..."}),D.jsx("style",{children:`
        /* Clean map styling - no default controls */
        
        /* Hide any remaining MapLibre attribution elements */
        .maplibregl-ctrl-attrib,
        .maplibregl-ctrl-bottom-right,
        .maplibregl-ctrl-bottom-left {
          display: none !important;
        }
        
        /* POI Popup Styling */
        .maplibregl-popup-content {
          background: rgba(255, 255, 255, 0.98) !important;
          backdrop-filter: blur(16px) !important;
          border-radius: 12px !important;
          border: 1px solid rgba(255, 255, 255, 0.3) !important;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08) !important;
          padding: 0 !important;
          max-width: 320px !important;
          min-width: 260px !important;
        }
        
        .poi-popup-content {
          padding: 16px;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .poi-popup-header {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 12px;
          padding-bottom: 12px;
          border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        .poi-popup-icon {
          width: 24px;
          height: 24px;
          border-radius: 50%;
          border: 2px solid white;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          flex-shrink: 0;
        }
        
        .poi-popup-title {
          margin: 0;
          font-size: 16px;
          font-weight: 600;
          color: #1F2937;
          line-height: 1.3;
        }
        
        .poi-popup-body {
          font-size: 13px;
          color: #4B5563;
          line-height: 1.5;
          margin: 0;
        }
        
        .poi-popup-body a {
          color: #059669;
          text-decoration: none;
          font-weight: 500;
          transition: color 0.2s ease;
        }
        
        .poi-popup-body a:hover {
          color: #047857;
          text-decoration: underline;
        }
        
        .maplibregl-popup-tip {
          border-top-color: rgba(255, 255, 255, 0.98) !important;
          border-bottom-color: rgba(255, 255, 255, 0.98) !important;
        }
        
        .maplibregl-popup-close-button {
          position: absolute !important;
          top: 8px !important;
          right: 8px !important;
          width: 24px !important;
          height: 24px !important;
          border-radius: 50% !important;
          background: rgba(0, 0, 0, 0.05) !important;
          border: none !important;
          font-size: 16px !important;
          color: #6B7280 !important;
          cursor: pointer !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          transition: all 0.2s ease !important;
        }
        
        .maplibregl-popup-close-button:hover {
          background: rgba(0, 0, 0, 0.1) !important;
          color: #374151 !important;
        }
        
        /* Search marker animation */
        @keyframes searchPulse {
          0% {
            box-shadow: 0 4px 16px rgba(255, 107, 107, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 0 rgba(255, 107, 107, 0.7);
          }
          70% {
            box-shadow: 0 4px 16px rgba(255, 107, 107, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 12px rgba(255, 107, 107, 0);
          }
          100% {
            box-shadow: 0 4px 16px rgba(255, 107, 107, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 0 rgba(255, 107, 107, 0);
          }
        }
        
        /* User location marker animation */
        @keyframes locationPulse {
          0% {
            box-shadow: 0 4px 16px rgba(62, 69, 51, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 0 rgba(122, 132, 113, 0.7);
          }
          70% {
            box-shadow: 0 4px 16px rgba(62, 69, 51, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 10px rgba(122, 132, 113, 0);
          }
          100% {
            box-shadow: 0 4px 16px rgba(62, 69, 51, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 0 rgba(122, 132, 113, 0);
          }
        }

        /* Position marker animation */
        @keyframes positionPulse {
          0% {
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 0 rgba(220, 38, 38, 0.7);
          }
          70% {
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 14px rgba(220, 38, 38, 0);
          }
          100% {
            box-shadow: 0 4px 16px rgba(220, 38, 38, 0.4), 0 2px 8px rgba(0,0,0,0.1), 0 0 0 0 rgba(220, 38, 38, 0);
          }
        }

        /* Coordinate copy animation */
        @keyframes coordinatePulse {
          0% {
            transform: scale(1);
            box-shadow: 0 4px 16px rgba(62, 69, 51, 0.4);
          }
          50% {
            transform: scale(1.1);
            box-shadow: 0 6px 24px rgba(62, 69, 51, 0.6), 0 0 0 8px rgba(62, 69, 51, 0.2);
          }
          100% {
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(62, 69, 51, 0.4);
          }
        }

        /* Distance measurement markers - force red color */
        .distance-marker {
          width: 16px !important;
          height: 16px !important;
          background: #ff4444 !important;
          background-color: #ff4444 !important;
          border: 3px solid white !important;
          border-radius: 50% !important;
          box-shadow: 0 2px 6px rgba(0,0,0,0.4) !important;
          z-index: 1000 !important;
        }

        /* Distance measurement lines */
        .distance-line-container {
          position: absolute !important;
          top: 0 !important;
          left: 0 !important;
          width: 100% !important;
          height: 100% !important;
          pointer-events: none !important;
          z-index: 999 !important;
        }

        .distance-line {
          background-color: #ff4444 !important;
          z-index: 999 !important;
        }

        .distance-label {
          background: rgba(255, 255, 255, 0.95) !important;
          color: #ff4444 !important;
          border: 1px solid #ff4444 !important;
          z-index: 1000 !important;
          font-weight: bold !important;
        }

        /* Aggressive POI marker overrides */
        .custom-poi-marker {
          transition: all 0.2s ease !important;
          z-index: 10 !important;
          position: relative !important;
        }

        .custom-poi-marker:hover {
          transform: scale(1.15) !important;
          z-index: 15 !important;
        }

        /* Ensure consistent POI overlay z-index across all map types */
        .custom-poi-overlay {
          z-index: 1 !important;
          position: absolute !important;
        }

        /* Force all POI markers to stay below popups with maximum specificity */
        div.custom-poi-overlay div.custom-poi-marker {
          z-index: 1 !important;
          position: relative !important;
        }

        div.custom-poi-overlay div.custom-poi-marker:hover {
          z-index: 2 !important;
        }

        /* CRITICAL FIX: Ensure MapLibre popups have higher z-index than POI markers */
        .maplibregl-popup {
          z-index: 1000 !important;
        }

        /* Override ALL MapLibre marker default styling - COMMENTED OUT TO ALLOW SEARCH/LOCATION MARKERS */
        /*
        .maplibregl-marker {
          background: none !important;
          border: none !important;
          cursor: inherit !important;
        }

        .maplibregl-marker svg {
          display: none !important;
        }

        .maplibregl-marker .custom-poi-marker {
          background: inherit !important;
          background-color: inherit !important;
          border: inherit !important;
          box-shadow: inherit !important;
        }

        /* Force override MapLibre's default blue marker */
        .maplibregl-marker .maplibregl-marker-anchor {
          display: none !important;
        }
        */
      `})]})});Am.displayName="MapLibreMap";const Jm=Am;function eg({categoryTree:re,categoryState:C,onCategoryToggle:N,onExpandToggle:A,pois:X}){const ie=u=>({på_eventyr:!0,krigsminne:!0,hule:!0,observasjonstårn:!0,aktivitet:!0,naturperle:!0,overnatte:!0,service:!0,transport:!0,bålplass:!0,gapahuk_vindskjul:!0,tilfluktsrom:!0,badeplass:!1,badeplass_med_strand:!1,fiskeplass:!1,kanopadling:!1,foss:!0,utsiktspunkt:!0,campingplass:!1,fri_camping:!1,hengekøyeplass:!1,hytte_dagstur:!1,hytte_turisthytte_betjent:!1,hytte_turisthytte_selvbetjent:!1,hytte_turisthytte_ubetjent:!1,hytte_utleie:!1,teltplass:!1,vandrerhjem:!1,kulturminne:!1,informasjon:!1,drikkevann:!1,spise_rasteplass:!1,toalett:!1,utfartparkering:!1,bussholdeplass:!0,taubane:!0,togstasjon:!0,tursti:!1,fjelltopp:!1,skiløype:!1})[u.id]||!1?!0:u.children?u.children.some(xe=>ie(xe)):!1,z=(u,W=0)=>{const te=u.children&&u.children.length>0,xe=C.expanded[u.id]||!1,De=C.checked[u.id]||!1,we=W*20,Qe=!ie(u);return D.jsxs("div",{style:{marginLeft:`${we}px`},children:[D.jsxs("div",{className:"category-item",style:{display:"flex",alignItems:"center",padding:"6px 0",minHeight:"32px",borderRadius:"6px",margin:"1px 0",transition:"background-color 0.2s ease"},children:[te&&D.jsx("button",{className:"expand-button",onClick:()=>A(u.id),style:{background:"none",border:"none",cursor:"pointer",padding:"4px",marginRight:"6px",fontSize:"12px",color:"#6b7280",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"20px",minHeight:"20px",transition:"all 0.2s ease"},onMouseEnter:ve=>{ve.currentTarget.style.backgroundColor="#f8fafc",ve.currentTarget.style.color="#334155"},onMouseLeave:ve=>{ve.currentTarget.style.backgroundColor="transparent",ve.currentTarget.style.color="#6b7280"},onFocus:ve=>{ve.currentTarget.style.backgroundColor="#f8fafc",ve.currentTarget.style.color="#334155",ve.currentTarget.style.boxShadow="0 0 0 2px rgba(148, 163, 184, 0.1)"},onBlur:ve=>{ve.currentTarget.style.backgroundColor="transparent",ve.currentTarget.style.color="#6b7280",ve.currentTarget.style.boxShadow="none"},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",transition:"transform 0.2s ease"},children:xe?"expand_more":"chevron_right"})}),!te&&D.jsx("div",{style:{width:"24px",display:"inline-block"}}),D.jsx("input",{type:"checkbox",id:u.id,checked:De,onChange:()=>!Qe&&N(u.id),disabled:Qe,style:{marginRight:"8px",opacity:Qe?.4:1,cursor:Qe?"not-allowed":"pointer",accentColor:"#10b981",width:"14px",height:"14px"}}),u.icon&&!u.parent&&D.jsx("div",{className:"icon-preview",style:{backgroundColor:Qe?"#e5e7eb":u.color??"#6b7280",width:"22px",height:"22px",borderRadius:"6px",display:"inline-flex",alignItems:"center",justifyContent:"center",marginRight:"10px",opacity:Qe?.5:1,boxShadow:Qe?"none":"0 1px 3px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease"},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"13px",color:"white",opacity:Qe?.6:1,fontWeight:"400",fontVariationSettings:'"wght" 400'},children:u.icon})}),D.jsx("label",{htmlFor:u.id,style:{cursor:Qe?"not-allowed":"pointer",fontSize:"14px",fontWeight:Qe?"400":"500",color:Qe?"#9ca3af":"#374151",opacity:Qe?.7:1,lineHeight:"1.4",letterSpacing:"0.1px",transition:"color 0.2s ease"},children:u.name})]}),te&&xe&&u.children&&D.jsx("div",{className:"subcategories",children:u.children.map(ve=>z(ve,W+1))})]},u.id)};return D.jsx("div",{className:"hierarchical-category-filter",children:re.map(u=>z(u))})}function tg({categoryTree:re,categoryState:C,onCategoryToggle:N,onExpandToggle:A,pois:X,loading:ie,error:z,mapType:u,onMapTypeChange:W}){const[te,xe]=Xe.useState(!1);return D.jsxs("div",{children:[ie&&D.jsx("div",{style:{padding:"8px",backgroundColor:"#f0f9ff",borderRadius:"4px",marginBottom:"8px",fontSize:"12px",color:"#0284c7"},children:"Laster POI data..."}),z&&D.jsxs("div",{style:{padding:"8px",backgroundColor:"#fef2f2",borderRadius:"4px",marginBottom:"8px",fontSize:"12px",color:"#dc2626"},children:["Feil: ",z]}),D.jsx("div",{className:"map-type-panel",style:{marginBottom:"16px"},children:D.jsxs("div",{style:{backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",padding:"12px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:[D.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#64748b"},children:"map"}),D.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#334155",letterSpacing:"0.2px"},children:"Type kart"})]}),D.jsxs("div",{style:{display:"flex",gap:"4px",backgroundColor:"#f1f5f9",borderRadius:"6px",padding:"4px"},children:[D.jsx("button",{onClick:()=>W("topo"),style:{flex:1,padding:"8px 12px",backgroundColor:u==="topo"?"#ffffff":"transparent",border:"none",borderRadius:"4px",fontSize:"13px",fontWeight:"500",color:u==="topo"?"#334155":"#64748b",cursor:"pointer",transition:"all 0.2s ease",boxShadow:u==="topo"?"0 1px 2px rgba(0, 0, 0, 0.1)":"none"},children:"Topo"}),D.jsx("button",{onClick:()=>W("satellite"),style:{flex:1,padding:"8px 12px",backgroundColor:u==="satellite"?"#ffffff":"transparent",border:"none",borderRadius:"4px",fontSize:"13px",fontWeight:"500",color:u==="satellite"?"#334155":"#64748b",cursor:"pointer",transition:"all 0.2s ease",boxShadow:u==="satellite"?"0 1px 2px rgba(0, 0, 0, 0.1)":"none"},children:"Satellitt"})]})]})}),D.jsxs("div",{className:"categories-panel",style:{marginBottom:"16px"},children:[D.jsxs("button",{onClick:()=>xe(!te),style:{width:"100%",padding:"8px 12px",backgroundColor:te?"#f1f5f9":"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",fontSize:"13px",fontWeight:"500",color:"#64748b",transition:"all 0.2s ease",marginBottom:te?"8px":"0"},onMouseEnter:De=>{te||(De.currentTarget.style.backgroundColor="#f8fafc",De.currentTarget.style.borderColor="#cbd5e1")},onMouseLeave:De=>{te||(De.currentTarget.style.backgroundColor="#ffffff",De.currentTarget.style.borderColor="#e2e8f0")},onFocus:De=>{De.currentTarget.style.borderColor="#94a3b8",De.currentTarget.style.boxShadow="0 0 0 2px rgba(148, 163, 184, 0.1)"},onBlur:De=>{De.currentTarget.style.borderColor="#e2e8f0",De.currentTarget.style.boxShadow="none"},children:[D.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#64748b"},children:"layers"}),D.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#334155",letterSpacing:"0.2px"},children:"Kategorier"})]}),D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",transform:te?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s ease"},children:"keyboard_arrow_down"})]}),te&&D.jsx("div",{style:{backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:D.jsx("div",{style:{padding:"12px"},children:D.jsx(eg,{categoryTree:re,categoryState:C,onCategoryToggle:N,onExpandToggle:A,pois:X})})})]})]})}function ig({onTrailTypesChange:re}){const[C,N]=Xe.useState(!1),[A,X]=Xe.useState([]),ie=[{type:"hiking",name:"Fottur",icon:"hiking",description:"Vandreruter og fotturer"},{type:"skiing",name:"Skiløype",icon:"downhill_skiing",description:"Langrennsløyper og skiturer"},{type:"cycling",name:"Sykkelrute",icon:"directions_bike",description:"Sykkelruter og sykkeltråkk"},{type:"other",name:"Annen rute",icon:"alt_route",description:"Andre typer ruter og stier"}],z=Xe.useCallback(u=>{const W=A.includes(u)?A.filter(te=>te!==u):[...A,u];X(W),re(W),console.log(`🥾 Trail type ${u} ${W.includes(u)?"enabled":"disabled"}`)},[A,re]);return Xe.useCallback(()=>{X([]),re([]),console.log("🥾 All trail types cleared")},[re]),D.jsxs("div",{className:"trail-panel",style:{marginBottom:"16px"},children:[D.jsxs("button",{onClick:()=>N(!C),style:{width:"100%",padding:"8px 12px",backgroundColor:C?"#f1f5f9":"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",fontSize:"13px",fontWeight:"500",color:A.length>0?"#3e4533":"#64748b",transition:"all 0.2s ease",marginBottom:C?"8px":"0"},onMouseEnter:u=>{C||(u.currentTarget.style.backgroundColor="#f8fafc",u.currentTarget.style.borderColor="#cbd5e1")},onMouseLeave:u=>{C||(u.currentTarget.style.backgroundColor="#ffffff",u.currentTarget.style.borderColor="#e2e8f0")},children:[D.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:A.length>0?"#3e4533":"#64748b"},children:"route"}),D.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:A.length>0?"#3e4533":"#334155",letterSpacing:"0.2px"},children:"Turløyper"}),A.length>0&&D.jsx("span",{style:{fontSize:"11px",backgroundColor:"#3e4533",color:"white",borderRadius:"10px",padding:"2px 6px",fontWeight:"600",minWidth:"16px",textAlign:"center"},children:A.length})]}),D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#64748b",transform:C?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s ease"},children:"keyboard_arrow_down"})]}),C&&D.jsx("div",{style:{backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:D.jsx("div",{style:{padding:"12px"},children:D.jsx("div",{style:{marginBottom:"12px"},children:ie.map(({type:u,name:W,icon:te,description:xe})=>D.jsx("div",{style:{marginBottom:"8px",border:"1px solid #e2e8f0",borderRadius:"6px",overflow:"hidden",transition:"all 0.2s ease"},children:D.jsxs("button",{onClick:()=>z(u),style:{width:"100%",padding:"10px 12px",backgroundColor:A.includes(u)?"#f0f9ff":"#ffffff",border:"none",display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:De=>{A.includes(u)||(De.currentTarget.style.backgroundColor="#f8fafc")},onMouseLeave:De=>{A.includes(u)||(De.currentTarget.style.backgroundColor="#ffffff")},children:[D.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"3px",border:`2px solid ${A.includes(u)?"#3e4533":"#d1d5db"}`,backgroundColor:A.includes(u)?"#3e4533":"#ffffff",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:A.includes(u)&&D.jsx("span",{style:{color:"white",fontSize:"10px",lineHeight:"1"},children:"✓"})}),D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"18px",color:A.includes(u)?"#3e4533":"#64748b"},children:te}),D.jsxs("div",{style:{flex:1,textAlign:"left"},children:[D.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:A.includes(u)?"#3e4533":"#334155",marginBottom:"2px"},children:W}),D.jsx("div",{style:{fontSize:"11px",color:"#6b7280"},children:xe})]})]})},u))})})})]})}function rg({onLayerToggle:re}){const[C,N]=Xe.useState(!1),[A,X]=Xe.useState(new Set),ie=Xe.useCallback(u=>{const W=new Set(A),te=A.has(u);te?W.delete(u):W.add(u),X(W),re(u,!te),console.log(`🌲 Naturskog layer ${u} ${te?"disabled":"enabled"}`)},[A,re]),z=Xe.useCallback(()=>{A.forEach(u=>{re(u,!1)}),X(new Set),console.log("🌲 All Naturskog layers cleared")},[A,re]);return D.jsxs("div",{className:"naturskog-panel",style:{marginBottom:"16px"},children:[D.jsxs("button",{onClick:()=>N(!C),style:{width:"100%",padding:"8px 12px",backgroundColor:C?"#f1f5f9":"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",fontSize:"13px",fontWeight:"500",color:A.size>0?"#3e4533":"#64748b",transition:"all 0.2s ease",marginBottom:C?"8px":"0"},onMouseEnter:u=>{C||(u.currentTarget.style.backgroundColor="#f8fafc",u.currentTarget.style.borderColor="#cbd5e1")},onMouseLeave:u=>{C||(u.currentTarget.style.backgroundColor="#ffffff",u.currentTarget.style.borderColor="#e2e8f0")},children:[D.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:A.size>0?"#3e4533":"#64748b"},children:"forest"}),D.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:A.size>0?"#3e4533":"#334155",letterSpacing:"0.2px"},children:"Naturskog"}),A.size>0&&D.jsx("span",{style:{fontSize:"11px",backgroundColor:"#3e4533",color:"white",borderRadius:"10px",padding:"2px 6px",fontWeight:"600",minWidth:"16px",textAlign:"center"},children:A.size})]}),D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#64748b",transform:C?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s ease"},children:"keyboard_arrow_down"})]}),C&&D.jsx("div",{style:{backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:D.jsxs("div",{style:{padding:"12px"},children:[D.jsx("div",{style:{marginBottom:"12px"},children:If.map(u=>{const W=A.has(u.type);return D.jsx("div",{style:{marginBottom:"8px",border:"1px solid #e2e8f0",borderRadius:"6px",overflow:"hidden",transition:"all 0.2s ease"},children:D.jsxs("button",{onClick:()=>ie(u.type),style:{width:"100%",padding:"10px 12px",backgroundColor:W?"#f0f9ff":"#ffffff",border:"none",display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:te=>{W||(te.currentTarget.style.backgroundColor="#f8fafc")},onMouseLeave:te=>{W||(te.currentTarget.style.backgroundColor="#ffffff")},children:[D.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"3px",border:`2px solid ${W?"#3e4533":"#d1d5db"}`,backgroundColor:W?"#3e4533":"#ffffff",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:W&&D.jsx("span",{style:{color:"white",fontSize:"10px",lineHeight:"1"},children:"✓"})}),D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"18px",color:W?u.color:"#9ca3af"},children:u.icon}),D.jsxs("div",{style:{flex:1,textAlign:"left"},children:[D.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:W?"#075985":"#374151",marginBottom:"2px"},children:u.name}),D.jsx("div",{style:{fontSize:"11px",color:"#6b7280",lineHeight:"1.3"},children:u.description})]})]})},u.type)})}),A.size>0&&D.jsx("button",{onClick:z,style:{width:"100%",padding:"8px 12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"4px",color:"#dc2626",fontSize:"12px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:u=>{u.currentTarget.style.backgroundColor="#fee2e2",u.currentTarget.style.borderColor="#fca5a5"},onMouseLeave:u=>{u.currentTarget.style.backgroundColor="#fef2f2",u.currentTarget.style.borderColor="#fecaca"},children:"Fjern alle kartlag"})]})})]})}const zm=Xe.createContext(void 0),Im=()=>{const re=Xe.useContext(zm);if(re===void 0)throw new Error("useUIStore must be used within a UIProvider");return re};function ng(){const{openHurtigtaster:re}=Im();return D.jsx("div",{style:{marginBottom:"16px"},children:D.jsxs("button",{onClick:re,style:{width:"100%",padding:"12px",backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#334155",transition:"all 0.2s ease",outline:"none"},onMouseEnter:C=>{C.currentTarget.style.backgroundColor="#f8fafc",C.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:C=>{C.currentTarget.style.backgroundColor="#ffffff",C.currentTarget.style.borderColor="#e2e8f0"},onFocus:C=>{C.currentTarget.style.borderColor="#94a3b8",C.currentTarget.style.boxShadow="0 0 0 2px rgba(148, 163, 184, 0.1)"},onBlur:C=>{C.currentTarget.style.borderColor="#e2e8f0",C.currentTarget.style.boxShadow="none"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#64748b"},children:"keyboard"}),D.jsx("span",{children:"Handlinger og hurtigtaster"})]})})}function ag(){const[re,C]=Xe.useState(!1),N=async()=>{try{if(localStorage.clear(),"caches"in window){const A=await caches.keys();await Promise.all(A.map(X=>caches.delete(X)))}sessionStorage.clear(),alert("✅ Alle dine data er slettet. Appen vil nå lastes på nytt."),window.location.reload()}catch(A){console.error("Error deleting data:",A),alert("⚠️ En feil oppstod ved sletting av data. Prøv igjen.")}};return re?D.jsx("div",{style:{marginBottom:"16px"},children:D.jsxs("div",{style:{padding:"16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px"},children:[D.jsx("p",{style:{margin:"0 0 12px 0",fontSize:"14px",fontWeight:"600",color:"#991b1b"},children:"Er du sikker?"}),D.jsx("p",{style:{margin:"0 0 16px 0",fontSize:"13px",color:"#7f1d1d",lineHeight:"1.5"},children:"Dette vil slette alle dine lokalt lagrede data, inkludert:"}),D.jsxs("ul",{style:{margin:"0 0 16px 0",paddingLeft:"20px",fontSize:"13px",color:"#7f1d1d"},children:[D.jsx("li",{children:"Kartvisningsinnstillinger"}),D.jsx("li",{children:"Søkehistorikk"}),D.jsx("li",{children:"Brukerpreferanser"}),D.jsx("li",{children:"Cache-data (offline-kart)"})]}),D.jsxs("div",{style:{display:"flex",gap:"8px"},children:[D.jsx("button",{onClick:N,style:{flex:1,padding:"10px",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background-color 0.2s"},onMouseEnter:A=>{A.currentTarget.style.backgroundColor="#b91c1c"},onMouseLeave:A=>{A.currentTarget.style.backgroundColor="#dc2626"},children:"Ja, slett alt"}),D.jsx("button",{onClick:()=>C(!1),style:{flex:1,padding:"10px",backgroundColor:"#ffffff",color:"#334155",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"14px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:A=>{A.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:A=>{A.currentTarget.style.backgroundColor="#ffffff"},children:"Avbryt"})]})]})}):D.jsx("div",{style:{marginBottom:"16px"},children:D.jsxs("button",{onClick:()=>C(!0),style:{width:"100%",padding:"12px",backgroundColor:"#ffffff",border:"1px solid #fecaca",borderRadius:"6px",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#dc2626",transition:"all 0.2s ease",outline:"none"},onMouseEnter:A=>{A.currentTarget.style.backgroundColor="#fef2f2",A.currentTarget.style.borderColor="#fca5a5"},onMouseLeave:A=>{A.currentTarget.style.backgroundColor="#ffffff",A.currentTarget.style.borderColor="#fecaca"},onFocus:A=>{A.currentTarget.style.borderColor="#f87171",A.currentTarget.style.boxShadow="0 0 0 2px rgba(220, 38, 38, 0.1)"},onBlur:A=>{A.currentTarget.style.borderColor="#fecaca",A.currentTarget.style.boxShadow="none"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#dc2626"},children:"delete_forever"}),D.jsx("span",{children:"Slett mine data"})]})})}const vm=re=>{let C;const N=new Set,A=(te,xe)=>{const De=typeof te=="function"?te(C):te;if(!Object.is(De,C)){const we=C;C=xe??(typeof De!="object"||De===null)?De:Object.assign({},C,De),N.forEach(Ee=>Ee(C,we))}},X=()=>C,u={setState:A,getState:X,getInitialState:()=>W,subscribe:te=>(N.add(te),()=>N.delete(te))},W=C=re(A,X,u);return u},sg=(re=>re?vm(re):vm),og=re=>re;function lg(re,C=og){const N=Ef.useSyncExternalStore(re.subscribe,Ef.useCallback(()=>C(re.getState()),[re,C]),Ef.useCallback(()=>C(re.getInitialState()),[re,C]));return Ef.useDebugValue(N),N}const bm=re=>{const C=sg(re),N=A=>lg(C,A);return Object.assign(N,C),N},cg=(re=>re?bm(re):bm),Rc={SESSION_TIMEOUT:1800*1e3,MAX_LOGIN_ATTEMPTS:5,LOCKOUT_DURATION:900*1e3,TOKEN_LENGTH:32,SALT_ROUNDS:12},Kn={ADMIN_HASH:"trakke_admin_hash_v2",SESSION_TOKEN:"trakke_session_token_v2",LOGIN_ATTEMPTS:"trakke_login_attempts_v2",LOCKOUT_UNTIL:"trakke_lockout_until_v2"};class Rd{static instance;currentSession=null;sessionCheckInterval=null;constructor(){this.initializeSecurityMeasures()}static getInstance(){return Rd.instance||(Rd.instance=new Rd),Rd.instance}initializeSecurityMeasures(){this.startSessionMonitoring(),this.validateCurrentSession(),this.cleanupOldLoginAttempts()}async generateSecureHash(C,N){if(!N){const X=crypto.getRandomValues(new Uint8Array(16));N=Array.from(X,ie=>ie.toString(16).padStart(2,"0")).join("")}let A=C+N;for(let X=0;X<Rc.SALT_ROUNDS;X++){const z=new TextEncoder().encode(A),u=await crypto.subtle.digest("SHA-256",z);A=Array.from(new Uint8Array(u),W=>W.toString(16).padStart(2,"0")).join("")}return{hash:A,salt:N}}async setAdminPassword(C){if(!C||C.length<8)throw new Error("Password must be at least 8 characters long");if(!this.validatePasswordStrength(C))throw new Error("Password must contain uppercase, lowercase, numbers, and special characters");const{hash:N,salt:A}=await this.generateSecureHash(C),X={hash:N,salt:A,createdAt:Date.now(),version:"2.0"};localStorage.setItem(Kn.ADMIN_HASH,JSON.stringify(X)),console.log("✅ Admin password set securely")}validatePasswordStrength(C){return[/[a-z]/,/[A-Z]/,/[0-9]/,/[^A-Za-z0-9]/].every(A=>A.test(C))&&C.length>=8}isLockedOut(){const C=localStorage.getItem(Kn.LOCKOUT_UNTIL);if(!C)return!1;const N=parseInt(C);return Date.now()<N?!0:(localStorage.removeItem(Kn.LOCKOUT_UNTIL),localStorage.removeItem(Kn.LOGIN_ATTEMPTS),!1)}recordFailedAttempt(){const C=this.getLoginAttempts(),N={timestamp:Date.now(),userAgent:navigator.userAgent};if(C.push(N),localStorage.setItem(Kn.LOGIN_ATTEMPTS,JSON.stringify(C)),C.length>=Rc.MAX_LOGIN_ATTEMPTS){const A=Date.now()+Rc.LOCKOUT_DURATION;localStorage.setItem(Kn.LOCKOUT_UNTIL,A.toString()),console.warn(`🔒 Admin account locked for ${Rc.LOCKOUT_DURATION/6e4} minutes due to too many failed attempts`)}}getLoginAttempts(){try{const C=localStorage.getItem(Kn.LOGIN_ATTEMPTS);if(!C)return[];const N=JSON.parse(C),A=Date.now()-3600*1e3;return N.filter(X=>X.timestamp>A)}catch{return[]}}cleanupOldLoginAttempts(){const C=this.getLoginAttempts();C.length===0?localStorage.removeItem(Kn.LOGIN_ATTEMPTS):localStorage.setItem(Kn.LOGIN_ATTEMPTS,JSON.stringify(C))}generateSessionToken(){const C=crypto.getRandomValues(new Uint8Array(Rc.TOKEN_LENGTH)),N=Date.now().toString(),A=Array.from(C,z=>z.toString(16).padStart(2,"0")).join(""),X=A+N;let ie=0;for(let z=0;z<X.length;z++){const u=X.charCodeAt(z);ie=(ie<<5)-ie+u,ie=ie&ie}return Math.abs(ie).toString(16)+A.slice(0,16)}async login(C){try{if(this.isLockedOut()){const te=localStorage.getItem(Kn.LOCKOUT_UNTIL);return{success:!1,message:`Account locked. Try again in ${Math.ceil((parseInt(te)-Date.now())/6e4)} minutes.`}}const N=localStorage.getItem(Kn.ADMIN_HASH);if(!N)return{success:!1,message:"Admin account not configured. Please set up admin password first."};const{hash:A,salt:X}=JSON.parse(N),{hash:ie}=await this.generateSecureHash(C,X);if(ie!==A)return this.recordFailedAttempt(),{success:!1,message:"Invalid password. Please try again."};const z=this.generateSessionToken(),u=Date.now()+Rc.SESSION_TIMEOUT;this.currentSession={token:z,expiresAt:u,lastActivity:Date.now(),permissions:["poi_manage","data_export","data_import"]};const W={token:this.currentSession.token,expiresAt:this.currentSession.expiresAt,permissions:this.currentSession.permissions};return localStorage.setItem(Kn.SESSION_TOKEN,JSON.stringify(W)),localStorage.removeItem(Kn.LOGIN_ATTEMPTS),localStorage.removeItem(Kn.LOCKOUT_UNTIL),console.log("✅ Admin login successful"),{success:!0,message:"Login successful"}}catch(N){return console.error("❌ Login error:",N),{success:!1,message:"Login failed due to system error"}}}validateCurrentSession(){try{const C=localStorage.getItem(Kn.SESSION_TOKEN);if(!C||!this.currentSession)return this.logout(),!1;const{expiresAt:N}=JSON.parse(C);return Date.now()>N?(console.log("🕐 Admin session expired"),this.logout(),!1):(this.currentSession&&(this.currentSession.lastActivity=Date.now()),!0)}catch{return this.logout(),!1}}hasPermission(C){return this.validateCurrentSession()?this.currentSession?.permissions.includes(C)??!1:!1}getCurrentSession(){return this.validateCurrentSession()?this.currentSession:null}isAuthenticated(){return this.validateCurrentSession()}logout(){this.currentSession=null,localStorage.removeItem(Kn.SESSION_TOKEN),this.sessionCheckInterval&&(clearInterval(this.sessionCheckInterval),this.sessionCheckInterval=null),console.log("🔓 Admin logged out")}startSessionMonitoring(){this.sessionCheckInterval=setInterval(()=>{this.currentSession&&this.validateCurrentSession()},6e4)}extendSession(){if(!this.currentSession)return;const C=Date.now()+Rc.SESSION_TIMEOUT;this.currentSession.expiresAt=C,this.currentSession.lastActivity=Date.now();const N={token:this.currentSession.token,expiresAt:C,permissions:this.currentSession.permissions};localStorage.setItem(Kn.SESSION_TOKEN,JSON.stringify(N))}getSecurityStatus(){const C=this.getLoginAttempts();return{isLocked:this.isLockedOut(),recentAttempts:C.length,maxAttempts:Rc.MAX_LOGIN_ATTEMPTS,sessionTimeout:Rc.SESSION_TIMEOUT/6e4,hasAdminPassword:!!localStorage.getItem(Kn.ADMIN_HASH)}}cleanup(){this.sessionCheckInterval&&(clearInterval(this.sessionCheckInterval),this.sessionCheckInterval=null)}}const Oc=Rd.getInstance();typeof window<"u"&&(window.adminService=Oc);const Lc={sanitizeInput(re){return re.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim()},validateCoordinates(re,C){return typeof re=="number"&&typeof C=="number"&&re>=-90&&re<=90&&C>=-180&&C<=180&&!isNaN(re)&&!isNaN(C)},generateCSRFToken(){const re=crypto.getRandomValues(new Uint8Array(16));return Array.from(re,C=>C.toString(16).padStart(2,"0")).join("")}},sm=cg((re,C)=>({isAuthenticated:!1,session:null,loginStatus:"idle",loginError:null,showAdminLogin:!1,showAdminPanel:!1,login:async N=>{re({loginStatus:"loading",loginError:null});try{const A=await Oc.login(N);if(A.success){const X=Oc.getCurrentSession();re({isAuthenticated:!0,session:X,loginStatus:"success",loginError:null,showAdminLogin:!1,showAdminPanel:!0}),console.log("✅ Admin login successful - session established")}else re({isAuthenticated:!1,session:null,loginStatus:"error",loginError:A.message})}catch(A){console.error("❌ Login error:",A),re({isAuthenticated:!1,session:null,loginStatus:"error",loginError:"Login failed due to system error"})}},logout:()=>{Oc.logout(),re({isAuthenticated:!1,session:null,loginStatus:"idle",loginError:null,showAdminLogin:!1,showAdminPanel:!1}),console.log("🔓 Admin logged out - session cleared")},checkAuthentication:()=>{const N=Oc.isAuthenticated(),A=Oc.getCurrentSession();re({isAuthenticated:N,session:N?A:null}),!N&&C().showAdminPanel&&re({showAdminPanel:!1})},extendSession:()=>{if(C().isAuthenticated){Oc.extendSession();const N=Oc.getCurrentSession();re({session:N})}},setShowAdminLogin:N=>{re({showAdminLogin:N}),N&&re({loginError:null,loginStatus:"idle"})},setShowAdminPanel:N=>{if(N&&!C().isAuthenticated){re({showAdminLogin:!0});return}re({showAdminPanel:N})},clearLoginError:()=>{re({loginError:null,loginStatus:"idle"})},hasPermission:N=>Oc.hasPermission(N)})),ug={POI_MANAGE:"poi_manage"};function hg(){const{isAuthenticated:re,setShowAdminLogin:C,setShowAdminPanel:N,session:A}=sm();return D.jsx("div",{style:{marginBottom:"16px"},children:re?D.jsxs("button",{onClick:()=>N(!0),style:{width:"100%",padding:"12px",backgroundColor:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:"6px",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#15803d",transition:"all 0.2s ease"},onMouseEnter:X=>{X.currentTarget.style.backgroundColor="#dcfce7",X.currentTarget.style.borderColor="#86efac"},onMouseLeave:X=>{X.currentTarget.style.backgroundColor="#f0fdf4",X.currentTarget.style.borderColor="#bbf7d0"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#15803d"},children:"admin_panel_settings"}),D.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[D.jsx("span",{children:"Admin"}),D.jsx("span",{style:{fontSize:"11px",color:"#16a34a",fontWeight:"400"},children:A?`Login utløper ${new Date(A.expiresAt).toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"})}`:"Aktiv økt"})]})]}):D.jsxs("button",{onClick:()=>C(!0),style:{width:"100%",padding:"12px",backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#334155",transition:"all 0.2s ease",outline:"none"},onMouseEnter:X=>{X.currentTarget.style.backgroundColor="#f8fafc",X.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:X=>{X.currentTarget.style.backgroundColor="#ffffff",X.currentTarget.style.borderColor="#e2e8f0"},onFocus:X=>{X.currentTarget.style.borderColor="#94a3b8",X.currentTarget.style.boxShadow="0 0 0 2px rgba(148, 163, 184, 0.1)"},onBlur:X=>{X.currentTarget.style.borderColor="#e2e8f0",X.currentTarget.style.boxShadow="none"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#64748b"},children:"login"}),D.jsx("span",{children:"Admin"})]})})}function dg({trail:re,onClose:C}){const[N,A]=Xe.useState([]),[X,ie]=Xe.useState(!1);if(Xe.useEffect(()=>{if(!re){A([]);return}(async()=>{ie(!0);try{const Ee=await Np.getElevationProfile(re,30);A(Ee)}catch(Ee){console.error("Failed to load elevation profile:",Ee),A([])}finally{ie(!1)}})()},[re]),!re)return null;const z=we=>we>=1e3?`${(we/1e3).toFixed(1)} km`:`${Math.round(we)} m`,u=we=>{if(!we)return"Ukjent varighet";const Ee=Math.floor(we/60),Qe=we%60;return Ee>0?`${Ee}t ${Qe}min`:`${Qe}min`},W=we=>{switch(we){case"easy":return"#22c55e";case"medium":return"#f59e0b";case"hard":return"#ef4444";case"expert":return"#8b5cf6";default:return"#6b7280"}},te=we=>{switch(we){case"hiking":return"hiking";case"skiing":return"downhill_skiing";case"cycling":return"directions_bike";case"mixed":return"sports";default:return"route"}},xe=we=>{switch(we){case"hiking":return"Fottur";case"skiing":return"Ski";case"cycling":return"Sykkel";case"mixed":return"Blandet";default:return"Annet"}},De=we=>{switch(we){case"easy":return"Lett";case"medium":return"Middels";case"hard":return"Vanskelig";case"expert":return"Ekspert";default:return"Ukjent"}};return D.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:C,children:D.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:window.innerWidth<768?"20px":"28px",maxWidth:"600px",width:"100%",boxShadow:"0 8px 32px rgba(0,0,0,0.12)",maxHeight:"80vh",overflowY:"auto"},onClick:we=>we.stopPropagation(),children:[D.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"20px"},children:[D.jsxs("div",{style:{flex:1},children:[D.jsx("h2",{style:{margin:"0 0 8px 0",fontSize:"20px",fontWeight:"600",color:"#111827",lineHeight:"1.3"},children:re.properties.name}),D.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:W(re.properties.difficulty)},children:te(re.properties.type)}),D.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:xe(re.properties.type)}),D.jsx("div",{style:{width:"4px",height:"4px",borderRadius:"50%",backgroundColor:"#d1d5db"}}),D.jsx("div",{style:{padding:"2px 8px",borderRadius:"4px",backgroundColor:W(re.properties.difficulty),color:"white",fontSize:"12px",fontWeight:"500"},children:De(re.properties.difficulty)})]})]}),D.jsx("button",{onClick:C,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"16px"},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"24px",color:"#6b7280"},children:"close"})})]}),D.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"12px",marginBottom:"20px"},children:[D.jsxs("div",{style:{textAlign:"center",padding:"12px",backgroundColor:"#f8fafc",borderRadius:"6px"},children:[D.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#111827"},children:z(re.properties.distance)}),D.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Avstand"})]}),re.properties.estimatedTime&&D.jsxs("div",{style:{textAlign:"center",padding:"12px",backgroundColor:"#f8fafc",borderRadius:"6px"},children:[D.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#111827"},children:u(re.properties.estimatedTime)}),D.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Estimert tid"})]}),re.properties.elevationGain&&D.jsxs("div",{style:{textAlign:"center",padding:"12px",backgroundColor:"#f8fafc",borderRadius:"6px"},children:[D.jsxs("div",{style:{fontSize:"18px",fontWeight:"600",color:"#111827"},children:[re.properties.elevationGain,"m"]}),D.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Stigning"})]})]}),re.properties.description&&D.jsxs("div",{style:{marginBottom:"20px"},children:[D.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"16px",fontWeight:"600",color:"#111827"},children:"Beskrivelse"}),D.jsx("p",{style:{margin:0,fontSize:"14px",color:"#374151",lineHeight:"1.6"},children:re.properties.description})]}),D.jsxs("div",{style:{marginBottom:"20px"},children:[D.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"16px",fontWeight:"600",color:"#111827"},children:"Lokasjon"}),D.jsxs("div",{style:{fontSize:"14px",color:"#374151"},children:[re.properties.municipality,re.properties.county&&re.properties.county!==re.properties.municipality&&D.jsxs("span",{children:[", ",re.properties.county]})]})]}),D.jsxs("div",{style:{marginBottom:"20px"},children:[D.jsx("h3",{style:{margin:"0 0 12px 0",fontSize:"16px",fontWeight:"600",color:"#111827"},children:"Høydeprofil"}),X?D.jsx("div",{style:{height:"120px",backgroundColor:"#f8fafc",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",color:"#6b7280"},children:"Laster høydeprofil..."}):N.length>0?D.jsx("div",{style:{height:"120px",backgroundColor:"#f8fafc",borderRadius:"6px",padding:"12px",position:"relative"},children:D.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 400 80",style:{overflow:"visible"},children:(()=>{if(N.length<2)return null;const we=Math.max(...N.map(wt=>wt.distance)),Ee=Math.min(...N.map(wt=>wt.elevation)),Qe=Math.max(...N.map(wt=>wt.elevation)),ve=Qe-Ee||1,St=N.map(wt=>{const jt=wt.distance/we*400,$t=80-(wt.elevation-Ee)/ve*80;return`${jt},${$t}`}).join(" ");return D.jsxs(D.Fragment,{children:[D.jsx("polygon",{points:`0,80 ${St} 400,80`,fill:"#3e4533",fillOpacity:"0.1"}),D.jsx("polyline",{points:St,fill:"none",stroke:"#3e4533",strokeWidth:"2"}),D.jsxs("text",{x:"5",y:"15",fontSize:"10",fill:"#6b7280",children:[Math.round(Qe),"m"]}),D.jsxs("text",{x:"5",y:"75",fontSize:"10",fill:"#6b7280",children:[Math.round(Ee),"m"]}),D.jsx("text",{x:"350",y:"75",fontSize:"10",fill:"#6b7280",children:z(we)})]})})()})}):D.jsx("div",{style:{height:"120px",backgroundColor:"#f8fafc",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",color:"#6b7280"},children:"Ingen høydedata tilgjengelig"})]}),D.jsxs("div",{style:{marginBottom:"20px"},children:[D.jsx("h3",{style:{margin:"0 0 8px 0",fontSize:"16px",fontWeight:"600",color:"#111827"},children:"Detaljer"}),D.jsxs("div",{style:{fontSize:"14px",color:"#374151",display:"flex",flexDirection:"column",gap:"4px"},children:[re.properties.surface&&D.jsxs("div",{children:[D.jsx("strong",{children:"Underlag:"})," ",re.properties.surface]}),re.properties.maintainer&&D.jsxs("div",{children:[D.jsx("strong",{children:"Vedlikeholder:"})," ",re.properties.maintainer]}),re.metadata.source&&D.jsxs("div",{children:[D.jsx("strong",{children:"Datakilde:"})," ",re.metadata.source]}),D.jsxs("div",{children:[D.jsx("strong",{children:"Sist oppdatert:"})," ",new Date(re.metadata.lastUpdated).toLocaleDateString("no-NO")]})]})]})]})})}const im=new Map,pg=300*1e3,Af={south:57.5,west:4,north:72,east:32};function Ld(re,C){return re>=Af.south&&re<=Af.north&&C>=Af.west&&C<=Af.east}function So(re){return typeof re=="number"&&!isNaN(re)&&isFinite(re)}function Df(re){return re&&re.charAt(0).toUpperCase()+re.slice(1)}function Dh(re){return re&&re.split(" ").map(C=>Df(C.toLowerCase())).join(" ")}async function fg(re,C){try{console.log(`🔍 Reverse geocoding coordinates: ${re}, ${C}`);const A=`https://ws.geonorge.no/stedsnavn/v1/punkt?nord=${re}&ost=${C}&radius=1000&maxAnt=3`,X=await fetch(A);if(!X.ok)return console.warn(`⚠️ Reverse geocoding failed: ${X.status}`),null;const z=(await X.json()).navn||[];if(z.length>0){const u=["by","bygd","tettsted","gård","naturområde","fjell","dal","ø","vatn"];let W=z[0];for(const Ee of u){const Qe=z.find(ve=>ve.navneobjekttype?.toLowerCase().includes(Ee)||ve.stedtype?.toLowerCase().includes(Ee));if(Qe){W=Qe;break}}const te=W.skrivemåte||W.stedsnavn||W.navn,xe=W.navneobjekttype||W.stedtype||"sted",De=W.kommuner?.[0]?.kommunenavn;if(!te)return null;let we=te;return De&&De!==te&&(we+=`, ${De}`),console.log(`✅ Found place: ${we} (${xe})`),we}return null}catch(N){return console.warn("⚠️ Reverse geocoding error:",N),null}}function mg(re){const C=re.trim(),N=/^(\d+\.?\d*)°?\s*([NS])\s*,?\s*(\d+\.?\d*)°?\s*([EW])$/i,A=C.match(N);if(A){let te=parseFloat(A[1]);const xe=A[2].toUpperCase();let De=parseFloat(A[3]);const we=A[4].toUpperCase();if(xe==="S"&&(te=-te),we==="W"&&(De=-De),So(te)&&So(De)&&Ld(te,De))return console.log(`📍 Parsed coordinates (degree-direction): ${te}, ${De}`),{lat:te,lng:De,format:"decimal"}}const X=re.replace(/['"′″]/g,"").trim(),ie=X.match(/^(-?\d+\.?\d*)[,\s]+(-?\d+\.?\d*)$/);if(ie){const te=parseFloat(ie[1]),xe=parseFloat(ie[2]);if(So(te)&&So(xe)&&Ld(te,xe))return console.log(`📍 Parsed coordinates (decimal): ${te}, ${xe}`),{lat:te,lng:xe,format:"decimal"}}const z=X.match(/^([NS])\s*(\d+\.?\d*)[,\s]+([EW])\s*(\d+\.?\d*)$/i);if(z){const te=z[1].toUpperCase();let xe=parseFloat(z[2]);const De=z[3].toUpperCase();let we=parseFloat(z[4]);if(te==="S"&&(xe=-xe),De==="W"&&(we=-we),So(xe)&&So(we)&&Ld(xe,we))return console.log(`📍 Parsed coordinates (prefix-direction): ${xe}, ${we}`),{lat:xe,lng:we,format:"decimal"}}const u=/(\d+)[°\s]*(\d+)?['\s]*(\d+\.?\d*)?["\s]*([NS])\s*[,\s]*(\d+)[°\s]*(\d+)?['\s]*(\d+\.?\d*)?["\s]*([EW])/i,W=X.match(u);if(W){const te=parseInt(W[1],10),xe=parseInt(W[2]||"0",10),De=parseFloat(W[3]||"0"),we=W[4].toUpperCase(),Ee=parseInt(W[5],10),Qe=parseInt(W[6]||"0",10),ve=parseFloat(W[7]||"0"),St=W[8].toUpperCase();let wt=te+xe/60+De/3600,jt=Ee+Qe/60+ve/3600;if(we==="S"&&(wt=-wt),St==="W"&&(jt=-jt),So(wt)&&So(jt)&&Ld(wt,jt))return console.log(`📍 Parsed coordinates (DMS): ${wt}, ${jt}`),{lat:wt,lng:jt,format:"dms"}}return null}function gg(re,C){const N=re.toLowerCase();return C.filter(A=>{const X=A.name.toLowerCase().includes(N),ie=A.description.toLowerCase().includes(N);return X||ie}).map(A=>{const X=Dh(A.name),ie=Df(A.description);return{id:`poi_${A.id}`,name:X,displayName:X,lat:A.lat,lng:A.lng,type:"poi",source:"internal",description:ie}}).slice(0,5)}const yg={By:"by",Tettsted:"tettsted",Grend:"grend",Kommune:"kommune",Fylke:"fylke",Bydel:"bydel",Kretsdel:"kretsdel",Fjell:"fjell",Topp:"topp",Høyde:"høyde",Ås:"ås",Egg:"egg",Kam:"kam",Rygg:"rygg",Dal:"dal",Dalen:"dalen",Juv:"juv",Kløft:"kløft",Li:"li",Skråning:"skråning",Platei:"plateau",Vidde:"vidde",Heii:"hei",Innsjø:"innsjø",Vatn:"vatn",Tjern:"tjern",Tjnn:"tjern",Dam:"dam",Elv:"elv",Bekk:"bekk",Å:"å",Foss:"foss",Stryk:"stryk",Kilde:"kilde",Fjord:"fjord",Sund:"sund",Bukt:"bukt",Vik:"vik",Strand:"strand",Øy:"øy",Holme:"holme",Skjær:"skjær",Grunn:"grunn",Skog:"skog",Myr:"myr",Mosse:"mosse",Sump:"sump",Eng:"eng",Mark:"mark",Lynghei:"lynghei",Slette:"slette",Bre:"bre",Snøfond:"snøfond",Ur:"ur",Gård:"gård",Gårdstun:"gårdstun",Husklynge:"husklynge",Ruin:"ruin",Tuft:"tuft",Kirke:"kirke",Kapell:"kapell",Kloster:"kloster",Minnesmere:"minnesmerke",Gravfelt:"gravfelt",Røys:"røys",Steinsetning:"steinsetning",Varde:"varde",Skole:"skole",Sykehus:"sykehus",Stasjon:"stasjon",Jernbanestasjon:"jernbanestasjon",Holdeplass:"holdeplass",Havn:"havn",Hamn:"hamn",Kai:"kai",Flyplass:"flyplass",Landingsstripe:"landingsplass",Bru:"bru",Færgekai:"færgekai",Tunnel:"tunnel",Vei:"vei",Gate:"gate",Plass:"plass",Torg:"torg",Hytte:"hytte",Bu:"bu",Koie:"koie",Seter:"seter",Støl:"støl",Gapahuk:"gapahuk",Vindskjul:"vindskjul",Rasteplass:"rasteplass",Utsiktspunkt:"utsiktspunkt",Aussichtspunkt:"utsiktspunkt",Trigpunkt:"trigpunkt",Høydemrke:"høydemærke",Grotte:"grotte",Hule:"hule",Berg:"berg",Steinbrudd:"steinbrudd",Gruv:"gruv"};async function _g(re){const C=[];try{const N=encodeURIComponent(re.trim()),A=`https://ws.geonorge.no/adresser/v1/sok?sok=${N}&treffPerSide=10&side=1`,X=await rm(A);if(!X||X.length===0){const ie=re.match(/^(.+?)\s+(\d+[A-Za-z]?)\s*$/);if(ie){const z=ie[1].trim();console.log(`🏠 Ingen eksakt match for "${re}", prøver gatenavn: "${z}"`);const u=`https://ws.geonorge.no/adresser/v1/sok?sok=${encodeURIComponent(z)}&treffPerSide=8&side=1`,W=await rm(u);W&&W.length>0&&C.push(...W)}}else C.push(...X);if(C.length===0){console.log(`🏠 Prøver fuzzy search for "${re}"`);const ie=`https://ws.geonorge.no/adresser/v1/sok?sok=${N}&treffPerSide=10&side=1&fuzzy=true`,z=await rm(ie);z&&C.push(...z)}return C}catch(N){return console.error("Adresse søkefeil:",N),[]}}async function rm(re){try{console.log("🏠 Kartverket adresse søk:",re);const C=new AbortController,N=setTimeout(()=>C.abort(),8e3),A=await fetch(re,{headers:{Accept:"application/json","User-Agent":"Trakke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},signal:C.signal});if(clearTimeout(N),!A.ok)throw new Error(`Kartverket Address API feil: ${A.status}`);const X=await A.json();return console.log(`🏠 Kartverket adresse resultater: ${X.metadata.totaltAntallTreff} treff, returnerer ${X.adresser?.length||0}`),!X.adresser||!Array.isArray(X.adresser)?[]:X.adresser.map(ie=>{if(!ie.representasjonspunkt)return null;const z=ie.representasjonspunkt.lat,u=ie.representasjonspunkt.lon;if(!So(z)||!So(u)||!Ld(z,u))return console.warn(`❌ Invalid coordinates for address ${ie.adressetekst}: lat=${z}, lng=${u}`),null;const W=Dh(ie.adressetekst),te=Dh(ie.kommunenavn);return{id:`kartverket_addr_${ie.adressenavn}_${ie.nummer}_${ie.postnummer}`,name:W,displayName:`${W}, ${te}`,lat:z,lng:u,type:"address",source:"kartverket",municipality:te,description:`Adresse i ${te} kommune (${ie.postnummer})`}}).filter(ie=>ie!==null).slice(0,6)}catch(C){return console.error("Address search error:",C),[]}}async function xg(re){try{const N=`https://ws.geonorge.no/stedsnavn/v1/navn?sok=${encodeURIComponent(re.trim())}*&treffPerSide=10&side=1&kommunenummer=*&fuzzy=true`;console.log("🗺️ Kartverket søk:",N);const A=new AbortController,X=setTimeout(()=>A.abort(),8e3),ie=await fetch(N,{headers:{Accept:"application/json","User-Agent":"Trakke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},signal:A.signal});if(clearTimeout(X),!ie.ok)throw new Error(`Kartverket API feil: ${ie.status}`);const z=await ie.json();return console.log(`📍 Kartverket resultater: ${z.metadata.totaltAntallTreff} treff, returnerer ${z.navn?.length||0}`),!z.navn||!Array.isArray(z.navn)?[]:z.navn.map(u=>{if(!u.representasjonspunkt)return null;const W=u.representasjonspunkt.nord,te=u.representasjonspunkt.øst;if(!So(W)||!So(te)||!Ld(W,te))return console.warn(`❌ Invalid coordinates for ${u.skrivemåte}: lat=${W}, lng=${te}`),null;const xe=u.kommuner?.[0]?.kommunenavn?Dh(u.kommuner[0].kommunenavn):"",De=u.fylker?.[0]?.fylkesnavn?Dh(u.fylker[0].fylkesnavn):"",we=yg[u.navneobjekttype]||u.navneobjekttype.toLowerCase(),Ee=Dh(u.skrivemåte),Qe=vg(u,we,xe,De);return{id:`kartverket_${u.stedsnummer}`,name:Ee,displayName:Qe,lat:W,lng:te,type:"place",source:"kartverket",municipality:xe,county:De,description:Df(`${we}${xe?` i ${xe} kommune`:""}${De?`, ${De} fylke`:""}`)}}).filter(u=>u!==null).slice(0,6)}catch(C){return C instanceof Error?C.name==="AbortError"?console.warn("Kartverket søk timed out"):console.error("Kartverket søkefeil:",C.message):console.error("Ukjent Kartverket feil:",C),[]}}function vg(re,C,N,A){const X=Dh(re.skrivemåte);return["Oslo","Bergen","Trondheim","Stavanger","Kristiansand","Tromsø","Drammen"].includes(X)&&C==="by"?X:re.navneobjekttype==="Kommune"?`${X} kommune`:re.navneobjekttype==="Fylke"?`${X} fylke`:(["gate","vei","plass","torg"].some(z=>X.toLowerCase().includes(z)),N&&N!==X?`${X}, ${N}`:A?`${X}, ${A}`:X)}function bg(re,C,N,A){const ie=(N-re)*Math.PI/180,z=(A-C)*Math.PI/180,u=Math.sin(ie/2)*Math.sin(ie/2)+Math.cos(re*Math.PI/180)*Math.cos(N*Math.PI/180)*Math.sin(z/2)*Math.sin(z/2);return 6371*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}function wg(re,C){const N=C.toLowerCase();return re.filter((X,ie)=>!re.slice(0,ie).some(z=>bg(X.lat,X.lng,z.lat,z.lng)<.5)).sort((X,ie)=>{if(X.type==="coordinates")return-1;if(ie.type==="coordinates")return 1;if(X.type==="poi"&&ie.type!=="poi")return-1;if(ie.type==="poi"&&X.type!=="poi")return 1;if(X.type==="place"&&ie.type==="address")return-1;if(ie.type==="place"&&X.type==="address")return 1;const z=X.type==="address"&&(X.name.toLowerCase().startsWith(N)||X.name.toLowerCase()===N),u=ie.type==="address"&&(ie.name.toLowerCase().startsWith(N)||ie.name.toLowerCase()===N);if(z&&ie.type==="place"&&!ie.name.toLowerCase().startsWith(N))return-1;if(u&&X.type==="place"&&!X.name.toLowerCase().startsWith(N))return 1;const W=X.name.toLowerCase()===N,te=ie.name.toLowerCase()===N;if(W&&!te)return-1;if(te&&!W)return 1;const xe=X.name.toLowerCase().startsWith(N),De=ie.name.toLowerCase().startsWith(N);return xe&&!De?-1:De&&!xe?1:X.displayName.localeCompare(ie.displayName,"no")}).slice(0,12)}class Pm{async search(C,N=[]){const A=C.trim();if(!A)return[];const X=A.toLowerCase(),ie=im.get(X);if(ie&&Date.now()-ie.timestamp<pg)return ie.results;const z=[];try{const W=mg(A);if(W){const we=await fg(W.lat,W.lng),Ee=`${W.lat.toFixed(5)}°N, ${W.lng.toFixed(5)}°E`;z.push({id:`coord_${W.lat}_${W.lng}`,name:we||"Koordinater",displayName:we?`${we} • ${Ee}`:Ee,lat:W.lat,lng:W.lng,type:"coordinates",source:"koordinater",description:we?`${we} - ${Ee}`:Df(`Koordinater (${W.format})`)})}const te=gg(X,N);z.push(...te);const xe=await xg(A);z.push(...xe);const De=await _g(A);z.push(...De)}catch(W){console.error("Søkefeil:",W)}const u=wg(z,X);return im.set(X,{results:u,timestamp:Date.now()}),u}clearCache(){im.clear()}}const Sg=new Pm,Dm=Xe.forwardRef(({onLocationSelect:re,pois:C,placeholder:N="Hvor går turen?",className:A=""},X)=>{const[ie,z]=Xe.useState(""),[u,W]=Xe.useState([]),[te,xe]=Xe.useState(!1),[De,we]=Xe.useState(!1),[Ee,Qe]=Xe.useState(-1),[ve,St]=Xe.useState(null),wt=Xe.useRef(null),jt=Xe.useRef(null),$t=Xe.useRef(null),Fi=`searchbox-listbox-${Math.random().toString(36).substring(2,9)}`;Xe.useImperativeHandle(X,()=>({focusInput:()=>{wt.current&&wt.current.focus()}}));const Rt=Xe.useCallback(Vt=>{console.error("Søkefeil:",Vt),St("Søket feilet. Prøv igjen."),W([]),xe(!1),we(!1),setTimeout(()=>St(null),3e3)},[]),vt=Xe.useCallback(async Vt=>{if(!Vt.trim()){W([]),xe(!1);return}we(!0),St(null);try{const Kt=await Sg.search(Vt,C);W(Kt),xe(Kt.length>0),Qe(-1)}catch(Kt){Rt(Kt instanceof Error?Kt:new Error("Ukjent feil"))}finally{we(!1)}},[C,Rt]),Ft=Vt=>{const Kt=Vt.target.value;z(Kt),St(null),$t.current&&(clearTimeout($t.current),$t.current=null),$t.current=setTimeout(()=>{vt(Kt)},300)},wi=Xe.useCallback((Vt,Kt=!0)=>{z(Vt.displayName),Kt&&(xe(!1),Qe(-1),wt.current?.blur()),re(Vt)},[re]),Ui=Vt=>{if(!te||u.length===0){Vt.key==="ArrowDown"&&u.length>0&&(Vt.preventDefault(),xe(!0),Qe(0));return}switch(Vt.key){case"ArrowDown":Vt.preventDefault(),Qe(Kt=>(Kt+1)%u.length);break;case"ArrowUp":Vt.preventDefault(),Qe(Kt=>Kt<=0?u.length-1:Kt-1);break;case"Enter":Vt.preventDefault(),Ee>=0&&Ee<u.length&&wi(u[Ee]);break;case"Escape":xe(!1),Qe(-1),wt.current?.blur();break;case"Tab":Ee>=0&&Ee<u.length&&(Vt.preventDefault(),wi(u[Ee],!1)),xe(!1);break}};Xe.useEffect(()=>{const Vt=Kt=>{const qi=Kt.target,He=jt.current?.contains(qi),gt=wt.current?.contains(qi);!He&&!gt&&(xe(!1),Qe(-1))};return document.addEventListener("mousedown",Vt),()=>{document.removeEventListener("mousedown",Vt),$t.current&&clearTimeout($t.current)}},[]);const Ri=()=>{z(""),W([]),xe(!1),Qe(-1),St(null),wt.current?.focus()},Yi=Vt=>({coordinates:"Koordinater",poi:"POI",address:"Adresse",place:"Sted"})[Vt]||"Ukjent",Ci=Vt=>`${Fi}-option-${Vt}`;return D.jsxs("div",{className:`search-box ${A}`,"data-search-box":!0,children:[D.jsxs("div",{className:"search-input-container",children:[D.jsx("input",{ref:wt,type:"text",value:ie,onChange:Ft,onKeyDown:Ui,onFocus:()=>{u.length>0&&xe(!0)},placeholder:N,className:"search-input",role:"combobox","aria-expanded":te,"aria-haspopup":"listbox","aria-owns":te?Fi:void 0,"aria-activedescendant":Ee>=0?Ci(Ee):void 0,"aria-autocomplete":"list","aria-label":"Søk etter steder og koordinater"}),ie&&D.jsx("button",{onClick:Ri,className:"search-clear",title:"Tøm søk","aria-label":"Tøm søkefeltet",type:"button",children:"×"})]}),ve&&D.jsxs("div",{className:"search-error",role:"alert","aria-live":"polite",children:[D.jsx("span",{style:{fontSize:"16px"},children:"⚠"}),ve]}),te&&u.length>0&&D.jsxs("div",{ref:jt,className:"search-results",role:"listbox",id:Fi,"aria-label":"Søkeresultater",children:[u.map((Vt,Kt)=>D.jsx("div",{id:Ci(Kt),className:`search-result-item ${Kt===Ee?"selected":""}`,onClick:()=>wi(Vt),onMouseEnter:()=>Qe(Kt),role:"option","aria-selected":Kt===Ee,tabIndex:-1,children:D.jsxs("div",{className:"result-content",children:[D.jsx("div",{className:"result-name",children:Vt.displayName}),Vt.description&&D.jsx("div",{className:"result-description",children:Vt.description}),D.jsxs("div",{className:"result-meta",children:[D.jsx("span",{className:"result-type",children:Yi(Vt.type)}),D.jsxs("span",{className:"result-coords","aria-label":`Koordinater ${Vt.lat.toFixed(4)}, ${Vt.lng.toFixed(4)}`,children:[Vt.lat.toFixed(4),", ",Vt.lng.toFixed(4)]})]})]})},Vt.id)),D.jsxs("div",{className:"search-help",role:"note",children:[D.jsx("small",{children:"💡 Du kan utvide kategoriene nedenfor og velge det du vil se på kartet."}),D.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"12px",marginTop:"6px",fontSize:"11px",color:"#9ca3af"},children:[D.jsx("span",{children:"↑↓ Naviger"}),D.jsx("span",{children:"↵ Velg"})]})]})]}),te&&u.length===0&&!De&&ie.trim()&&!ve&&D.jsx("div",{ref:jt,className:"search-results",children:D.jsxs("div",{className:"search-no-results",role:"status","aria-live":"polite",children:[D.jsx("span",{style:{fontSize:"32px"},"aria-hidden":"true",children:"🔍"}),D.jsxs("div",{children:['Ingen resultater for "',ie,'"']}),D.jsx("small",{children:"Prøv stedsnavn, koordinater eller andre søkeord"})]})})]})});Dm.displayName="SearchBox";const Dd=[{id:"aktivitet",name:"Aktivitet",icon:"sentiment_satisfied",color:"#3e4533",children:[{id:"badeplass",name:"Badeplass",parent:"aktivitet",poiTypes:["swimming"],icon:"pool",color:"#0d9488"},{id:"badeplass_med_strand",name:"Badeplass med strand",parent:"aktivitet",poiTypes:["beach"],icon:"beach_access",color:"#0d9488"},{id:"bålplass",name:"Bål-/grillplass",parent:"aktivitet",poiTypes:["fire_places"],icon:"local_fire_department",color:"#0d9488"},{id:"fiskeplass",name:"Fiskeplass",parent:"aktivitet",poiTypes:["fishing_spots"],icon:"phishing",color:"#0d9488"},{id:"kanopadling",name:"Kanopadling",parent:"aktivitet",poiTypes:["canoeing"],icon:"kayaking",color:"#0d9488"}]},{id:"naturperle",name:"Naturperle",icon:"landscape",color:"#059669",children:[{id:"foss",name:"Foss",parent:"naturperle",poiTypes:["nature_gems"],icon:"water_drop",color:"#059669"},{id:"utsiktspunkt",name:"Utsiktspunkt",parent:"naturperle",poiTypes:["viewpoints"],icon:"landscape",color:"#059669"}]},{id:"overnatte",name:"Overnatte",icon:"cottage",color:"#b45309",children:[{id:"campingplass",name:"Campingplass",parent:"overnatte",poiTypes:["camping_site"],icon:"camping",color:"#b45309"},{id:"gapahuk_vindskjul",name:"Gapahuk/vindskjul",parent:"overnatte",poiTypes:["wilderness_shelter"],icon:"cottage",color:"#b45309"},{id:"fri_camping",name:"Fri camping",parent:"overnatte",poiTypes:["wild_camping"],icon:"forest",color:"#b45309"},{id:"hengekøyeplass",name:"Hengekøyeplass",parent:"overnatte",poiTypes:["hammock_spots"],icon:"weekend",color:"#b45309"},{id:"hytte_dagstur",name:"Dagsturhytte, skihytte",parent:"overnatte",poiTypes:["self_service_huts"],icon:"cabin",color:"#b45309"},{id:"hytte_turisthytte_betjent",name:"Turisthytte/fjellstue, betjent",parent:"overnatte",poiTypes:["staffed_huts"],icon:"house",color:"#b45309"},{id:"hytte_turisthytte_selvbetjent",name:"Turisthytte, selvbetjent",parent:"overnatte",poiTypes:["self_service_huts"],icon:"cabin",color:"#b45309"},{id:"hytte_turisthytte_ubetjent",name:"Turisthytte, ubetjent",parent:"overnatte",poiTypes:["self_service_huts"],icon:"cabin",color:"#b45309"},{id:"hytte_utleie",name:"Utleiehytte",parent:"overnatte",poiTypes:["staffed_huts"],icon:"house",color:"#b45309"},{id:"teltplass",name:"Teltplass",parent:"overnatte",poiTypes:["tent_area"],icon:"holiday_village",color:"#b45309"},{id:"vandrerhjem",name:"Vandrerhjem",parent:"overnatte",poiTypes:["staffed_huts"],icon:"house",color:"#b45309"}]},{id:"på_eventyr",name:"På eventyr",icon:"explore",color:"#7c3aed",children:[{id:"hule",name:"Hule",parent:"på_eventyr",poiTypes:["nature_gems"],icon:"terrain",color:"#7c3aed"},{id:"krigsminne",name:"Krigsminne",parent:"på_eventyr",poiTypes:["war_memorials"],icon:"military_tech",color:"#7c3aed"},{id:"kulturminne",name:"Kulturminne",parent:"på_eventyr",poiTypes:["archaeological"],icon:"archaeology",color:"#7c3aed"},{id:"observasjonstårn",name:"Observasjonstårn",parent:"på_eventyr",poiTypes:["viewpoints"],icon:"tower",color:"#7c3aed"}]},{id:"service",name:"Service",icon:"support",color:"#ea580c",children:[{id:"informasjon",name:"Informasjon",parent:"service",poiTypes:["information_boards"],icon:"info",color:"#ea580c"},{id:"drikkevann",name:"Drikkevann",parent:"service",poiTypes:["drinking_water"],icon:"water_drop",color:"#ea580c"},{id:"spise_rasteplass",name:"Spise- og rasteplass",parent:"service",poiTypes:["rest_areas"],icon:"deck",color:"#ea580c"},{id:"tilfluktsrom",name:"Tilfluktsrom",parent:"service",poiTypes:["emergency_shelters"],icon:"shield",color:"#ea580c"},{id:"toalett",name:"Toalett",parent:"service",poiTypes:["toilets"],icon:"wc",color:"#ea580c"},{id:"utfartparkering",name:"Utfartparkering",parent:"service",poiTypes:["parking"],icon:"local_parking",color:"#ea580c"}]},{id:"transport",name:"Transport",icon:"directions_transit",color:"#0284c7",children:[{id:"bussholdeplass",name:"Bussholdeplass",parent:"transport",poiTypes:["public_transport"],icon:"directions_bus",color:"#0284c7"},{id:"taubane",name:"Taubane",parent:"transport",poiTypes:["cable_cars"],icon:"cable_car",color:"#0284c7"},{id:"togstasjon",name:"Togstasjon",parent:"transport",poiTypes:["train_stations"],icon:"train",color:"#0284c7"}]}];function Tg(){const re=[];return Dd.forEach(C=>{re.push({value:C.id,label:C.name,isMainCategory:!0,color:C.color,icon:C.icon}),C.children&&C.children.forEach(N=>{re.push({value:N.id,label:`  ${N.name}`,isMainCategory:!1,mainCategoryName:C.name,color:N.color,icon:N.icon})})}),re}class jc{static BASE_URL="https://overpass-api.de/api/interpreter";static CACHE_DURATION=600*1e3;static cache=new Map;static async fetchKrigsminnePOIs(C){const N=`krigsminner_norway_${C.north},${C.south},${C.east},${C.west}`;try{console.log("🔄 Fetching Krigsminne from OpenStreetMap...",C);const A={north:Math.min(C.north,72),south:Math.max(C.south,57.5),east:Math.min(C.east,32),west:Math.max(C.west,4)};console.log("🗺️ Query bounds:",A);const X=`
        [out:json][timeout:25];
        (
          // War memorials specifically
          node["historic"="memorial"]["memorial"="war_memorial"](${A.south},${A.west},${A.north},${A.east});
          way["historic"="memorial"]["memorial"="war_memorial"](${A.south},${A.west},${A.north},${A.east});
          
          // Historic forts (defensive structures)
          node["historic"="fort"](${A.south},${A.west},${A.north},${A.east});
          way["historic"="fort"](${A.south},${A.west},${A.north},${A.east});
          
          // WWII bunkers (actual war sites)
          node["military"="bunker"]["bunker_type"](${A.south},${A.west},${A.north},${A.east});
          
          // Historic battlefields
          node["historic"="battlefield"](${A.south},${A.west},${A.north},${A.east});
        );
        out center body 100;
      `.trim();console.log("🔍 Overpass query:",X);const ie=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:X});if(!ie.ok)throw new Error(`Overpass API request failed: ${ie.status}`);const z=await ie.text(),u=JSON.parse(z);console.log("📊 Raw Overpass response:",u),(u.elements?.slice(0,3)||[]).forEach((xe,De)=>{xe.tags?.name&&console.log(`🔍 Sample name ${De+1}:`,xe.tags.name)});const te=this.transformOverpassDataToPOIs(u);return console.log(`🔄 Transformed ${te.length} Krigsminne POIs from Overpass API`),this.cache.set(N,{data:te,timestamp:Date.now()}),console.log(`✅ Fetched ${te.length} Krigsminne POIs from OpenStreetMap`),te}catch(A){return console.error("❌ Error fetching Krigsminne from Overpass API:",A),[]}}static async fetchCaveEntrancePOIs(C){const N=`caves_norway_${C.north},${C.south},${C.east},${C.west}`;try{console.log("🕳️ Fetching cave entrances from OpenStreetMap...",C);const A={north:Math.min(C.north,72),south:Math.max(C.south,57.5),east:Math.min(C.east,32),west:Math.max(C.west,4)};console.log("🗺️ Query bounds:",A);const X=`
        [out:json][timeout:25];
        (
          // Natural cave entrances
          node["natural"="cave_entrance"](${A.south},${A.west},${A.north},${A.east});
          way["natural"="cave_entrance"](${A.south},${A.west},${A.north},${A.east});
        );
        out center body 100;
      `.trim();console.log("🔍 Cave entrance Overpass query:",X);const ie=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:X});if(!ie.ok)throw new Error(`Overpass API request failed: ${ie.status}`);const z=await ie.text(),u=JSON.parse(z);console.log("📊 Raw cave entrance Overpass response:",u);const W=this.transformCaveEntranceDataToPOIs(u);return console.log(`🕳️ Transformed ${W.length} cave entrance POIs from Overpass API`),this.cache.set(N,{data:W,timestamp:Date.now()}),console.log(`✅ Fetched ${W.length} cave entrance POIs from OpenStreetMap`),W}catch(A){return console.error("❌ Error fetching cave entrances from Overpass API:",A),[]}}static async fetchObservationTowerPOIs(C){const N=`towers_norway_${C.north},${C.south},${C.east},${C.west}`;try{console.log("🗼 Fetching observation towers from OpenStreetMap...",C);const A={north:Math.min(C.north,72),south:Math.max(C.south,57.5),east:Math.min(C.east,32),west:Math.max(C.west,4)};console.log("🗺️ Query bounds:",A);const X=`
        [out:json][timeout:25];
        (
          // Observation towers
          node["man_made"="tower"]["tower:type"="observation"](${A.south},${A.west},${A.north},${A.east});
          way["man_made"="tower"]["tower:type"="observation"](${A.south},${A.west},${A.north},${A.east});
          
          // Watchtowers (for fire observation, military observation, etc.)
          node["man_made"="tower"]["tower:type"="watchtower"](${A.south},${A.west},${A.north},${A.east});
          way["man_made"="tower"]["tower:type"="watchtower"](${A.south},${A.west},${A.north},${A.east});
          
          // General observation towers (some may not have tower:type tag)
          node["man_made"="tower"]["tourism"="viewpoint"](${A.south},${A.west},${A.north},${A.east});
        );
        out center body 100;
      `.trim();console.log("🔍 Observation tower Overpass query:",X);const ie=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:X});if(!ie.ok)throw new Error(`Overpass API request failed: ${ie.status}`);const z=await ie.text(),u=JSON.parse(z);console.log("📊 Raw observation tower Overpass response:",u);const W=this.transformObservationTowerDataToPOIs(u);return console.log(`🗼 Transformed ${W.length} observation tower POIs from Overpass API`),this.cache.set(N,{data:W,timestamp:Date.now()}),console.log(`✅ Fetched ${W.length} observation tower POIs from OpenStreetMap`),W}catch(A){return console.error("❌ Error fetching observation towers from Overpass API:",A),[]}}static transformOverpassDataToPOIs(C){if(!C.elements)return[];const N=[];return C.elements.forEach(A=>{try{let X,ie;if(A.type==="node"){if(A.lat===void 0||A.lon===void 0)return;X=A.lat,ie=A.lon}else if(A.type==="way"||A.type==="relation")if(A.center)X=A.center.lat,ie=A.center.lon;else return;else return;if(!X||!ie||isNaN(X)||isNaN(ie)||X<57.5||X>72||ie<4||ie>32)return;const z=A.tags||{},u=this.extractName(z),W=this.generateDescription(z),te=this.determineType(z),xe={id:`osm_${A.type}_${A.id}`,name:u,type:te,lat:X,lng:ie,category:"war_memorials",tags:z,lastUpdated:new Date().toISOString()};N.push(xe)}catch(X){console.error("❌ Failed to process Overpass element:",X)}}),console.log(`✅ Converted ${N.length} Krigsminne POIs from Overpass data`),N}static transformCaveEntranceDataToPOIs(C){if(!C.elements)return[];const N=[];return C.elements.forEach(A=>{try{let X,ie;if(A.type==="node"){if(A.lat===void 0||A.lon===void 0)return;X=A.lat,ie=A.lon}else if(A.type==="way"||A.type==="relation")if(A.center)X=A.center.lat,ie=A.center.lon;else return;else return;if(!X||!ie||isNaN(X)||isNaN(ie)||X<57.5||X>72||ie<4||ie>32)return;const z=A.tags||{},u=this.extractCaveName(z),W=this.generateCaveDescription(z),te=this.determineCaveType(z),xe={id:`osm_${A.type}_${A.id}`,name:u,type:te,lat:X,lng:ie,category:"caves",tags:z,lastUpdated:new Date().toISOString()};N.push(xe)}catch(X){console.error("❌ Failed to process cave entrance element:",X)}}),console.log(`✅ Converted ${N.length} cave entrance POIs from Overpass data`),N}static transformObservationTowerDataToPOIs(C){if(!C.elements)return[];const N=[];return C.elements.forEach(A=>{try{let X,ie;if(A.type==="node"){if(A.lat===void 0||A.lon===void 0)return;X=A.lat,ie=A.lon}else if(A.type==="way"||A.type==="relation")if(A.center)X=A.center.lat,ie=A.center.lon;else return;else return;if(!X||!ie||isNaN(X)||isNaN(ie)||X<57.5||X>72||ie<4||ie>32)return;const z=A.tags||{},u=this.extractTowerName(z),W=this.generateTowerDescription(z),te=this.determineTowerType(z),xe={id:`osm_${A.type}_${A.id}`,name:u,type:te,lat:X,lng:ie,category:"towers",tags:z,lastUpdated:new Date().toISOString()};N.push(xe)}catch(X){console.error("❌ Failed to process observation tower element:",X)}}),console.log(`✅ Converted ${N.length} observation tower POIs from Overpass data`),N}static ensureUTF8(C){if(typeof C!="string")return C;try{const N=encodeURIComponent(C);return decodeURIComponent(N)}catch{return console.warn("UTF-8 encoding issue with text:",C),C}}static extractName(C){const N=C["name:no"]||C["name:nb"]||C["name:nn"];return N?this.ensureUTF8(N):C.name?this.ensureUTF8(C.name):C["name:en"]?this.ensureUTF8(C["name:en"]):C.historic==="fort"?"Fort":C.historic==="castle"?"Slott":C.historic==="battlefield"?"Slagmark":C.historic==="memorial"?"Minnesmerke":C.memorial==="war_memorial"?"Krigsminne":C.memorial==="stolperstein"?"Snublestein":C.military==="bunker"?"Bunker":C.military==="naval_mine"?"Sjømine":C.military==="trench"?"Skyttergraver":C.military?"Militært anlegg":"Historisk sted"}static generateDescription(C){const N=[];if(C.historic==="fort"){let A="Historisk fort";C.ruins==="yes"&&(A+=" (ruiner)"),N.push(A)}else if(C.historic==="castle"){let A="Slott eller borg";C.ruins==="yes"&&(A+=" (ruiner)"),N.push(A)}else C.historic==="battlefield"?N.push("Historisk slagmark"):C.historic==="memorial"&&N.push("Minnesmerke");if(C.start_date){const A=C.start_date.substring(0,4);A&&!isNaN(Number(A))&&N.push(`Bygget ${A}`)}if(C.architect&&N.push(`Arkitekt: ${this.ensureUTF8(C.architect)}`),C.heritage&&(C.heritage.includes("unesco")?N.push("UNESCO-verdensarvsted"):C.heritage.includes("national")?N.push("Nasjonalt kulturminne"):N.push("Verneverdig kulturminne")),C.military){const A={bunker:"militær bunker",airfield:"militært flyplassområde",barracks:"militær kaserne",naval_base:"marineanlegg",range:"skyte- og øvingsområde",training_area:"militært treningsområde",danger_area:"militært fareområde",naval_mine:"sjømine",checkpoint:"kontrollpost",trench:"skyttergraver",office:"militærkontor",depot:"militærdepot"};N.push(A[C.military]||`militært anlegg (${C.military})`)}if(C.memorial){const A={war_memorial:"krigsminne",stolperstein:"snublestein",statue:"minnesmerke-statue",plaque:"minneplakett",stone:"minnestein",cross:"minnekors",obelisk:"minnesmerke-obelisk",monument:"monument"};N.push(A[C.memorial]||`minnesmerke (${C.memorial})`)}if(C.start_date&&N.push(`fra ${C.start_date}`),C.heritage&&N.push("kulturminneobjekt"),C.wheelchair==="yes"?N.push("♿ Tilgjengelig for rullestol"):C.wheelchair==="limited"&&N.push("♿ Delvis tilgjengelig for rullestol"),C.access==="private"?N.push("⚠️ Privat eiendom"):C.access==="no"?N.push("❌ Stengt for allmennheten"):C.access==="customers"&&N.push("🎫 Kun for kunder/besøkende"),C.opening_hours&&N.push(`🕒 Åpningstider: ${C.opening_hours}`),C.fee==="yes"?N.push("💰 Inngang/avgift påkrevd"):C.fee==="no"&&N.push("🆓 Gratis inngang"),C.wikipedia){const A=C.wikipedia.includes("http")?C.wikipedia:`https://no.wikipedia.org/wiki/${encodeURIComponent(C.wikipedia.replace("no:",""))}`;N.push(`📖 Les mer: ${A}`)}else C.wikidata&&N.push(`📖 Wikidata: https://www.wikidata.org/wiki/${C.wikidata}`);return C.description&&N.push(this.ensureUTF8(C.description)),N.length>0?N.join(". ").charAt(0).toUpperCase()+N.join(". ").slice(1)+".":"Historisk eller militært anlegg i Norge."}static determineType(C){return C.historic==="fort"?"Fort":C.historic==="castle"?"Slott":C.historic==="battlefield"?"Slagmark":C.historic==="memorial"?"Minnesmerke":C.memorial==="war_memorial"?"Krigsminne":C.memorial==="stolperstein"?"Snublestein":C.military==="bunker"?"Bunker":C.military==="naval_mine"?"Sjømine":C.military==="trench"?"Skyttergraver":C.military==="naval_base"?"Marineanlegg":C.military?"Militæranlegg":"Historisk sted"}static extractCaveName(C){const N=C["name:no"]||C["name:nb"]||C["name:nn"];return N?this.ensureUTF8(N):C.name?this.ensureUTF8(C.name):C["name:en"]?this.ensureUTF8(C["name:en"]):C.cave_entrance==="yes"?"Huleinngang":(C.natural==="cave_entrance","Hule")}static generateCaveDescription(C){const N=[];if(C.natural==="cave_entrance"&&N.push("Naturlig huleinngang"),C.cave&&(C.cave==="system"?N.push("del av hulesystem"):C.cave==="single"&&N.push("enkeltstående hule")),C.geological==="limestone"?N.push("kalksteinhule"):C.geological==="sandstone"?N.push("sandsteinhule"):C.geological==="granite"&&N.push("granitthule"),C.length){const A=parseFloat(C.length);isNaN(A)||(A>=1e3?N.push(`lengde: ${(A/1e3).toFixed(1)} km`):N.push(`lengde: ${A} meter`))}if(C.depth){const A=parseFloat(C.depth);isNaN(A)||N.push(`dybde: ${A} meter`)}if(C.difficulty){const A={easy:"lett tilgjengelig",moderate:"moderat vanskelighetsgrad",difficult:"vanskelig tilgang",expert:"kun for erfarne huleutforskere"};N.push(A[C.difficulty]||`vanskelighetsgrad: ${C.difficulty}`)}if(C.equipment){const A={helmet:"hjelm påkrevd",light:"lommelykt påkrevd",rope:"tau påkrevd",wetsuit:"våtdrakt påkrevd"};N.push(A[C.equipment]||`utstyr: ${C.equipment}`)}if(C.hazard&&N.push(`⚠️ Fare: ${C.hazard}`),C.access==="private"?N.push("⚠️ Privat eiendom"):C.access==="no"?N.push("❌ Stengt for allmennheten"):C.access==="permit"&&N.push("🎫 Tilgang krever tillatelse"),C.opening_hours&&N.push(`🕒 Åpningstider: ${C.opening_hours}`),C.fee==="yes"?N.push("💰 Avgift påkrevd"):C.fee==="no"&&N.push("🆓 Gratis tilgang"),C.wikipedia){const A=C.wikipedia.includes("http")?C.wikipedia:`https://no.wikipedia.org/wiki/${encodeURIComponent(C.wikipedia.replace("no:",""))}`;N.push(`📖 Les mer: ${A}`)}else C.wikidata&&N.push(`📖 Wikidata: https://www.wikidata.org/wiki/${C.wikidata}`);return C.description&&N.push(this.ensureUTF8(C.description)),N.length>0?N.join(". ").charAt(0).toUpperCase()+N.join(". ").slice(1)+".":"Naturlig hule i Norge."}static determineCaveType(C){return C.cave==="system"?"Hulesystem":C.cave==="single"?"Enkelthule":C.natural==="cave_entrance"?"Huleinngang":"Hule"}static extractTowerName(C){const N=C["name:no"]||C["name:nb"]||C["name:nn"];return N?this.ensureUTF8(N):C.name?this.ensureUTF8(C.name):C["name:en"]?this.ensureUTF8(C["name:en"]):C["tower:type"]==="observation"?"Observasjonstårn":C["tower:type"]==="watchtower"?"Vakttårn":C["tower:type"]==="fire_observation"?"Brannvakttårn":C.tourism==="viewpoint"?"Utsiktstårn":C.man_made==="tower"?"Tårn":"Observasjonstårn"}static generateTowerDescription(C){const N=[];if(C["tower:type"]){const A={observation:"observasjonstårn for utsikt",watchtower:"vakttårn for overvåking",fire_observation:"brannvakttårn",communication:"kommunikasjonstårn",water:"vanntårn",bell_tower:"klokketårn"};N.push(A[C["tower:type"]]||`tårn av type ${C["tower:type"]}`)}else C.man_made==="tower"&&N.push("byggetårn");if(C.height){const A=parseFloat(C.height);isNaN(A)||N.push(`høyde: ${A} meter`)}else if(C.ele){const A=parseFloat(C.ele);isNaN(A)||N.push(`høyde over havet: ${A} meter`)}if(C.start_date){const A=C.start_date.substring(0,4);A&&!isNaN(Number(A))&&N.push(`bygget ${A}`)}if(C.material){const A={wood:"bygget av tre",concrete:"bygget av betong",steel:"bygget av stål",stone:"bygget av stein",brick:"bygget av murstein"};N.push(A[C.material]||`bygget av ${C.material}`)}if(C.tourism==="viewpoint"&&N.push("utsiktspunkt for besøkende"),C.operator&&N.push(`drift: ${this.ensureUTF8(C.operator)}`),C.access==="private"?N.push("⚠️ Privat eiendom"):C.access==="no"?N.push("❌ Stengt for allmennheten"):C.access==="customers"?N.push("🎫 Kun for besøkende/kunder"):C.access==="yes"&&N.push("🆓 Offentlig tilgjengelig"),C.opening_hours&&N.push(`🕒 Åpningstider: ${C.opening_hours}`),C.fee==="yes"?N.push("💰 Inngang/avgift påkrevd"):C.fee==="no"&&N.push("🆓 Gratis adgang"),C.climbing==="yes"?N.push("🧗 Klatring tillatt"):C.climbing==="no"&&N.push("⛔ Klatring forbudt"),C.hazard&&N.push(`⚠️ Fare: ${C.hazard}`),C.wikipedia){const A=C.wikipedia.includes("http")?C.wikipedia:`https://no.wikipedia.org/wiki/${encodeURIComponent(C.wikipedia.replace("no:",""))}`;N.push(`📖 Les mer: ${A}`)}else C.wikidata&&N.push(`📖 Wikidata: https://www.wikidata.org/wiki/${C.wikidata}`);return C.description&&N.push(this.ensureUTF8(C.description)),N.length>0?N.join(". ").charAt(0).toUpperCase()+N.join(". ").slice(1)+".":"Observasjonstårn eller vakttårn i Norge."}static determineTowerType(C){return C["tower:type"]==="observation"?"Observasjonstårn":C["tower:type"]==="watchtower"?"Vakttårn":C["tower:type"]==="fire_observation"?"Brannvakttårn":C.tourism==="viewpoint"?"Utsiktstårn":C["tower:type"]==="communication"?"Kommunikasjonstårn":C.man_made==="tower"?"Tårn":"Observasjonstårn"}static clearCache(){this.cache.clear(),console.log("🗑️ Overpass cache cleared")}static async fetchHuntingStandPOIs(C){const N=`hunting_stands_norway_${C.north},${C.south},${C.east},${C.west}`;try{console.log("🦌 Fetching hunting stands from OpenStreetMap...",C);const A={north:Math.min(C.north,72),south:Math.max(C.south,57.5),east:Math.min(C.east,32),west:Math.max(C.west,4)},X=`
        [out:json][timeout:25];
        (
          // Hunting stands - amenity=hunting_stand
          node["amenity"="hunting_stand"](${A.south},${A.west},${A.north},${A.east});
        );
        out center body 100;
      `.trim();console.log("🔍 Hunting stand Overpass query:",X);const ie=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:X});if(!ie.ok)throw new Error(`Overpass API request failed: ${ie.status}`);const z=await ie.text(),u=JSON.parse(z);console.log("📊 Raw hunting stand Overpass response:",u);const W=u.elements?.map(te=>({id:te.id||`${te.type}-${te.lat}-${te.lon}`,type:te.type||"node",lat:te.lat||te.center?.lat,lng:te.lon||te.center?.lon,name:te.tags?.name||te.tags?.["name:no"]||te.tags?.["name:nb"]||"Jakttårn",tags:te.tags||{}}))||[];return console.log(`🦌 Extracted ${W.length} raw hunting stand POIs from Overpass API`),this.cache.set(N,{data:W,timestamp:Date.now()}),console.log(`✅ Fetched ${W.length} hunting stand POIs from OpenStreetMap`),W}catch(A){return console.error("❌ Error fetching hunting stands:",A),[]}}static async fetchFirepitPOIs(C){const N=`firepits_norway_${C.north},${C.south},${C.east},${C.west}`;try{console.log("🔥 Fetching fire pits from OpenStreetMap...",C);const A={north:Math.min(C.north,72),south:Math.max(C.south,57.5),east:Math.min(C.east,32),west:Math.max(C.west,4)},X=`
        [out:json][timeout:25];
        (
          // Fire pits - leisure=firepit
          node["leisure"="firepit"](${A.south},${A.west},${A.north},${A.east});
          way["leisure"="firepit"](${A.south},${A.west},${A.north},${A.east});
        );
        out center body 100;
      `.trim();console.log("🔍 Fire pit Overpass query:",X);const ie=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:X});if(!ie.ok)throw new Error(`Overpass API request failed: ${ie.status}`);const z=await ie.text(),u=JSON.parse(z);console.log("📊 Raw fire pit Overpass response:",u);const W=u.elements?.map(te=>({id:te.id||`${te.type}-${te.lat}-${te.lon}`,type:te.type||"node",lat:te.lat||te.center?.lat,lng:te.lon||te.center?.lon,name:te.tags?.name||te.tags?.["name:no"]||te.tags?.["name:nb"]||"Bål-/grillplass",tags:te.tags||{}}))||[];return console.log(`🔥 Extracted ${W.length} raw fire pit POIs from Overpass API`),this.cache.set(N,{data:W,timestamp:Date.now()}),console.log(`✅ Fetched ${W.length} fire pit POIs from OpenStreetMap`),W}catch(A){return console.error("❌ Error fetching fire pits:",A),[]}}static async fetchShelterPOIs(C){const N=`shelters_norway_${C.north},${C.south},${C.east},${C.west}`;try{console.log("🏠 Fetching shelters from OpenStreetMap...",C);const A={north:Math.min(C.north,72),south:Math.max(C.south,57.5),east:Math.min(C.east,32),west:Math.max(C.west,4)},X=`
        [out:json][timeout:25];
        (
          // Basic huts - amenity=shelter with shelter_type=basic_hut
          node["amenity"="shelter"]["shelter_type"="basic_hut"](${A.south},${A.west},${A.north},${A.east});
          way["amenity"="shelter"]["shelter_type"="basic_hut"](${A.south},${A.west},${A.north},${A.east});
          
          // Weather shelters - amenity=shelter with shelter_type=weather_shelter
          node["amenity"="shelter"]["shelter_type"="weather_shelter"](${A.south},${A.west},${A.north},${A.east});
          way["amenity"="shelter"]["shelter_type"="weather_shelter"](${A.south},${A.west},${A.north},${A.east});
          
          // Rock shelters - amenity=shelter with shelter_type=rock_shelter
          node["amenity"="shelter"]["shelter_type"="rock_shelter"](${A.south},${A.west},${A.north},${A.east});
          way["amenity"="shelter"]["shelter_type"="rock_shelter"](${A.south},${A.west},${A.north},${A.east});
          
          // Lavvu shelters - amenity=shelter with shelter_type=lavvu
          node["amenity"="shelter"]["shelter_type"="lavvu"](${A.south},${A.west},${A.north},${A.east});
          way["amenity"="shelter"]["shelter_type"="lavvu"](${A.south},${A.west},${A.north},${A.east});
          
          // Generic shelters without specific shelter_type - amenity=shelter
          node["amenity"="shelter"][!"shelter_type"](${A.south},${A.west},${A.north},${A.east});
          way["amenity"="shelter"][!"shelter_type"](${A.south},${A.west},${A.north},${A.east});
        );
        out center body 100;
      `.trim();console.log("🔍 Shelter Overpass query:",X);const ie=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:X});if(!ie.ok)throw new Error(`Overpass API request failed: ${ie.status}`);const z=await ie.text(),u=JSON.parse(z);console.log("📊 Raw shelter Overpass response:",u);const W=u.elements?.map(te=>({id:te.id||`${te.type}-${te.lat}-${te.lon}`,type:te.type||"node",lat:te.lat||te.center?.lat,lng:te.lon||te.center?.lon,name:te.tags?.name||te.tags?.["name:no"]||te.tags?.["name:nb"]||"Gapahuk/vindskjul",tags:te.tags||{}}))||[];return console.log(`🏠 Extracted ${W.length} raw shelter POIs from Overpass API`),this.cache.set(N,{data:W,timestamp:Date.now()}),console.log(`✅ Fetched ${W.length} shelter POIs from OpenStreetMap`),W}catch(A){return console.error("❌ Error fetching shelters:",A),[]}}static async fetchCableCarPOIs(C){const{south:N,west:A,north:X,east:ie}=C,z=`cablecars_${N}_${A}_${X}_${ie}`,u=this.cache.get(z);if(u&&Date.now()-u.timestamp<this.CACHE_DURATION)return console.log(`🗄️ Using cached cable car data (${u.data.length} POIs)`),u.data;const W=`
      [out:json][timeout:25];
      (
        node["aerialway"="cable_car"](${N},${A},${X},${ie});
        way["aerialway"="cable_car"](${N},${A},${X},${ie});
        node["aerialway"="gondola"](${N},${A},${X},${ie});
        way["aerialway"="gondola"](${N},${A},${X},${ie});
        node["aerialway"="goods"](${N},${A},${X},${ie});
        way["aerialway"="goods"](${N},${A},${X},${ie});
      );
      out center body 500;
    `.trim();try{const te=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:W});if(!te.ok)throw new Error(`Overpass API request failed: ${te.status}`);const xe=await te.text(),we=JSON.parse(xe).elements?.map(Ee=>({id:Ee.id?.toString()||`cablecar_${Ee.lat}_${Ee.lon}`,type:Ee.type||"node",lat:Ee.lat||Ee.center?.lat,lng:Ee.lon||Ee.center?.lon,name:Ee.tags?.name||Ee.tags?.["name:no"]||Ee.tags?.["name:nb"]||"Taubane",tags:Ee.tags||{}}))||[];return console.log(`🚡 Extracted ${we.length} cable car POIs`),this.cache.set(z,{data:we,timestamp:Date.now()}),console.log(`✅ Fetched ${we.length} cable car POIs from OpenStreetMap`),we}catch(te){return console.error("❌ Error fetching cable cars:",te),[]}}static async fetchWaterfallPOIs(C){const{south:N,west:A,north:X,east:ie}=C,z=`waterfalls_${N}_${A}_${X}_${ie}`,u=this.cache.get(z);if(u&&Date.now()-u.timestamp<this.CACHE_DURATION)return console.log(`🗄️ Using cached waterfall data (${u.data.length} POIs)`),u.data;const W=`
      [out:json][timeout:25];
      (
        node["waterway"="waterfall"](${N},${A},${X},${ie});
        way["waterway"="waterfall"](${N},${A},${X},${ie});
        node["natural"="waterfall"](${N},${A},${X},${ie});
        way["natural"="waterfall"](${N},${A},${X},${ie});
      );
      out center body 500;
    `.trim();try{const te=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:W});if(!te.ok)throw new Error(`Overpass API request failed: ${te.status}`);const xe=await te.text(),we=JSON.parse(xe).elements?.map(Ee=>({id:Ee.id?.toString()||`waterfall_${Ee.lat}_${Ee.lon}`,type:Ee.type||"node",lat:Ee.lat||Ee.center?.lat,lng:Ee.lon||Ee.center?.lon,name:Ee.tags?.name||Ee.tags?.["name:no"]||Ee.tags?.["name:nb"]||"Foss",tags:Ee.tags||{}}))||[];return console.log(`💧 Extracted ${we.length} waterfall POIs`),this.cache.set(z,{data:we,timestamp:Date.now()}),console.log(`✅ Fetched ${we.length} waterfall POIs from OpenStreetMap`),we}catch(te){return console.error("❌ Error fetching waterfalls:",te),[]}}static async fetchViewpointPOIs(C){const{south:N,west:A,north:X,east:ie}=C,z=`viewpoints_${N}_${A}_${X}_${ie}`,u=this.cache.get(z);if(u&&Date.now()-u.timestamp<this.CACHE_DURATION)return console.log(`🗄️ Using cached viewpoint data (${u.data.length} POIs)`),u.data;const W=`
      [out:json][timeout:25];
      (
        node["tourism"="viewpoint"](${N},${A},${X},${ie});
        way["tourism"="viewpoint"](${N},${A},${X},${ie});
      );
      out center body 500;
    `.trim();try{const te=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8",Accept:"application/json; charset=utf-8","User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"},body:W});if(!te.ok)throw new Error(`Overpass API request failed: ${te.status}`);const xe=await te.text(),we=JSON.parse(xe).elements?.map(Ee=>({id:Ee.id?.toString()||`viewpoint_${Ee.lat}_${Ee.lon}`,type:Ee.type||"node",lat:Ee.lat||Ee.center?.lat,lng:Ee.lon||Ee.center?.lon,name:Ee.tags?.name||Ee.tags?.["name:no"]||Ee.tags?.["name:nb"]||"Utsiktspunkt",tags:Ee.tags||{}}))||[];return console.log(`👁️ Extracted ${we.length} viewpoint POIs`),this.cache.set(z,{data:we,timestamp:Date.now()}),console.log(`✅ Fetched ${we.length} viewpoint POIs from OpenStreetMap`),we}catch(te){return console.error("❌ Error fetching viewpoints:",te),[]}}}const Bp={POI_DATA:"trakke_admin_pois_v1",POI_BACKUP:"trakke_admin_pois_backup_v1"};class jd{static instance;constructor(){}static getInstance(){return jd.instance||(jd.instance=new jd),jd.instance}initializeStore(){const C={version:"1.0",lastUpdated:Date.now(),pois:[]};return localStorage.setItem(Bp.POI_DATA,JSON.stringify(C)),C}getStore(){try{const C=localStorage.getItem(Bp.POI_DATA);if(!C)return this.initializeStore();const N=JSON.parse(C);return!N.version||!Array.isArray(N.pois)?(console.warn("⚠️ Invalid POI store structure, reinitializing"),this.initializeStore()):N}catch(C){return console.error("❌ Error reading POI store:",C),this.initializeStore()}}saveStore(C){try{const N=localStorage.getItem(Bp.POI_DATA);N&&localStorage.setItem(Bp.POI_BACKUP,N),C.lastUpdated=Date.now(),localStorage.setItem(Bp.POI_DATA,JSON.stringify(C)),console.log("✅ POI data saved successfully")}catch(N){throw console.error("❌ Error saving POI store:",N),new Error("Failed to save POI data")}}generatePOIId(){const C=Date.now().toString(36),N=Math.random().toString(36).substr(2,9);return`admin_${C}_${N}`}validatePOI(C){const N=[];if((!C.name||typeof C.name!="string"||!C.name.trim())&&N.push("Name is required"),(!C.description||typeof C.description!="string"||!C.description.trim())&&N.push("Description is required"),(!C.type||typeof C.type!="string")&&N.push("Category is required"),(typeof C.lat!="number"||!Lc.validateCoordinates(C.lat,C.lng||0))&&N.push("Valid coordinates are required"),(typeof C.lng!="number"||!Lc.validateCoordinates(C.lat||0,C.lng))&&N.push("Valid coordinates are required"),C.website&&typeof C.website=="string"&&C.website.trim())try{new URL(C.website.startsWith("http")?C.website:`https://${C.website}`)}catch{N.push("Invalid website URL")}return N}sanitizePOI(C){return{...C,name:C.name?Lc.sanitizeInput(C.name):"",description:C.description?Lc.sanitizeInput(C.description):"",type:C.type?Lc.sanitizeInput(C.type):void 0,subcategory:C.subcategory?Lc.sanitizeInput(C.subcategory):void 0,website:C.website?Lc.sanitizeInput(C.website):void 0,phone:C.phone?Lc.sanitizeInput(C.phone):void 0,address:C.address?Lc.sanitizeInput(C.address):void 0}}getAllPOIs(){return this.getStore().pois}getPOIById(C){return this.getStore().pois.find(A=>A.id===C)||null}async addPOI(C){try{const N=this.validatePOI(C);if(N.length>0)return{success:!1,message:`Validation errors: ${N.join(", ")}`};const X={...this.sanitizePOI(C),id:this.generatePOIId(),createdAt:Date.now(),updatedAt:Date.now(),createdBy:"admin",source:"admin"},ie=this.getStore();return ie.pois.push(X),this.saveStore(ie),console.log("✅ POI added successfully:",X.name),{success:!0,id:X.id,message:"POI added successfully"}}catch(N){return console.error("❌ Error adding POI:",N),{success:!1,message:"Failed to add POI due to system error"}}}async updatePOI(C,N){try{const A=this.getStore(),X=A.pois.findIndex(W=>W.id===C);if(X===-1)return{success:!1,message:"POI not found"};const ie={...A.pois[X],...N},z=this.validatePOI(ie);if(z.length>0)return{success:!1,message:`Validation errors: ${z.join(", ")}`};const u=this.sanitizePOI(N);return A.pois[X]={...A.pois[X],...u,updatedAt:Date.now()},this.saveStore(A),console.log("✅ POI updated successfully:",C),{success:!0,message:"POI updated successfully"}}catch(A){return console.error("❌ Error updating POI:",A),{success:!1,message:"Failed to update POI due to system error"}}}async deletePOI(C){try{const N=this.getStore(),A=N.pois.findIndex(ie=>ie.id===C);if(A===-1)return{success:!1,message:"POI not found"};const X=N.pois[A];return N.pois.splice(A,1),this.saveStore(N),console.log("✅ POI deleted successfully:",X.name),{success:!0,message:"POI deleted successfully"}}catch(N){return console.error("❌ Error deleting POI:",N),{success:!1,message:"Failed to delete POI due to system error"}}}getPOIsByCategory(C){return this.getStore().pois.filter(A=>A.type===C)}getPOIsByCategories(C){return C.length===0?[]:this.getStore().pois.filter(A=>C.includes(A.type))}searchPOIs(C){if(!C.trim())return[];const N=this.getStore(),A=C.toLowerCase().trim();return N.pois.filter(X=>X.name.toLowerCase().includes(A)||X.description.toLowerCase().includes(A))}exportPOIs(){const C=this.getStore();return JSON.stringify({...C,exportedAt:Date.now(),exportedBy:"admin"},null,2)}async importPOIs(C){try{const N=JSON.parse(C);if(!N.pois||!Array.isArray(N.pois))return{success:!1,imported:0,message:"Invalid import format - missing POIs array"};let A=0;const X=this.getStore();for(const ie of N.pois)if(this.validatePOI(ie).length===0){const u=this.sanitizePOI(ie);u.id=this.generatePOIId(),u.createdAt=Date.now(),u.updatedAt=Date.now(),u.createdBy="admin",u.source="admin",X.pois.push(u),A++}return A>0&&this.saveStore(X),{success:!0,imported:A,message:`Successfully imported ${A} POIs`}}catch(N){return console.error("❌ Error importing POIs:",N),{success:!1,imported:0,message:"Failed to import POIs - invalid JSON format"}}}getStorageStats(){const C=this.getStore(),N=JSON.stringify(C).length;return{totalPOIs:C.pois.length,lastUpdated:new Date(C.lastUpdated),dataSize:`${(N/1024).toFixed(2)} KB`,version:C.version}}}const Rm=jd.getInstance();class Mg{baseUrl="https://wfs.geonorge.no/skwms1/wfs.tilfluktsrom_offentlige";async fetchWithFallback(C,N){try{console.log("🔄 Trying direct WFS access (GDPR compliant)...");const A=await fetch(C,{headers:N});if(A.ok)return console.log("✅ Direct WFS access successful - CORS enabled by Geonorge"),A;console.warn(`⚠️ Direct access returned ${A.status}: ${A.statusText}`)}catch(A){console.warn("❌ Direct access error:",A),A instanceof TypeError&&A.message.includes("Failed to fetch")&&console.error("🚨 CORS policy blocking request - WFS server does not allow cross-origin requests")}throw new Error("Tilfluktsrom WFS er ikke tilgjengelig. CORS-policy blokkerer direkte tilgang. Implementer egen proxy for å løse dette.")}async fetchTilfluktsrom(C){try{const N=window.location.hostname.includes("github.io");console.log(`🏠 Fetching tilfluktsrom data from Geonorge WFS... (${N?"PRODUCTION":"DEVELOPMENT"} mode)`,C);const A=new URLSearchParams({service:"WFS",version:"2.0.0",request:"GetFeature",typeNames:"app:Tilfluktsrom",outputFormat:"application/gml+xml; version=3.2",srsName:"EPSG:4326",bbox:`${C.west},${C.south},${C.east},${C.north},EPSG:4326`,count:"100"}),X=`${this.baseUrl}?${A.toString()}`;console.log("🔗 WFS URL:",X);const ie=await this.fetchWithFallback(X,{"User-Agent":"Tråkke Norwegian Outdoor App (https://github.com/elzacka/trakke-react)"});if(!ie.ok)throw new Error(`WFS request failed: ${ie.status} ${ie.statusText}`);const z=await ie.text();console.log("📄 Received XML response, parsing...");const W=new DOMParser().parseFromString(z,"text/xml"),te=W.getElementsByTagName("ServiceException");if(te.length>0)throw new Error(`WFS Service Exception: ${te[0].textContent}`);const xe=W.getElementsByTagNameNS("*","Tilfluktsrom"),De=[];console.log(`📊 Found ${xe.length} tilfluktsrom features`);for(let we=0;we<xe.length;we++){const Ee=xe[we];try{const St=Ee.getElementsByTagNameNS("*","posisjon")[0]?.getElementsByTagNameNS("*","Point")[0]?.getElementsByTagNameNS("*","pos")[0];if(!St?.textContent){console.warn("⚠️ Skipping feature without position data");continue}const wt=St.textContent.trim().split(" ");if(wt.length!==2){console.warn("⚠️ Invalid coordinate format:",St.textContent);continue}const jt=parseFloat(wt[0]),$t=parseFloat(wt[1]);if(isNaN($t)||isNaN(jt)){console.warn("⚠️ Invalid coordinates:",wt);continue}const Fi=Ee.getElementsByTagNameNS("*","lokalId")[0],Rt=Ee.getElementsByTagNameNS("*","romnr")[0],vt=Ee.getElementsByTagNameNS("*","plasser")[0],Ft=Ee.getElementsByTagNameNS("*","adresse")[0],wi=Fi?.textContent||`tilfluktsrom_${we}`,Ui=Rt?.textContent,Ri=vt?.textContent,Yi=Ft?.textContent,Ci=Yi?`Tilfluktsrom - ${Yi}`:`Tilfluktsrom ${Ui||wi}`,Vt=[];Ui&&Vt.push(`Rom nr: ${Ui}`),Ri&&Vt.push(`Kapasitet: ${Ri} personer`),Yi&&Vt.push(`Adresse: ${Yi}`);const Kt=Vt.length>0?`Offentlig tilfluktsrom. ${Vt.join(". ")}`:"Offentlig tilfluktsrom for befolkningen",qi={id:wi,name:Ci,lat:$t,lng:jt,tags:{romnr:Ui||void 0,plasser:Ri||void 0,adresse:Yi||void 0,description:Kt}};De.push(qi)}catch(Qe){console.warn("⚠️ Error parsing tilfluktsrom feature:",Qe);continue}}return console.log(`✅ Successfully parsed ${De.length} tilfluktsrom POIs`),De}catch(N){return console.error("❌ Error fetching tilfluktsrom data:",N),N instanceof Error&&N.message.includes("CORS")?(console.warn("⚠️ Tilfluktsrom data ikke tilgjengelig pga. CORS-policy."),console.warn("💡 Vurder å implementere egen proxy (Cloudflare Worker eller GitHub Actions)"),[]):N instanceof TypeError&&N.message.includes("fetch")?(console.error("🚨 Likely CORS issue - WFS service may not allow requests from this domain"),[]):(console.error("🚨 Returning empty tilfluktsrom list due to error"),[])}}getStaticExamples(){return[{id:"example_tilfluktsrom_oslo_1",name:"Tilfluktsrom - Oslo Sentrum",lat:59.9139,lng:10.7522,tags:{romnr:"001",plasser:"500",adresse:"Karl Johans gate, Oslo",description:"Offentlig tilfluktsrom for befolkningen. Rom nr: 001. Kapasitet: 500 personer. Adresse: Karl Johans gate, Oslo"}},{id:"example_tilfluktsrom_bergen_1",name:"Tilfluktsrom - Bergen Sentrum",lat:60.3913,lng:5.3221,tags:{romnr:"002",plasser:"300",adresse:"Bryggen, Bergen",description:"Offentlig tilfluktsrom for befolkningen. Rom nr: 002. Kapasitet: 300 personer. Adresse: Bryggen, Bergen"}},{id:"example_tilfluktsrom_trondheim_1",name:"Tilfluktsrom - Trondheim Sentrum",lat:63.4305,lng:10.3951,tags:{romnr:"003",plasser:"400",adresse:"Munkegata, Trondheim",description:"Offentlig tilfluktsrom for befolkningen. Rom nr: 003. Kapasitet: 400 personer. Adresse: Munkegata, Trondheim"}}]}}class wm{static GEOCODER_URL="https://api.entur.io/geocoder/v1";static CLIENT_NAME="trakke-norwegian-outdoor-app";static CACHE_DURATION=900*1e3;static cache=new Map;static async fetchBusStops(C){return console.log("🚌 Fetching bus stops from Entur API..."),this.fetchStopsMultipleSearches(C,["venue"],["onstreetBus","busStation"])}static async fetchTrainStations(C){return console.log("🚂 Fetching train stations from Entur API..."),this.fetchStopsMultipleSearches(C,["venue"],["railStation"])}static async fetchStopsMultipleSearches(C,N,A){const X=`combined_${A.join(",")}_${C.north},${C.south},${C.east},${C.west}`,ie=this.cache.get(X);if(ie&&Date.now()-ie.timestamp<this.CACHE_DURATION)return console.log(`🗄️ Using cached Entur data (${ie.data.length} stops)`),ie.data;const z=["a","b","s","o","e"],u=z.map(W=>this.fetchStops(C,N,A,W));try{const W=await Promise.all(u),te=new Map;W.forEach(De=>{De.forEach(we=>{te.set(we.id,we)})});const xe=Array.from(te.values());return console.log(`📊 Combined ${xe.length} unique stops from ${z.length} parallel searches`),this.cache.set(X,{data:xe,timestamp:Date.now()}),xe}catch(W){return console.error("❌ Error in parallel searches:",W),[]}}static async fetchStops(C,N,A,X){const ie=`${X}_${A.join(",")}_${C.north},${C.south},${C.east},${C.west}`,z=this.cache.get(ie);if(z&&Date.now()-z.timestamp<this.CACHE_DURATION)return console.log(`🗄️ Using cached Entur data (${z.data.length} stops)`),z.data;try{const u=(C.north+C.south)/2,W=(C.east+C.west)/2,te=C.north-u,xe=C.east-W,De=Math.sqrt(te*te+xe*xe)*111,we=Math.min(De*1e3,1e5),Ee=new URLSearchParams({text:X,"focus.point.lat":String(u),"focus.point.lon":String(W),layers:N.join(","),size:"500","boundary.rect.min_lat":String(C.south),"boundary.rect.min_lon":String(C.west),"boundary.rect.max_lat":String(C.north),"boundary.rect.max_lon":String(C.east)}),Qe=`${this.GEOCODER_URL}/autocomplete?${Ee.toString()}`;console.log("📡 Entur API request:",Qe);const ve=await fetch(Qe,{headers:{"ET-Client-Name":this.CLIENT_NAME,Accept:"application/json"}});if(!ve.ok)throw new Error(`Entur API error: ${ve.status} ${ve.statusText}`);const St=await ve.json(),wt=this.parseEnturResponse(St,A);return this.cache.set(ie,{data:wt,timestamp:Date.now()}),console.log(`✅ Fetched ${wt.length} stops from Entur (${A.join(", ")})`),wt}catch(u){return console.error("❌ Error fetching Entur stops:",u),[]}}static parseEnturResponse(C,N){if(!C.features||!Array.isArray(C.features))return console.warn("⚠️ No features in Entur response"),[];const A=C.features.filter(X=>{const ie=X.properties?.category?.[0]||"";return N.some(z=>ie.toLowerCase().includes(z.toLowerCase()))}).map(X=>{const ie=X.properties,z=X.geometry?.coordinates;if(!z||z.length!==2)return null;let u="bus";const W=ie.category?.[0]||"",te=W.toLowerCase();te.includes("rail")||te.includes("station")?u="train":te.includes("tram")?u="tram":te.includes("metro")?u="metro":te.includes("ferry")&&(u="ferry");const xe=ie.label||ie.name||"Unnamed stop";return{id:ie.id||`entur_${z[1]}_${z[0]}`,name:xe,type:u,lat:z[1],lng:z[0],locality:ie.locality,category:W}}).filter(X=>X!==null);return console.log(`📊 Parsed ${A.length} valid stops from ${C.features.length} features`),A}static clearCache(){this.cache.clear(),console.log("🗑️ Entur cache cleared")}}class kg{flickrApiKey="2f0e634b471b9c9a74f47d3b2eb7a3f0";enableImageFetch=!0;IMAGE_SOURCES={nasjonalbiblioteket:{name:"Norwegian National Library",baseUrl:"https://api.nb.no",enabled:!0,priority:1},digitalt_museum:{name:"Digitalt Museum Norway",baseUrl:"https://api.dimu.org/api/solr/select",enabled:!0,priority:2},flickr:{name:"Flickr",baseUrl:"https://api.flickr.com/services/rest/",enabled:!0,priority:3},riksantikvaren:{name:"Riksantikvaren (Cultural Heritage)",baseUrl:"https://kulturminnebilder.ra.no",enabled:!1,priority:4}};async enhancePOI(C,N,A){console.log(`🏰 Enhancing Krigsminne POI: ${A} at [${C}, ${N}]`);try{if(!this.enableImageFetch)return console.log("⚠️ Image fetching disabled (invalid API keys). Returning empty enhancement data."),{};console.log(`📍 Only fetching geotagged images for specific coordinates [${C}, ${N}]`),console.log("📡 Starting comprehensive image fetch from multiple Norwegian sources...");const[X,ie,z]=await Promise.allSettled([this.fetchFlickrImages(C,N,A),this.fetchDigitaltMuseumImages(C,N,A),this.fetchNasjonalbibliotekImages(C,N,A)]),u=X.status==="fulfilled"?X.value:[],W=ie.status==="fulfilled"?ie.value:[],te=z.status==="fulfilled"?z.value:[];let xe=[...te||[],...W||[],...u||[]];console.log(`📊 Found ${xe.length} images: ${te?.length||0} Nasjonalbiblioteket + ${W?.length||0} Digitalt Museum + ${u?.length||0} Flickr`),xe.length===0&&(console.log(`📸 No geotagged images found from external APIs for specific location [${C}, ${N}]`),console.log("⚠️ Using only verified geotagged sources - no fallback images provided")),xe=xe.slice(0,6);const De={media:{thumbnails:xe}},we=xe.length>0,Ee={nasjonalbiblioteket:te?.length||0,digitalt_museum:W?.length||0,flickr:u?.length||0,curated:xe.length===(te?.length||0)+(W?.length||0)+(u?.length||0)?0:xe.length};return console.log(`✅ Enhanced Krigsminne POI with ${xe.length} images:`),console.log(`📊 Source breakdown: ${Ee.nasjonalbiblioteket} Nasjonalbiblioteket + ${Ee.digitalt_museum} Digitalt Museum + ${Ee.flickr} Flickr + ${Ee.curated} curated`),we&&console.log("📋 Final enhancement data:",De),De}catch(X){return console.error("❌ Error enhancing Krigsminne POI:",X),{}}}async fetchDigitaltMuseumImages(C,N,A){try{console.log(`🏛️ Searching Digitalt Museum for ${A}...`);const X=["krigsminne Norge","war memorial Norway","minnesmerke Norge","Oslo krigsminne","WWII Norway memorial"];for(const ie of X){console.log(`🔍 Digitalt Museum search: "${ie}"`);const z="https://api.dimu.org/api/solr/select",u=new URLSearchParams({q:ie,fq:'artifact.type:"Fotografi"',wt:"json",rows:"8",start:"0","api.key":"demo"}),W=await fetch(`${z}?${u.toString()}`);if(!W.ok){console.warn(`⚠️ Digitalt Museum API failed for "${ie}": ${W.status}`);continue}const te=await W.json();console.log(`📊 Digitalt Museum response for "${ie}":`,te);const xe=te.response?.docs||[];if(console.log(`🏛️ Found ${xe.length} items in Digitalt Museum for "${ie}"`),xe.length>0){const De=xe.filter(we=>we.artifact?.pictureUrl).slice(0,4).map(we=>({url:we.artifact.pictureUrl,title:we.artifact.title||"Historisk fotografi",source:"digitalt_museum",caption:we.artifact.description||"Fra Digitalt Museum",photographer:we.artifact.creator||"Ukjent fotograf"}));if(De.length>0)return console.log(`✅ Found ${De.length} suitable images from Digitalt Museum`),De}}return console.log("🏛️ No images found in Digitalt Museum after trying all queries"),[]}catch(X){return console.warn("⚠️ Digitalt Museum fetch error:",X),[]}}async fetchNasjonalbibliotekImages(C,N,A){try{console.log(`📚 Searching Norwegian National Library for ${A}...`);const X=["krigsminne Norge","war memorial Norway","minnesmerke andre verdenskrig","WWII monument Norway","norwegische kriegsdenkmäler"];for(const ie of X){console.log(`🔍 National Library search: "${ie}"`);try{console.log("📚 National Library API not yet implemented for this search")}catch(z){console.warn(`⚠️ National Library search failed for "${ie}":`,z)}}return console.log("📚 No images found in Norwegian National Library (API implementation pending)"),[]}catch(X){return console.warn("⚠️ Norwegian National Library fetch error:",X),[]}}async fetchFlickrImages(C,N,A){try{console.log(`📸 Fetching Flickr images for ${A}...`);const ie=A.split(" ").filter(u=>u.length>2).slice(0,2).join(" "),z=[{text:"Oslo historical norway monument",tags:"oslo,norway,historical,monument",radius:"20"},{text:"norway war memorial historical",tags:"norway,war,memorial,historical",radius:"25"},{text:"norway wwii memorial monument",tags:"norway,wwii,memorial,monument",radius:"30"}];for(const[u,W]of z.entries()){console.log(`📸 Trying Flickr search strategy ${u+1}: "${W.text}" (radius: ${W.radius}km)`);const te="https://api.flickr.com/services/rest/",xe=new URLSearchParams({method:"flickr.photos.search",api_key:this.flickrApiKey,lat:C.toString(),lon:N.toString(),radius:W.radius,text:W.text,tags:W.tags,tag_mode:"any",sort:"relevance",per_page:"20",format:"json",nojsoncallback:"1",extras:"url_t,url_s,url_m,description,date_taken,owner_name,tags",content_type:"1",media:"photos",safe_search:"1"}),De=`${te}?${xe.toString()}`;console.log(`🔗 Flickr API URL: ${De}`);const we=await fetch(De);if(!we.ok){console.warn(`⚠️ Flickr strategy ${u+1} failed: ${we.status}`);continue}const Ee=await we.json();console.log(`📊 Flickr strategy ${u+1} response:`,Ee);const Qe=Ee.photos?.photo||[];if(console.log(`📸 Strategy ${u+1} found ${Qe.length} photos`),Qe.length>0){const ve=Qe.filter(St=>St.url_t||St.url_s).slice(0,6).map(St=>({url:St.url_t||St.url_s||St.url_m,title:St.title||"Historisk bilde",source:"flickr",caption:St.description?._content||St.title||"Historisk fotografi fra området",year:St.datetaken?new Date(St.datetaken).getFullYear():void 0,photographer:St.ownername||"Ukjent fotograf"}));return console.log(`✅ Found ${ve.length} suitable Flickr images using strategy ${u+1}`),ve}}return console.log("📸 No Flickr images found after trying all strategies"),[]}catch(X){return console.error("❌ Flickr fetch error:",X),[]}}}const Cg=new kg,Eg=({children:re})=>{const[C,N]=Xe.useState(!1),[A,X]=Xe.useState(!1),te={isHurtigtasterOpen:C,isTegnforklaringOpen:A,openHurtigtaster:()=>{N(!0),X(!1)},closeHurtigtaster:()=>{N(!1)},openTegnforklaring:()=>{X(!0),N(!1)},closeTegnforklaring:()=>{X(!1)}};return D.jsx(zm.Provider,{value:te,children:re})},om=({isOpen:re,onClose:C,title:N,children:A,ariaLabelledBy:X,className:ie,showHeader:z=!0})=>{const u=Xe.useRef(null),W=Xe.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`),te=X||W.current,xe=X||(z?te:void 0);return Xe.useEffect(()=>{if(!re)return;const De=we=>{we.key==="Escape"&&C()};return document.addEventListener("keydown",De),()=>document.removeEventListener("keydown",De)},[re,C]),Xe.useEffect(()=>{if(!re)return;const De=document.body.style.overflow;document.body.style.overflow="hidden";const we=u.current;return we&&we.focus(),()=>{document.body.style.overflow=De}},[re]),Xe.useEffect(()=>{if(!re)return;const De=u.current;if(!De)return;const we=De.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),Ee=we[0],Qe=we[we.length-1],ve=St=>{St.key==="Tab"&&(St.shiftKey?document.activeElement===Ee&&(St.preventDefault(),Qe?.focus()):document.activeElement===Qe&&(St.preventDefault(),Ee?.focus()))};return De.addEventListener("keydown",ve),()=>De.removeEventListener("keydown",ve)},[re]),re?D.jsx("div",{className:"modal-backdrop",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:De=>{De.target===De.currentTarget&&window.innerWidth>=768&&C()},children:D.jsxs("div",{ref:u,role:"dialog","aria-modal":"true","aria-labelledby":xe,tabIndex:-1,className:ie,style:{backgroundColor:"white",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0,0,0,0.12)",width:"100%",maxWidth:ie?void 0:window.innerWidth<768?"340px":"500px",maxHeight:window.innerWidth<768?"85vh":"80vh",overflow:"hidden",display:"flex",flexDirection:"column",outline:"none",...window.innerWidth<768?{borderRadius:"12px"}:{}},onClick:De=>De.stopPropagation(),children:[z&&D.jsxs("div",{style:{padding:window.innerWidth<768?"16px":"28px",paddingBottom:window.innerWidth<768?"12px":"20px",display:"flex",alignItems:"center",justifyContent:"space-between",flexShrink:0},children:[D.jsx("h2",{id:te,style:{margin:0,fontSize:"20px",fontWeight:"600",color:"#111827"},children:N||""}),D.jsx("button",{onClick:C,style:{width:"32px",height:"32px",borderRadius:"8px",border:"none",backgroundColor:"rgba(0, 0, 0, 0.1)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",color:"#374151",transition:"background-color 0.2s ease"},onMouseEnter:De=>{De.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:De=>{De.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)"},onFocus:De=>{De.currentTarget.style.backgroundColor="#f8fafc",De.currentTarget.style.boxShadow="0 0 0 2px rgba(148, 163, 184, 0.1)"},onBlur:De=>{De.currentTarget.style.backgroundColor="rgba(0, 0, 0, 0.1)",De.currentTarget.style.boxShadow="none"},"aria-label":"Lukk modal",children:"×"})]}),D.jsx("div",{style:{padding:window.innerWidth<768?"0 16px 16px":"0 28px 28px",overflow:"auto",flex:1},children:A})]})}):null},Sm=[{action:"Panorér kart",tokens:["Dra finger"],isGesture:!0},{action:"Zoom inn/ut",tokens:["Knip"],isGesture:!0},{action:"Roter kart",tokens:["To fingre + vri"],isGesture:!0},{action:"Vipp kart",tokens:["To fingre + skyv opp/ned"],isGesture:!0},{action:"Zoom til punkt",tokens:["Dobbelttrykk"],isGesture:!0},{action:"Kopier koordinater fra kart",tokens:["Langt trykk"],isGesture:!0},{action:"Søk",tokens:["Ctrl","K"]},{action:"Åpne/lukk meny",tokens:["Ctrl","B"]},{action:"Avbryt/lukk",tokens:["Esc"]},{action:"Naviger søkeresultater",tokens:["↑","↓"]},{action:"Velg søkeresultat",tokens:["Enter"]},{action:"Fullfør søk",tokens:["Tab"]},{action:"Panorér kart",tokens:["Skyv"],isGesture:!0},{action:"Zoom inn/ut",tokens:["Rullehjul"],isGesture:!0},{action:"Zoom inn/ut (presis)",tokens:["Shift + rullehjul"],isGesture:!0},{action:"Zoom til område",tokens:["Shift + skyv"],isGesture:!0},{action:"Vipp og roter kart",tokens:["Ctrl + skyv"],isGesture:!0},{action:"Zoom til punkt",tokens:["Dobbeltklikk"],isGesture:!0},{action:"Kopier koordinater fra kart",tokens:["Ctrl + klikk"],isGesture:!0}],Ag=({token:re,isGesture:C})=>D.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"6px 8px",borderRadius:"6px",fontSize:"13px",fontFamily:C?"inherit":'ui-monospace, SFMono-Regular, "SF Mono", monospace',fontWeight:C?"normal":"500",minWidth:"2ch",backgroundColor:C?"transparent":"#f3f4f6",border:C?"1px dashed #9ca3af":"1px solid #e5e7eb",color:C?"#6b7280":"#374151",whiteSpace:"nowrap"},children:re}),zg=({shortcut:re})=>D.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:window.innerWidth<768?"8px 12px":"10px 16px",borderBottom:"1px solid #f3f4f6"},children:[D.jsx("span",{style:{fontSize:window.innerWidth<768?"14px":"15px",fontWeight:"500",color:"#111827"},children:re.action}),D.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:re.tokens.map((C,N)=>D.jsx(Ag,{token:C,isGesture:re.isGesture},N))})]}),Ig=({isOpen:re,onClose:C})=>{const N=Sm.slice(0,6),A=Sm.slice(6),X=window.innerWidth<768,ie=z=>D.jsx("div",{style:{borderRadius:"8px",border:"1px solid #e5e7eb",overflow:"hidden"},children:z.map((u,W)=>D.jsx("div",{style:{backgroundColor:"white",borderBottom:W<z.length-1?"1px solid #f3f4f6":"none"},children:D.jsx(zg,{shortcut:u})},W))});return D.jsx(om,{isOpen:re,onClose:C,title:"Handlinger og hurtigtaster",showHeader:!0,ariaLabelledBy:"hurtigtaster-title",children:D.jsx("div",{style:{margin:0,padding:0},children:ie(X?N:A)})})},Pg=[{id:"bygninger_tettbebyggelse",name:"Bygninger og tettbebyggelse",description:"Bygninger og tettbebyggelse",category:"bygninger_befolket_omrade",columnSide:"left",order:1,visual:{type:"fill",backgroundColor:[255,220,190],style:"solid"}},{id:"tettbebygget_omrade",name:"Tettbebygget område",description:"Tettbebygget område",category:"bygninger_befolket_omrade",columnSide:"left",order:2,visual:{type:"fill",backgroundColor:[247,190,140],style:"solid"}},{id:"spredt_bebyggelse_annet",name:"Spredt bebyggelse. Annet",description:"Spredt bebyggelse. Annet",category:"bygninger_befolket_omrade",columnSide:"left",order:3,visual:{type:"fill",backgroundColor:[255,220,190],pattern:"dots",style:"solid"}},{id:"gard_bolighus_hytte",name:"Gård, bolighus, hytte, seter",description:"Gård, bolighus, hytte, seter",category:"bygninger_befolket_omrade",columnSide:"left",order:4,visual:{type:"symbol",rgb:[0,0,0],shape:"square"}},{id:"naust_bu_annet_utfyllende",name:"Naust, bu. Annet, utfyllende m.v.",description:"Naust, bu. Annet, utfyllende m.v.",category:"bygninger_befolket_omrade",columnSide:"left",order:5,visual:{type:"point",rgb:[0,0,0],shape:"circle"}},{id:"andre_bygninger_verkshus",name:"Andre bygninger. Øvrige bygninger",description:"Andre bygninger. Øvrige bygninger",category:"bygninger_befolket_omrade",columnSide:"left",order:6,visual:{type:"mixed",rgb:[0,0,0]}},{id:"drivhus_verkshus_lager",name:"Drivhus, verkshus, lager. Større bygg med spesiell funksjon",description:"Drivhus, verkshus, lager. Større bygg med spesiell funksjon",category:"bygninger_befolket_omrade",columnSide:"left",order:7,visual:{type:"symbol",backgroundColor:[255,255,0],rgb:[0,0,0],shape:"square"}},{id:"veinummer_europavei",name:"Veinummer: Europavei",description:"Europavei rutenummer",category:"samferdsel",columnSide:"left",order:8,visual:{type:"symbol",backgroundColor:[0,128,0],rgb:[255,255,255]}},{id:"veinummer_stamvei",name:"Veinummer: Stamvei",description:"Stamvei rutenummer",category:"samferdsel",columnSide:"left",order:9,visual:{type:"symbol",backgroundColor:[255,0,0],rgb:[255,255,255]}},{id:"veinummer_annen_riksvei",name:"Veinummer: Annen riksvei",description:"Riksvei rutenummer",category:"samferdsel",columnSide:"left",order:10,visual:{type:"symbol",backgroundColor:[255,255,255],rgb:[0,0,0]}},{id:"europavei_riksvei_motorvei",name:"Europavei, riksvei - motorvei",description:"Europavei, riksvei med motorveistandard",category:"samferdsel",columnSide:"left",order:11,visual:{type:"line",rgb:[210,35,42],lineWidth:"4px",style:"solid"}},{id:"europavei_riksvei_adskilt_kjorebane",name:"Europavei, riksvei - adskilt kjørebane",description:"Europavei, riksvei med adskilt kjørebane",category:"samferdsel",columnSide:"left",order:12,visual:{type:"line",rgb:[210,35,42],lineWidth:"3px",style:"solid"}},{id:"europavei_riksvei",name:"Europavei, riksvei",description:"Europavei, riksvei",category:"samferdsel",columnSide:"left",order:13,visual:{type:"line",rgb:[210,35,42],lineWidth:"2px",style:"solid"}},{id:"fylkesvei",name:"Fylkesvei",description:"Fylkesvei",category:"samferdsel",columnSide:"left",order:14,visual:{type:"line",rgb:[210,35,42],lineWidth:"2px",style:"solid"}},{id:"kommunal_vei",name:"Kommunal vei",description:"Kommunal vei",category:"samferdsel",columnSide:"left",order:15,visual:{type:"line",rgb:[110,110,110],lineWidth:"1.5px",style:"solid"}},{id:"privat_vei_skogsbilvei",name:"Privat vei, skogsbilvei m.v.",description:"Privat vei, skogsbilvei",category:"samferdsel",columnSide:"left",order:16,visual:{type:"line",rgb:[110,110,110],lineWidth:"1px",style:"dashed"}},{id:"traktorvei",name:"Traktorvei",description:"Traktorvei",category:"samferdsel",columnSide:"left",order:17,visual:{type:"line",rgb:[156,156,156],lineWidth:"1px",style:"dashed"}},{id:"merket_sti_gang_sykkelvei",name:"Merket sti, gang-/sykkelvei",description:"Merket sti, gang- og sykkelvei",category:"samferdsel",columnSide:"left",order:18,visual:{type:"line",rgb:[195,30,40],lineWidth:"1px",style:"dashed"}},{id:"sti_gangvei",name:"Sti, gangvei",description:"Sti, gangvei",category:"samferdsel",columnSide:"left",order:19,visual:{type:"line",rgb:[195,30,40],lineWidth:"0.5px",style:"dashed"}},{id:"jernbane_enkelspor",name:"Jernbane: Enkelspor",description:"Jernbane med enkelspor",category:"samferdsel",columnSide:"left",order:20,visual:{type:"line",rgb:[0,0,0],lineWidth:"1px",style:"solid",pattern:"railway-single"}},{id:"jernbane_flerspor",name:"Jernbane: Flerspor",description:"Jernbane med flere spor",category:"samferdsel",columnSide:"left",order:21,visual:{type:"line",rgb:[0,0,0],lineWidth:"2px",style:"solid",pattern:"railway-multi"}},{id:"jernbane_stasjon",name:"Jernbane: Jernbanestasjon",description:"Jernbanestasjon",category:"samferdsel",columnSide:"left",order:22,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"jernbane_tunnel",name:"Jernbane: Tunnel",description:"Jernbanetunnel",category:"samferdsel",columnSide:"left",order:23,visual:{type:"line",rgb:[127,127,127],lineWidth:"1px",style:"dashed",pattern:"railway-tunnel"}},{id:"bru",name:"Bru",description:"Bru",category:"samferdsel",columnSide:"left",order:24,visual:{type:"line",rgb:[0,0,0],lineWidth:"2px",style:"solid"}},{id:"tunnel_vei",name:"Tunnel: Vei",description:"Veitunnel",category:"samferdsel",columnSide:"left",order:25,visual:{type:"line",rgb:[0,0,0],lineWidth:"2px",style:"dashed"}},{id:"bilferge",name:"Bilferge",description:"Bilfergerute",category:"samferdsel",columnSide:"left",order:26,visual:{type:"line",rgb:[194,31,41],lineWidth:"1px",style:"dashed"}},{id:"passasjerferje",name:"Passasjerferje",description:"Passasjerferge",category:"samferdsel",columnSide:"left",order:27,visual:{type:"symbol",rgb:[194,31,41],shape:"custom"}},{id:"flyplass",name:"Flyplass",description:"Flyplass",category:"samferdsel",columnSide:"left",order:28,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"helikopterplass",name:"Helikopterplass",description:"Helikopterlandingsplass",category:"samferdsel",columnSide:"left",order:29,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"kraftlinje_enkelinje",name:"Kraftlinje: Enkelinje",description:"Kraftoverføringslinje",category:"kraftlinje",columnSide:"left",order:30,visual:{type:"line",rgb:[0,0,0],lineWidth:"1px",style:"solid"}},{id:"kraftlinje_flere_linjer",name:"Kraftlinje: Flere linjer",description:"Kraftoverføringslinje med flere linjer",category:"kraftlinje",columnSide:"left",order:31,visual:{type:"line",rgb:[0,0,0],lineWidth:"2px",style:"solid",pattern:"parallel"}},{id:"vindmolle",name:"Vindmølle",description:"Vindkraftanlegg",category:"kraftlinje",columnSide:"left",order:32,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"industriomrade_fabrikk",name:"Industriområde, fabrikk",description:"Industriområde og fabrikkanlegg",category:"industri_anlegg",columnSide:"left",order:33,visual:{type:"fill",backgroundColor:[215,215,215],style:"solid"}},{id:"kraftstasjon_transformator",name:"Kraftstasjon, transformatorstasjon",description:"Kraftstasjon og transformator",category:"industri_anlegg",columnSide:"left",order:34,visual:{type:"symbol",rgb:[0,0,0],shape:"square"}},{id:"steinbrudd_grustak",name:"Steinbrudd, grustak",description:"Steinbrudd og grustakanlegg",category:"industri_anlegg",columnSide:"left",order:35,visual:{type:"fill",backgroundColor:[215,215,215],pattern:"rocks",style:"solid"}},{id:"spesiell_punktdetalj",name:"Spesiell punktdetalj",description:"Spesielle punktdetaljer",category:"industri_anlegg",columnSide:"left",order:36,visual:{type:"symbol",rgb:[252,247,215],backgroundColor:[252,247,215],shape:"circle"}},{id:"fyr_lykt",name:"Fyr, lykt",description:"Fyr og lykt for navigasjon",category:"industri_anlegg",columnSide:"left",order:37,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"mast_telekommunikasjon",name:"Mast for telekommunikasjon",description:"Telekommunikasjonsmast",category:"industri_anlegg",columnSide:"left",order:38,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"bygning_tank",name:"Bygning, tank",description:"Bygninger og tankanlegg",category:"industri_anlegg",columnSide:"left",order:39,visual:{type:"symbol",rgb:[0,0,0],shape:"circle"}},{id:"gruve_mine",name:"Gruve, mine",description:"Gruver og miner",category:"industri_anlegg",columnSide:"left",order:40,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"tarn",name:"Tårn",description:"Tårn og høye konstruksjoner",category:"industri_anlegg",columnSide:"left",order:41,visual:{type:"symbol",rgb:[0,0,0],shape:"triangle"}},{id:"park_idrettsplass",name:"Park, idrettsplass",description:"Parker og idrettsplasser",category:"arealbruk",columnSide:"left",order:42,visual:{type:"fill",backgroundColor:[155,185,60],style:"solid"}},{id:"gravplass",name:"Gravplass",description:"Gravplasser og kirkegårder",category:"arealbruk",columnSide:"left",order:43,visual:{type:"fill",backgroundColor:[155,185,60],style:"solid"}},{id:"alpinbakke_idrett",name:"Alpinbakke, idrettsanlegg",description:"Alpinbakker og idrettsanlegg",category:"arealbruk",columnSide:"left",order:44,visual:{type:"fill",backgroundColor:[155,185,60],style:"solid"}},{id:"campingplass",name:"Campingplass",description:"Campingplasser",category:"arealbruk",columnSide:"left",order:45,visual:{type:"symbol",rgb:[255,0,0],shape:"triangle"}},{id:"skytebane",name:"Skytebane",description:"Skytebaner",category:"arealbruk",columnSide:"left",order:46,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"turisthytte",name:"Turisthytte",description:"Turisthytter",category:"arealbruk",columnSide:"left",order:47,visual:{type:"symbol",rgb:[255,0,0],backgroundColor:[255,255,255],shape:"square"}},{id:"riksgrense",name:"Riksgrense",description:"Riksgrense",category:"administrative_grenser",columnSide:"right",order:50,visual:{type:"line",rgb:[190,90,190],lineWidth:"2px",style:"dashed"}},{id:"grunnlinje",name:"Grunnlinje",description:"Grunnlinje, territorialgrense",category:"administrative_grenser",columnSide:"right",order:51,visual:{type:"line",rgb:[210,115,60],lineWidth:"1px",style:"dashed"}},{id:"fylkesgrense",name:"Fylkesgrense",description:"Fylkesgrense",category:"administrative_grenser",columnSide:"right",order:52,visual:{type:"line",rgb:[180,135,255],lineWidth:"1px",style:"dashed"}},{id:"kommunegrense",name:"Kommunegrense",description:"Kommunegrense",category:"administrative_grenser",columnSide:"right",order:53,visual:{type:"line",rgb:[180,135,255],lineWidth:"0.5px",style:"dashed"}},{id:"statsallmenningsgrense",name:"Statsallmenningsgrense",description:"Statsallmenning",category:"administrative_grenser",columnSide:"right",order:54,visual:{type:"line",rgb:[0,0,0],lineWidth:"1px",style:"dashed"}},{id:"hydrografi_vann",name:"Hydrografi",description:"Vann og vassdrag",category:"hydrografi",columnSide:"right",order:55,visual:{type:"fill",backgroundColor:[224,255,255],rgb:[0,166,255]}},{id:"elv_bekk",name:"Elv, bekk",description:"Elver og bekker",category:"hydrografi",columnSide:"right",order:56,visual:{type:"line",rgb:[0,166,255],lineWidth:"1px",style:"solid"}},{id:"innsjokant",name:"Innsjøkant",description:"Innsjøkanter",category:"hydrografi",columnSide:"right",order:57,visual:{type:"line",rgb:[0,166,255],lineWidth:"1px",style:"solid"}},{id:"kanal_groft",name:"Kanal, grøft",description:"Kanaler og grøfter",category:"hydrografi",columnSide:"right",order:58,visual:{type:"line",rgb:[0,166,255],lineWidth:"0.5px",style:"solid"}},{id:"sno_isbre",name:"Snø- og isbre",description:"Snø og isbreer",category:"hydrografi",columnSide:"right",order:59,visual:{type:"fill",backgroundColor:[255,255,255],rgb:[0,166,255],style:"solid",pattern:"dotted"}},{id:"kystlinje",name:"Kystlinje",description:"Kystlinje",category:"kystlinje_terreng",columnSide:"right",order:60,visual:{type:"line",rgb:[0,166,255],lineWidth:"2px",style:"solid"}},{id:"terrenglinjer",name:"Terrenglinjer",description:"Høydekurver",category:"kystlinje_terreng",columnSide:"right",order:61,visual:{type:"line",rgb:[200,133,70],lineWidth:"1px",style:"solid"}},{id:"fjell_berg",name:"Fjell, berg",description:"Fjell og berg i dagen",category:"kystlinje_terreng",columnSide:"right",order:62,visual:{type:"fill",backgroundColor:[255,255,230],style:"solid"}},{id:"morene_ur",name:"Morene, ur",description:"Morener og ur",category:"kystlinje_terreng",columnSide:"right",order:63,visual:{type:"fill",backgroundColor:[215,215,215],pattern:"rocks",style:"solid"}},{id:"dyrka_mark",name:"Dyrka mark",description:"Dyrket mark og jordbruksareal",category:"vegetasjon",columnSide:"right",order:64,visual:{type:"fill",backgroundColor:[255,247,163],style:"solid"}},{id:"skog",name:"Skog",description:"Skog og skogområder",category:"vegetasjon",columnSide:"right",order:65,visual:{type:"fill",backgroundColor:[210,230,124],style:"solid"}},{id:"myr",name:"Myr",description:"Myr og våtmark",category:"vegetasjon",columnSide:"right",order:66,visual:{type:"fill",backgroundColor:[130,200,240],pattern:"lines",style:"solid"}},{id:"alpint_omrade",name:"Alpint område",description:"Alpine og høyfjellsområder",category:"vegetasjon",columnSide:"right",order:67,visual:{type:"fill",backgroundColor:[255,255,230],style:"solid"}},{id:"tettsted",name:"Tettsted",description:"Tettstedsområder",category:"bebyggelse_tjenester",columnSide:"right",order:68,visual:{type:"symbol",rgb:[247,128,128],backgroundColor:[247,128,128],shape:"circle"}},{id:"kirke",name:"Kirke",description:"Kirker og kapell",category:"bebyggelse_tjenester",columnSide:"right",order:69,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"sykehus",name:"Sykehus",description:"Sykehus og helseinstitusjoner",category:"bebyggelse_tjenester",columnSide:"right",order:70,visual:{type:"symbol",rgb:[255,0,51],backgroundColor:[255,255,255],shape:"custom"}},{id:"skole",name:"Skole",description:"Skoler og utdanningsinstitusjoner",category:"bebyggelse_tjenester",columnSide:"right",order:71,visual:{type:"symbol",rgb:[0,0,0],shape:"square"}},{id:"post_telefon",name:"Post, telefon",description:"Post- og telefonkontorer",category:"bebyggelse_tjenester",columnSide:"right",order:72,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"politi_brannstasjon",name:"Politi, brannstasjon",description:"Politi- og brannstasjoner",category:"bebyggelse_tjenester",columnSide:"right",order:73,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"monument_minnesmerke",name:"Monument, minnesmerke",description:"Monumenter og minnesmerker",category:"gjenstander",columnSide:"right",order:74,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"ruiner",name:"Ruiner",description:"Ruiner og historiske levninger",category:"gjenstander",columnSide:"right",order:75,visual:{type:"symbol",rgb:[0,0,0],shape:"custom"}},{id:"bru_konstruksjon",name:"Bru, konstruksjon",description:"Bruer og konstruksjoner",category:"gjenstander",columnSide:"right",order:76,visual:{type:"line",rgb:[0,0,0],lineWidth:"2px",style:"solid"}},{id:"dam_sluse",name:"Dam, sluse",description:"Dammer og sluser",category:"gjenstander",columnSide:"right",order:77,visual:{type:"line",rgb:[0,0,0],lineWidth:"2px",style:"solid"}},{id:"kai_molo",name:"Kai, molo",description:"Kaier og moloer",category:"gjenstander",columnSide:"right",order:78,visual:{type:"line",rgb:[0,0,0],lineWidth:"1px",style:"solid"}},{id:"tunnel_undergang",name:"Tunnel, undergang",description:"Tunneler og underganger",category:"gjenstander",columnSide:"right",order:79,visual:{type:"line",rgb:[0,0,0],lineWidth:"2px",style:"dashed"}}],Dg={bygninger_befolket_omrade:{name:"Bygninger og befolket område",description:"Bebyggelse og bygninger",columnSide:"left"},samferdsel:{name:"Samferdsel",description:"Veier, jernbaner og transport",columnSide:"left"},kraftlinje:{name:"Kraftlinje",description:"Kraftlinjer og energianlegg",columnSide:"left"},industri_anlegg:{name:"Industri og anlegg",description:"Industriområder og anlegg",columnSide:"left"},arealbruk:{name:"Arealbruk",description:"Forskjellige typer arealbruk",columnSide:"left"},administrative_grenser:{name:"Administrative grenser",description:"Grenser og områder",columnSide:"right"},hydrografi:{name:"Hydrografi",description:"Vann og vassdrag",columnSide:"right"},kystlinje_terreng:{name:"Kystlinje og terrengformer",description:"Kyst og terreng",columnSide:"right"},vegetasjon:{name:"Vegetasjon",description:"Vegetasjon og arealbruk",columnSide:"right"},bebyggelse_tjenester:{name:"Bebyggelse og tjenester",description:"Bebyggelse og offentlige tjenester",columnSide:"right"},gjenstander:{name:"Gjenstander",description:"Forskjellige objekter og konstruksjoner",columnSide:"right"}},Tm=re=>Pg.filter(C=>C.columnSide===re),Rg=re=>{const{visual:C}=re,N="24px",A={width:N,height:N,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",border:"1px solid #e5e7eb",borderRadius:"4px",backgroundColor:"#ffffff",flexShrink:0};switch(C.type){case"line":return D.jsx("div",{style:A,children:D.jsx("div",{style:{width:"80%",height:C.lineWidth?`${Math.max(1,parseInt(C.lineWidth)/2)}px`:"2px",backgroundColor:C.style==="dashed"||C.style==="dotted"?"transparent":C.rgb?`rgb(${C.rgb.join(",")})`:"#000",backgroundImage:C.style==="dashed"?`repeating-linear-gradient(to right, rgb(${C.rgb?.join(",")||"0,0,0"}) 0, rgb(${C.rgb?.join(",")||"0,0,0"}) 3px, transparent 3px, transparent 6px)`:C.style==="dotted"?`repeating-linear-gradient(to right, rgb(${C.rgb?.join(",")||"0,0,0"}) 0, rgb(${C.rgb?.join(",")||"0,0,0"}) 1px, transparent 1px, transparent 3px)`:C.pattern==="railway-single"?`repeating-linear-gradient(to right, transparent 0, transparent 2px, rgb(${C.rgb?.join(",")||"0,0,0"}) 2px, rgb(${C.rgb?.join(",")||"0,0,0"}) 3px)`:C.pattern==="railway-multi"?`repeating-linear-gradient(to right, transparent 0, transparent 1px, rgb(${C.rgb?.join(",")||"0,0,0"}) 1px, rgb(${C.rgb?.join(",")||"0,0,0"}) 2px, transparent 2px, transparent 3px)`:C.pattern==="parallel"?`repeating-linear-gradient(to right, rgb(${C.rgb?.join(",")||"0,0,0"}) 0, rgb(${C.rgb?.join(",")||"0,0,0"}) 1px, transparent 1px, transparent 2px)`:void 0}})});case"fill":return D.jsx("div",{style:{...A,backgroundColor:C.backgroundColor?`rgb(${C.backgroundColor.join(",")})`:"#ddd",border:C.rgb?`1px solid rgb(${C.rgb.join(",")})`:"1px solid #999",...C.pattern==="dots"&&{backgroundImage:`radial-gradient(circle at 3px 3px, rgba(0,0,0,0.3) 1px, transparent 1px),
                             radial-gradient(circle at 8px 8px, rgba(0,0,0,0.3) 1px, transparent 1px)`,backgroundSize:"12px 12px"}}});case"point":return D.jsx("div",{style:A,children:C.pattern==="rocks"?D.jsx("div",{style:{width:"100%",height:"100%",backgroundImage:`radial-gradient(circle at 3px 3px, rgb(${C.rgb?.join(",")||"100,100,100"}) 1px, transparent 1px),
                               radial-gradient(circle at 8px 8px, rgb(${C.rgb?.join(",")||"100,100,100"}) 1px, transparent 1px),
                               radial-gradient(circle at 15px 5px, rgb(${C.rgb?.join(",")||"100,100,100"}) 1px, transparent 1px)`,backgroundSize:"18px 12px"}}):C.shape==="circle"?D.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:C.rgb?`rgb(${C.rgb.join(",")})`:"#000"}}):D.jsx("div",{style:{width:"4px",height:"4px",backgroundColor:C.rgb?`rgb(${C.rgb.join(",")})`:"#000"}})});case"symbol":{const X=C.backgroundColor?`rgb(${C.backgroundColor.join(",")})`:void 0,ie=C.rgb?`rgb(${C.rgb.join(",")})`:"#000";return D.jsx("div",{style:A,children:C.shape==="square"?D.jsx("div",{style:{width:"10px",height:"10px",backgroundColor:X||ie,border:X?`1px solid ${ie}`:void 0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"5px",color:X?ie:"#fff"}}):C.shape==="circle"?D.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:X||ie,border:X?`1px solid ${ie}`:void 0}}):C.shape==="triangle"?D.jsx("div",{style:{width:"0",height:"0",borderLeft:"4px solid transparent",borderRight:"4px solid transparent",borderBottom:`6px solid ${ie}`}}):D.jsx("div",{style:{width:"8px",height:"8px",backgroundColor:ie}})})}default:return D.jsx("div",{style:A,children:D.jsx("div",{style:{width:"3px",height:"3px",backgroundColor:C.rgb?`rgb(${C.rgb.join(",")})`:"#000"}})})}},Lg=re=>{const C=Dg[re];return D.jsx("div",{style:{marginBottom:"12px",marginTop:"24px",paddingBottom:"8px",borderBottom:"2px solid #e5e7eb"},children:D.jsx("h3",{style:{margin:0,fontSize:"16px",fontWeight:"bold",color:"#111827",textTransform:"uppercase"},children:C.name})})},Mm=re=>{const C=re.reduce((N,A)=>(N[A.category]||(N[A.category]=[]),N[A.category].push(A),N),{});return Object.entries(C).map(([N,A])=>D.jsxs("div",{style:{marginBottom:"32px"},children:[Lg(N),D.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:A.map(X=>D.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"6px 0"},children:[Rg(X),D.jsx("div",{style:{flex:1},children:D.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:X.name})})]},X.id))})]},N))},jg=({isOpen:re,onClose:C})=>{const N=Tm("left").sort((X,ie)=>X.order-ie.order),A=Tm("right").sort((X,ie)=>X.order-ie.order);return D.jsx(om,{isOpen:re,onClose:C,title:"Tegnforklaring",ariaLabelledBy:"tegnforklaring-title",children:D.jsxs("div",{style:{display:"grid",gridTemplateColumns:window.innerWidth<768?"1fr":"1fr 1fr",gap:"32px"},children:[D.jsx("div",{children:Mm(N)}),D.jsx("div",{children:Mm(A)})]})})},Og=()=>{const{showAdminLogin:re,loginStatus:C,loginError:N,login:A,setShowAdminLogin:X,clearLoginError:ie}=sm(),[z,u]=Xe.useState(""),[W,te]=Xe.useState(!1);Xe.useEffect(()=>{re||(u(""),te(!1),ie())},[re,ie]);const xe=Xe.useCallback(()=>X(!1),[X]);Xe.useEffect(()=>{if(!re)return;const Ee=Qe=>{Qe.key==="Escape"&&xe()};return document.addEventListener("keydown",Ee),()=>document.removeEventListener("keydown",Ee)},[re,xe]);const De=async Ee=>{Ee.preventDefault(),z.trim()&&await A(z)},we=C==="loading";return D.jsxs("div",{className:"modal-backdrop",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(2px)",display:re?"flex":"none",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:Ee=>{Ee.target===Ee.currentTarget&&xe()},children:[D.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":"admin-login-heading",style:{width:"100%",maxWidth:"380px",backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"24px",position:"relative",boxShadow:"0 20px 32px rgba(0, 0, 0, 0.15)"},onClick:Ee=>Ee.stopPropagation(),children:[D.jsx("button",{type:"button",onClick:xe,style:{position:"absolute",top:"12px",right:"12px",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent",border:"none",borderRadius:"4px",color:"#64748b",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:Ee=>{Ee.currentTarget.style.backgroundColor="#f1f5f9",Ee.currentTarget.style.color="#334155"},onMouseLeave:Ee=>{Ee.currentTarget.style.backgroundColor="transparent",Ee.currentTarget.style.color="#64748b"},onFocus:Ee=>{Ee.currentTarget.style.backgroundColor="#f1f5f9",Ee.currentTarget.style.color="#334155",Ee.currentTarget.style.boxShadow="0 0 0 2px rgba(148, 163, 184, 0.1)"},onBlur:Ee=>{Ee.currentTarget.style.backgroundColor="transparent",Ee.currentTarget.style.color="#64748b",Ee.currentTarget.style.boxShadow="none"},"aria-label":"Lukk",children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px"},children:"close"})}),D.jsxs("div",{style:{marginBottom:"20px"},children:[D.jsx("h2",{id:"admin-login-heading",style:{fontSize:"18px",fontWeight:"600",color:"#334155",marginBottom:"4px",textAlign:"left"},children:"Admin innlogging"}),D.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:"0",lineHeight:"1.4"},children:"Skriv inn passordet for å få tilgang"})]}),D.jsxs("form",{onSubmit:De,style:{display:"flex",flexDirection:"column",gap:"16px"},children:[D.jsxs("div",{children:[D.jsx("label",{htmlFor:"admin-password",style:{display:"block",fontSize:"14px",fontWeight:"500",color:"#334155",marginBottom:"6px"},children:"Passord"}),D.jsxs("div",{style:{position:"relative"},children:[D.jsx("input",{id:"admin-password",type:W?"text":"password",value:z,onChange:Ee=>u(Ee.target.value),placeholder:"Skriv inn passord",style:{width:"100%",height:"40px",padding:"0 36px 0 12px",fontSize:"14px",border:"1px solid #e2e8f0",borderRadius:"6px",backgroundColor:"#ffffff",color:"#334155",transition:"all 0.2s ease",outline:"none"},onFocus:Ee=>{Ee.currentTarget.style.borderColor="#3e4533",Ee.currentTarget.style.boxShadow="0 0 0 2px rgba(62, 69, 51, 0.1)"},onBlur:Ee=>{Ee.currentTarget.style.borderColor="#e2e8f0",Ee.currentTarget.style.boxShadow="none"},disabled:we,autoFocus:!0,autoComplete:"current-password"}),D.jsx("button",{type:"button",onClick:()=>te(!W),style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"transparent",border:"none",color:"#64748b",cursor:"pointer",borderRadius:"4px",transition:"all 0.2s ease"},onMouseEnter:Ee=>{Ee.currentTarget.style.backgroundColor="#f1f5f9",Ee.currentTarget.style.color="#334155"},onMouseLeave:Ee=>{Ee.currentTarget.style.backgroundColor="transparent",Ee.currentTarget.style.color="#64748b"},disabled:we,tabIndex:-1,"aria-label":W?"Skjul passord":"Vis passord",children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px"},children:W?"visibility_off":"visibility"})})]})]}),N&&D.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"8px",padding:"12px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"6px",fontSize:"14px",color:"#dc2626"},role:"alert",children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#ef4444",marginTop:"1px",flexShrink:0},children:"error"}),D.jsx("p",{style:{margin:"0",lineHeight:"1.4"},children:N})]}),D.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"4px"},children:[D.jsx("button",{type:"button",onClick:xe,style:{flex:"1",height:"40px",padding:"0 16px",fontSize:"14px",fontWeight:"500",color:"#334155",backgroundColor:"#ffffff",border:"1px solid #e2e8f0",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s ease",outline:"none"},onMouseEnter:Ee=>{Ee.currentTarget.style.backgroundColor="#f8fafc",Ee.currentTarget.style.borderColor="#cbd5e1"},onMouseLeave:Ee=>{Ee.currentTarget.style.backgroundColor="#ffffff",Ee.currentTarget.style.borderColor="#e2e8f0"},onFocus:Ee=>{Ee.currentTarget.style.borderColor="#94a3b8",Ee.currentTarget.style.boxShadow="0 0 0 2px rgba(148, 163, 184, 0.1)"},onBlur:Ee=>{Ee.currentTarget.style.borderColor="#e2e8f0",Ee.currentTarget.style.boxShadow="none"},disabled:we,children:"Avbryt"}),D.jsx("button",{type:"submit",disabled:!z.trim()||we,className:"admin-login-button",style:{flex:"1",height:"40px",padding:"0 16px",fontSize:"14px",fontWeight:"500",color:"#ffffff",backgroundColor:!z.trim()||we?"#3e4533":"rgb(62, 69, 51)",border:`1px solid ${!z.trim()||we?"#3e4533":"rgb(62, 69, 51)"}`,borderRadius:"6px",cursor:z.trim()&&!we?"pointer":"not-allowed",transition:"all 0.2s ease",outline:"none",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},onMouseEnter:Ee=>{z.trim()&&!we&&(Ee.currentTarget.style.backgroundColor="rgb(45, 51, 39)",Ee.currentTarget.style.borderColor="rgb(45, 51, 39)")},onMouseLeave:Ee=>{z.trim()&&!we&&(Ee.currentTarget.style.backgroundColor="rgb(62, 69, 51)",Ee.currentTarget.style.borderColor="rgb(62, 69, 51)")},onFocus:Ee=>{z.trim()&&!we&&(Ee.currentTarget.style.boxShadow="0 0 0 2px rgba(62, 69, 51, 0.2)")},onBlur:Ee=>{Ee.currentTarget.style.boxShadow="none"},onMouseDown:Ee=>{z.trim()&&!we&&(Ee.currentTarget.style.backgroundColor="rgb(31, 34, 27)",Ee.currentTarget.style.borderColor="rgb(31, 34, 27)",Ee.currentTarget.style.transform="translateY(1px)")},onMouseUp:Ee=>{z.trim()&&!we&&(Ee.currentTarget.style.backgroundColor="rgb(45, 51, 39)",Ee.currentTarget.style.borderColor="rgb(45, 51, 39)",Ee.currentTarget.style.transform="none")},children:we?D.jsxs(D.Fragment,{children:[D.jsx("div",{style:{width:"14px",height:"14px",border:"2px solid transparent",borderTop:"2px solid #ffffff",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Logger inn..."]}):D.jsxs(D.Fragment,{children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px"},children:"login"}),"Logg inn"]})})]})]})]}),D.jsx("style",{children:`
        button.admin-login-button:not(:disabled) {
          background-color: rgb(62, 69, 51) !important;
          border-color: rgb(62, 69, 51) !important;
        }
        button.admin-login-button:not(:disabled):hover {
          background-color: rgb(45, 51, 39) !important;
          border-color: rgb(45, 51, 39) !important;
        }
        button.admin-login-button:not(:disabled):active {
          background-color: rgb(31, 34, 27) !important;
          border-color: rgb(31, 34, 27) !important;
        }
        button.admin-login-button:disabled,
        button.admin-login-button[disabled],
        button.admin-login-button[disabled="true"] {
          background-color: #3e4533 !important;
          border-color: #3e4533 !important;
          opacity: 1 !important;
        }
        /* High specificity override for all states */
        button.admin-login-button.admin-login-button {
          background-color: rgb(62, 69, 51) !important;
          border-color: rgb(62, 69, 51) !important;
        }
        button.admin-login-button.admin-login-button:disabled {
          background-color: #3e4533 !important;
          border-color: #3e4533 !important;
        }
      `})]})},nm={name:"",description:"",lat:0,lng:0,type:"",subcategory:"",source:"admin",website:"",phone:"",address:""},Bg=({onCategoryToggle:re,categoryState:C,onPOIAdded:N})=>{const{showAdminPanel:A,session:X,logout:ie,setShowAdminPanel:z,hasPermission:u}=sm(),[W,te]=Xe.useState("add"),[xe,De]=Xe.useState(nm),[we,Ee]=Xe.useState("idle"),[Qe,ve]=Xe.useState("");Xe.useEffect(()=>{A&&xe.lat===0&&xe.lng===0&&De(Rt=>({...Rt,lat:59.9139,lng:10.7522}))},[A,xe.lat,xe.lng]);const St=()=>{z(!1),De(nm),Ee("idle"),ve("")},wt=(Rt,vt)=>{De(Ft=>({...Ft,[Rt]:vt}))},jt=()=>{if(!xe.name.trim())return"Navn er påkrevd";if(!xe.description.trim())return"Beskrivelse er påkrevd";if(!xe.type)return"Kategori er påkrevd";if(xe.lat<-90||xe.lat>90)return"Ugyldig breddegrad";if(xe.lng<-180||xe.lng>180)return"Ugyldig lengdegrad";if(xe.website?.trim())try{new URL(xe.website.startsWith("http")?xe.website:`https://${xe.website}`)}catch{return"Ugyldig nettside URL"}return null},$t=async Rt=>{Rt.preventDefault();const vt=jt();if(vt){Ee("error"),ve(vt);return}if(!u(ug.POI_MANAGE)){Ee("error"),ve("Ingen tilgang til POI-administrasjon");return}Ee("saving"),ve("");try{const Ft=await Rm.addPOI({name:xe.name.trim(),description:xe.description.trim(),lat:xe.lat,lng:xe.lng,type:xe.type,subcategory:xe.subcategory??void 0,website:xe.website?.trim()??void 0,phone:xe.phone?.trim()??void 0,address:xe.address?.trim()??void 0,color:"#3b82f6"});Ft.success?(Ee("success"),ve("✅ POI lagret og kategorien er aktivert!"),re&&C&&xe.type&&(C.checked[xe.type]||(console.log(`🏷️ Auto-enabling category: ${xe.type}`),re(xe.type))),N&&N(),setTimeout(()=>{De(nm),Ee("idle"),ve("")},3e3)):(Ee("error"),ve(Ft.message))}catch(Ft){console.error("Error saving POI:",Ft),Ee("error"),ve("Feil ved lagring av POI")}},Fi=Tg();return A?D.jsxs(om,{isOpen:A,onClose:St,title:"",className:"max-w-4xl max-h-[95vh] overflow-hidden shadow-2xl",children:[D.jsx("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 p-6 mb-8 rounded-xl border border-green-200",children:D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsxs("div",{className:"flex items-center",children:[D.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mr-4",children:D.jsx("span",{className:"material-symbols-outlined text-white text-xl",children:"admin_panel_settings"})}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:"Admin Panel"}),D.jsxs("p",{className:"text-sm text-gray-600 flex items-center",children:[D.jsx("span",{className:"material-symbols-outlined text-green-500 text-sm mr-1",children:"verified"}),"Autentisert • Utløper ",X?new Date(X.expiresAt).toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"}):"Ukjent"]})]})]}),D.jsxs("button",{onClick:ie,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg transition-colors duration-200 flex items-center shadow-lg hover:shadow-xl",children:[D.jsx("span",{className:"material-symbols-outlined mr-2 text-lg",children:"logout"}),"Logg ut"]})]})}),D.jsxs("div",{className:"flex mb-8 bg-gray-100 rounded-xl p-1.5 shadow-inner",children:[D.jsxs("button",{onClick:()=>te("add"),className:`flex-1 px-6 py-3 text-sm font-semibold rounded-lg transition-all duration-200 flex items-center justify-center ${W==="add"?"bg-white text-blue-600 shadow-lg transform scale-[1.02]":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[D.jsx("span",{className:"material-symbols-outlined text-lg mr-2",children:"add_location"}),"Legg til POI"]}),D.jsxs("button",{onClick:()=>te("manage"),className:`flex-1 px-6 py-3 text-sm font-semibold rounded-lg transition-all duration-200 flex items-center justify-center ${W==="manage"?"bg-white text-blue-600 shadow-lg transform scale-[1.02]":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[D.jsx("span",{className:"material-symbols-outlined text-lg mr-2",children:"edit_location"}),"Administrer POI"]})]}),W==="add"&&D.jsx("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:D.jsxs("div",{className:"p-6",children:[D.jsxs("div",{className:"flex items-center mb-6",children:[D.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3",children:D.jsx("span",{className:"material-symbols-outlined text-blue-600",children:"add_location"})}),D.jsxs("div",{children:[D.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Nytt interessepunkt"}),D.jsx("p",{className:"text-sm text-gray-600",children:"Fyll ut informasjonen under for å legge til et nytt POI"})]})]}),D.jsxs("form",{onSubmit:$t,className:"space-y-6",children:[D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Navn *"}),D.jsxs("div",{className:"relative",children:[D.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:D.jsx("span",{className:"material-symbols-outlined text-gray-400 text-lg",children:"location_on"})}),D.jsx("input",{type:"text",value:xe.name,onChange:Rt=>wt("name",Rt.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 text-gray-900 placeholder-gray-500",placeholder:"F.eks. Preikestolen, Geirangerfjord"})]})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Kategori *"}),D.jsxs("div",{className:"relative",children:[D.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:D.jsx("span",{className:"material-symbols-outlined text-gray-400 text-lg",children:"category"})}),D.jsxs("select",{value:xe.type,onChange:Rt=>wt("type",Rt.target.value),className:"w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 appearance-none bg-white text-gray-900",children:[D.jsx("option",{value:"",className:"text-gray-500",children:"Velg underkategori for POI"}),Fi.map(Rt=>D.jsx("option",{value:Rt.isMainCategory?"":Rt.value,disabled:Rt.isMainCategory,className:Rt.isMainCategory?"font-semibold text-gray-900 bg-gray-100":"text-gray-700 pl-4",children:Rt.isMainCategory?`── ${Rt.label.toUpperCase()} ──`:Rt.label},Rt.value))]}),D.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:D.jsx("span",{className:"material-symbols-outlined text-gray-400 text-lg",children:"expand_more"})})]}),xe.type&&D.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex items-center",children:[D.jsx("span",{className:"material-symbols-outlined text-green-500 text-sm mr-1",children:"check_circle"}),Fi.find(Rt=>Rt.value===xe.type)?.mainCategoryName," kategori valgt"]})]})]}),D.jsxs("div",{className:"md:col-span-2",children:[D.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Beskrivelse *"}),D.jsxs("div",{className:"relative",children:[D.jsx("div",{className:"absolute top-3 left-3 pointer-events-none",children:D.jsx("span",{className:"material-symbols-outlined text-gray-400 text-lg",children:"description"})}),D.jsx("textarea",{value:xe.description,onChange:Rt=>wt("description",Rt.target.value),rows:4,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 text-gray-900 placeholder-gray-500 resize-none",placeholder:"Beskriv stedet, aktiviteter, fasiliteter og andre relevante detaljer..."})]})]}),D.jsx("div",{className:"md:col-span-2",children:D.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[D.jsxs("div",{className:"flex items-center mb-3",children:[D.jsx("span",{className:"material-symbols-outlined text-blue-600 mr-2",children:"my_location"}),D.jsx("h4",{className:"text-sm font-semibold text-blue-900",children:"Koordinater"})]}),D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Breddegrad (Latitude) *"}),D.jsx("input",{type:"number",step:"any",value:xe.lat,onChange:Rt=>wt("lat",parseFloat(Rt.target.value)||0),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 text-gray-900 font-mono",placeholder:"59.9139"})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lengdegrad (Longitude) *"}),D.jsx("input",{type:"number",step:"any",value:xe.lng,onChange:Rt=>wt("lng",parseFloat(Rt.target.value)||0),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 text-gray-900 font-mono",placeholder:"10.7522"})]})]}),D.jsxs("p",{className:"text-xs text-blue-700 mt-2 flex items-center",children:[D.jsx("span",{className:"material-symbols-outlined text-xs mr-1",children:"info"}),"Koordinater brukes for å plassere POI-et på kartet"]})]})}),D.jsxs("div",{className:"md:col-span-2",children:[D.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[D.jsx("span",{className:"material-symbols-outlined mr-2 text-gray-600",children:"tune"}),"Tilleggsinformasjon (valgfritt)"]}),D.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nettside"}),D.jsxs("div",{className:"relative",children:[D.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:D.jsx("span",{className:"material-symbols-outlined text-gray-400 text-lg",children:"language"})}),D.jsx("input",{type:"url",value:xe.website??"",onChange:Rt=>wt("website",Rt.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 text-gray-900 placeholder-gray-500",placeholder:"https://example.com"})]})]}),D.jsxs("div",{children:[D.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefon"}),D.jsxs("div",{className:"relative",children:[D.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:D.jsx("span",{className:"material-symbols-outlined text-gray-400 text-lg",children:"phone"})}),D.jsx("input",{type:"tel",value:xe.phone||"",onChange:Rt=>wt("phone",Rt.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 text-gray-900 placeholder-gray-500",placeholder:"+47 12 34 56 78"})]})]}),D.jsxs("div",{className:"md:col-span-2",children:[D.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adresse"}),D.jsxs("div",{className:"relative",children:[D.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:D.jsx("span",{className:"material-symbols-outlined text-gray-400 text-lg",children:"home"})}),D.jsx("input",{type:"text",value:xe.address||"",onChange:Rt=>wt("address",Rt.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-3 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-200 text-gray-900 placeholder-gray-500",placeholder:"Gateadresse, postnummer, sted"})]})]})]})]}),Qe&&D.jsx("div",{className:`p-4 rounded-lg animate-in slide-in-from-top-2 duration-300 ${we==="success"?"bg-green-50 border border-green-200":we==="error"?"bg-red-50 border border-red-200":"bg-blue-50 border border-blue-200"}`,children:D.jsxs("div",{className:"flex items-start",children:[D.jsx("span",{className:`material-symbols-outlined mr-3 flex-shrink-0 mt-0.5 ${we==="success"?"text-green-500":we==="error"?"text-red-500":"text-blue-500"}`,children:we==="success"?"check_circle":we==="error"?"error":"info"}),D.jsxs("div",{children:[D.jsx("h4",{className:`text-sm font-semibold mb-1 ${we==="success"?"text-green-800":we==="error"?"text-red-800":"text-blue-800"}`,children:we==="success"?"🎉 Suksess!":we==="error"?"Feil oppstod":"Informasjon"}),D.jsx("p",{className:`text-sm ${we==="success"?"text-green-700":we==="error"?"text-red-700":"text-blue-700"}`,children:Qe})]})]})}),D.jsxs("div",{className:"flex gap-4 pt-8 border-t border-gray-200",children:[D.jsxs("button",{type:"button",onClick:St,className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 focus:outline-none focus:ring-3 focus:ring-gray-500/20 transition-all duration-200",children:[D.jsx("span",{className:"material-symbols-outlined mr-2 text-lg",children:"close"}),"Lukk"]}),D.jsx("button",{type:"submit",disabled:we==="saving",className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-3 focus:ring-blue-500/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl",children:we==="saving"?D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Lagrer POI..."]}):D.jsxs(D.Fragment,{children:[D.jsx("span",{className:"material-symbols-outlined mr-2 text-lg",children:"save"}),"Lagre POI"]})})]})]})]})}),W==="manage"&&D.jsx("div",{className:"max-h-96 overflow-y-auto",children:D.jsxs("div",{className:"text-center py-8 text-gray-500",children:[D.jsx("span",{className:"material-symbols-outlined text-4xl mb-2",children:"construction"}),D.jsx("p",{children:"POI-administrasjon kommer snart"}),D.jsx("p",{className:"text-sm mt-1",children:"Funksjoner for redigering og sletting av eksisterende POI-er"})]})})]}):null},Ng=({onClose:re,onDismiss:C})=>{const[N,A]=Xe.useState(null),[X,ie]=Xe.useState("unknown"),[z,u]=Xe.useState("other");Xe.useEffect(()=>{const xe=navigator.userAgent.toLowerCase(),De=/iphone|ipad|ipod/.test(xe),we=/android/.test(xe),Ee=/safari/.test(xe)&&!/chrome/.test(xe),Qe=/chrome/.test(xe)&&!/edge/.test(xe),ve=/firefox/.test(xe),St=/edge/.test(xe)||/edg\//.test(xe);De?(ie("ios"),u(Ee?"safari":"other")):we?(ie("android"),Qe?u("chrome"):ve?u("firefox"):St&&u("edge")):ie("desktop");const wt=jt=>{jt.preventDefault(),A(jt)};return window.addEventListener("beforeinstallprompt",wt),()=>{window.removeEventListener("beforeinstallprompt",wt)}},[]);const W=async()=>{if(N){await N.prompt();const{outcome:xe}=await N.userChoice;console.log(`PWA install outcome: ${xe}`),A(null),re()}},te=()=>{C()};return D.jsx("div",{className:"install-prompt-overlay",onClick:re,children:D.jsxs("div",{className:"install-prompt-modal",onClick:xe=>xe.stopPropagation(),children:[D.jsxs("div",{className:"install-prompt-header",children:[D.jsx("div",{className:"install-prompt-icon",children:D.jsx("span",{className:"material-symbols-outlined",style:{color:"#3e4533",fontSize:"32px"},children:"forest"})}),D.jsx("button",{className:"install-prompt-close",onClick:re,"aria-label":"Lukk",children:D.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),D.jsx("h2",{className:"install-prompt-title",children:"Bruke Tråkke som app?"}),D.jsxs("div",{className:"install-prompt-instructions",children:[X==="ios"&&z==="safari"&&D.jsxs(D.Fragment,{children:[D.jsx("p",{className:"install-prompt-description",children:"Følg disse stegene:"}),D.jsxs("ol",{className:"install-prompt-steps",children:[D.jsxs("li",{children:[D.jsx("span",{className:"step-number",children:"1"}),D.jsx("div",{className:"step-content",children:D.jsxs("span",{className:"step-text",children:["Trykk på ",D.jsx("strong",{children:"de tre prikkene"})," nederst til høyre"]})})]}),D.jsxs("li",{children:[D.jsx("span",{className:"step-number",children:"2"}),D.jsx("div",{className:"step-content",children:D.jsxs("span",{className:"step-text",children:["Trykk ",D.jsx("strong",{children:"Del-ikonet"})]})})]}),D.jsxs("li",{children:[D.jsx("span",{className:"step-number",children:"3"}),D.jsx("div",{className:"step-content",children:D.jsxs("span",{className:"step-text",children:["Sveip opp og velg ",D.jsx("strong",{children:"«Legg til på Hjem-skjerm»"})]})})]}),D.jsxs("li",{children:[D.jsx("span",{className:"step-number",children:"4"}),D.jsx("div",{className:"step-content",children:D.jsxs("span",{className:"step-text",children:["Velg ",D.jsx("strong",{children:"«Åpne som nettapp»"})]})})]}),D.jsxs("li",{children:[D.jsx("span",{className:"step-number",children:"5"}),D.jsx("div",{className:"step-content",children:D.jsxs("span",{className:"step-text",children:["Trykk ",D.jsx("strong",{children:"«Legg til»"})," i høyre hjørne"]})})]})]}),D.jsxs("div",{className:"install-prompt-note",children:[D.jsx("span",{className:"material-symbols-outlined",children:"info"}),D.jsx("span",{children:"Dette fungerer kun i Safari på iOS"})]})]}),X==="ios"&&z!=="safari"&&D.jsxs(D.Fragment,{children:[D.jsxs("p",{className:"install-prompt-description",children:["For å installere Tråkke på din iPhone må du åpne denne siden i ",D.jsx("strong",{children:"Safari"}),"."]}),D.jsxs("div",{className:"install-prompt-note",children:[D.jsx("span",{className:"material-symbols-outlined",children:"info"}),D.jsx("span",{children:"Kopier lenken og åpne den i Safari-nettleseren"})]})]}),X==="android"&&N&&D.jsxs(D.Fragment,{children:[D.jsx("p",{className:"install-prompt-description",children:"Installer Tråkke for raskere tilgang og bedre ytelse"}),D.jsxs("button",{className:"install-prompt-install-btn",onClick:W,children:[D.jsx("span",{className:"material-symbols-outlined",children:"download"}),"Installer nå"]})]}),X==="android"&&!N&&D.jsxs(D.Fragment,{children:[D.jsx("p",{className:"install-prompt-description",children:"Følg disse stegene for å installere Tråkke:"}),D.jsxs("ol",{className:"install-prompt-steps",children:[D.jsxs("li",{children:[D.jsx("span",{className:"step-number",children:"1"}),D.jsx("div",{className:"step-content",children:D.jsxs("span",{className:"step-text",children:["Trykk på ",D.jsx("strong",{children:"meny-ikonet"})," (",D.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"16px",verticalAlign:"middle"},children:"more_vert"}),") øverst til høyre"]})})]}),D.jsxs("li",{children:[D.jsx("span",{className:"step-number",children:"2"}),D.jsx("div",{className:"step-content",children:D.jsxs("span",{className:"step-text",children:["Velg ",D.jsx("strong",{children:"«Legg til på startsiden»"})," eller ",D.jsx("strong",{children:"«Installer app»"})]})})]}),D.jsxs("li",{children:[D.jsx("span",{className:"step-number",children:"3"}),D.jsx("div",{className:"step-content",children:D.jsx("span",{className:"step-text",children:"Bekreft installasjonen"})})]})]})]}),X==="desktop"&&D.jsxs(D.Fragment,{children:[D.jsx("p",{className:"install-prompt-description",children:"Installer Tråkke for raskere tilgang og offline-støtte"}),N&&D.jsxs("button",{className:"install-prompt-install-btn",onClick:W,children:[D.jsx("span",{className:"material-symbols-outlined",children:"download"}),"Installer nå"]}),!N&&D.jsxs("div",{className:"install-prompt-note",children:[D.jsx("span",{className:"material-symbols-outlined",children:"info"}),D.jsx("span",{children:"Installasjon er tilgjengelig i Chrome, Edge og andre Chromium-baserte nettlesere"})]})]})]}),D.jsxs("div",{className:"install-prompt-footer",children:[D.jsx("button",{className:"install-prompt-dismiss-btn",onClick:te,children:"Ikke vis igjen"}),D.jsx("button",{className:"install-prompt-later-btn",onClick:re,children:"Kanskje senere"})]})]})})};function Fg(){const{isHurtigtasterOpen:re,isTegnforklaringOpen:C,closeHurtigtaster:N,closeTegnforklaring:A}=Im(),[X,ie]=Xe.useState({checked:{},expanded:{}}),[z,u]=Xe.useState(!0),[W,te]=Xe.useState(null),[xe,De]=Xe.useState("topo"),[we,Ee]=Xe.useState(null),[Qe,ve]=Xe.useState(null),[St,wt]=Xe.useState(!1),[jt,$t]=Xe.useState(0),[Fi,Rt]=Xe.useState(7),[vt,Ft]=Xe.useState(null),[wi,Ui]=Xe.useState(!1),[Ri,Yi]=Xe.useState(!0),[Ci,Vt]=Xe.useState([]),[Kt,qi]=Xe.useState(!1),[He,gt]=Xe.useState(new Set),[Ot,At]=Xe.useState(!1),[mi,be]=Xe.useState(!1),[Ye,yt]=Xe.useState([]),[kt,Ht]=Xe.useState(!1),[Gt,ei]=Xe.useState(null),[$i,vi]=Xe.useState(null),[Cn,_n]=Xe.useState(null),[Tr,En]=Xe.useState(!1),[zi,Bi]=Xe.useState([]),cn=Xe.useRef(null);Xe.useRef(new Pm);const Pa=Xe.useRef(new Mg),Ei=Xe.useRef(null);console.log(`🎯 MapLibre App: ${Ye.length} POIs loaded`);const An=Xe.useCallback(ze=>{te(null),setTimeout(()=>{te(ze),console.log("📍 Navigerer til:",ze.displayName)},50)},[]),Fn=Xe.useCallback(()=>{if(console.log("🔘 Position button clicked!"),console.log("🔘 Current userLocation state:",Qe),console.log("🔘 Current locationLoading state:",St),Qe&&!St){console.log("🔘 Toggling off - clearing user location"),ve(null);return}if(!navigator.geolocation){console.error("Geolocation is not supported by this browser");return}wt(!0),navigator.geolocation.getCurrentPosition(ze=>{const{latitude:Ke,longitude:pe}=ze.coords;console.log("📍 User location obtained:",Ke,pe),console.log("📍 Setting userLocation state...");const Me={north:72,south:57.5,east:32,west:4};Ke>=Me.south&&Ke<=Me.north&&pe>=Me.west&&pe<=Me.east?(ve({lat:Ke,lng:pe}),console.log("✅ Location set within Norway bounds:",{lat:Ke,lng:pe})):(console.warn("⚠️ Location outside Norway bounds, but setting regardless"),ve({lat:Ke,lng:pe}),console.log("✅ Location set outside Norway bounds:",{lat:Ke,lng:pe})),wt(!1),console.log("📍 Location loading set to false")},ze=>{switch(console.error("Error getting location:",ze.message),wt(!1),ze.code){case ze.PERMISSION_DENIED:console.error("Location access denied by user");break;case ze.POSITION_UNAVAILABLE:console.error("Location information unavailable");break;case ze.TIMEOUT:console.error("Location request timed out");break}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},[St,Qe]),Hr=Xe.useCallback(()=>{u(ze=>!ze)},[]);Xe.useEffect(()=>{const ze=Ke=>{if((Ke.ctrlKey||Ke.metaKey)&&Ke.key.toLowerCase()==="k"){Ke.preventDefault(),Ke.stopPropagation();const Me=document.activeElement?.closest("[data-search-box]");z?(u(!1),setTimeout(()=>{cn.current?.focusInput()},300)):Me?u(!0):cn.current?.focusInput()}else if(Ke.key==="Escape"){const pe=document.activeElement;pe?.closest("[data-search-box]")?(pe?.blur(),Ke.preventDefault()):z||(u(!0),Ke.preventDefault())}else(Ke.ctrlKey||Ke.metaKey)&&Ke.key.toLowerCase()==="b"&&(Ke.preventDefault(),Ke.stopPropagation(),Hr())};return document.addEventListener("keydown",ze),()=>{document.removeEventListener("keydown",ze)}},[z,Hr]),Xe.useEffect(()=>{(()=>{const Ke="pwa-install-dismissed",pe="pwa-installed",Me=navigator.userAgent.toLowerCase();if(!/iphone|ipad|ipod|android/.test(Me))return;if(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://")){localStorage.setItem(pe,"true");return}if(localStorage.getItem(pe))return;const ri=localStorage.getItem(Ke);if(ri&&(Date.now()-parseInt(ri))/864e5<7)return;const di=setTimeout(()=>{be(!0)},3e3);return()=>clearTimeout(di)})()},[]);const Qn=Xe.useCallback(()=>{be(!1)},[]),un=Xe.useCallback(()=>{localStorage.setItem("pwa-install-dismissed",Date.now().toString()),be(!1)},[]),dr=Xe.useCallback(ze=>{ie(Ke=>{const pe={...Ke.checked},ht=!Ke.checked[ze];pe[ze]=ht;const ot=(Ze,dt)=>{for(const Bt of Ze){if(Bt.id===dt)return Bt;if(Bt.children){const xt=ot(Bt.children,dt);if(xt)return xt}}return null},ri=ot(Dd,ze);if(ri){if(ri.children){const Ze=(dt,Bt)=>{dt.forEach(xt=>{pe[xt.id]=Bt,xt.children&&Ze(xt.children,Bt)})};Ze(ri.children,ht)}if(ri.parent){const Ze=ot(Dd,ri.parent);if(Ze?.children){const dt=Ze.children.every(xt=>pe[xt.id]),Bt=Ze.children.some(xt=>pe[xt.id]);dt?pe[ri.parent]=!0:Bt||(pe[ri.parent]=!1)}}}const di={...Ke,checked:pe};return console.log("🔄 Category toggle:",{nodeId:ze,isChecked:ht,newChecked:pe}),setTimeout(async()=>{const Ze=Se(di);if(console.log(`🏷️ Categories changed. Active categories: ${Ze.join(", ")}`),Ze.length===0){yt([]),console.log("🏷️ No categories selected, cleared POIs");return}if(we){console.log("📍 Current viewport:",we),Ht(!0),ei(null);try{let dt=[];if(Ze.includes("krigsminne")){console.log("🏰 Loading enhanced Krigsminne from OpenStreetMap with viewport:",we);const xt=await jc.fetchKrigsminnePOIs(we);console.log("📊 Raw Overpass POIs received:",xt.length,xt);const Si=await Ae(xt);dt=[...dt,...Si],console.log(`🏰 Loaded ${Si.length} enhanced Krigsminne POIs from OpenStreetMap`)}if(Ze.includes("hule")){console.log("🕳️ Loading cave entrances from OpenStreetMap with viewport:",we);const xt=await jc.fetchCaveEntrancePOIs(we);console.log("📊 Raw Cave POIs received:",xt.length,xt);const Si=Ge(xt);dt=[...dt,...Si],console.log(`🕳️ Loaded ${Si.length} cave entrance POIs from OpenStreetMap`)}if(Ze.includes("observasjonstårn")){console.log("🗼 Loading observation towers from OpenStreetMap with viewport:",we);const xt=await jc.fetchObservationTowerPOIs(we);console.log("📊 Raw Tower POIs received:",xt.length,xt);const Si=Ve(xt);dt=[...dt,...Si],console.log(`🗼 Loaded ${Si.length} observation tower POIs from OpenStreetMap`),console.log("🦌 Loading hunting stands from OpenStreetMap with viewport:",we);const Un=await jc.fetchHuntingStandPOIs(we);console.log("📊 Raw Hunting Stand POIs received:",Un.length,Un);const Zt=ct(Un);dt=[...dt,...Zt],console.log(`🦌 Loaded ${Zt.length} hunting stand POIs from OpenStreetMap`)}if(Ze.includes("bålplass")){console.log("🔥 Loading fire pits from OpenStreetMap with viewport:",we);const xt=await jc.fetchFirepitPOIs(we);console.log("📊 Raw Firepit POIs received:",xt.length,xt);const Si=_e(xt);dt=[...dt,...Si],console.log(`🔥 Loaded ${Si.length} fire pit POIs from OpenStreetMap`)}if(Ze.includes("gapahuk_vindskjul")){console.log("🏠 Loading shelters from OpenStreetMap with viewport:",we);const xt=await jc.fetchShelterPOIs(we);console.log("📊 Raw Shelter POIs received:",xt.length,xt);const Si=qt(xt);dt=[...dt,...Si],console.log(`🏠 Loaded ${Si.length} shelter POIs from OpenStreetMap`)}if(Ze.includes("tilfluktsrom")){console.log("🛡️ Loading tilfluktsrom from Geonorge WFS with viewport:",we);try{const xt=await Pa.current.fetchTilfluktsrom(we);console.log("📊 Raw Tilfluktsrom POIs received:",xt.length,xt);const Si=Ii(xt);dt=[...dt,...Si],console.log(`🛡️ Loaded ${Si.length} tilfluktsrom POIs from Geonorge WFS`)}catch(xt){console.error("❌ Error loading tilfluktsrom data:",xt),ei(`Feil ved lasting av tilfluktsrom: ${xt instanceof Error?xt.message:"Ukjent feil"}`)}}if(Ze.includes("bussholdeplass"))if(we.zoom>=10){console.log("🚌 Loading bus stops from Entur API with viewport:",we);try{const xt=await wm.fetchBusStops(we);console.log("📊 Raw bus stop data received:",xt.length,xt);const Si=zt(xt,"bus");dt=[...dt,...Si],console.log(`🚌 Loaded ${Si.length} bus stops from Entur API`)}catch(xt){console.error("❌ Error loading bus stops:",xt),ei(`Feil ved lasting av bussholdeplasser: ${xt instanceof Error?xt.message:"Ukjent feil"}`)}}else console.log("🚌 Skipping bus stops - zoom in to level 10 or higher (current: "+we.zoom+")");if(Ze.includes("togstasjon"))if(we.zoom>=8){console.log("🚂 Loading train stations from Entur API with viewport:",we);try{const xt=await wm.fetchTrainStations(we);console.log("📊 Raw train station data received:",xt.length,xt);const Si=zt(xt,"train");dt=[...dt,...Si],console.log(`🚂 Loaded ${Si.length} train stations from Entur API`)}catch(xt){console.error("❌ Error loading train stations:",xt),ei(`Feil ved lasting av togstasjoner: ${xt instanceof Error?xt.message:"Ukjent feil"}`)}}else console.log("🚂 Skipping train stations - zoom in to level 8 or higher (current: "+we.zoom+")");if(Ze.includes("taubane")){console.log("🚡 Loading cable cars from OpenStreetMap with viewport:",we);const xt=await jc.fetchCableCarPOIs(we);console.log("📊 Raw Cable Car POIs received:",xt.length,xt);const Si=oi(xt);dt=[...dt,...Si],console.log(`🚡 Loaded ${Si.length} cable car POIs from OpenStreetMap`)}if(Ze.includes("foss")){console.log("💧 Loading waterfalls from OpenStreetMap with viewport:",we);const xt=await jc.fetchWaterfallPOIs(we);console.log("📊 Raw Waterfall POIs received:",xt.length,xt);const Si=ki(xt);dt=[...dt,...Si],console.log(`💧 Loaded ${Si.length} waterfall POIs from OpenStreetMap`)}if(Ze.includes("utsiktspunkt")){console.log("👁️ Loading viewpoints from OpenStreetMap with viewport:",we);const xt=await jc.fetchViewpointPOIs(we);console.log("📊 Raw Viewpoint POIs received:",xt.length,xt);const Si=mr(xt);dt=[...dt,...Si],console.log(`👁️ Loaded ${Si.length} viewpoint POIs from OpenStreetMap`)}console.log("🏛️ Loading custom POIs for active categories:",Ze);const Bt=await Rm.getPOIsByCategories(Ze);Bt.length>0?(console.log(`📊 Loaded ${Bt.length} custom POIs:`,Bt),dt=[...dt,...Bt]):console.log("📭 No custom POIs found for active categories"),dt.length===0&&console.log("⚠️ No active categories with POI data:",Ze),console.log("🎯 Setting POIs on map:",dt),yt(dt),console.log(`🏷️ Loaded ${dt.length} total POIs for active categories: ${Ze.join(", ")}`)}catch(dt){console.error("❌ Error loading POIs:",dt),ei("Kunne ikke laste POI-data"),yt([])}finally{Ht(!1)}}else console.log("⚠️ No viewport available, skipping POI loading")},100),di})},[we]),fa=Xe.useCallback(ze=>{ie(Ke=>({...Ke,expanded:{...Ke.expanded,[ze]:!Ke.expanded[ze]}}))},[]),rn=Xe.useCallback(()=>{console.log("🔄 POI added, refreshing data..."),Se(X).length>0&&we&&ie(Ke=>({...Ke}))},[X,we]),st=Xe.useCallback(ze=>{console.log(`🗺️ Changing map type from ${xe} to ${ze}`),De(ze)},[xe]),Pt=Xe.useCallback(ze=>{Ee(ze),Rt(ze.zoom),console.log("🗺️ Viewport changed:",ze)},[]),Et=Xe.useCallback((ze,Ke=60.13)=>{const ht=156543.03392*Math.cos(Ke*Math.PI/180)/Math.pow(2,ze)*100;if(ht>=1e3){const ot=ht/1e3;return ot>=100?`${Math.round(ot/50)*50}km`:ot>=10?`${Math.round(ot/10)*10}km`:ot>=5?`${Math.round(ot/5)*5}km`:ot>=1?`${Math.round(ot)}km`:`${ot.toFixed(1)}km`}else return ht>=1e3?`${Math.round(ht/100)*100}m`:ht>=500?`${Math.round(ht/100)*100}m`:ht>=100?`${Math.round(ht/50)*50}m`:ht>=50?`${Math.round(ht/10)*10}m`:ht>=10?`${Math.round(ht/5)*5}m`:`${Math.round(ht)}m`},[]);Xe.useCallback(()=>xe==="topo"?18:17,[xe]);const ne=Xe.useCallback(ze=>{$t(ze)},[]),O=Xe.useCallback(ze=>{Ft(ze)},[]),F=Xe.useCallback(ze=>{Ui(ze),ze&&setTimeout(()=>Ui(!1),2e3)},[]),G=Xe.useCallback(ze=>{if(console.log("🥾 Trail selected:",ze.properties.name),vi(ze),En(!0),Ei.current){const Ke=Ei.current.getMap();if(Ke&&ze.geometry.coordinates.length>0){const pe=ze.geometry.coordinates,Me=pe.reduce((ot,ri)=>({north:Math.max(ot.north,ri[1]),south:Math.min(ot.south,ri[1]),east:Math.max(ot.east,ri[0]),west:Math.min(ot.west,ri[0])}),{north:pe[0][1],south:pe[0][1],east:pe[0][0],west:pe[0][0]}),ht=.01;Ke.fitBounds([[Me.west-ht,Me.south-ht],[Me.east+ht,Me.north+ht]],{padding:50,duration:1e3})}}},[]),ee=Xe.useCallback(ze=>{_n(ze)},[]),le=Xe.useCallback(()=>{En(!1),vi(null)},[]),fe=Xe.useCallback(ze=>{if(console.log("🥾 Trail types changed:",ze),Bi(ze),Ei.current){const Ke=Ei.current.getMap();Ke&&(["hiking","cycling","skiing","other"].forEach(Me=>{const ht=`turrutebasen-${Me}`;try{Ke.getLayer(ht)&&Ke.setLayoutProperty(ht,"visibility","none")}catch(ot){console.warn(`Could not hide trail layer ${ht}:`,ot)}}),ze.forEach(Me=>{const ht=`turrutebasen-${Me}`,ot=`turrutebasen-${Me}`;try{if(!Ke.getLayer(ht)){console.log(`🔄 Lazy loading trail layer: ${ht}`);const di=Np.getWMSLayerSources()[ot];di&&(Ke.getSource(ot)||(Ke.addSource(ot,di),console.log(`✅ Added trail source: ${ot}`)),Ke.addLayer({id:ht,type:"raster",source:ot,paint:{"raster-opacity":.8}}),console.log(`✅ Added trail layer: ${ht}`))}Ke.setLayoutProperty(ht,"visibility","visible"),console.log(`✅ Trail layer ${ht} enabled`)}catch(ri){console.warn(`Could not show trail layer ${ht}:`,ri)}}))}},[]),Pe=Xe.useCallback((ze,Ke)=>{if(console.log(`🌲 Naturskog layer ${ze} ${Ke?"enabled":"disabled"}`),gt(pe=>{const Me=new Set(pe);return Ke?Me.add(ze):Me.delete(ze),Me}),Ei.current){const pe=Ei.current.getMap();if(pe){const Me=`naturskog-${ze}`,ht=`naturskog-${ze}`;try{if(!pe.getLayer(Me)){console.log(`🔄 Lazy loading Naturskog layer: ${Me}`);const ot=Pf.getWMSLayerSources(),ri=Pf.getMapLayers(),di=ot[ht],Ze=ri.find(dt=>dt.id===Me);di&&Ze&&(pe.getSource(ht)||(pe.addSource(ht,di),console.log(`✅ Added Naturskog source: ${ht}`)),pe.addLayer(Ze),console.log(`✅ Added Naturskog layer: ${Me}`))}pe.setLayoutProperty(Me,"visibility",Ke?"visible":"none"),console.log(`✅ Naturskog layer ${ze} visibility set to ${Ke?"visible":"none"}`)}catch(ot){console.warn(`⚠️ Could not toggle Naturskog layer ${ze}:`,ot)}}}},[]);Xe.useEffect(()=>{if(!Ei.current)return;const ze=Ei.current.getMap();if(!ze)return;const Ke=()=>{console.log("🔄 Style changed, re-initializing active layers"),zi.length>0&&(console.log(`🥾 Re-adding ${zi.length} active trail layers`),fe(zi)),He.size>0&&(console.log(`🌲 Re-adding ${He.size} active Naturskog layers`),He.forEach(pe=>{Pe(pe,!0)}))};return ze.once("styledata",Ke),()=>{ze&&ze.off("styledata",Ke)}},[xe,zi,He,fe,Pe]);const Se=ze=>{const Ke=[];function pe(Me){ze.checked[Me.id]&&(Me.id==="krigsminne"?Ke.push("krigsminne"):Me.id==="hule"?Ke.push("hule"):Me.id==="observasjonstårn"?Ke.push("observasjonstårn"):Me.id==="bålplass"?Ke.push("bålplass"):Me.id==="gapahuk_vindskjul"?Ke.push("gapahuk_vindskjul"):Me.id==="tilfluktsrom"?Ke.push("tilfluktsrom"):Me.id==="bussholdeplass"?Ke.push("bussholdeplass"):Me.id==="togstasjon"&&Ke.push("togstasjon")),Me.children&&Me.children.forEach(pe)}return Dd.forEach(pe),Ke},Ae=async ze=>{console.log("🎨 Enhancing POIs with historical data and media...");const Ke=await Promise.all(ze.map(async pe=>{const Me={id:pe.id,name:gi(pe.name),description:gi(pe.tags.description)||"Krigsminne",type:"war_memorials",color:"#7c3aed",lat:pe.lat,lng:pe.lng};try{const ht=await Cg.enhancePOI(pe.lat,pe.lng,pe.name);ht&&Object.keys(ht).length>0&&(Me.enhancedData=ht,console.log(`✨ Enhanced ${pe.name} with rich data`))}catch(ht){console.warn(`⚠️ Could not enhance ${pe.name}:`,ht)}return Me}));return console.log("🔄 Transformed enhanced POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}${pe.enhancedData?" (ENHANCED)":""}`)),Ke},Ge=ze=>{const Ke=ze.map(pe=>({id:pe.id,name:gi(pe.name),description:gi(pe.tags.description)||"Hule",type:"nature_gems",color:"#7c3aed",lat:pe.lat,lng:pe.lng}));return console.log("🔄 Transformed Cave POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},Ve=ze=>{const Ke=ze.map(pe=>({id:pe.id,name:gi(pe.name),description:gi(pe.tags.description)||"Observasjonstårn",type:"viewpoints",color:"#7c3aed",lat:pe.lat,lng:pe.lng}));return console.log("🔄 Transformed Tower POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},ct=ze=>{const Ke=ze.map(pe=>{let Me=pe.name;(!Me||Me==="Jakttårn")&&(Me=pe.tags.place||pe.tags.addr_place||pe.tags.addr_city||pe.tags["name:place"]||"Jakttårn");const ht="Observasjonstårn",ot=[];pe.tags.hunting==="yes"&&ot.push("Jakttårn"),pe.tags.access&&ot.push(`Tilgang: ${nr(pe.tags.access)}`),pe.tags.height&&ot.push(`Høyde: ${pe.tags.height}m`);const ri=ot.length>0?`${ht}. ${ot.join(". ")}`:ht;return{id:pe.id,name:gi(Me),description:gi(ri),type:"viewpoints",lat:pe.lat,lng:pe.lng,color:"#7c3aed"}});return console.log("🔄 Transformed Hunting Stand POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},_e=ze=>{const Ke=ze.map(pe=>{let Me=pe.name;(!Me||Me==="Bål-/grillplass")&&(Me=pe.tags.place||pe.tags.addr_place||pe.tags.addr_city||pe.tags["name:place"]||"Bål-/grillplass");const ht="Bål-/grillplass",ot=[];pe.tags.fuel&&ot.push(`Brennstoff: ${nr(pe.tags.fuel)}`),pe.tags.access&&ot.push(`Tilgang: ${nr(pe.tags.access)}`),pe.tags.fee==="yes"&&ot.push("Avgift påkrevd"),pe.tags.fee==="no"&&ot.push("Gratis");const ri=ot.length>0?`${ht}. ${ot.join(". ")}`:ht;return{id:pe.id,name:gi(Me),description:gi(ri),type:"fire_places",lat:pe.lat,lng:pe.lng,color:"#3e4533"}});return console.log("🔄 Transformed Firepit POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},qt=ze=>{const Ke=ze.map(pe=>{let Me=pe.name;(!Me||Me==="Gapahuk/vindskjul")&&(Me=pe.tags.place||pe.tags.addr_place||pe.tags.addr_city||pe.tags["name:place"]||"Gapahuk/vindskjul");const ht="Gapahuk/vindskjul",ot=[];pe.tags.shelter_type&&ot.push(nr(pe.tags.shelter_type)),pe.tags.capacity&&ot.push(`Kapasitet: ${pe.tags.capacity} personer`),pe.tags.access&&ot.push(`Tilgang: ${nr(pe.tags.access)}`),pe.tags.fee==="yes"&&ot.push("Avgift påkrevd"),pe.tags.fee==="no"&&ot.push("Gratis");const ri=ot.length>0?`${ht}. ${ot.join(". ")}`:ht;return{id:pe.id,name:gi(Me),description:gi(ri),type:"wilderness_shelter",lat:pe.lat,lng:pe.lng,color:"#b45309"}});return console.log("🔄 Transformed Shelter POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},Ii=ze=>{const Ke=ze.map(pe=>({id:pe.id,name:gi(pe.name),description:gi(pe.tags.description??"Offentlig tilfluktsrom"),type:"emergency_shelters",lat:pe.lat,lng:pe.lng,color:"#ea580c"}));return console.log("🔄 Transformed Tilfluktsrom POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},zt=(ze,Ke)=>{const pe="#0284c7",Me=Ke==="bus",ht=ze.map(ot=>({id:ot.id,name:gi(ot.name),description:ot.locality?`${Me?"Bussholdeplass":"Togstasjon"} i ${ot.locality}`:Me?"Bussholdeplass":"Togstasjon",type:Me?"public_transport":"train_stations",lat:ot.lat,lng:ot.lng,color:pe}));return console.log(`🔄 Transformed ${Ke} stops:`,ht.map(ot=>`${ot.name} at [${ot.lat}, ${ot.lng}]`)),ht},oi=ze=>{const Ke=ze.map(pe=>{let Me=pe.name;(!Me||Me==="Taubane")&&(Me=pe.tags.place||pe.tags.addr_place||pe.tags.addr_city||pe.tags["name:place"]||"Taubane");const ht="Taubane",ot=[];pe.tags.aerialway==="cable_car"?ot.push("Kabelbane"):pe.tags.aerialway==="gondola"?ot.push("Gondol"):pe.tags.aerialway==="goods"&&ot.push("Godsbane"),pe.tags.access&&ot.push(`Tilgang: ${nr(pe.tags.access)}`),pe.tags.capacity&&ot.push(`Kapasitet: ${pe.tags.capacity}`);const ri=ot.length>0?`${ht}. ${ot.join(". ")}`:ht;return{id:pe.id,name:gi(Me),description:gi(ri),type:"cable_cars",lat:pe.lat,lng:pe.lng,color:"#0284c7"}});return console.log("🔄 Transformed Cable Car POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},ki=ze=>{const Ke=ze.map(pe=>{let Me=pe.name;(!Me||Me==="Foss")&&(Me=pe.tags.place||pe.tags.addr_place||pe.tags.addr_city||pe.tags["name:place"]||"Foss");const ht="Foss",ot=[];pe.tags.height&&ot.push(`Høyde: ${pe.tags.height}m`),pe.tags.intermittent==="yes"&&ot.push("Sesongavhengig");const ri=ot.length>0?`${ht}. ${ot.join(". ")}`:ht;return{id:pe.id,name:gi(Me),description:gi(ri),type:"nature_gems",lat:pe.lat,lng:pe.lng,color:"#7c3aed"}});return console.log("🔄 Transformed Waterfall POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},mr=ze=>{const Ke=ze.map(pe=>{let Me=pe.name;(!Me||Me==="Utsiktspunkt")&&(Me=pe.tags.place||pe.tags.addr_place||pe.tags.addr_city||pe.tags["name:place"]||"Utsiktspunkt");const ht="Utsiktspunkt",ot=[];pe.tags.ele&&ot.push(`Høyde: ${pe.tags.ele}moh`),pe.tags.direction&&ot.push(`Retning: ${pe.tags.direction}°`),pe.tags.access&&ot.push(`Tilgang: ${nr(pe.tags.access)}`);const ri=ot.length>0?`${ht}. ${ot.join(". ")}`:ht;return{id:pe.id,name:gi(Me),description:gi(ri),type:"viewpoints",lat:pe.lat,lng:pe.lng,color:"#7c3aed"}});return console.log("🔄 Transformed Viewpoint POIs:",Ke.map(pe=>`${pe.name} at [${pe.lat}, ${pe.lng}] - ${pe.description}`)),Ke},nr=ze=>({private:"privat",no:"ingen tilgang",yes:"offentlig tilgang",customers:"kun for kunder",permit:"kun med tillatelse",public:"offentlig",basic_hut:"enkel hytte",weather_shelter:"værbeskyttelse",rock_shelter:"bergskjul",lavvu:"lavvo",wood:"ved",charcoal:"kull",gas:"gass",electric:"elektrisk",unknown:"ukjent"})[ze.toLowerCase()]||ze,gi=ze=>ze&&ze.replace(/Ã¦/g,"æ").replace(/Ã¸/g,"ø").replace(/Ã¥/g,"å").replace(/Ã†/g,"Æ").replace(/Ã˜/g,"Ø").replace(/Ã…/g,"Å").replace(/â€"/g,"–").replace(/â€™/g,"'");return D.jsxs(D.Fragment,{children:[D.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `}),D.jsxs("div",{className:"app",style:{position:"relative",width:"100vw",height:"100vh",fontFamily:'Exo 2, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:[D.jsx("div",{className:"map-container",style:{width:"100vw",height:"100vh",position:"relative",zIndex:0},children:D.jsx(Jm,{ref:Ei,pois:Ye,categoryState:X,categoryTree:Dd,onCategoryToggle:dr,onExpandToggle:fa,onViewportChange:Pt,onBearingChange:ne,onCoordinatesChange:O,onCoordinatesCopied:F,searchResult:W,userLocation:Qe,sidebarCollapsed:z,mapType:xe,distanceMeasurements:Ci,onDistanceMeasurementUpdate:Vt,isDistanceMeasuring:Kt,onDistanceMeasuringChange:qi,activeTrailTypes:zi,onTrailSelect:G,onTrailHighlight:ee})}),D.jsx("div",{style:{position:"absolute",top:0,left:0,width:z?"0px":"340px",height:"100vh",transition:"width 0.3s cubic-bezier(0.4, 0, 0.2, 1)",overflow:"hidden",background:"linear-gradient(180deg, #ffffff 0%, #f8fafc 100%)",borderRight:"1px solid #e2e8f0",display:"flex",flexDirection:"column",zIndex:80,boxShadow:z?"none":"4px 0 20px rgba(0, 0, 0, 0.08)"},children:!z&&D.jsxs(D.Fragment,{children:[D.jsxs("div",{style:{padding:window.innerWidth<768?"44px 20px 20px":"24px 20px 20px",borderBottom:"1px solid rgba(226, 232, 240, 0.6)",backgroundColor:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(8px)"},children:[D.jsxs("h1",{style:{margin:"0 0 8px 0",fontSize:"24px",fontWeight:"600",color:"#3e4533",fontFamily:"Exo 2, sans-serif",display:"flex",alignItems:"center",gap:"8px"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"26px",color:"#3e4533",fontWeight:"400",fontVariationSettings:'"wght" 400'},children:"forest"}),"Tråkke"]}),D.jsx("p",{style:{margin:"-10px 0 8px 0",fontSize:"13px",color:"#6b7280",fontWeight:"400",lineHeight:"1.5",letterSpacing:"0.1px",fontStyle:"italic"},children:"Oppdag Norge med turskoa på"})]}),D.jsx("div",{style:{padding:"20px 20px 16px"},children:D.jsx(Dm,{ref:cn,onLocationSelect:An,pois:Ye,placeholder:"Hvor går turen?"})}),D.jsxs("div",{style:{flex:1,overflow:"auto",padding:"0 20px 0px",display:"flex",flexDirection:"column"},children:[D.jsx(tg,{categoryTree:Dd,categoryState:X,onCategoryToggle:dr,onExpandToggle:fa,pois:Ye,loading:kt,error:Gt,mapType:xe,onMapTypeChange:st}),D.jsx(rg,{onLayerToggle:Pe}),D.jsx(ig,{onTrailTypesChange:fe}),D.jsx(ng,{}),D.jsx(ag,{}),D.jsx(hg,{}),D.jsx("div",{style:{marginTop:"auto",marginBottom:"24px",padding:"16px 0 20px",textAlign:"left",borderTop:"1px solid rgba(241, 245, 249, 0.6)",background:"rgba(248, 250, 252, 0.8)",backdropFilter:"blur(8px)"},children:D.jsx("p",{style:{margin:"0",fontSize:"10px",color:"#94a3b8",fontWeight:"400",lineHeight:"1.5",letterSpacing:"0.2px",textTransform:"uppercase",opacity:.8},children:"Under utvikling • Sist oppdatert 22. okt 2025"})})]})]})}),D.jsx("button",{onClick:Hr,"aria-label":"Toggle sidebar navigation",className:"sidebar-toggle",tabIndex:2,style:{position:"absolute",left:z?"0":"340px",top:"50%",transform:"translateY(-50%)",zIndex:90,width:"32px",height:"48px",background:z?"rgba(255, 255, 255, 0.95)":"linear-gradient(180deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"0 8px 8px 0",border:"none",borderLeft:z?"none":"1px solid #e2e8f0",boxShadow:z?"2px 0 8px rgba(0, 0, 0, 0.1)":"none",backdropFilter:"blur(8px)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",marginLeft:z?"0":"-1px",outline:"none",WebkitTapHighlightColor:"transparent"},onMouseEnter:ze=>{ze.currentTarget.style.background=z?"rgba(255, 255, 255, 1.0)":"#ffffff"},onMouseLeave:ze=>{ze.currentTarget.style.background=z?"rgba(255, 255, 255, 0.95)":"linear-gradient(180deg, #ffffff 0%, #f8fafc 100%)"},onKeyDown:ze=>{(ze.key==="Enter"||ze.key===" ")&&(ze.preventDefault(),Hr())},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",color:"#555"},children:z?"chevron_right":"chevron_left"})}),Ri&&D.jsxs("div",{className:"map-controls",style:{position:"absolute",bottom:"24px",right:window.innerWidth<768?"3px":"11px",zIndex:100,display:"flex",flexDirection:"column",gap:"8px"},children:[D.jsx("button",{onClick:()=>Yi(!Ri),"aria-label":Ri?"Hide map controls":"Show map controls",style:{width:"44px",height:"44px",borderRadius:"8px",border:"none",backgroundColor:"rgba(255, 255, 255, 0.9)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.15)",transition:"all 0.2s ease",fontSize:"12px",color:"#374151"},onMouseEnter:ze=>{ze.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:ze=>{ze.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.9)"},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px",transform:Ri?"rotate(0deg)":"rotate(180deg)",transition:"transform 0.2s ease"},children:Ri?"visibility_off":"visibility"})}),D.jsxs("div",{style:{display:"flex",flexDirection:"column",background:"rgba(255, 255, 255, 0.9)",borderRadius:"8px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.15)"},children:[D.jsx("button",{"aria-label":"Zoom in",tabIndex:3,style:{width:"44px",height:"44px",background:"transparent",border:"none",borderBottom:"1px solid rgba(0, 0, 0, 0.1)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s ease",fontSize:"20px",fontWeight:"500",color:"#111827"},onMouseEnter:ze=>{ze.currentTarget.style.background="rgba(0, 0, 0, 0.05)"},onMouseLeave:ze=>{ze.currentTarget.style.background="transparent"},onClick:()=>{if(Ei.current){const ze=Ei.current.getMap();ze&&ze.zoomIn()}},children:D.jsx("span",{children:"+"})}),D.jsx("div",{style:{width:"44px",padding:"8px 4px",borderBottom:"1px solid rgba(0, 0, 0, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.02)"},children:D.jsx("span",{style:{fontSize:"9px",fontWeight:"500",color:"#374151",lineHeight:"1",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:Et(Fi,vt?.lat)})}),D.jsx("button",{"aria-label":"Zoom out",tabIndex:4,style:{width:"44px",height:"44px",background:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s ease",fontSize:"20px",fontWeight:"500",color:"#111827"},onMouseEnter:ze=>{ze.currentTarget.style.background="rgba(0, 0, 0, 0.05)"},onMouseLeave:ze=>{ze.currentTarget.style.background="transparent"},onClick:()=>{if(Ei.current){const ze=Ei.current.getMap();ze&&ze.zoomOut()}},children:D.jsx("span",{children:"−"})})]}),D.jsx("button",{"aria-label":St?"Getting location...":"Reset orientation and center on my location",tabIndex:5,disabled:St,style:{width:"44px",height:"44px",background:Qe||St?"#3e4533":"rgba(255, 255, 255, 0.9)",borderRadius:"8px",border:"none",boxShadow:"0 1px 3px rgba(0,0,0,0.15)",cursor:St?"wait":"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",opacity:St?.7:1},onMouseEnter:ze=>{St||(ze.currentTarget.style.transform="scale(1.05)",ze.currentTarget.style.background=Qe||St?"#2d3327":"#ffffff",ze.currentTarget.style.boxShadow="0 2px 6px rgba(0,0,0,0.25)")},onMouseLeave:ze=>{St||(ze.currentTarget.style.transform="scale(1.0)",ze.currentTarget.style.background=Qe||St?"#3e4533":"rgba(255, 255, 255, 0.9)",ze.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.15)")},onClick:()=>{Ei.current&&Ei.current.resetBearing(),Fn()},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"20px",color:Qe||St?"white":"#111827",transform:`rotate(${-jt}deg)`,transition:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)",animation:St?"spin 1s linear infinite":"none"},children:St?"sync":"navigation"})}),D.jsx("button",{"aria-label":Ei.current?.getMap()?Kt?"Finish distance measurement":"Start distance measurement":"Distance measurement",tabIndex:6,style:{width:"44px",height:"44px",background:Kt?"#3e4533":"rgba(255, 255, 255, 0.9)",borderRadius:"8px",border:"none",boxShadow:"0 1px 3px rgba(0,0,0,0.15)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},onMouseEnter:ze=>{ze.currentTarget.style.transform="scale(1.05)",ze.currentTarget.style.background=Kt?"#2d3327":"#ffffff",ze.currentTarget.style.boxShadow="0 2px 6px rgba(0,0,0,0.25)"},onMouseLeave:ze=>{ze.currentTarget.style.transform="scale(1.0)",ze.currentTarget.style.background=Kt?"#3e4533":"rgba(255, 255, 255, 0.9)",ze.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.15)"},onClick:()=>{Ei.current&&Ei.current.toggleDistanceMeasurement()},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"20px",color:Kt?"white":"#111827"},children:"straighten"})}),Ci.length>0&&D.jsx("button",{"aria-label":"Clear all distance measurements",tabIndex:7,style:{width:"44px",height:"44px",background:"rgba(255, 255, 255, 0.9)",borderRadius:"8px",border:"none",boxShadow:"0 1px 3px rgba(0,0,0,0.15)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},onMouseEnter:ze=>{ze.currentTarget.style.transform="scale(1.05)",ze.currentTarget.style.background="#ffffff",ze.currentTarget.style.boxShadow="0 2px 6px rgba(0,0,0,0.25)"},onMouseLeave:ze=>{ze.currentTarget.style.transform="scale(1.0)",ze.currentTarget.style.background="rgba(255, 255, 255, 0.9)",ze.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.15)"},onClick:()=>{Ei.current&&Ei.current.clearDistanceMeasurements()},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"20px",color:"#111827"},children:"clear_all"})}),D.jsx("button",{"aria-label":"Map information and credits",tabIndex:8,style:{width:"44px",height:"44px",background:"rgba(255, 255, 255, 0.9)",borderRadius:"8px",border:"none",boxShadow:"0 1px 3px rgba(0,0,0,0.15)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},onMouseEnter:ze=>{ze.currentTarget.style.transform="scale(1.05)",ze.currentTarget.style.background="#ffffff",ze.currentTarget.style.boxShadow="0 2px 6px rgba(0,0,0,0.25)"},onMouseLeave:ze=>{ze.currentTarget.style.transform="scale(1.0)",ze.currentTarget.style.background="rgba(255, 255, 255, 0.9)",ze.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.15)"},onClick:()=>At(!0),children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"20px",color:"#111827"},children:"info"})})]}),!Ri&&D.jsx("button",{onClick:()=>Yi(!0),"aria-label":"Show map controls",style:{position:"absolute",bottom:"24px",right:window.innerWidth<768?"3px":"11px",zIndex:101,width:"44px",height:"44px",borderRadius:"8px",border:"none",backgroundColor:"rgba(255, 255, 255, 0.9)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.15)",transition:"all 0.2s ease",fontSize:"12px",color:"#374151"},onMouseEnter:ze=>{ze.currentTarget.style.backgroundColor="#f8fafc"},onMouseLeave:ze=>{ze.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.9)"},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"16px"},children:"visibility"})}),Kt&&D.jsxs("div",{style:{position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",zIndex:100,backgroundColor:"#3e4533",color:"white",padding:"4px 6px",borderRadius:"4px",boxShadow:"0 1px 3px rgba(0,0,0,0.15)",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px",animation:"fadeIn 0.3s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',whiteSpace:"nowrap"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"14px"},children:"touch_app"}),D.jsx("span",{children:window.innerWidth<768?"Trykk på kartet for å måle":"Klikk på kartet for å måle avstand"})]}),wi&&D.jsxs("div",{style:{position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",zIndex:100,backgroundColor:"#3e4533",color:"white",padding:"4px 6px",borderRadius:"4px",boxShadow:"0 1px 3px rgba(0,0,0,0.15)",fontSize:"12px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px",animation:"fadeIn 0.3s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',whiteSpace:"nowrap"},children:[D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"14px"},children:"check_circle"}),D.jsx("span",{children:"Koordinater kopiert!"})]}),D.jsx("div",{className:"compass-container",style:{display:"none"},children:D.jsx("button",{"aria-label":"Reset map orientation to north",tabIndex:7,style:{width:"40px",height:"40px",background:"rgba(255, 255, 255, 0.95)",borderRadius:"6px",border:"none",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.15)",backdropFilter:"blur(8px)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background 0.2s ease"},onMouseEnter:ze=>ze.currentTarget.style.background="rgba(255, 255, 255, 1)",onMouseLeave:ze=>ze.currentTarget.style.background="rgba(255, 255, 255, 0.95)",onMouseDown:ze=>ze.currentTarget.style.background="rgba(0, 0, 0, 0.1)",onMouseUp:ze=>ze.currentTarget.style.background="rgba(255, 255, 255, 1)",onClick:()=>{Ei.current&&Ei.current.resetBearing()},onKeyDown:ze=>{(ze.key==="Enter"||ze.key===" ")&&(ze.preventDefault(),Ei.current&&Ei.current.resetBearing())},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"18px",color:"#555",display:"inline-block",transform:`rotate(${-jt}deg)`,transition:"transform 0.3s ease"},children:"navigation"})})})]}),D.jsx("style",{children:`
        /* Animations */
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateX(-50%) translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
          }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 767px) {

          .sidebar-toggle {
            width: 40px !important;
            height: 56px !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
          }

          .coordinate-display {
            bottom: 24px !important;
            left: 12px !important;
          }
        }

        /* Focus indicators for accessibility - only show on keyboard focus */
        .sidebar-toggle:focus-visible,
        .map-controls button:focus-visible {
          outline: 2px solid #9ca3af !important;
          outline-offset: 2px !important;
        }

        /* Remove focus outline on mouse click but keep for keyboard navigation */
        .sidebar-toggle:focus:not(:focus-visible),
        .map-controls button:focus:not(:focus-visible) {
          outline: none !important;
        }

        /* Touch targets - minimum 44px for mobile */
        @media (max-width: 767px) {
          .map-controls button {
            min-width: 44px !important;
            min-height: 44px !important;
          }
          
          .sidebar-toggle {
            min-width: 44px !important;
            min-height: 56px !important;
          }
        }

        /* Performance optimizations */
        .map-controls,
        .compass-container,
        .sidebar-toggle,
        .credits-container {
          will-change: transform;
        }
      `}),Ot&&D.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"16px"},onClick:()=>At(!1),children:D.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:window.innerWidth<768?"16px":"28px",maxWidth:window.innerWidth<768?"340px":"500px",width:"100%",boxShadow:"0 8px 32px rgba(0,0,0,0.12)",maxHeight:window.innerWidth<768?"85vh":"80vh",overflowY:"auto"},onClick:ze=>ze.stopPropagation(),children:[D.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:window.innerWidth<768?"12px":"20px"},children:[D.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:"600",color:"#111827"},children:"Datakilder"}),D.jsx("button",{onClick:()=>At(!1),style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},children:D.jsx("span",{style:{fontFamily:"Material Symbols Outlined",fontSize:"24px",color:"#6b7280"},children:"close"})})]}),D.jsxs("div",{style:{fontSize:window.innerWidth<768?"13px":"14px",color:"#374151",lineHeight:window.innerWidth<768?"1.5":"1.6"},children:[D.jsxs("p",{style:{marginTop:0},children:[D.jsx("strong",{children:"Karttype:"})," ",xe==="topo"?"Topografisk kart":"Satellittkart"]}),xe==="topo"?D.jsxs(D.Fragment,{children:[D.jsxs("p",{children:[D.jsx("strong",{children:"Kartdata fra Kartverket:"}),D.jsx("br",{}),"Topografiske kartdata leveres av Kartverket via WMTS-tjenesten. Kartverket er Norges offisielle kartmyndighet."]}),D.jsxs("p",{children:[D.jsx("strong",{children:"© Kartverket"}),D.jsx("br",{}),D.jsx("a",{href:"https://www.kartverket.no",target:"_blank",rel:"noopener noreferrer",style:{color:"#667154",textDecoration:"underline"},children:"www.kartverket.no"})]})]}):D.jsxs(D.Fragment,{children:[D.jsxs("p",{children:[D.jsx("strong",{children:"Satellittbilder fra Esri:"}),D.jsx("br",{}),"Satellittbildene leveres av Esri World Imagery og gir global dekning med høy oppløsning. Bildene er sammensatt fra flere kommersielle og offentlige kilder."]}),D.jsxs("p",{children:[D.jsx("strong",{children:"© Esri"}),D.jsx("br",{}),D.jsx("a",{href:"https://www.esri.com/en-us/arcgis/products/imagery/imagery-sources",target:"_blank",rel:"noopener noreferrer",style:{color:"#667154",textDecoration:"underline"},children:"Esri World Imagery"})]}),D.jsxs("p",{style:{fontSize:"12px",color:"#94a3b8",marginTop:"8px"},children:[D.jsx("strong",{children:"Merk:"})," Satellittbildene lastes fra servere i USA (arcgisonline.com). Din IP-adresse vil bli sendt til Esri for å hente kartfliser, i henhold til deres personvernregler."]})]}),D.jsxs("p",{children:[D.jsx("strong",{children:"Kategorier (POI-data) og kartlag:"}),D.jsx("br",{}),"Leveres fra flere kilder:"]}),D.jsxs("ul",{style:{marginTop:window.innerWidth<768?"6px":"8px",marginBottom:window.innerWidth<768?"8px":"12px",paddingLeft:"20px",lineHeight:window.innerWidth<768?"1.6":"1.8"},children:[D.jsxs("li",{children:[D.jsx("strong",{children:"Flere kategorier"})," – Fra OpenStreetMap, et brukerstyrt og gratis kartprosjekt som samler geografiske data og gjør dem tilgjengelig for alle",D.jsx("br",{}),D.jsx("a",{href:"https://www.openstreetmap.org/copyright",target:"_blank",rel:"noopener noreferrer",style:{color:"#667154",textDecoration:"underline",fontSize:"13px"},children:"© OpenStreetMap-bidragsytere"})]}),D.jsxs("li",{style:{marginTop:window.innerWidth<768?"6px":"8px"},children:[D.jsx("strong",{children:"Tilfluktsrom"})," – Datasett i Geonorges kartkatalog",D.jsx("br",{}),D.jsx("a",{href:"https://kartkatalog.geonorge.no/metadata/tilfluktsrom-offentlige/dbae9aae-10e7-4b75-8d67-7f0e8828f3d8",target:"_blank",rel:"noopener noreferrer",style:{color:"#667154",textDecoration:"underline",fontSize:"13px"},children:"© Direktoratet for samfunnssikkerhet og beredskap"})]}),D.jsxs("li",{style:{marginTop:window.innerWidth<768?"6px":"8px"},children:[D.jsx("strong",{children:"Bussholdeplass og togstasjon"})," – Fra Entur, Norges nasjonale register for kollektivtrafikk",D.jsx("br",{}),D.jsx("a",{href:"https://developer.entur.org",target:"_blank",rel:"noopener noreferrer",style:{color:"#667154",textDecoration:"underline",fontSize:"13px"},children:"© Entur"})]}),D.jsxs("li",{style:{marginTop:window.innerWidth<768?"6px":"8px"},children:[D.jsx("strong",{children:"Naturskog"})," – Datasett i Geonorges kartkatalog",D.jsx("br",{}),D.jsx("a",{href:"https://kartkatalog.geonorge.no/metadata/naturskog-v1/a0062ac4-8ee0-408f-9373-4c8b8c3088d8",target:"_blank",rel:"noopener noreferrer",style:{color:"#667154",textDecoration:"underline",fontSize:"13px"},children:"© Miljødirektoratet"})]}),D.jsxs("li",{style:{marginTop:window.innerWidth<768?"6px":"8px"},children:[D.jsx("strong",{children:"Turløype"})," – Datasett (turrutebasen) i Geonorges kartkatalog",D.jsx("br",{}),D.jsx("a",{href:"https://kartkatalog.geonorge.no/metadata/turrutebasen/d1422d17-6d95-4ef1-96ab-8af31744dd63?search=turrut",target:"_blank",rel:"noopener noreferrer",style:{color:"#667154",textDecoration:"underline",fontSize:"13px"},children:"© Kartverket"})]})]}),D.jsx("div",{style:{marginTop:window.innerWidth<768?"12px":"20px",padding:window.innerWidth<768?"8px":"12px",backgroundColor:"#f8fafc",borderRadius:"6px",border:"1px solid #e2e8f0"},children:D.jsxs("p",{style:{margin:0,fontSize:"13px",color:"#64748b"},children:[D.jsx("strong",{children:"I henhold til "}),D.jsx("a",{href:"https://data.norge.no/nlod/no/2.0",target:"_blank",rel:"noopener noreferrer",style:{color:"#667154",textDecoration:"underline"},children:"Norsk lisens for offentlige data (NLOD)"})]})})]})]})}),D.jsx(Ig,{isOpen:re,onClose:N}),D.jsx(jg,{isOpen:C,onClose:A}),mi&&D.jsx(Ng,{onClose:Qn,onDismiss:un}),Tr&&D.jsx(dg,{trail:$i,onClose:le}),D.jsx(Og,{}),D.jsx(Bg,{onCategoryToggle:dr,categoryState:X,onPOIAdded:rn})]})}function Ug(){return D.jsx(Eg,{children:D.jsx(Fg,{})})}console.log("🚀 Loading MapLibre TrakkeApp with Kartverket official landtopo vector tiles...");try{const re=document.getElementById("root");re?(console.log("✅ Found root element, creating React root..."),Gm.createRoot(re).render(D.jsx(Ug,{})),console.log("✅ MapLibre TrakkeApp with Kartverket landtopo should be rendered")):console.error("❌ Could not find root element")}catch(re){console.error("❌ Error rendering MapLibre TrakkeApp:",re)}
